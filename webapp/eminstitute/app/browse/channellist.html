#set($libraryid = $context.getRequestParameter("libraryid"))
#if(!$libraryid)
	#set($libraryid= "*")
#else
	#set( $library = $mediaarchive.getData("library",$libraryid) ) 
#end

<div id="projectresultholder">
	<div class="contentcolumn">
		
##	#if($libraryid == "*")
##		#set($hits = $mediaarchive.query("librarycollection").all().sort("name").search($context))
##	#elseif( $libraryid == "subscriptions")
##		#set($hits = $mediaarchive.getProjectManager().listCollectionsForFollower($user))
##	#else
##		#set($hits = $mediaarchive.query("librarycollection").exact("library",$libraryid).sort("name").search($context))
##	#end
	
	
	<div class="clearfix"></div>
	
	<div class="project-grid ">
	#set($libraries = $mediaarchive.getList("library"))
	#foreach( $library in $libraries)
		#set($libraryid = $library.getId())
		#set($collectivehits = $mediaarchive.query("librarycollection").exact("library",$libraryid).sort("name").search($context))
		#set( $n = $collectivehits.setHitsPerPage(75))
		<div class="stations-grid ">
			<h3>$library.getName()</h3>
			#foreach( $ohit in $collectivehits.getPageOfHits() )
				#set($link = false) 
				#if($ohit.assetportrait)
					#set($asset = $mediaarchive.getAsset($ohit.assetportrait))
					#set($link = $mediaarchive.asLinkToPreview($asset,"image200x200.jpg"))
				#elseif($ohit.assetbanner)
					#set( $banner = $mediaarchive.getAsset($ohit.assetbanner) )
					#set($link = $mediaarchive.asLinkToPreview($banner,"image200x200.jpg"))
				#end
				<a href="$applink/collective/about/${ohit.id}/${ohit.getName().replaceAll(" ", "-")}.html" 
					class="project-title" title="$!ohit.collectivedescription">
				<div class="project-item" style='#if($link) background-image: url("#uuencode($link)") #end; min-width:313px;'>
				<div class="project-item-box">
					<span>$ohit.name</span>
				</div>
				</div>
				</a>
			#end
		<div class="clearfix"></div>
		</div>
		
	#end
	
	</div>
	
	
	#if($hits.getPages() > 1 )
		[[Next page]]
	#end
	</div>
</div>


