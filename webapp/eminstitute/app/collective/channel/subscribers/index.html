#set($collectionid = $librarycol.getId())
<div id="subscriberssidebar">
<div class="subscribe-area">
	#if( $user )
		#set( $likesearcher = $mediaarchive.getSearcher("librarycollectionlikes") )
		#set( $liked = $likesearcher.query().exact("followeruser",$user.getId()).exact("collectionid",$collectionid).searchOne() )

		#if ($liked)
			<div class="subscribe-title">
				 <a href="$applink/collective/channel/subscribers/unsubscribe.html?id=${liked.getId()}&collectionid=$librarycol.getId()" 
					class="btn subscribe-btn">[[Liked]]</a>
			</div>
		#else
			<form name="saveproject" id="saveproject" class="ajaxform" data-targetdiv="subscriberssidebar" action="$applink/collective/channel/subscribers/addsave.html" method="post">
			<input type="hidden" name="save" value="true" />
			
			<input type="hidden" name="teamuserid" value="$user.getId()" />
			<input type="hidden" name="field" value="addeddate" />
			<input type="hidden" name="addeddate.value" value="$storeddate" />
			<input type="hidden" name="field" value="collectionid" />
			<input type="hidden" name="collectionid.value" value="$collectionid" />
			<input type="hidden" name="collectionid" value="$collectionid" />
			<input type="submit" class="btn subscribe-btn" value="[[Like]]" />
			</form>
		#end
	#else
		#set($loginok = "$applink/collective/about/$collectionid/${librarycol.getWebName()}.html")
		<a href="$applink/authentication/login.html?loginokpage=$!loginok" class="btn subscribe-btn">[[Login to Like]]</a>
	#end	
	
	<div class="subscribe-headline">
		#if( $caneditcollection)
		<a class="oe-dataedit showeditonright" data-target="#editjoincollectivetext-$librarycol.id" title="[[Edit Join Collective Text]]" data-width="500"	href="#"><i class="fas fa-edit"></i></a>
		#end
		<div class="oe-editable" id="editjoincollectivetext-$librarycol.id" data-dataid="$librarycol.id" data-field="joincollectivetext" data-searchtype="librarycollection">
   		#if($librarycol.joincollectivetext) 
			$!librarycol.joincollectivetext
		#end
		</div>
	</div>	

<div class="subscribers-box">
<div class="subscribers-box-box">
<a class="emdialog" data-cancelsubmit="true" title="View Subscribers" href="$applink/collective/channel/subscribers/subscriberslist.html?collectionid=$librarycol.getId()">
	<div class="box-content" style="border-right:1px solid #ddd">
	<strong>[[Likes]]</strong>
	#set( $subscribers = $mediaarchive.query("librarycollectionusers").exact("collectionid",$collectionid).search($context) )
	<div class="box-number">$subscribers.size()</div>
	</div>
</a>	
</div> 
<div class="subscribers-box-box">
<a class="emdialog" title="[[Share]]" href="$applink/components/share/embed.html?collectionid=$librarycol.id">
	<div class="box-content">
	<strong>[[Share]]</strong>
	<div class="box-icons">
		<i class="fas fa-envelope"></i>
	</div>
	</div>
</div>  
</a>
<div class="clearfix"></div>
</div>

</div>

#if($librarycol.collectivedescription)
	<div class="collectivedescription">
	#esc($librarycol.collectivedescription)
	</div>
#end
#if ($librarycol.facebooklink)
		<a href="https://www.facebook.com/${librarycol.facebooklink}"><i class="fab fa-facebook-f"></i></a>
#end
#if ($librarycol.socialinstagram)
	<a href="https://www.facebook.com/${librarycol.instagramlink}"><i class="fab fa-instagram"></i></a>
#end

<div class="subscribesidebarbox">

<h4><i class="fas fa-users"></i> [[Team]]</h4>

#set( $team = $mediaarchive.query("librarycollectionusers").exact("collectionid",$collectionid).exact("ontheteam",true).search($context) )
	
#if( $team.isEmpty()) 
	<p>[[No Team yet]]</p>
#else
<div class="row no-gutters" style="margin-bottom:1rem;">
  #foreach( $hit in $team)
	
  	#set( $followeruser = $mediaarchive.getUser($hit.followeruser) )
    #set( $userlink = "$applink/users/${followeruser.getId()}/${followeruser.getAnonNickName()}.html")
	#set( $userimageurl = $mediaarchive.asLinkToProfile($followeruser.assetportrait) )
	#if(!$userimageurl)
		#set( $userimageurl = "$applink/theme/images/user.svg" )
	#end

	<div class="col-md-6" >
	  <div class="teammember">
	  	
	  	<div style="position: absolute; width:40px;">
		<a href="#esc($userlink)" style="display:inline-block; height:40px">
		<img  src="${userimageurl}"  title="$!followeruser.getAnonNickName()" class="img-fluid align-middle usericon" 
			style="position:relative; top:50%; transform: translateY(-50%);"></a>
		</div>
	  	<div style="margin-left:40px; height:40px; position:relative;">
	    <div style="position:relative; top:50%; transform: translateY(-50%);">
	    	<a href="#esc($userlink)" title="$!followeruser.getAnonNickName()">$!followeruser.getAnonNickName()</a></div> 
	   	<div>
	        </div>
		<i></i>
	    </div>
	    
	  </div>
	</div>
  #end
	</div>
	
#end
#if($user)
#set( $onteam = $mediaarchive.query("librarycollectionusers").exact("followeruser",$user.getId()).exact("collectionid",$collectionid).exact("ontheteam",true).search($context) )
#if(!$onteam)

			<p>
			[[Join the team to contribute]]
			</p> 

<form name="saveproject" id="saveproject" class="ajaxform" data-targetdiv="subscriberssidebar" action="$applink/collective/channel/subscribers/teamsave.html" method="post" style="padding-bottom:5px">
			<input type="hidden" name="save" value="true" />
			<input type="hidden" name="field" value="followeruser" />
			<input type="hidden" name="followeruser.value" value="$user.getId()" />
			
			<input type="hidden" name="field" value="addeddate" />
			<input type="hidden" name="addeddate.value" value="$storeddate" />
			<input type="hidden" name="field" value="collectionid" />
			<input type="hidden" name="collectionid.value" value="$collectionid" />
			<input type="hidden" name="collectionid" value="$collectionid" />
			<input type="hidden" name="field" value="ontheteam" />
			<input type="hidden" name="ontheteam.value" value="true" />
			<input type="submit" class="btn btn-success" value="[[Join Team]]" />
</form>
#end
#end
	#if( $caneditcollection)
	<div class="pull-right" style="text-align:center;">
	<a href="$applink/collective/channel/subscribers/usersearch.html?collectionid=${collectionid}" class="emdialog btn-gray btn btn-sm" title="[[Search Users]]">
	<i class="fas fa-search"></i> [[Add Member]]
	</a>
	</div>
	#end


#set( $donations = $mediaarchive.query("transaction").exact("collectionid",$collectionid).sort("paymentdate").search($context) )
	
<h3>[[Recent Donations]]</h3>
#if( !$donations.isEmpty() )
<table>
	#foreach($transaction in $donations)
		#if ($transaction.userid)
	 	#set( $selecteduser = $mediaarchive.getUser($transaction.userid) )
		#set( $userlink = "$applink/users/${selecteduser.getId()}/${selecteduser.getAnonNickName()}.html")
		#set( $userimageurl = $mediaarchive.asLinkToProfile($selecteduser.assetportrait) )
		#if(!$userimageurl)
			#set( $userimageurl = "$applink/theme/images/user.svg" )
		#end
		<tr>
			<td style="width:40px">
$!context.getDateTime($transaction.paymentdate)
			</td>
			<td> 
			<span style="font-size:1rem"><strong>$$transaction.totalprice</strong></span> [[from]]
			$selecteduser.getAnonNickName()
			</td></tr>
		#end		
	#end
</table>
#end
<div class="text-center">
	<a href="$applink/collective/donate/donate.html?collectionid=$collectionid" class="btn subscribe-btn">[[Donate Now]]</a>
</div>

<h3>[[Community]]</h3>
		<div class="" style="padding-left:6px;">		
	#foreach($library in $librarycol.getLibraries())
			<a href="$applink/community/${library.id}/${library.getWebName()}.html">$library</a>
	#end
		</div>	




</div>
        
 