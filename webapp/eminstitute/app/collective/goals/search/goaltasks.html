#if(!$goalfolder)
	#set( $goalfolder = $context.getRequestParameter("goalfolder"))
	
	#if(!$goalfolder)
		#set( $goalfolder = $context.getPageValue("goalfolder") )
	#end
	
	#if(!$goalfolder)
		#set( $goalfolder = "search" )
	#end
#end
#set( $target = "tasklist#eid($goal.id)")
#set( $onlyopen = $context.getRequestParameter("onlyopen"))
<div id="editgoal">
<div id="$target">
<div  class="goalstaskcontainer" id="${goal.id}container">

<div>
	#set($points = 0)
	#foreach($task in $tasks)
		#set( $tree =  $mediaarchive.getCategory($task.projectdepartment))
		#if($tree)
			#set( $c = $tree.getInt("goalpoints") )
			#if( $c == 0)
				#set( $c = 10)
			#end
			#set($points = $points + $c)
		#end
		#set($collectionid = $goal.collectionid)
		#set( $edittask = "$applink/collective/goals/task/taskedit.html?id=${task.id}&collectionid=$goal.collectionid&onlyopen=$!onlyopen&targetdiv=$target")
		
			<div id="taskrow$task.getId()" class="goaltaskrow" >
				<div class="taskage">$task.getAge()</div>
				<div class="taskowner">$!mediaarchive.getUser($task.completedby).getAnonNickName()</div>
				<div class="tasktype">
						$!tree
				</div>
				#set( $comment = $mediaarchive.query("goaltaskcomments").exact("goaltaskid",$task.id) )
				<div class="taskdetails">
				#if($!task.comment.length() > 300)
				$!task.comment.substring(0, 300) ...
				#else
				$!task.comment
				#end
				</div>
	
				
				
				
	
				<div class="taskstatus goalstatus-$!task.taskstatus">
					
					<a 
					
					#if($user)
						id="task$task.getId()"
						href="$edittask"
						title="[[Edit Task]]"
					#else
						href="#"
						title="[[Task]]"
					#end
					data-focuson="$task.id"
					data-width="900"
					class=" taskedit taskedit-$!{task.taskstatus} #if($user)ajax#end " 
					data-targetdiv="taskrow$task.getId()" 
					data-oemaxlevel="1" 
					 >
					##<i class="fas fa-pencil-alt"></i>
					$!mediaarchive.getData("taskstatus", $task.taskstatus)
					</a>
					
					##set( $comment = $mediaarchive.query("goaltaskcomments").exact("goaltaskid",$task.id).match("commenttext","*").sort("dateDown").searchOne() )
				</div>
				<div class="clearfix"></div>
			</div>
	#end
</div>

	<div class="clearfix"></div>	
						
	#if($user && ( $canviewsettings || $caneditcollection)  && $goal.collectionid)

	<a class="appendgoalbutton"
		title="[[Add Note]]"
		data-targetdiv="$target"
		data-cancelsubmit="true"
		data-parameterdata="categoryvalues"
		data-collectionid="$goal.collectionid"
		data-categoryid="$!selectedcat.getId()"
		data-hitssessionid="$!{goalhits.getSessionId()}"
		data-goalfolder="$!goalfolder" ##tabs
		data-pickone="true"
		data-goalid="$goal.id"
		data-dialogid="picktask"
		href="$applink/collective/goals/task/noteedit.html"
		 ><i class="fas fa-sticky-note"></i> 
		</a>

	&nbsp;

	<a class="appendgoalbutton"
		title="[[Add Task]]"
		data-targetdiv="$target"
		data-cancelsubmit="true"
		data-parameterdata="categoryvalues"
		data-collectionid="$goal.collectionid"
		data-categoryid="$!selectedcat.getId()"
		data-hitssessionid="$!{goalhits.getSessionId()}"
		data-goalfolder="$!goalfolder" ##tabs
		data-pickone="true"
		data-goalid="$goal.id"
		data-dialogid="picktask"
		href="$applink/collective/goals/task/taskedit.html"
		 ><i class="fas fa-clipboard-check"></i> 
		</a>


	#end
	#if (!$onlyopen && $points>0)
		$points
	#end
	
</div>		
</div>	

</div>


