#set( $goalfolder = $context.getRequestParameter("goalfolder"))

#if(!$goalfolder)
	#set( $goalfolder = $context.getPageValue("goalfolder") )
#end

#if(!$goalfolder)
	#set( $goalfolder = "search" )
#end


<li id="goal$goal.id" class="card card-mini card-goal goalstatus$!{goal.projectstatus}" data-goalid="$goal.id">
   	<div class="goalheader #if( $caneditcollection) ui-draggable ui-draggable-handle #end "
   		 data-goalid="$goal.id" 
   		 data-cloneparentid="goal$goal.id">
			<div >
			#set( $project = $!mediaarchive.getData("collectiveproject",$goal.goaltrackercolumn) )
			#set( $collection = $!mediaarchive.getData("librarycollection",$goal.collectionid) )  
	    	<div  class="text-right">
		    	#if( $goal.ticketlevel)<i class="ticketlevel"> $mediaarchive.getData("ticketlevel",$goal.ticketlevel)</i>: #end
				#if ($goalfolder=='agentcalendar' && $collection)
				<a title="$collection" class="" href="$apphome/collective/goals/priorities/index.html?collectionid=$goal.collectionid&goaltrackerstaff=*">
				$!{collection}
				</a> >
				#end
				<a title="$goal.name" class="" href="$apphome/collective/goals/search/index.html?collectionid=$goal.collectionid&goaltrackercolumn.value=${project.id}&operation=matches&field=goaltrackercolumn">
				$!{project}
				</a>				
			    
			</div>
    		#set( $goallink = "$apphome/collective/goals/editgoalpanel.html?id=${goal.id}&collectionid=$goal.collectionid&categoryid=$!selectedcat.getId()&hitssessionid=$!{goalhits.getSessionId()}&goalfolder=$!goalfolder")
		    <a href="$goallink"
		    	title="$goal.name" class="emdialog editgoalshow" data-urlbar="$apphome/collective/goals/priorities/index.html?collectionid=$goal.collectionid&opengoalid=${goal.id}" data-width="900" >
		    	<div style="font-weight:bold;" >	 
		    	 $goal.name
		    	 </div> 
			<span class="headersubtext">$!mediaarchive.getData("tickettype",$goal.tickettype) [[added]] $!goal.getAge() [[ago]] - [[by]] $!mediaarchive.getUser($goal.owner).getAnonNickName()</span>
			</a>
    			$pages.include("$apphome/collective/goals/like.html",$context)
				#if($goal.projectstatus != "completed")
				<a href="$apphome/collective/goals/search/resolvegoal.html?goalid=$goal.id" data-targetdiv="goal$goal.id" 
				data-oemaxlevel="1"
				class="ajax btn btn-xs" 
					style="background-color:#ffd4007a;float:right;margin-top:5px" > [[Resolve]]

				</a>
					#if( $goal.resolveddate)<div> [[Due by]] $context.getDateTime($goal.resolveddate) </div>#end
				#end
	</div>
<div class="clearfix"></div>
    	<div class="goal-body">
			<div class="goal-footerX"> 
			#set($points = 0)
			#foreach($task in $tasks)
				#set( $tree =  $mediaarchive.getCategory($task.projectdepartment))
				#if($tree)
					#set( $c = $tree.getInt("goalpoints") )
					#if( $c == 0)#set( $c = 10)#end
					#set($points = $points + $c)
				#end
    			#set( $edittask = "$apphome/collective/goals/task/taskedit.html?id=${task.id}&collectionid=$goal.collectionid")
				<a href="$edittask"
					data-focuson="$task.id"
					data-width="900"
					id="task$task.getId()"
					class="btn btn-xs taskcomplete$!{task.taskstatus} ajax" data-targetdiv="task$task.getId()" data-oemaxlevel="1" title="$tree.getCategoryPath()" >
					#if( $task.completedby )
						#set( $completedby = $mediaarchive.getUser($task.completedby) )
						$!completedby.getAnonNickName() :
					#elseif( $task.startedby )
						#set( $startedby = $mediaarchive.getUser($task.startedby) )
						$!startedby.getAnonNickName() :
					#end	
					$task</a>
			#end
			#if($canviewsettings  && $librarycol.getId())
			<a class="emdialog"
				title="Add Tasks"
				data-cancelsubmit="true"
				data-parameterdata="categoryvalues"
				data-width="1000" 
				data-collectionid="$librarycol.getId()"
				data-categoryid="$!selectedcat.getId()"
				data-hitssessionid="$!{goalhits.getSessionId()}"
				data-goalfolder="$!goalfolder" ##tabs
				data-pickone="true"
				data-goalid="$goal.id"
				data-action="$apphome/collective/goals/actions/search/categorypicked.html"
				href="$apphome/collective/goals/actions/search/searchcategory.html?targetdiv=goal${goal.id}&clearselection=&detailid=category-exact"
				 ><i class="fas fa-plus-circle"></i> $points</a>
			#else
				$points
			#end
			
			
			</div>
		</div>
		
		
</li>
