#if(!$task)
#set( $taskid = $context.getRequestParameter("taskid"))
#if( $taskid)
#set( $task = $mediaarchive.getData("goaltask",$taskid) )
#end
#end

#set($target = $context.getRequestParameter("targetdiv"))

<tr id="taskrow$task.getId()" >
	<td class="taskage" scope="row">$!task.getAge()</td>
	
<td colspan="4"> 
  	<form id="someform" class="ajaxform" data-targetdiv="$target" data-oemaxlevel="1" action="$applink/collective/goals/task/tasksave.html" >

  		<div class="card-task-body changetaskstatus" data-taskid="$!task.id"  >
  		<!-- EDITING BOX STARTS HERE -->
  		
	    	<input type="hidden" name="goalid" value="$selectedgoal.id" />
	    	<input type="hidden" name="onlyopen" value="false" />
	    	<input type="hidden" name="taskid" value="$!task.id" />
	    	<input type="hidden" name="collectionid" value="$librarycol.getId()" />

			<div style="margin-bottom:10px;">
  			<textarea id="commenttext" class="form-control grabfocus" style="" name="comment">$!task.comment</textarea>
  			</div>

#set( $selectedstatus = $task.taskstatus)
#if( !$selectedstatus )
#set( $selectedstatus = "0")	
#end
		<div style="padding:5px 0 10px;">
			<div style="width:20px; float:left;"><i class="fas fa-check-square" style="color:#07172C"></i></div>
  			<select  name="taskstatus" class="form-control form-control-sm" >
			  <option value="" ></option>
			  #set( $options = $mediaarchive.getList("taskstatus"))
			  #foreach( $option in $options)
			  <option value="$option.id" #if( $selectedstatus == $option.id) selected #end >$option.getName()</option>
			  #end
			</select>
		</div>		


			<div style="padding:5px 0 10px;">
			## change completedby field to staff field? 
#set( $completedby = $task.completedby)
#if( !$completedby )
#set( $completedby = $user.id)	
#end
  			<div style="width:20px; float:left;"><i class="fas fa-user" style="color:#07172C"></i></div> 
  			<select class="form-control form-control-sm"  name="completedby"  >
			  <option value="" ></option>
			  #set( $team = $mediaarchive.query("librarycollectionusers").exact("collectionid",$librarycol.getId()).exact("ontheteam",true).search($context) )
				#foreach( $hit in $team)
					#set( $followeruser = $mediaarchive.getUser($hit.followeruser) )
			  		<option value="$hit.followeruser" #if( $completedby == $hit.followeruser) selected #end>$followeruser.getName()</option>
				#end
			</select>
			</div>

	
<!-- Add task type -->
#set($parentid = $mediaarchive.getCatalogSettingValue("rootactionscategory"))
#if(!$parentid)
	rootactionscategory is not set in catalogsettings
	#set($parentid = "AXNtQiCCVfeK6wAcFmEZ")
#end
#set( $hits = $mediaarchive.query("category").exact("parents",$parentid).sort("name").search($context) )
<div style="padding:5px 0 10px;">
			## change completedby field to staff field? 
  			<div style="width:20px; float:left;"><i class="fas fa-hammer" style="color:#07172C"></i></div> 
  			
	<select id="selectedcategories" name="projectdepartment" class="selectautosubmit listautocomplete form-control select2">
	<option value=""></option>
	#set( $projectdepartment = $task.projectdepartment)
	#foreach( $hit in $hits)
	    <option #if ($projectdepartment && $projectdepartment == $hit.id) selected #end value="$hit.id">$hit ($!hit.goalpoints)</option>
	#end
	</select>
</div>	
<!-- END TYPE -->	

  			
			<input id="submitbutton" type="submit" form="someform" value="[[Save]]" name="submitbutton" class="btn btn-xs btn-primary float-right">
			<!-- Delete Button -->
			#if( $caneditcollection )
    		<a class="btn btn-xs btn-danger float-left ajax" data-confirm="[[Are you sure?]]"
    			 targetdiv="editgoal" title="[[Remove task]]"
    			href="$applink/collective/goals/taskdelete.html?collectionid=$librarycol.getId()&goalid=$selectedgoal.id&taskid=$task.id">[[Delete]]</a> 
    		#end
    		<!-- Cancel Button  -->
    		#set( $targetdiv = "tasklist#eid($selectedgoal.id)")
			#set( $cancellink = "$applink/collective/goals/search/goaltasks.html?collectionid=$librarycol.getId()&goalid=$selectedgoal.id")
			<a href="$cancellink" data-focuson="$task.id" id="task$task.getId()" class="btn btn-xs btn-warning float-left taskedit-$!{task.taskstatus} ajax" data-targetdiv="$targetdiv" data-oemaxlevel="1" title="$tree.getCategoryPath()" >
			[[Cancel]]</a>
			<!-- removed taskedit class from "a" tag above  -->
			</div>
		
	<div class="taskstatus goalstatus-$!task.taskstatus">
	
		
	</div>
</form>
	</td>		
</tr>
			
