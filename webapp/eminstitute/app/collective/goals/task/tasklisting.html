#if(!$task)
#set( $taskid = $context.getRequestParameter("taskid"))
#set( $task = $mediaarchive.getData("goaltask",$taskid) )
#end

#set( $editclose = $context.getRequestParameter("editclose"))
#if( $editclose)
#set( $edittask = "$apphome/collective/goals/task/taskedit.html?id=${task.id}&collectionid=$librarycol.getId()")
				<a href="$edittask"
					data-focuson="$task.id"
					id="task$task.getId()"
					class="btn btn-xs taskcomplete$!{task.taskstatus} ajax" data-targetdiv="task$task.getId()" data-oemaxlevel="1" title="$tree.getCategoryPath()" >
					#if( $task.completedby )
						#set( $completedby = $mediaarchive.getUser($task.completedby) )
						$!completedby.getAnonNickName() :
					#elseif( $task.startedby )
						#set( $startedby = $mediaarchive.getUser($task.startedby) )
						$!startedby.getAnonNickName() :
					#end	
					$task</a>
#else

<div id="$task.id" class="card-task  pull-left card card-mini " data-taskid="$task.id" >
	
	#set( $selectedcat = $mediaarchive.getCategory($task.projectdepartment))
    	<div class="card-task-header taskcomplete$!{task.taskstatus} ui-draggable ui-droppable ui-draggable-handle"
    	 title="$selectedcat.getCategoryPath()"
    	 data-taskid="$task.id"
    	 data-cloneparentid="$task.id"
		 data-savepath="$apphome/collective/goals/task/tasksave.html"
    	 >
    		<a href="$apphome/collective/goals/actions/index.html?collectionid=$librarycol.getId()&nodeID=$task.projectdepartment" class="taskinfopoints">
    		<i class="fas fa-hands-helping" #if($selectedcat.goalpoints) title="${selectedcat.goalpoints} points"#end"></i></a>
    		<a class="ajax" data-targetdiv="$task.id" href="$apphome/collective/goals/task/taskedit.html?id=${task.id}&collectionid=$librarycol.getId()&editclose=true">
    		 $task.name 
    		</a> 
    		#if( $caneditdata )
    		<a class="ajax tasklistdelete" data-confirm="Are you sure?"
    			 targetdiv="editgoal" title="Remove task"
    			href="$apphome/collective/goals/taskdelete.html?collectionid=$librarycol.getId()&goalid=$selectedgoal.id&taskid=$task.id"><i class="fas fa-minus-circle"></i></a> 
    		#end
    	</div>
  		<div class="card-task-body changetaskstatus" 	data-taskid="$task.id"  >
	    	<form id="someform" class="ajaxform" data-targetdiv="$task.id" data-oemaxlevel="1" action="$apphome/collective/goals/task/tasksave.html" >
	    	<input type="hidden" name="taskid" value="$task.id" />
  			<select  name="taskstatus" style="width:100%" >
			  <option value="" ></option>
			  #set( $options = $mediaarchive.getList("taskstatus"))
			  #foreach( $option in $options)
			  <option value="$option.id" #if( $task.taskstatus == $option.id) selected #end >$option.getName()</option>
			  #end
			</select>
			<div>
  			#if( $task.taskstatus == "3" )<span class="completedby">[[By]]: 
  			
  			<select  name="completedby" style="width:100%" >
			  <option value="" ></option>
			  #set( $users = $mediaarchive.getList("user"))
			  #foreach( $auser in $users)
			  <option value="$auser.id" #if( $task.completedby == $auser.id) selected #end >$auser.getName()</option>
			  #end
			</select>
  			##$!mediaarchive.getUser($task.completedby).getAnonNickName()
  			
  			#end</span>
			</div>
			</form>
		$pages.include("$apphome/collective/goals/comments/listcomments.html?taskid=$task.id")
  		</div>
</div>
#end