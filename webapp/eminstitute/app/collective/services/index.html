#set($collectionid = $librarycol.getId())
<div class="collectivecontent" >
<div class="row no-gutters h-100" >
<div class="col">
<div class="collectivemaincol h-100">
	<div class="content">
					<h3>[[Products and Services]]</h3>
					##Search instances in these organizations
				#set( $products = $mediaarchive.query("collectiveproduct").match("collectionid", $collectionid).search() )
				#if ($products)
					<div class="emdata">
				    <table class="table table-striped">
				        <thead>
				            <tr class="tableheader">
				            	<th>[[Created On]]</th>
				                <th>[[Name]]</th>
				         		<th>[[Price]]</th>
				                <th>[[Description]]</th>
				                <th>[[Options]]</th>
											                <!-- <th>[[Payment Options]]</th> -->
				                
				            </tr>
				        </thead>
							#foreach($hit in $products)
							#if ($hit.instance_status == "active")
								#set($instancescount = $instancescount+1)
							#end
							<tr>
							    <td>$!context.getDate($hit.createdon)</td>
					            <td>$hit.name</td>
								<td style="text-align: center;">$!context.roundDouble($!hit.productprice,2)</td>
					            <td style="text-align: center;">$!hit.productdescription</td>
					            
								<td>
									<a href="$applink/collective/services/editproduct.html?collectionid=${collectionid}&id=${hit.id}" class="emdialog btn btn-sm btn-info" title="[[Add a Project]]">[[Edit]]</a>
								##	<a href="$applink/collective/services/paylater.html?collectionid=${collectionid}&productid=${hit.id}" class=" btn btn-sm btn-primary" title="[[Add a Project]]">[[Invoice Me]]</a>
								</td>
					        </tr>
							#end
				    </table>
			    	</div>
			    	#end	
			    	#if( $caneditcollection )
			    	<a href="$applink/collective/services/addnew.html?collectionid=${collectionid}" class="emdialog btn btn-sm btn-primary mb-4" title="[[Add a Billing]]">[[Add Product or Service]]</a>
			    	#end
			    	
			    	 #set( $invoices = $mediaarchive.query("collectiveinvoice").match("collectionid", $collectionid).search() )
				#if ($invoices)
				<h3>[[Invoices]]</h3>
					<div class="emdata">
				    <table class="table table-striped">
				        <thead>
				            <tr class="tableheader">
				            	<th>[[Created On]]</th>
				            	<th>[[Billed On]]</th>
				                <th>[[Invoice Number]]</th>
				                <th>[[Paid On]]</th>
				         		<th>[[Total Price]]</th>
				         		<th>[[Options]]</th>
				            </tr>
				        </thead>
						#foreach($hit in $invoices)
							#if ($hit.instance_status == "active")
								#set($instancescount = $instancescount+1)
							#end
							<tr>
							    <td>$!context.getDate($hit.createdon)</td>	
							    <td>$!context.getDate($hit.duedate)</td>
					            <td>$hit.invoicenumber</td>
					            <td>$!context.getDate($hit.invoicepaidon)</td>
								<td style="text-align: center;">$!context.roundDouble($!hit.totalprice, 2)</td>
								
								<td>
									#if ($hit.getValue("paymentstatus") == "invoiced")
									<a href="$applink/collective/services/paynow.html?invoiceid=${hit.id}&collectionid=$collectionid" class="btn btn-sm btn-primary">[[Pay Now]]</a>										
									#else
									<a href="$applink/collective/services/viewinvoice.html?invoiceid=${hit.id}&collectionid=$collectionid" title="[[View Invoice]]" class="emdialog btn btn-sm btn-secondary">[[View Details]]</a>
									#end
								</td>
					        </tr>
						#end
				    </table>
			    	</div>
				#end

				#if ($subs)
				<h3>[[Subscriptions]]</h3>
					<div class="emdata">
				    <table class="table table-striped">
				        <thead>
				            <tr class="tableheader">
				            	<th>[[Created On]]</th>
				            	<th>[[Billed On]]</th>
				                <th>[[Subscription Type]]</th>
				                <th>[[Type Counter]]</th>
				         		<th>[[Status]]</th>
				         		<th>[[Service Start]]</th>
				         		<th>[[Service End]]</th>
				         		<th>[[Options]]</th>
				            </tr>
				        </thead>
						#foreach($hit in $subs)
							<tr>
							    <td>$!context.getDate($hit.created)</td>
							    <td>$ $!context.stripePriceToString($hit.plan.amount)</td>
							    <td>$hit.plan.interval</td>
							    <td>$hit.plan.interval_count</td>
							    <td>$hit.status</td>
							    <td>$!context.getDate($hit.current_period_start)</td>
								<td>$!context.getDate($hit.current_period_end)</td>
							    <td>
							    	#if ($hit.status == "active")
									<a href="$applink/collective/services/pausesubscription.html?subid=${hit.id}" class="emdialog btn btn-sm btn-info">[[Cancel Subscription]]</a>
									<a href="$applink/collective/services/viewstripeinvoices.html?customerid=${hit.customer}&subid=${hit.id}" class="emdialog btn btn-sm btn-info">[[View Invoices]]</a>										
									#else
									<a href="$applink/collective/services/viewinvoice.html?invoiceid=${hit.id}" title="[[View Invoice]]" class="emdialog btn btn-sm btn-secondary">[[View Details]]</a>
									#end
							    </td>
					        </tr>
						#end
				    </table>
			    	</div>
				#end
				
					
		</div>
	 
	</div>
	</div>	
	 <div class="col-lg-3 ">
		<div class="collective-sidebar">
			$pages.include("$apphome/collective/channel/subscribers/index.html", $context)
		</div>
	 </div>
	
</div>		
</div>
			
