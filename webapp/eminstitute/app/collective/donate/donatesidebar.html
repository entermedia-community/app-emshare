#set($collectionid = $librarycol.getId())

<div id="subscriberssidebar" style="position:relative">

	#set($currentTotal = $transactionManager.getTransactionTotal($librarycol.getId()))

##	#if( $caneditcollection)
	
##	<a class="emdialog btn btn-sm btn-light" style="position:absolute; right: 0px; top:20px;" data-allwaysloadpage="true" href="$applink/collective/edit/editcollective.html?collectionid=$librarycol.getId()" title="[[Edit your Goals]]"><i class="fas fa-cog"></i> [[Goals]]</a>
	
##	#end


##Distribution details, move all this to Donate/Expendetures area 

	<div class="sidebarbox"  >
		<h4><i class="fas fa-bullseye"></i> [[Goal]]
		</h4>
				<div class="" style="padding-left:6px;">		
				#if($librarycol.goaldate)
				<strong>[[Our Goal Is:]] $${librarycol.goalamount} by #date($librarycol,"goaldate")! </strong><br>
				#if($librarycol.distributedtotal) [[We have raised]]: $${currentTotal} USD<br> 
				Spent: $${librarycol.distributedtotal} <br>[[Remaining]]: $$mathutil.subtract($currentTotal,$librarycol.distributedtotal) #end
				#else
				<strong>[[No goals yet]]!</strong>
				#end
				</div>	
		#if( $caneditcollection)
			<div style=" padding:6px; color:#888"><i class="fas fa-info-circle"></i> [[Configure Goals on Project Settings]]</div>
		#end

	</div>
	<div style="" class="text-center">
		<a href="$applink/collective/donate/$collectionid/donate.html" class="btn subscribe-btn">[[Donate]]</a>
	</div>
	
	#set( $donations = $mediaarchive.query("transaction").exact("collectionid",$collectionid).sort("paymentdateDown").search($context) )
	<div class="sidebarbox" >
	
	<h4>
		
		<a class="emdialog float-right" style="font-size:.8em;" data-cancelsubmit="true" title="View All Donations" href="$applink/collective/donate/donationlist.html?collectionid=$librarycol.getId()">
		$${currentTotal}</a>
		
			<i class="fas fa-hand-holding-usd"></i> [[Donations]]
	</h4>	
			#if( !$donations.isEmpty() )
			<strong>[[Recent Donations]]</strong>
				#foreach($transaction in $donations.getPageOfHits())
				 	#set( $selecteduser = $mediaarchive.getUser($transaction.userid) )
					<div style="background-color:#eee;padding:5px 10px 5px 10px; margin:4px 0;">
						<span style="font-size:1rem"><strong>$$transaction.totalprice</strong></span> [[from]]
						#if( $transaction.paymenttype =="paypal" && $transaction.name) 
							 $transaction.name
						#elseif($selecteduser)$!selecteduser.getAnonNickName()
						#end
						 <br>[[on]] $!context.getDateTime($transaction.paymentdate) 
					</div>	
				#end
			#end
	</div>

</div>
        
 