#set($collectionid = $librarycol.getId())

<div id="subscriberssidebar">

	#set($currentTotal = $transactionManager.getTransactionTotal($librarycol.getId()))

	#if( $caneditcollection)
	<div class="float-right" style="margin:8px -10px 0 0">
	<a class="emdialog" data-allwaysloadpage="true" href="$applink/collective/edit/editcollective.html?collectionid=$librarycol.getId()" title="[[Edit your Goals]]"><i class="fas fa-cog"></i></a>
	</div>
	#end

	<div class="subscribesidebarbox" style="padding-top:15px;" >
		<h4><i class="fas fa-bullseye"></i> [[Goal]]</h4>
				<div class="" style="padding-left:6px;">		
				#if($librarycol.goaldate)
				<strong>[[Our Goal Is:]] $${librarycol.goalamount} by #date($librarycol,"goaldate")! </strong><br>
				#if($librarycol.distributedtotal) [[We have raised]]: $${currentTotal} USD<br> 
				Spent: $${librarycol.distributedtotal} <br>[[Remaining]]: $$mathutil.subtract($currentTotal,$librarycol.distributedtotal) #end
				#else
				<strong>[[No goals yet]]!</strong>
				#end
				</div>	

	</div>
		<div style="margin:20px 0;" class="text-center">
			<a href="$applink/collective/donate/$collectionid/donate.html" class="btn subscribe-btn">[[Donate Now]]</a>
		</div>

	<div class="subscribesidebarbox" >
	#set( $donations = $mediaarchive.query("transaction").exact("collectionid",$collectionid).sort("paymentdateDown").search($context) )
	<h4>
		<div class="float-right" >
		<a class="emdialog" data-cancelsubmit="true" title="View All Donations" href="$applink/collective/donate/donationlist.html?collectionid=$librarycol.getId()">
		$${currentTotal}</a>
		</div>
			<i class="fas fa-hand-holding-usd"></i> [[Donations]]</h4>	
			#if( !$donations.isEmpty() )
			<strong>[[Recent Donations]]</strong>
				#foreach($transaction in $donations.getPageOfHits())
				 	#set( $selecteduser = $mediaarchive.getUser($transaction.userid) )
					<div style="background-color:#eee;padding:5px 10px 5px 10px; margin:4px 0;">
						<span style="font-size:1rem"><strong>$$transaction.totalprice</strong></span> [[from]]
						#if( $transaction.paymenttype =="paypal" && $transaction.name) 
							 $transaction.name
						#elseif($selecteduser)$!selecteduser.getAnonNickName()
						#end
						 <br>[[on]] $!context.getDateTime($transaction.paymentdate) 
					</div>	
				#end
			#end
	</div>

</div>
        
 