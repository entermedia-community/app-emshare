#set( $chatuser = $mediaarchive.getUser($chat.user) ) 
#set( $userlink = "$applink/users/${chatuser.getId()}/${chatuser.getAnonNickName()}.html")
#set( $userimageurl = $mediaarchive.asLinkToProfile($chatuser.assetportrait) )
#if(!$userimageurl) #set( $userimageurl = "$applink/theme/images/user.svg" ) #end

<div class="chatterbox-chat" role="alert"
	id="chatter-message-$chat.id">
	<div class="chat-icon">
		<a href="#esc($userlink)" title="$chatuser.getAnonNickName()"><img
			src="${userimageurl}" class="img-fluid usericon"></a>
	</div>
	#if($candeletecomments)
		<div class="float-right" >
	<!-- 	 <a class="confirm" data-confirm="Are you sure?" title="Delete message"
			data-id="${chat.id}" data-target="#chatter-message-$chat.id"
			data-searchtype="chatterbox" href="#"><i class="fas fa-times"></i></a>
		 -->
		</div>
	#end
	<div class="chat-msg">
		<a href="#esc($userlink)" title="$context.getDateTime($chat.date)"><strong>
				$chatuser.getAnonNickName()</strong></a><br> 
#if($chat.message)
	#if( $chat.message.startsWith("http"))
		<a href="$chat.message">$chat.message</a>
	#else
			$chat.message
	#end
#end			
	</div>
	<div class="clearfix"></div>
</div>

<script>

	if ("$chatuser" != "$user"){
		console.log(Notification.permission);
	}
	
	/* console.log("$chatuser");
	console.log("$user");
	console.log("$user.getAnonNickName()"); */
	
	function showNotification() 
	{
		const notification = new Notification("$chatuser.getAnonNickName()", {
			body: "$chat.message",
			icon: "https://entermediadb.org/entermediadb/mediadb/services/module/asset/downloads/preset/2019/12/f0/94a/image200x200.png"
		});
		
	}
	
	
	if (Notification.permission === "granted" && "$chatuser" != "$user") {
		showNotification();
	} else if (Notification.permission !== "denied") {
		Notification.requestPermission().then(permission => {
			if (permission === "granted" && "$chatuser" != "$user"){
				showNotification();
			}
		});
	}

</script>
