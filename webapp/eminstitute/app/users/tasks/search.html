<div class="maincontent">
##Search collections this user is teammeber
#set($organizationsuser = $mediaarchive.query("librarycollectionusers").exact("followeruser",$user.getId()).exact("ontheteam","true").search() )
#set($userprojects = [])
#foreach( $ohit in $organizationsuser )
	#set($x = $userprojects.add($ohit.collectionid))
#end
#if(!$userprojects)
	[[No projects for this user]]
#else
	#set($ticketlevel = $context.getRequestParameter("ticketlevel"))
	#if(!$ticketlevel)
		#set($ticketlevel = "1")
	#end
	
#set( $opengoalid = $context.getRequestParameter("opengoalid"))
#if( $opengoalid )
    #set( $goal = $mediaarchive.getData("projectgoal",$opengoalid))
    #set( $goallink = "$applink/collective/goals/editgoalpanel.html?id=${goal.id}&collectionid=$goal.collectionid&goalfolder=$!content.goalfolder")
    <a href="$goallink" title="$goal.name" class="emdialog editgoalshow openemdialog" style="display: none" >[[Goal link]]</a>	
#end
	
	
	#if($canviewsettings)
		#set( $hits = $mediaarchive.query("projectgoal").exact("ticketlevel",$ticketlevel).orgroup("projectstatus","open|critical").enduser(true).sort("projectstatus").sort("creationdateDown").search() )
	#else
		#set( $hits = $mediaarchive.query("projectgoal").orgroup("collectionid",$userprojects).exact("ticketlevel",$ticketlevel).orgroup("projectstatus","open|critical").enduser(true).sort("creationdateDown").search() )
	#end
	#if (!$hits.isEmpty())
		<div class="goals-header-actions">
		$hits.size() [[Tasks]]
		</div>
		<div class="emdata" style="overflow-x:auto;">
		<table width="100%" class="table table-striped table-hover">
		<thead>
			<tr class="tableheader">
				<th style="width:130px;">[[Project]]</th>
				<th style="width:130px;">[[Ticket]]</th>
				<th>[[Details]]</th>
				<th style="width:180px">[[Status]]</th>		
			</tr>
		</thead>
		#foreach($goal in $hits)
			#set( $goal = $mediaarchive.getSearcher("projectgoal").loadData($goal))
			<tr class="goalstatus$!{goal.projectstatus}" >
			$context.putPageValue("goal",$goal)
			<td >
			#set( $project= $!mediaarchive.getData("librarycollection",$goal.collectionid) )
			<a href="$applink/collective/goals/priorities/index.html?collectionid=$goal.collectionid"
			style="text-decoration:underline;" >
			$!project
			</a>
			</td>
			<td>
			<a data-cancelsubmit="true" data-hidefooter="true" href="$applink/collective/goals/editgoalpanel.html?id=$goal.id&collectionid=$goal.collectionid&goalfolder=agent" 
				title="" class="emdialog editgoalshow" style="text-decoration:underline;" data-urlbar="$applink/users/tasks/search.html?ticketlevel=$ticketlevel&goaltrackerstaff=*&opengoalid=$goal.id"
				data-width="900">$!goal.ticketnumber $goal.name</a>
			</td>
			<td >
				#esc( $!goal.details ) 	
				
				#if( $goal.response)
					<hr><i>
					#esc($goal.response)
					</i>
				#end	
				<div class="goal-body">
				$pages.include("$apphome/collective/goals/search/goaltasks.html?indialog=true",$context)
				</div>				
			</td>
			
			<td class="text-center" >
				$pages.include("$apphome/users/tasks/resolvebutton.html",$context) 
				<div class="clearfix" style="padding:5px;"> </div>
				<span class="headersubtext">
				
					$!mediaarchive.getData("tickettype",$goal.tickettype) $!goal.getAge() [[ago]] [[by]] $!mediaarchive.getUser($goal.owner).getAnonNickName()
				</span><br>
				
					#set( $project= $!mediaarchive.getData("collectiveproject",$goal.goaltrackercolumn) )
				<a href="$sitelink/app/collective/goals/search/search.html?collectionid=$goal.collectionid&field=goaltrackercolumn&operation=matches&goaltrackercolumn.value=$project.id" 
				style="text-decoration:underline;" >
				$!project
				</a>
					<br>
					
					#if ($goal.deliverydate)
						<span style="color:red">[[Due on:]] $goal.deliverydate.substring(0, 10)</span>
					#end
				</td>

		
		</tr>
		
		#end
		</table>
		#else
		<img src="$applink/theme/images/cnbnothing.png">
		
		</img>
		</div>
	#end
#end
</div>



