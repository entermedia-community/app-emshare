<div class="maincontent">
	#set( $hits = $opentickets)
		<div class="dropdown show" style="float:right;">
		  <a class="btn btn-success dropdown-toggle" style="color:white;" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    Employee
		  </a>
	
	
		  <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
		    <a class="dropdown-item" href="https://entermediadb.org/entermediadb/app/users/tasks/mytasks.html?goaltrackerstaff=cburkey">Chris</a>
		    <a class="dropdown-item" href="https://entermediadb.org/entermediadb/app/users/tasks/mytasks.html?goaltrackerstaff=cristobalmejia">Cristobal</a>
		    <a class="dropdown-item" href="https://entermediadb.org/entermediadb/app/users/tasks/mytasks.html?goaltrackerstaff=277">David</a>
		    <a class="dropdown-item" href="https://entermediadb.org/entermediadb/app/users/tasks/mytasks.html?goaltrackerstaff=426">Mando</a>
		    <a class="dropdown-item" href="https://entermediadb.org/entermediadb/app/users/tasks/mytasks.html?goaltrackerstaff=534">Mitsuo</a>
		    <a class="dropdown-item" href="https://entermediadb.org/entermediadb/app/users/tasks/mytasks.html?goaltrackerstaff=388">Rishi</a>
		    <a class="dropdown-item" href="https://entermediadb.org/entermediadb/app/users/tasks/mytasks.html?goaltrackerstaff=489">Victor</a>
		  </div>
		</div>
	#if($canviewsettings)
	#if($hits)
		<div class="goals-header-actions">
		$hits.size() [[Tasks]]
		
		</div>
		<div class="emdata" style="overflow-x:auto;">
		<table width="100%" class="table table-striped table-hover">
		<thead>
		<tr class="tableheader">
			<th style="width:130px;">[[Workspace]]</th>
			<th style="width:130px;">[[Topic]]</th>
			<th>[[Goal]]</th>
			<th style="width:130px;">[[Team]]</th>
			<th>[[Details]]</th>
			<th style="width:97px;">[[Status]]</th>
			<th style="width:250px">[[Created]]</th>
			
		</tr>
		</thead>
		#foreach($goal in $hits)
			##set( $goal = $mediaarchive.getSearcher("projectgoal").loadData($goal))
			<tr class="goalstatus$!{goal.projectstatus}" >
			$context.putPageValue("goal",$goal)
			<td >
			#set( $project= $!mediaarchive.getData("librarycollection",$goal.collectionid) )
			<a href="$sitelink/app/collective/goals/priorities/index.html?collectionid=$goal.collectionid"
			style="text-decoration:underline;" >
			$!project
			</a>
			</td>
			<td >
			#set( $project= $!mediaarchive.getData("collectiveproject",$goal.goaltrackercolumn) )
			<a href="$sitelink/app/collective/goals/search/search.html?collectionid=$goal.collectionid&field=goaltrackercolumn&operation=matches&goaltrackercolumn.value=$project.id" 
			style="text-decoration:underline;" >
			$!project
			</a>
			<br><a href="#" class="badge badge-pill badge-info">$!mediaarchive.getData("ticketlevel",$goal.ticketlevel)</a>
			</td>
		
			<td>
			<a data-cancelsubmit="true" data-hidefooter="true" href="$sitelink/app/collective/goals/editgoalpanel.html?id=$goal.id&collectionid=$goal.collectionid&goalfolder=agent" 
				title="" class="emdialog editgoalshow" style="text-decoration:underline;" data-urlbar="$applink/users/tasks/search.html?ticketlevel=$goal.ticketlevel&goaltrackerstaff=*&opengoalid=$goal.id"
				data-width="900">$goal.name</a>
			</td>
			<td>
		  			$pages.include("$apphome/collective/goals/like.html",$context)
			</td>	
			<td >
				$!goal.details 		
				
				<div class="goal-body">
				$pages.include("$apphome/collective/goals/search/goaltasks.html?indialog=true",$context)
				</div>
				
			</td>
			<td class="text-center" >
				$pages.include("$apphome/users/tasks/resolvebutton.html",$context) 
			</td>
			
			<td class="text-right" >
				<span class="headersubtext">
				
					$!mediaarchive.getData("tickettype",$goal.tickettype) $!goal.getAge() [[ago]] [[by]] $!mediaarchive.getUser($goal.owner).getAnonNickName()
				</span><br>
				#if ($goal.deliverydate)
					<span style="color:red">[[Due on:]] $goal.deliverydate.substring(0, 10)</span>
				#end
			</td>
		
		</tr>
		
		#end
		</table>
		</div>
	#end
#end
<!-- Points Report Begins **going back one month needs to be fixed.-->

<h4 class="modal-title">[[Weekly Points Report]]</h4>
	    <p>[[Month]]: $context.getDateTime($since) 
	    
	    <!-- <a class="btn" href="./report.html?collectionid=*&monthsback=$monthsback"> [Go Back ${monthsback} Month]</a></p> -->
	<div class="pull-left card card-mini" style="margin:5px;"> 
    	<div class="card-task-header" >$user</div>
  		<div class="card-task-body " >
  		#set( $weeks = $completed.weeksInMonth($since) )
			<table class="striped" style="width:100%">
  			<tr><th>Tickets and Tasks</th><th style="width:280px;">[[Closed On]]</th><th style="width:80px;">[[Points]]</th></tr>
			#set( $totalpoints = 0)  			
  		#foreach( $week in $weeks)
			#set( $counted = 0)
			#set( $weekpoints = 0)  	
			#set($tasks = $completed.getTasksForWeek($user,$week))
  		    #foreach($task in $tasks)
  				#set( $selectedcat = $mediaarchive.getCategory($task.projectdepartment))
				#set( $points = $selectedcat.getValue("goalpoints"))
				#if( !$points || $points == 0)
					#set( $points = 10 )
				#end
				#set( $counted = $counted +1)
				#set( $totalpoints = $totalpoints + $points)
				#set( $weekpoints = $weekpoints + $points)
  				<tr><td><a class="emdialog" data-width="900"
		 	 	title="Ticket Details" 
		 	 		href="$applink/collective/goals/editgoalpanel.html?id=$task.projectgoal&collectionid=$task.collectionid&nodeID=$selectedcat.id&goalfolder=$content.goalfolder">
		 	 		#set($collection = $!mediaarchive.getData("librarycollection",$task.collectionid) )
		 	 		Task: $collection - $task.name - "$!mediaarchive.getData("projectgoal",$task.projectgoal)"</a></td>
  					<td>$context.getDateTime($task.getDate("completedon"))</td><td>$points</td>
  				</tr>
  		    #end
  		    
  		    #set($tickets = $completed.getTicketsForWeek($user,$week))
  		    
  		    #set( $countedtickets = 0)
  		    #if(!$tickets.isEmpty())
  		    #foreach($ticket in $tickets)
  		   		#set( $points = $ticket.getValue("points"))
  		    	<tr><td>
  		    	#set( $goallink = "$applink/collective/goals/editgoalpanel.html?id=${ticket.id}&collectionid=$ticket.collectionid&goalfolder=search")
  		    	#set($collection = $!mediaarchive.getData("librarycollection",$ticket.collectionid) )
  		    	  <a href="$goallink"
		    	title="$ticket.name" class="emdialog editgoalshow" 
		    	data-urlbar="$applink/collective/goals/search/index.html?collectionid=$ticket.collectionid&opengoalid=${ticket.id}" data-width="900" >
  			Ticket: $collection - $mediaarchive.getData("collectiveproject",$ticket.goaltrackercolumn) - "$ticket.name" </a></td><td>$!context.getDateTime($ticket.getDate("resolveddate"))</td><td>$points</td></tr>
				#set( $counted = $counted +1)
				#set( $weekpoints = $weekpoints + $points)
				#set( $totalpoints = $totalpoints + $points)
  		    #end
  		    #end
  		    #if( $weekpoints > 0)
  			<tr><td colspan="2" style="padding-left: 50px;"> </td><td style="text-align:right;">$weekpoints</td></tr>
  			#end
		#end
 		    #if( $totalpoints > 0)
 			<tr><td colspan="2" style="padding-left: 50px;"> </td><td style="text-align:right;">$totalpoints</td></tr>
 			#end
  			</table>
  		</div>
	</div>

</div>



