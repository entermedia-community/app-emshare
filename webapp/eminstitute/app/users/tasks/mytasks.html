<div class="maincontent">
	#set( $hits = $opentickets)
	
		<div class="dropdown show" style="float:right;">
		  <!-- <a class="btn btn-success dropdown-toggle" style="color:white;" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    Employee
		  </a> -->
		  
		  #set( $agents = $mediaarchive.getList("agentlist"))
		  #if( $agents.isEmpty() )
		  	Please populate agentlist table
		#else
			##openprojects
			#set ($aprojects = $mediaarchive.query("projectgoal").not("projectstatus", "closed").not("projectstatus", "completed").search($context))
			#set($pids = [])
		  	#foreach ( $aproject in $aprojects)
		  			#set($x = $pids.add($aproject.id))
		  	#end
			#foreach ( $agent in $agents)
				#set( $auser = $mediaarchive.getUser($agent.get("userid")))
			  	##set( $nitasks =  $mediaarchive.query("goaltask").exact("taskstatus", "1").exact("taskstatus", "0").exact("completedby", $agent.get("userid")).search($context))

			  	#set( $nitasks =  $mediaarchive.query("goaltask").not("taskstatus", "3").not("taskstatus", "5").orgroup("projectgoal", $pids).exact("completedby", $agent.get("userid")).search($context))
			  	<a class="btn btn-success #if( $selecteduser.getId() == $agent.get("userid") ) active #end" 
			  	style="color:white;" 
			  	href="$applink/users/tasks/mytasks.html?goaltrackerstaff=${agent.get("userid")}&collectionid=*">
			    $auser <span style="color:orange;"><b>$!nitasks.size()</b></span>
			  </a>
			#end
		#end
	
		</div>
	#if($canviewsettings)
	<div class="goals-header-actions">
	<nobr>
		 $opentickets.size() open tickets
		#set( $critical = $mediaarchive.query("projectgoal").orgroup("projectstatus", "critical").sort("creationdateUp").search($context) )
		with $critical.size() priority tickets.
		#if( !$critical.isEmpty() )
			#set( $goal = $mediaarchive.getSearcher("projectgoal").loadData($critical.first()) )
			#set( $project= $!mediaarchive.getData("collectiveproject",$goal.goaltrackercolumn) )
			<a style="float:left;" data-cancelsubmit="true" data-hidefooter="true" href="$sitelink/app/collective/goals/editgoalpanel.html?id=$goal.id&collectionid=$goal.collectionid&goalfolder=agent" title="" class="emdialog editgoalshow" style="text-decoration:underline;" data-urlbar="$applink/users/tasks/search.html?ticketlevel=$goal.ticketlevel&goaltrackerstaff=*&opengoalid=$goal.id" data-width="900">Oldest priority is $goal.getAge() old.&nbsp;</a> 
		#end
		</nobr>
		
		</div>
	#if($hits)
		
		<div class="emdata" style="overflow-x:auto;">
		<table width="100%" class="table table-striped">
		<thead>
		<tr class="tableheader">
			<th style="width:130px;">[[Workspace]]</th>
			<!-- <th style="width:130px;">[[Topic]]</th> -->
			<th style="width:130px;">[[Ticket]]</th>
<!-- 			<th style="width:130px;">[[Team]]</th>-->			
			<th>[[Details]]</th>
			<th style="width:180px;">[[Status]]</th>
			<!-- <th style="width:250px">[[#]]</th> -->
			
		</tr>
		</thead>
		#foreach($goal in $hits)
		    #set( $tasks =  $tasklookup.get($goal.getId()) )
		    #if( !$tasks.isEmpty())
				<tr class="goalstatus$!{goal.projectstatus}" >
				$context.putPageValue("goal",$goal)
				$context.putPageValue("tasks",$tasks)
				<td >
				#set( $project= $!mediaarchive.getData("librarycollection",$goal.collectionid) )
				<a href="$sitelink/app/collective/goals/priorities/index.html?collectionid=$goal.collectionid"
				style="text-decoration:underline;" >
				$!project
				</a>
				</td>
				<td>
				<a data-cancelsubmit="true" data-hidefooter="true" href="$sitelink/app/collective/goals/editgoalpanel.html?id=$goal.id&collectionid=$goal.collectionid&goalfolder=agent" 
					title="" class="emdialog editgoalshow" style="text-decoration:underline;" data-urlbar="$applink/users/tasks/search.html?ticketlevel=$goal.ticketlevel&goaltrackerstaff=*&opengoalid=$goal.id"
					data-width="900">$!goal.ticketnumber $goal.name</a>
				</td>
				<td >
					$!goal.details 		
					
					<div class="goal-body">
					
					$pages.include("$apphome/collective/goals/search/goaltasks.html?indialog=true&onlyuser=true",$context)
					</div>
					
				</td>
				<td class="text-center" >
				$pages.include("$apphome/users/tasks/resolvebutton.html",$context) 
				<div class="clearfix" style="padding:5px;"> </div>
				<span class="headersubtext">
					$!mediaarchive.getData("tickettype",$goal.tickettype) $!goal.getAge() [[ago]] [[by]] $!mediaarchive.getUser($goal.owner).getAnonNickName()
				</span><br>
				
					#set( $project= $!mediaarchive.getData("collectiveproject",$goal.goaltrackercolumn) )
				<a href="$sitelink/app/collective/goals/search/search.html?collectionid=$goal.collectionid&field=goaltrackercolumn&operation=matches&goaltrackercolumn.value=$project.id" 
				style="text-decoration:underline;" >
				$!project
				</a>
					<br>
					
					#if ($goal.deliverydate)
						<span style="color:red">[[Due on:]] $goal.deliverydate.substring(0, 10)</span>
					#end
				</td>
				
				</tr>
			#end	
		
		#end
		</table>
		</div>
	#end
#end


</div>



