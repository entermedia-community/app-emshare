<div class="maincontent">

	    <h4 class="modal-title">[[Weekly Points Report]]</h4>
	    <p>[[Month]]: $context.getDateTime($since) 
	    <a class="btn" href="./report.html?collectionid=*&monthsback=$monthsback"> [Go Back ${monthsback} Month]</a></p>
#foreach($person in $users)
	<div class="pull-left card card-mini" style="margin:5px;"> 
    	<div class="card-task-header" >$person</div>
  		<div class="card-task-body " >
  		#set( $weeks = $completed.weeksInMonth($since) )
			<table class="striped" style="width:100%">
  			<tr><th>Tickets and Tasks</th><th style="width:280px;">[[Closed On]]</th><th style="width:80px;">[[Points]]</th></tr>
			#set( $totalpoints = 0)  			
  		#foreach( $week in $weeks)
			#set( $counted = 0)
			#set( $weekpoints = 0)  	
			#set($tasks = $completed.getTasksForWeek($person,$week))
  		    #foreach($task in $tasks)
  				#set( $selectedcat = $mediaarchive.getCategory($task.projectdepartment))
				#set( $points = $selectedcat.getValue("goalpoints"))
				#if( !$points || $points == 0)
					#set( $points = 10 )
				#end
				#set( $counted = $counted +1)
				#set( $totalpoints = $totalpoints + $points)
				#set( $weekpoints = $weekpoints + $points)
  				<tr><td><a class="emdialog" data-width="900"
		 	 	title="Ticket Details" 
		 	 		href="$applink/collective/goals/editgoalpanel.html?id=$task.projectgoal&collectionid=$task.collectionid&nodeID=$selectedcat.id&goalfolder=$content.goalfolder">
		 	 		#set($collection = $!mediaarchive.getData("librarycollection",$task.collectionid) )
		 	 		Task: $collection - $task.name - "$!mediaarchive.getData("projectgoal",$task.projectgoal)"</a></td>
  					<td>$context.getDateTime($task.getDate("completedon"))</td><td>$points</td>
  				</tr>
  		    #end
  		    
  		    #set($tickets = $completed.getTicketsForWeek($person,$week))
  		    
  		    ##DO NOT COUNT TICKET COMPLETITION POINTS ANYMORE (Starting Sept 2020)
  		    #if(1==2)
	  		    #set( $countedtickets = 0)
	  		    #if(!$tickets.isEmpty())
	  		    #foreach($ticket in $tickets)
	  		   		#set( $points = $ticket.getValue("points"))
	  		    	<tr><td>
	  		    	#set( $goallink = "$applink/collective/goals/editgoalpanel.html?id=${ticket.id}&collectionid=$ticket.collectionid&goalfolder=search")
	  		    	#set($collection = $!mediaarchive.getData("librarycollection",$ticket.collectionid) )
	  		    	  <a href="$goallink"
			    	title="$ticket.name" class="emdialog editgoalshow" 
			    	data-urlbar="$applink/collective/goals/search/index.html?collectionid=$ticket.collectionid&opengoalid=${ticket.id}" data-width="900" >
	  			Ticket: $collection - $mediaarchive.getData("collectiveproject",$ticket.goaltrackercolumn) - "$ticket.name" </a></td><td>$!context.getDateTime($ticket.getDate("resolveddate"))</td><td>$points</td></tr>
					#set( $counted = $counted +1)
					#set( $weekpoints = $weekpoints + $points)
					#set( $totalpoints = $totalpoints + $points)
	  		    #end
	  		    #end
  		    #end
  		    
  		    #if( $weekpoints > 0)
  			<tr><td colspan="2" style="padding-left: 50px;"> </td><td style="text-align:right;">$weekpoints</td></tr>
  			#end
		#end
 		    #if( $totalpoints > 0)
 			<tr><td colspan="2" style="padding-left: 50px;"> </td><td style="text-align:right;">$totalpoints</td></tr>
 			#end
  			</table>
  		</div>
	</div>
#end
<div class="clearfix"></div>
</div>

	
