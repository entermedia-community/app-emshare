<div class="masonry-grid" 
data-maxheightX="$!mediaarchive.getCatalogSettingValue('stacked_gallery_imagesize')"
data-maxheight="180" 
data-cellpadding="4"
data-makebox="true"
data-singlepage="true"  >



#set($count = 0)
#set($viewerlink = $content.get("assetviewerlink") )
#set($stackedfield = $mediaarchive.getCatalogSettingValue("stackedgalleryfield"))

#foreach( $hit in $hits.getPageOfHits())
	
	$context.putPageValue("hit", $hit)
	#set($asset = $mediaarchive.getAsset($hit.id))
	$context.putPageValue("asset", $asset)
	
	#set($type = $hit.getSearchHit().getType())
	#set($rendertype = $mediaarchive.getMediaRenderType($hit.fileformat))
	$context.putPageValue("type", $rendertype)
	
	$context.putPageValue("assetid", $hit.id)
	$context.putPageValue("count", $count )
	$context.putPageValue("sourcepath", $hit.sourcepath )
	$context.putPageValue("thumbsize", "mediumplus" )
	
	#set($sourcepath = $hit.sourcepath)
	#set($assetwidth = $mediaarchive.getRealImageWidth($hit))
	#set($assetheight = $mediaarchive.getRealImageHeight($hit))
	#set($click = "$siteroot$viewerlink?hitssessionid=${hits.getSessionId()}&assetid=${hit.id}")
	#set($isselected = $hits.isSelectedOnPage(${hit.id}) )
       
	<div class="masonry-grid-cell stackedplayer-cell assetdraggable resultsassetcontainer #if($isselected) emrowselected #end" 
		 id="gallerycell_${hit.id}"
		 data-assetid="$hit.id" 
		 data-width="$assetwidth" 
		 style="height:180px;width:250px;"
		 data-height="$assetheight">
		<div class="grid-cell-hover"></div>
		<div class="grid-gallery-checkbox">
			<input type="checkbox" class="selectionbox resultsselection" name="count" value="${hit.id}" 
		        	#if($isselected) checked #end data-dataid="${hit.id}" />          
		</div>
	    	    <div class="grid-thumbimage" data-assetid="$!hit.id">
	    	    	#if(!$rendertype || $type =="rendertype")
	    	    		#set( $rendertype = "mime" )
	    	    	#elseif( $rendertype =="video")
	    	    		#set( $rendertype = "videothumbnail" )
	    	    	#end
	        	    $pages.include("$componenthome/results/thumbnails/${rendertype}.html", $context)
	        	</div>
	    		
	    		
	    		##Caption
	    	 	<div class="grid-caption grid-caption-${rendertype} #if($rendertype=="default") grid-caption-show #end">
	    	 		#if($stackedfield)
			         	#set($title = $hit.get($stackedfield))
					 #end
					 #if(!$title)		         	
			         	#if( $hit.assettitle )
				        	#set($title =  $hit.assettitle) 
				        #else 
				        	#set($title = $hit.name) 
				        #end
			         #end
			         <a class="stackedplayer grid-caption-link" id="clickid${hit.id}" data-assetid="$hit.id" href="#" title="#esc($!title)">
			         <span>#esc($!title)</span>
			         
			         ##Show entities or something more?
			         #foreach( $module in $mediaarchive.getList("module") )
			         	#set( $showon = $module.get("showonsearch") )
			         	#if($showon == "true")
			         	
			         		#set( $values = $hit.getValues($module.getId()) )
			         		#if( $values)
			         		<span>
			         			$module:
					         	#foreach( $row in $values )
					         		$mediaarchive.getCachedData($module.getId(),$row)
					         	#end
					         </span>	
					        #end	
			         	#end
			         #end
			         
			         </a>
			         
			        #foreach($row in $list)
						#set( $val = false )
						#set( $val = $mediaarchive.getCachedData($fieldid,$row) )
						#if( $val)
							<span class="clipdetail"><a href="$apphome/components/gridsample/preview/entity.html?id=$val.getId()&searchtype=$fieldid" class="emdialog entity-dialog">$val</a></span>
						#else
						##Missing: $fieldid = $v
						#end
					#end
         
			           
			        <div class="grid-gallery-footer"> 
			        
			        
			        
	        	   	$pages.include("$componenthome/results/badges.html", $context)
			         #if ($hit.assetaddeddate)
			         $!context.getDate($hit.assetaddeddate)
			         #end
					#if($canaddtofavorites)
	  	        	<div id="gsassetfavorite-${hit.id}" class="media-info-icons">
			        	 $pages.include("$apphome/views/modules/asset/editor/favorite/index.html?targetdiv=gsassetfavorite", $context)
			   		</div>
	  	        	#end
	  	        	#if($canquickdownload)
		  	        	#if( $desktop )
				        	<a href="#" class="emdesktopdownload grid-gallery-download" data-assetid="$hit.id" title="[[Download]] $!title">
				        	<i class="fas fa-download"> </i>
				        	</a>
			        	#else
							#set($dlink = $mediaarchive.asLinkToOriginal($hit))
							#set($dlink = "$siteroot/$mediadbappid/services/module/asset/downloads/originals/$dlink?assetid=$!hit.getId()")
							#if($collectionid)
								#set($dlink = "$dlink&collectionid=$!{collectionid}")
							#end
				        	<a href="$dlink" class="grid-gallery-download" data-assetid="$hit.id" title="[[Download]] $!title">
				        	<i class="fas fa-download"> </i>
				        	</a>
			        	#end
			        #end 
		        	</div>
		       </div>
		 
		 
		        	
		  
		</div>
       #set ( $count = $count + 1) 
   
	#end

</div>