#set( $fieldexternalid = $context.getRequestParameter("fieldexternalid"))
#set( $fieldexternalvalue = $context.getRequestParameter("fieldexternalvalue"))
$context.putPageValue("fieldexternalid", $fieldexternalid)
$context.putPageValue("fieldexternalvalue", $fieldexternalvalue)


#set($viewid = "${module.id}resultstable")
$context.putPageValue("viewid",$viewid)

#set($viewpath = "${module.id}/$viewid")
$context.putPageValue("viewpath",$viewpath)


#set($tabid = "tab_${viewid}")
#set($submoduleresults = "results$!{viewid}")
$context.putPageValue("submoduleresults", $submoduleresults)

#set($hits = $pickerhits)
$context.putPageValue("hits", $hits)
$context.putPageValue("tablehits", $hits)

#set($tabletype = "subentity")
$context.putPageValue("tabletype", $tabletype)

<div id="$!submoduleresults" class="submodulepicker">
	<div class="entity-ction-header">
		<h3 class="m-0 mr-auto align-items-center">
			#set($moduleicon = "box")
			#ifnotnull($submodule.moduleicon)
				#set($moduleicon = $submodule.moduleicon)
			#end	
			<i class="bi bi-$moduleicon module-icon" style="font-size: 0.8em;;"></i> 
			#text($submodule) <small>($hits.size())</small>
		</h3>
	</div>
		
	#if( $hits && $hits.size() > 0 )		
			#set($total = $hits.getTotalPages() )
				
			#set($maintargetdiv = "$!{moduleid}resultscontainer")
			$context.putPageValue("maintargetdiv", $maintargetdiv)

			$pages.include("${searchhome}/results.html",$context)
						
	#else
	
		#set($addnew = "$!{componenthome}/entities/addnew.html")
		<div class="w-100 text-center mt-5">
			<p class="text-muted">[[No]] #text($module) [[created yet]]</p>
			<a class="btn btn-accent emdialog rounded"
			data-dialogid="entitypickeraddnew"
			data-hidefooter="true"
			data-targetdivinner="pickersearchentities"
			data-ajaxreloadtargets="onetomanytab"
			data-fieldexternalid="$!fieldexternalid"
			data-fieldexternalvalue="$!fieldexternalvalue"
			href="$addnew"
			title="[[Create New]] #text($entity)">
			<i class="bi bi-plus-lg mr-1"></i> [[Create New]]</a>
		
			#if($tabletype == "subentity")
				#set($entity = $mediaarchive.getCachedData("module", $searchtype))	
				<div id="resultsdiv$!{entity.getId()}"></div>
			#end
		</div>
	#end
</div>
