#set( $moduleid = $module.id)

#ifnull($viewid)
	#set($viewid = $context.getRequestParameter("viewid"))
#end
#ifnull($viewid)
	#set($viewid = "${moduleid}resultstable")
#end
$context.putPageValue("viewid", $viewid)
#ifnull($viewpath)
	$context.putPageValue("viewpath", "${module.id}/${viewid}")
#end
#set($entitymoduleviewid = $context.getRequestParameter("entitymoduleviewid"))

#set($searchhomename = $page.get("searchhomename") )
<div id="$searchhomename" class="tableresults resultsdiv" 
		data-${module.id}hitssessionid="$!hits.getSessionId()" 
		data-hitssessionid="$!hits.getSessionId()"
		data-componenthome="$!home$!componenthome"
		data-searchhome="$!searchhome"
		data-targetdiv="$searchhomename"
		data-category="$!category.id"
		#if( $page.isPropertyTrue("filterbyentity",false) )
			data-field="$!{entitymodule.id}"
			data-$!{entitymodule.id}value="$!entity.id"
			data-operation="exact"
			data-entitymoduleviewid="$!entitymoduleviewid"  ##this is used in sub-modules to keep the views right
		#end

		
		data-lightboxid="$!lightboxid"  
		data-pagenum="$!hits.getPage()" 
		data-totalpages="$!hits.getTotalPages()"
		#ifnotnull($entity)
			data-entityid="$!entity.id"
			data-entitymoduleid="$!entitymodule.id"
		#end
		data-viewid="$!viewid"
		data-section="$!content.section">
	
	$pages.include("${searchhome}/searchheader.html", $context)	
		
	#set($searcher = $searcherManager.getSearcher($catalogid, $moduleid))
	$context.putPageValue("searcher", $searcher)
	
	#set($isentity = $module.get("isentity"))
	$context.putPageValue("isentity", $isentity )
	
	
	#if (!$nodeID)
		#set($nodeID = $context.getRequestParameter("nodeID"))
		$context.putPageValue("nodeID",$nodeID)
	#end
	
	
	
	#set($resultview = $userprofile.get("${moduleid}resultview"))
	
	#if(!$resultview)
		#set($resultview = $content.get("${moduleid}resultview"))
	#end
	#if(!$resultview)
		#set($resultview = $context.getRequestParameter("resultview"))
	#end
	#if(!$resultview)
		#set($resultview = $content.resultview)
	#end
	#if(!$resultview)
		#set($resultview = $module.get("moduleresultsview"))
	#end
	#if(!$resultview)
		#set($resultview = "table")
	#end

	
	$context.putPageValue("searchtype", $moduleid)
	$context.putPageValue("resultview",$resultview)
	
	#if($module.modulerendertype)
		$context.putPageValue("modulerendertype",$module.modulerendertype)
	#else
		$context.putPageValue("modulerendertype","entity")
	#end
	
	$context.putPageValue("moduletotalhits",$moduletotalhits)



	#if( $hits && $hits.size() > 0 )		
		$pages.include("${searchhome}/resultviews.html", $context)
	#else
	
		#set($addnew = "$!{componenthome}/entities/addnew.html")
		<div class="w-100 text-center mt-5">
			<p class="text-muted">[[No]] #text($module) [[created yet]]</p>
			<a class="btn btn-accent emdialog rounded"
			data-dialogid="entitypickeraddnew"
			data-hidefooter="true"
			data-targetdivinner="pickersearchentities"
			data-ajaxreloadtargets="onetomanytab"
			data-fieldexternalid="$!fieldexternalid"
			data-fieldexternalvalue="$!fieldexternalvalue"
			href="$addnew"
			title="[[Create New]] #text($entity)">
			<i class="bi bi-plus-lg mr-1"></i> [[Create New]]</a>
		
			#if($tabletype == "subentity")
				#set($entity = $mediaarchive.getCachedData("module", $searchtype))	
				<div id="resultsdiv$!{entity.getId()}"></div>
			#end
		</div>
	#end
		
</div>

##opens an entity
#set($entityid = $context.getRequestParameter('entityid'))
#set($entitytabopen = $context.getRequestParameter('entitytabopen'))
#if($entityid)
<span class="showentity" data-dataid="$entityid" data-entitytabopen="$!{entitytabopen}"></span>
#end

