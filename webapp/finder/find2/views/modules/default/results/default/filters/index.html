#if(!$moduleid)
	#set( $moduleid = $module.getId())
#end
##$hits

#if(!$categoryid)
	#set($categoryid = $context.getRequestParameter("categoryid"))
#end
#if(!$parentmoduleid)
	#set ( $parentmoduleid = $context.getRequestParameter("topmoduleid") )
#end
#if(!$entityid)
	#set ( $entityid = $context.getRequestParameter("entityid") )
#end
#if(!$targetdivsearch)
	#set ( $targetdivsearch = $context.getRequestParameter("targetdivsearch") )
#end
#if(!$targetdivsearch)
	#set($targetdivsearch = "$!{moduleid}resultscontainer")
#end

#if(!$tabletype)
	#set($tabletype = $context.getRequestParameter("tabletype"))
#end
#if(!$viewid)
	#set($viewid = $context.getRequestParameter("viewid"))
#end
	
<div id="moduleadvfilterpanel" class="advfilterpanel" >

<div class="advfilterpanelcontent" >
	#set( $view = "$moduleid/$!{moduleid}advancedfilter")

	#set( $searcher = $mediaarchive.getSearcher($moduleid))
	
	$context.putPageValue("view", $view)
	$context.putPageValue("searcher", $searcher)
	
	#set($usestartswith = $page.isPropertyTrue('usestartswith'))
	$context.putPageValue("usestartswith",$usestartswith)
	$context.putPageValue("caneditlists",false)

	#if(!$resultslink)
	#set($resultslink = $context.getRequestParameter("resultslink"))
	#end
	
	
	
	<form  	name="filterform" 
			id="filterform" 
			class="ajaxform autosubmitform filterform"
			method="POST" 

			action="${searchhome}/index.html"
			data-oemaxlevel="1"
			data-targetdiv="resultsdiv${module.id}"
	>
	<input type="hidden" name="targetdivsearch" value="$targetdivsearch" />
	<input type="hidden" name="searching" value="true" />
	
	#set($pickertarget = $context.getRequestParameter("pickertarget"))
	<input type="hidden" name="pickertarget" value="$!pickertarget" />
	
	#set($lightboxid = $context.getRequestParameter("lightboxid"))
	<input type="hidden" name="lightboxid" value="$!lightboxid" />
	
		##We need 2 things passed in: $searcher, $view or $searcher $details
		#set ($details = $searcher.getDetailsForView($view))

		
		#ifnull($idprefix)
			#set($idprefix = "search")
		#end
		$context.putPageValue("idprefix",$idprefix)
		
		##FILTERS
		#foreach( $detail in $details)   
			##set( $viewpermission = $context.getPageValue("canviewfilter${detail.getId()}") )
			$context.putPageValue("detail", $detail)
			$context.putPageValue("searchform", true)
			
			#set( $viewtype = $detail.searchcomponent )
			#if (!$viewtype)
				#set( $viewtype = $detail.viewType )
			#end
			#if (!$viewtype)
				#set ($viewtype = $detail.dataType)
			#end
			#if (!$viewtype || $viewtype == "text" || $detail.isMultiLanguage() || $viewtype == "textarea" || $viewtype == "html")
				#set ($viewtype = "default")
			#end
			#if ($viewtype == "date")
				#set ($viewtype = "datesearch")
			#end
			$context.putPageValue("viewtype", $viewtype)
			
			#if ($detail.isLeaf() )
				#set($filternode = $hits.findFilterValue($detail))
				$context.putPageValue("filternode",$filternode)
				#ifnull($filternode)
					#if( $viewtype != "list" && $viewtype != "entity" )  ##always show dates and text boxes
						$pages.include("${searchhome}/filters/detailedit.html", $context) 
					#else
						##dont show this on the form	
					#end	
				#end
				
				#ifnotnull($filternode)
					$pages.include("${searchhome}/filters/detailedit.html", $context) 
				#end
			#else
				#if($detail.hasChildren())
					$pages.include("${searchhome}/filters/section.html", $context) 
				#end
			#end
		#end
		
		#set( $nodeID = $context.getRequestParameter("nodeID"))
		
		#if($parentmoduleid)
			<input name="topmoduleid" type="hidden" value="$!topmoduleid" />
			<input name="entityid" type="hidden" value="$!entityid" />
			
			#if($tabletype == "subentity")
				#if($viewid)
					<input name="viewid" type="hidden" value="$!viewid" />
				#end
				<input name="field" type="hidden" value="$!fieldexternalid" />
				<input name="$!{fieldexternalid}.value" type="hidden" value="$!fieldexternalvalue" />
				<input type="hidden" name="operation" value="exact" />
				
				<input name="fieldexternalid" type="hidden" value="$!fieldexternalid" />
				<input name="fieldexternalvalue" type="hidden" value="$!fieldexternalvalue" />
			#else
				#set($dialogindextype = $context.getRequestParameter("dialogindextype"))
				<input name="dialogindextype" type="hidden" value="$!dialogindextype" />
				<input name="targetdivsearch" type="hidden" value="$!targetdivsearch" />
				
			#end
			
		#end
		
		#if( $categoryid )
			<input type="hidden" name="exact-search" value="false" />
			
			<input type="hidden" name="field" value="category" />
			<input type="hidden" name="operation" value="exact" />
			<input type="hidden" name="category.value" value="$categoryid" />
			<input type="hidden" name="nodeID" value="$!nodeID" />
			<input type="hidden" name="categoryid" value="$categoryid" />
		#end
		

		<input type="hidden" name="$!{moduleid}endusersearch" value="true"/>
	
		<input type="hidden" name="customproperty" value="userinputsearch"/>
		<input type="hidden" name="userinputsearch.value" value="true"/>
		<input type="hidden" name="removeterm" id="filtersremoveterm" value=""/>
			
##		#set ($resultview = $userprofile.get('resultview'))
##		#if( !$resultview )
##		<input type="hidden" name="resultstype" value="table" />
##		#end
		
		#set( $usefirstfilters = $userprofile.getBoolean("usefirstfilters"))
		#if( $hits.hasFiltersChanged() || $usefirstfilters )
			<div class="clearfix"></div>
			<div class="d-flex flex-column py-1 pl-2 my-1 bg-light align-items-right filter-showall-group">
				##<span class="text-brand">Filter Behavior</span>
				<div class="d-flex align-items-center">
					<label  class="mb-0 pr-2 #if($usefirstfilters)filter-exclusive #else filter-inclusive #end" for="filterautorefresh">[[Show Active Filters]]</label>
					<div class="custom-control custom-switch  boolean-switcher">
					<input 	type="hidden"	name="usefirstfilters"	value="$usefirstfilters" />
					<input 	type="checkbox"
						id="filterautorefresh" 
					name="usefirstfiltersvalue"
					class="custom-control-input "
					value="true"
					#if( $usefirstfilters) checked #end 
					>
					<label class="custom-control-label" for="filterautorefresh"></label>
					</div>
					<label class="mb-0 #if($usefirstfilters)filter-inclusive #else filter-exclusive  #end" for="filterautorefresh">[[Show All]]</label>
				</div>
			</div>
		#end
</form>

</div>
	
</div>