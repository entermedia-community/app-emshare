#set($entityid = $context.getRequestParameter("entityid"))
#if(!$entityid)
	#set($entityid = $context.getRequestParameter("entity"))
#end
#if(!$parentsearchtype)
	#set($parentsearchtype = $context.getRequestParameter("parentsearchtype"))
#end
$context.putPageValue("parentsearchtype", $parentsearchtype)
#if( !$entity)
	#set( $entity  = $mediaarchive.getData($parentsearchtype, $entityid) )
#end
#if(!$currenttab)
	#set($currenttab = $context.getRequestParameter("currenttab"))
#end
#if(!$parentmoduleid)
	#set ( $parentmoduleid = $context.getRequestParameter("topmoduleid") )
	$context.putPageValue("topmoduleid", $parentmoduleid)
#end
#ifnotnull($parentmoduleid)
		#set($parentmodule = $mediaarchive.getCachedData("module", $parentmoduleid))
#end

<div id="tab_media" 
class=" entity-tab-content entity-tab-media tabtypemedia" 
##style=" #if($currenttab != 'media' || $hidesubmodule) display:none; #end"
data-tabid="tab_media"
data-viewid="media"
data-entityid="$!entityid"
data-currenttab="$!currenttab"
data-parentsearchtype="$!parentsearchtype"
data-topmoduleid="$!topmoduleid"
data-url="${searchhome}/tabs/preview/entitytabmedia.html">
<div id="$!submodulepickerid" class="submodulepicker entity-tab-content" >
		
		#ifnull($defaultfolder)
			#ifnull($entity)
			
				##TODO: remove this
				#set($defaultfolder =  $mediaarchive.getBean("entityManager").loadDefaultFolderForModule($parentmodule, $context.getUser()))
			#end
			
			#ifnotnull($entity)
				#if($parentmodule.getId()=="faceprofilegroup")
					#set($defaultfolder =  $mediaarchive.getBean("entityManager").loadDefaultFolderForModule($parentmodule, $context.getUser()))		
				#else
					#set($defaultfolder =  $mediaarchive.getBean("entityManager").createDefaultFolder($entity, $context.getUser()))
				#end
			#end
		#end
		$context.putPageValue("defaultfolder", $defaultfolder)
		#if(!$currentcategoryid && $defaultfolder)
			#set( $currentcategoryid = $defaultfolder.getId())
			$context.putPageValue("categoryid", $currentcategoryid)
		#end

		$context.putPageValue("entitydialogid", "entity")
		
		$context.putPageValue("searchhome", "$apphome/views/modules/asset/results/entitydialog")
		$context.putPageValue("module", $mediaarchive.getCachedData("module","asset") )
		$context.putPageValue("moduleid", "asset")
		
		$pages.include("$apphome/views/modules/asset/results/entitydialog/index.html", $context)  
	
	<div class="clearfix"></div>
</div>
</div>


