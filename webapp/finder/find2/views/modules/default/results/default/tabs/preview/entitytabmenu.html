##always reset it?

#if($tabmodule)
	#set( $searchtype = $tabmodule.getId())
	#set( $moduleid = $tabmodule.getId())
#end
#ifnull($id)
	#set( $id = $context.getRequestParameter("id"))
#end
#ifnull($id)
	#set( $id = $context.getRequestParameter("entityid"))
#end
#if(!$tabtype)
	#set($tabtype = $context.getRequestParamenter("tabtype"))
#end

#set($tablink = "${searchhome}/tabs/preview/${tabtype}.html")
	
#if($tabtype == "tabsubmodulehome")
	#set($tabid = "tab_${viewid}")
	#set($tabname = $viewdata.getName($context))

#elseif($tabtype=="tabsubmoduleboxes")
	#set($tabid = "tab_submoduleboxes")
	#set($tabname = $viewdata.getName($context))
	#set($viewid = "tabsubmoduleboxes")
	##set($moduleicon = "check-circle")
	#set($tablink = "$apphome/views/modules/${entitymodule.id}/results/submoduleboxes/show.html")
#elseif($tabtype=="tablightboxes")
	#set($tabid = "tab_lightboxes")
	#set($tabname = $viewdata.getName($context))
	#set($viewid = "tablightboxes")
	#set($moduleicon = "check-circle")
	#set($tablink = "$apphome/views/modules/${entitymodule.id}/results/lightboxes/index.html")
#elseif($tabtype=="tablightboxboxes")
	#set($tabid = "tab_lightboxboxes")
	#set($tabname = $viewdata.getName($context))
	#set($viewid = "tablightboxboxes")
	#set($moduleicon = "check-circle")
	#set($tablink = "$apphome/views/modules/${entitymodule.id}/results/lightboxboxes/index.html")
#elseif($tabtype=="tabworkflowchat")
	#set($tabid = "tab_workflowchat")
	#set($tabname = $viewdata.getName($context))
	#set($viewid = "tabworkflowchat")
	#set($moduleicon = "chat-left-text")
	#set($tablink = "$componenthome/entities/chatterbox/index.html")	###TODO move this to results
#elseif($tabtype=="tabimport")
	#set($tabid = "tab_import")
	#set($tabname = "[[Import]]")
	#set($viewid = "tabimport")
	#set($moduleicon = "box-arrow-in-right")
	
#elseif($tabtype=="tabexport")
	#set($tabid = "tab_export")
	#set($tabname = "[[Export]]")
	#set($viewid = "tabexport")
	#set($moduleicon = "box-arrow-right")

#elseif($tabtype=="tabactivityhistory")
	#set($tabid = "tab_activityhistory")
	#set($tabname = "[[History]]")
	#set($viewid = "tabactivityhistory")
	#set($moduleicon = "clock-history")	

#elseif($tabtype=="entitytabmedia")
	#set($tabid = "tab_media")
	#set($tabname = $tabmodule.getName($context))
	#set($viewid = "media")
#else
	#if( !$entity)
		#set( $entity  = $mediaarchive.getData($searchtype, $id) )
	#end
	#set($tabname = $viewdata.getName($context))
	#set($targetentitytabid = "entity-tab-#eid($!{viewid})")
	#set($tabid = "tab_$viewid")
#end

<div class="entity-tab#if($currenttab == $viewid) current-entity#end"#if(!$tabtype) data-entityid="$!entity.getId()"#end>
	<a 
		#if($addnew=='true')
			href="#"
			data-isnewentity="true"
		#else
			href="$!{tablink}"
		#end 
		class="entity-tab-label"
		id="tab_$!tabid"
		data-tabid="$!tabid"
		data-currenttab="$!viewid"
		data-viewid="$!viewid"
		data-tabtype="$tabtype" 
		data-toggle="tab"
		data-target="$!targetentitytabid"
		data-entityid="$!entity.getId()" 
		data-entitymoduleid="$!entitymodule.id"
		#if($id.startsWith("multiedit"))
			data-ismultiedit="true"
			data-edit="true"
		#end 
		role="tab" 
		#if(!$tabtype)
			aria-controls="$targetentitytabid" 
			
		#end
		title="#esc($tabname)">

	   	#if (!$moduleicon && $tabmodule.moduleicon)
	   		#set($moduleicon = $tabmodule.moduleicon)
	   	#end

		#ifnull($moduleicon)
			#set($moduleicon = "box")
		#end

		<i class="bi bi-${moduleicon} module-icon"></i> 
		
		#if($tabtype == "submodulehome")
			#text($tabname)
		#elseif($tabtype=="media") 
			 #text($tabmodule)
		#else
			#text($tabname)
		#end
	</a>
</div>




