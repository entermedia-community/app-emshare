
#set($module = $mediaarchive.getCachedData("module", "asset"))
$context.putPageValue("module", $module)
#set($moduleid = $module.getId())

#set($componenthome = "$apphome/views/modules/asset/components")
$context.putPageValue("componenthome", $componenthome)

#if( !$category)
	#set($categoryid = $context.getRequestParameter("categoryid"))
	#if(!$categoryid)
		#set($categoryid = $context.getRequestParameter("rootcategory"))
	#end
	#if($categoryid)
		#set($category = $mediaarchive.getCachedData("category", $categoryid))
	#end
#end

#if( !$categoryid && $category)
	#set( $categoryid= $category.getId())
#end
$context.putPageValue("category", $category)
$context.putPageValue("categoryid", $categoryid)
#set($rootcategories = $category.getParentCategories()) 

#set($rootcategory = $context.getRequestParameter("rootcategory"))
#if(!$rootcategory)
	#set( $rootcategory = $categoryid)
#end

#set($resultview = $userprofile.get("assetresultview"))

#set($maintargetdiv = "dialogassetresultscontainer")
$context.putPageValue("maintargetdiv", $maintargetdiv)

$context.putPageValue("dialogresults", true)

#set( $targetdivmedia = "dialogmediaentity")
$context.putPageValue("targetdivmedia", $targetdivmedia)
#ifnull($lightboxassetsresults)
	#set($lightboxassetsresults = $context.getRequestParameter("lightboxassetsresults"))
#end
#ifnull($lightboxid)
	#set($lightboxid = $context.getRequestParameter("lightboxid"))
#end

#set($searchhomename = $page.get("searchhomename") )

<div id="$searchhomename"
	class="dialogassetresults assetresults resultsdiv resultsdiv${module.id}" 
	data-moduleid="asset"  ##required for sorting
	data-resultview="$!resultview"
	data-url="$searchhome/index.html"
	data-nodeID="$!categoryid"
	data-exactsearch="true"
	data-dialogresults="true"
	data-lightboxassetsresults="$!{lightboxassetsresults}"
	data-hitssessionid="$!hits.getSessionId()"
	data-componenthome = "$!componenthome"
	data-searchhome="$!searchhome"
	data-oemaxlevel="1"
	data-assetsortby="$!hits.getSearchQuery().getSortBy()"
	
	data-rootcategory="$!rootcategory"
	data-targetdiv="$searchhomename"
	data-category="$!category.id"
	
	data-lightboxid="$!lightboxid"  
	data-pagenum="$!hits.getPage()" 
	data-totalpages="$!hits.getTotalPages()"
	#ifnotnull($entity)
		data-entityid="$!entity.id"
		data-entitymoduleid="$!entitymodule.id"
	#end
		
	> 
	
	<div class="emgrid-module emgrid-box emgrid-module-asset h-100">
		
		$context.putPageValue("rootcategory", $rootcategory)

		#if($categoryid != $rootcategory)
			$context.putPageValue("selectednodes", $categoryid)
		#end
		
		#set($canupload = false)
		#if($canviewupload)
			#if($parentmodule.getBoolean("enableuploading") && $permissions.can($parentmoduleid, "upload_files"))
				#set($canupload = true)
			#end
		#end

		$context.putPageValue("canupload", $canupload)
		
		#ifnull($hidedialogtree)
		
			#set($dialogtreestatus = $userprofile.get("dialogtreestatus"))
			#ifnotnull($dialogtreestatus)
				#if($dialogtreestatus != "open")
					#set($dialogtreestatus = "close")
				#end
			#end
			#ifnull($dialogtreestatus)
				#set($dialogtreestatus = "close")
			#end
			$context.putPageValue("dialogtreestatus", $dialogtreestatus)
			
			<div class="embedmediacontainer">
				#if($dialogtreestatus == "open")
					<div class="embedmediacol embedmediacol-tree embedtreestatus$dialogtreestatus">
						<div class="embedmediacolactions d-flex align-items-center">
							
							<a href="#" 
							class="d-flex align-items-center toggledialogtree toggledialogclose"
							data-targetdiv="resultsdiv"
							data-oemaxlevel="1"
							data-url="$searchhome/index.html"
							data-entityid="$!entity.id"
							data-entitymoduleid="$!entitymodule.id"
							data-rootcategory="$!rootcategory"
							data-categoryid="$!categoryid"
							data-treestatus="close"
							title="[[Collapse Tree]]">
								<i class="fas fa-angle-double-left"></i>
								<h3 class="embedmediacolheader">[[Folders]]</h3>
							</a>
		
							#if($canviewupload && $parentmodule.getBoolean("enableuploading") && $permissions.can($parentmoduleid, "upload_files"))
							<a href="" 
								class="createfoldertree"
								data-tree="dialogentitymediatreetree" 
								style="width:32px;" 
								title="[[Add Sub-Folder]]"><i class="bi bi-folder-plus"></i></a>
								
							
							#end
						</div>
						
						<div class="assetdropcategory h-100 dialogdroppable">
							<div class="embedmediatree">
							
							#set( $link = "$componenthome/emtree/tree.html")
							#set( $link = "${link}?dialogentitymediatreeroot=$rootcategory&treename=dialogentitymediatree&editabletree=true&targetdivsearch=$!targetdivmedia" )
							#set( $link = "${link}&maintargetdiv=$!maintargetdiv&targetdiv=$!targetdivmedia&maxlevelclick=1&updateAddressBar=false&uploadmaxlevel=1&nodeID=$!{categoryid}&exactsearch=true" )
							#set( $link = "${link}&customurladdmedia=$apphome/views/modules/asset/add/entityaddmedia.html" )
							#set( $link = "${link}&oemaxlevel=1&urlprefix=$apphome/views/modules/asset/dialogshowcategory.html" )
								
							$pages.include($link, $context)
							</div>
						</div>
					</div>
				#end
			#end
			<div class="embedmediacol embedmediacol-results" #ifnotnull($hidedialogtree)style="width:100%;"#end>
				<div id="dialogmediaentity" >
					#set( $uploadmedia = $context.getRequestParameter("uploadmedia"))
					
					#if($uploadmedia && $canupload)
						$pages.include("$apphome/views/modules/asset/add/entityaddmedia.html?categoryid=$rootcategory", $context)
					#else
						$context.putPageValue("targetdivsearch", $targetdivmedia)
						$context.putPageValue("resultview",$resultview)
						
						$pages.include("${searchhome}/resultviews.html", $context)
					#end
				</div>
			</div>
		</div>
		
	</div>


</div>
