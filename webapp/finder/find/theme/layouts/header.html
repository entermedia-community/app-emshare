<div class="emheader">
<!-- <div class=" navbar  navbar-expand-lg navbar-dark ">
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
	    <span class="navbar-toggler-icon"></span>
	  </button>
	<div class="collapse navbar-collapse navlinks" id="navbarNav">
	<ul class="navbar-nav  ml-auto">

		#if( $user )
			<li class="nav-item nav-first-item"><a class="emdialog" data-width="900" data-height="1900" title="[[Help Center]]" href="$siteroot$apphome/views/modules/help/helpcenter.html">[[Help]]</a></li>
	    	#if( $canviewmyaccount ) 
	   			<li class="nav-item"><a href="$siteroot$apphome/views/myaccount/myassets/index.html">[[My Account]]</a></li>	    	
	    	#end
			 <li   class="nav-item"><a href="https://entermediadb.org/app/workspaces/index.html">[[My Workspaces]]</a></li>
	    	<li   class="nav-item"><a href="$siteroot$apphome/authentication/logout.html">[[Logout]]</a></li> 
	    #else 
	    	<li class="nav-item nav-first-item"><a href="$siteroot$apphome/authentication/login.html" class="first">[[Login]]</a></li> 
	    #end
	    #if($user)
		#set( $localesearcher = $mediaarchive.getSearcher("locale") )
	       #set($currentlang = $localesearcher.searchById($context.language))
	      #if($currentlang)
	 	<li class="nav-item dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">$currentlang</a> 
	    #else
	 	<li class="nav-item dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">[[Language]]</a> 
	     #end
	  
	  	<div id="language-bar-select" class="dropdown-menu">
			#set( $localesearcher = $mediaarchive.getSearcher("locale") )
			#set( $languages = $localesearcher.query().match("enabled", "true").search($context) )
			#foreach( $lang in $languages)
				#set($langurl = "$siteroot$apphome/components/languages/changelanguage.html?newlang=locale_$lang.id&origURL=$context.getPathUrl()")
				 <a class="dropdown-item" href="#urlescape($langurl)">$lang </a>
			#end
	    </div> 
		</li>
		#end	
		
	    #if($canviewsettings)
	   	<li><a href="$siteroot$apphome/views/dashboard/index.html" >[[Dashboard]]</a></li> 
	   	<li><a #if ( $module ) href="$siteroot$apphome/views/settings/modules/$module.id/index.html" #else href="$siteroot$apphome/views/settings/index.html" #end>[[Settings]]</a></li> 
	    #end 
	</ul>
 </div>
</div> -->

#set( $workspaceproviderurl = $mediaarchive.getCatalogSettingValue("workspace-provider-url"))

	<nav class="navbar navbar-dark bg-dark justify-content-between">
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse" id="navbarNavDropdown">
			<ul class="navbar-nav">
			<li class="nav-item dropdown" id="workspacedropmenu">
				<a class="nav-link dropdown-toggle workspaces" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	              [[My Workspaces]]
	            </a>
		        <div id="workspacelist" class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">	</div>
			</li>
			#set( $workspaceid = $mediaarchive.getCatalogSettingsValue("workspace-id"))
			#if( $workspaceid )
			<li class="nav-item">
				<a class="nav-link" href="${workspaceproviderurl}/app/collective/community/index.html?collectionid=$workspaceid">[[Workspace Team]]</a>
			</li>
			#end
			<li class="nav-item">
				<a class="nav-link" href="/finder/find/authentication/logout.html">[[Logout]]</a>
			</li>
			</ul>
		</div>
	</nav>
</div>


<div id="header" class="mediacenterheader">
	<div class="pushcontent #if($sidebarcomponent) pushcontent-open pushcontent-$sidebarcomponent #end"
	style="#if($sidebarcomponent && $sidebarwidth) margin-left:${sidebarwidth}px;#end">
	
	<div class="logocontainer">
		<a class="emlogo" href="$siteroot$apphome/index.html" title="[[EnterMedia Insights]]">
			<span><img src="$siteroot$themeprefix/images/emfinder.png" alt="[[EnterMedia Insights]]" /></span>
		</a>
	</div>
		
	  #if(!$hidefilters)
	        $pages.include("$apphome/components/gridfilters/header-search.html", $context)
	        ##$pages.include("$apphome/components/gridfilters/filters-selected.html", $context)
	    #end
	</div>
</div>



<script>
var emKey = "#esc($userprofile.entermediacloudkey)";
if (emKey) {
	emKey = encodeURIComponent(emKey);	
	
	const rootsite='$workspaceproviderurl';
	$(".workspaces").on('click', function() {	
		var href = `${rootsite}/entermediadb/mediadb/services/authentication/workspacesonteam.json?noredirect=true&entermedia.key=${emKey}`; // TODO: call in java		
		$('#workspacelist').html('');
		$.ajax({type: "GET", url: href, crossDomain: true, 
	        success:function(result) {	        	
	        	if (result.status === "error") {
	        		const url = '<a class="dropdown-item" target="_blank" href="https://emediafinder.com">eMediaFinder.com</a>';
	        	  	$('#workspacelist').append(url);
	        		return;
	        	}	        	
	        	if (result.workspaces.length > 0) {
		        	$.each(result.workspaces, function (i, ws) {
		        		console.log(result);
		        		const url = '<a class="dropdown-item" href="'
		        		 	+ ws.url + '/finder/find/startmediaboat.html?'
		        			+ 'entermediacloudkey=' + result.userKey 
		        			+ "&collectionid=" + ws.collectionid + '">'
		        			+ ws.name + '</a>';
		        	    $('#workspacelist').append(url);
		        	});
	        	} else {
	        		const url = '<a class="dropdown-item" target="_blank" href="https://emediafinder.com/app/workspaces/index.html">Create a Workspace</a>';
		        	$('#workspacelist').append(url);
		            return;
	        	}
	        },
	        error:function(result) {
	        }
	    });
	});
} else {
	const url = '<a class="dropdown-item" target="_blank" href="https://emediafinder.com">eMediaFinder.com</a>';
  	$('#workspacelist').append(url);
}

//url: href, async: false, data: {}, success: function (data) {		
//	console.log('thing');
//}
</script>
