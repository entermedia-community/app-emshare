#if($cansidebar)
	#set($forcedsidebarcomponent = $context.getRequestParameter("sidebarcomponent")) 
	#if($forcedsidebarcomponent)
		#set( $sidebarcomponent = $forcedsidebarcomponent )
	#end
	
	#if($sidebarcomponent == "categories" && !$canviewcategorynav )
		#set($sidebarcomponent = "")
	#end
	#if($sidebarcomponent)
		#set( $sidebarwidth = $userprofile.get("sidebarwidth"))
		
		#if($sidebarwidth=='' || $sidebarwidth=='undefined')
			#set($sidebarwidth = 280)
		#end
	#end
#end

<div id="header" class="mediacenterheader autostickywidth d-flex align-items-center justify-content-between pl-2 pr-3">
	<div class="logocontainer">
		#set ($homeurl = "$!{siteroot}$apphome/index.html")
		#ifnotnull($category)
			#set( $assetid = $category.findValue("headercategoryimage") )
			#ifnotnull($assetid)
				#set($logoasset = $mediaarchive.getCachedData("asset",$assetid))
				#set($logourl = $mediaarchive.asLinkToOriginal($logoasset))
				#set($logourl = "$siteroot/$mediadbappid/services/module/asset/downloads/originals/${logourl}")
			#end
			#ifnotnull( $logourl)
			<a class="emlogo-custom" href="$homeurl" title="[[eMediaWorkspace]]" data-clearfilters="true">
				<img src="$logourl" class="logoimg" alt="[[eMediaWorkspace]]" />
			</a>
			#end
		#end
		#ifnull( $logourl)
			#set( $logourl = "$!{siteroot}$themeprefix/images/logo.png")
			<a class="emlogo" href="$homeurl" title="[[eMediaWorkspace]]">
				<img src="$logourl" class="logoimg" alt="[[eMediaWorkspace]]" />
			</a>
		#end
	</div>
	
	#if($canviewquicksearchheader)
		$pages.include("$apphome/components/gridfilters/header-search.html", $context)
	#end
	
	#if($user)
	<div class="d-flex align-items-center z-n1">
		#set($uploadmodules = 0)
		#foreach ( $amodule in $userprofile.getEntities() )
			#if($amodule.getBoolean("enableuploading"))
				#set($uploadmodules = $uploadmodules  +1)
			#end
		#end
		#if( $uploadmodules > 0 && $canviewupload )
			<div class="headeruploadarea">
				##$pages.include("$apphome/components/upload/types/html5inlinetop.html", $context)
				<div class="dropdown show">
					<a class="btn-upload dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						[[Upload to]]
					</a>
					<div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuLink">
						#foreach ( $amodule in $userprofile.getEntities() )
							#set($amoduleid = $amodule.getId())

							
							#if($amodule.getBoolean("enableuploading"))
								#if($permissions.can($amoduleid, "create") && $amoduleid!="faceprofilegroup" && $amoduleid!="asset" && $amoduleid!="modulesearch")
									#set($entityrendertype = "entity")
									#if ($amodule.modulerendertype)
										#set($entityrendertype = $amodule.modulerendertype)
									#end
									##set($addurl = "$siteroot$applink/views/modules/${amoduleid}/components/gridsample/preview/$!{entityrendertype}.html?edit=true&addnew=true&viewid=$!{moduleid}addnew")
									
									#set($addurl = "$siteroot$applink/views/modules/${amoduleid}/components/entities/search/searchpicker.html")
									
									#ifnotnull($topentityid)
										#set($addurl = "$addurl&fieldexternalid=${topmodule.getId()}&fieldexternalvalue=${topentityid}&reloadtargets=topmodulecontainer")
									#end
									<a class="dropdown-item emdialog" 
										href="$addurl" 
										data-viewfiles="true"
										data-width="1200">#text($amodule)</a>
									#if($amoduleid=="librarycollection")
									<a class="dropdown-item ajax sidebarselected"
										data-updateurl="true" 
										data-targetdiv="applicationmaincontent" 
										data-oemaxlayout="3"
										href="$siteroot$applink/views/modules/asset/add/start.html"
										title="[[Upload Media]]">[[My Gallery]]</a>	
									#end
									
								#end
							#end
							
							
						#end

					</div>
				</div>
			</div>
		#end
		
		#if($canviewbasket)
			$pages.include("$apphome/components/basket/menuitem.html")
		#end
		
		#if($user && $canaddtofavorites)
			<a href="$siteroot$applink/views/modules/modulesearch/bookmarks.html" 
				class='ajax activelistener btn-upload #if( $selected=="favorites" || $selected=="modulesearch") active #end' 
				data-targetdiv="applicationmaincontent" 
				data-oemaxlevel="3" 
				data-clearselection="true"
				data-clearfilters="true"
				data-updateurl="true"
				data-scrolltotop="true"
				title="[[View Bookmarks]]">
					[[Bookmarks]] <i class="bi bi-bookmarks-fill ml-1"></i>
			</a> 
		#end

		#if($canviewsettings && $userprofile.hasModule("order") )
			#set( $orders = $mediaarchive.query("order").exact("checkoutstatus","pending").search($context))
		#end
		<div class="position-relative em">
			#if( $orders.size() > 0)
				<div class="dot-badge" role="alert"></div>
			#end
			<button class="dropdown-toggle" type="button" data-toggle="dropdown">
				<span class="navbar-toggler-icon text-white"></span>
			</button> 
			<div class="dropdown-menu dropdown-menu-right"> 
				#if($canviewsettings)
					#if( $orders.size() > 0)
						<a href="$apphome/views/modules/order/pending.html" 
							class="dropdown-item ajax" 
							data-targetdiv="applicationmaincontent" 
							data-oemaxlevel="3" 
							data-updateurl="true" 
							title="[[Pending Orders]]">
							$orders.size() [[Pending Orders]]
						</a>
					#end
					<a href="$!{siteroot}$apphome/views/dashboard/index.html" class="dropdown-item ajax" 
						data-targetdivinner="application" data-updateurl="true" data-oemaxlevel="4" title="[[Dashboard]]">
						[[Dashboard]]
					</a>
				#end
				#if( $user )
					#if( $canviewmyaccount ) 
						<a class="dropdown-item ajax" data-targetdivinner="application" data-updateurl="true" data-oemaxlevel="4" href="$!siteroot$apphome/views/myaccount/index.html"  title="[[Account Settings]]">
							[[My Account]]
						</a>
						<a class="dropdown-item ajax" data-targetdivinner="application" data-updateurl="true" data-oemaxlevel="4" href="$!siteroot$apphome/views/myaccount/orders/index.html"  title="[[My Orders]]">
							[[My Orders]]
						</a>
					#end
					#set( $localesearcher = $mediaarchive.getSearcher("locale") )
					#set($currentlang = $localesearcher.searchById($context.language))
					<div class="dropdown dropleft">
						<a class="dropdown-item dropdown-toggle" href="#" data-toggle="dropdown">
							#if($currentlang)
								$currentlang
							#else
								[[Language]]
							#end
						</a> 
						<div id="language-bar-select" class="dropdown-menu">
							#set( $languages = $localesearcher.query().named("localehits").match("enabled", "true").search($context) )
							#foreach( $lang in $languages)
								#set($langurl = "$home$apphome/components/languages/changelanguage.html?newlang=locale_${lang.id}&origURL=$context.getPathUrl()")
								<a class="dropdown-item" href="#urlescape($langurl)">$lang</a>
							#end
						</div> 
					</div> 
          #if ( $canviewappsmenu && !$appsmenu.isEmpty())
          <div class="dropdown dropleft site-switcher">
            <a class="dropdown-item dropdown-toggle" href="#" data-toggle="dropdown"> 
              <i class="bi bi-arrow-repeat mr-2"></i>[[Switch Site]]
            </a>
            <div class="dropdown-menu">
              #foreach( $link in $appsmenu)
                #set($linkurl = $link.get("url"))
                #ifnotnull($linkurl) 
                  <a href='$linkurl' class='dropdown-item' title='#if( $link.deploypath != $apphome)[[Go to]] #end #text($link)'>
                    #if( $link.deploypath == $apphome)<i class="bi bi-check-circle-fill ns mr-2"></i>#end #text($link)
                  </a>
                #end
              #end
            </div>
          </div>
          #end
					<a class="dropdown-item" href="$!siteroot$apphome/authentication/logout.html" title="[[Logout]]">
						[[Logout]] ($user)
					</a> 
				#else  
					<a class="dropdown-item" href="$!siteroot$apphome/authentication/login.html"  title="[[Login]]">
						[[Login]]
					</a> 
				#end 
			</div>
		</div>
	</div>
	#end
</div>