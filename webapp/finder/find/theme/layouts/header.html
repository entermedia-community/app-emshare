<div class="emheader">
<!-- <div class=" navbar  navbar-expand-lg navbar-dark ">
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
	    <span class="navbar-toggler-icon"></span>
	  </button>
	<div class="collapse navbar-collapse navlinks" id="navbarNav">
	<ul class="navbar-nav  ml-auto">

		#if( $user )
			<li class="nav-item nav-first-item"><a class="emdialog" data-width="900" data-height="1900" title="[[Help Center]]" href="$home$apphome/views/modules/help/helpcenter.html">[[Help]]</a></li>
	    	#if( $canviewmyaccount ) 
	   			<li class="nav-item"><a href="$home$apphome/views/myaccount/myassets/index.html">[[My Account]]</a></li>	    	
	    	#end
			 <li   class="nav-item"><a href="https://entermediadb.org/app/workspaces/index.html">[[My Workspaces]]</a></li>
	    	<li   class="nav-item"><a href="$home$apphome/authentication/logout.html">[[Logout]]</a></li> 
	    #else 
	    	<li class="nav-item nav-first-item"><a href="$home$apphome/authentication/login.html" class="first">[[Login]]</a></li> 
	    #end
	    #if($user)
		#set( $localesearcher = $mediaarchive.getSearcher("locale") )
	       #set($currentlang = $localesearcher.searchById($context.language))
	      #if($currentlang)
	 	<li class="nav-item dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">$currentlang</a> 
	    #else
	 	<li class="nav-item dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">[[Language]]</a> 
	     #end
	  
	  	<div id="language-bar-select" class="dropdown-menu">
			#set( $localesearcher = $mediaarchive.getSearcher("locale") )
			#set( $languages = $localesearcher.query().match("enabled", "true").search($context) )
			#foreach( $lang in $languages)
				#set($langurl = "$home$apphome/components/languages/changelanguage.html?newlang=locale_$lang.id&origURL=$context.getPathUrl()")
				 <a class="dropdown-item" href="#urlescape($langurl)">$lang </a>
			#end
	    </div> 
		</li>
		#end	
		
	    #if($canviewsettings)
	   	<li><a href="$home$apphome/views/dashboard/index.html" >[[Dashboard]]</a></li> 
	   	<li><a #if ( $module ) href="$home$apphome/views/settings/modules/$module.id/index.html" #else href="$home$apphome/views/settings/index.html" #end>[[Settings]]</a></li> 
	    #end 
	</ul>
 </div>
</div> -->

	<nav class="navbar navbar-dark bg-dark justify-content-between">
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse" id="navbarNavDropdown">
			<ul class="navbar-nav">
			<li class="nav-item active">
				<a class="nav-link" href="#">[[Dashboard]] <span class="sr-only">([[current]])</span></a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="#">[[My Account]]</a>
			</li>
			<li class="nav-item dropdown" id="workspacedropmenu">
				
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/finder/find/views/settings/status/tools/index.html">[[Settings]]</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="/views/modules/help/helpcenter.html">[[Help]]</a>
			</li>
			</ul>
		</div>
	</nav>
</div>


<div id="header" class="mediacenterheader">
	<div class="pushcontent #if($sidebarcomponent) pushcontent-open pushcontent-$sidebarcomponent #end"
	style="#if($sidebarcomponent && $sidebarwidth) margin-left:${sidebarwidth}px;#end">
	
	<div class="logocontainer">
		<a class="emlogo" href="$home$apphome/index.html" title="[[EnterMedia Insights]]">
			<span><img src="$home$themeprefix/images/emfinder.png" alt="[[EnterMedia Insights]]" /></span>
		</a>
	</div>
		
	  #if(!$hidefilters)
	        $pages.include("$apphome/components/gridfilters/header-search.html", $context)
	        ##$pages.include("$apphome/components/gridfilters/filters-selected.html", $context)
	    #end
	</div>
</div>



<script>
const emKey = "#esc($userprofile.entermediacloudkey)";
if (emKey) {
	$("#workspacedropmenu").html('<a class="nav-link dropdown-toggle workspaces" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'
	    +'[[My Workspaces]] </a>'
		+ '<div id="workspacelist" class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">	</div>');	
	
	const rootsite='https://emediafinder.com';
	$(".workspaces").on('click', function() {	
		var href = `${rootsite}/entermediadb/mediadb/services/authentication/workspacesonteam.json?entermedia.key=${emKey}`; // TODO: call in java
		$.ajax({type: "GET", url: href, crossDomain: true, 
	        success:function(result) {
	        	$('#workspacelist').html('');
	        	$.each(result.workspaces, function (i, ws) {
	        		console.log(result);
	        		const url = '<a class="dropdown-item" href="'
	        		 	+ ws.url + '/finder/find/startmediaboat.html?'
	        			+ 'entermediacloudkey=' + result.userKey 
	        			+ "&collectionid=" + ws.collectionid + '">'
	        			+ ws.name + '</a>';
	        	  $('#workspacelist').append(url);
	        	});
	        },
	        error:function(result) {
	        }
	    });
	});
}

//url: href, async: false, data: {}, success: function (data) {		
//	console.log('thing');
//}
</script>
