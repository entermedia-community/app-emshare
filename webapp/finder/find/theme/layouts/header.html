#if($cansidebar)
	#set($forcedsidebarcomponent = $context.getRequestParameter("sidebarcomponent")) 
	#if($forcedsidebarcomponent)
		#set( $sidebarcomponent = $forcedsidebarcomponent )
	#end
	
	#if($sidebarcomponent == "categories" && !$canviewcategorynav )
		#set($sidebarcomponent = "")
	#end
	#if($sidebarcomponent)
		#set( $sidebarwidth = $userprofile.get("sidebarwidth"))
		
		#if($sidebarwidth=='' || $sidebarwidth=='undefined')
			#set($sidebarwidth = 280)
		#end
	#end
#end

<div id="header" class="mediacenterheader autostickywidth d-flex align-items-center justify-content-between pl-2 pr-3">
	<div class="logocontainer">
		#set ($homeurl = "$!{siteroot}$apphome/index.html")
		#ifnotnull($category)
			#set( $assetid = $category.findValue("headercategoryimage") )
			#ifnotnull($assetid)
				#set($logoasset = $mediaarchive.getCachedData("asset",$assetid))
				#set($logourl = $mediaarchive.asLinkToOriginal($logoasset))
				#set($logourl = "$siteroot/$mediadbappid/services/module/asset/downloads/originals/${logourl}")
			#end
		#end
		
		#ifnull($logourl)
			
			#set($themeid = $userprofile.getValue("themeid") )
			#ifnull($themeid)
				#set($themeid = $content.get("themeid") )
			#end	
			
			#set( $logourl = "$!{siteroot}$themeprefix/$themeid/logo.png")
			
			#set($theme = $mediaarchive.getCachedData("theme", $themeid))
	    	#set($logowidth = $theme.logowidth)
	    	#set($logoheight = $theme.logoheight)
		#end
		
		#ifnotnull($logourl)
			<a class="emlogo" href="$homeurl" title="[[eMedia Library]]" style="width: var(--themed-logo-width); height: var(--themed-logo-height);">
				<img src="$logourl" class="logoimg" alt="[[eMedia Library]]" />
			</a>
		#end
		
		
    #if ( $canviewappsmenu && $appsmenu.size() > 1)
    <div class="dropdown site-switcher">
      <button class="dropdown-toggle btn py-1 px-2 rounded" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <i class="fas fa-chevron-down text-white" style="margin-top: 2px;"></i>
      </button>
      <div class="dropdown-menu">
        #foreach( $link in $appsmenu)
          #set($linkurl = $link.get("url"))
          #ifnotnull($linkurl) 
            <a href='$linkurl' class='dropdown-item d-flex align-items-center' title='#if( $link.deploypath != $apphome)[[Go to]] #end #text($link)'>
              #text($link) #if( $link.deploypath == $apphome)<i class="bi bi-check-circle-fill ns ml-2"></i>#end
            </a>
          #end
        #end
      </div>
    </div>
    #end
	</div>
	
	#if($canviewquicksearchheader)
		$pages.include("$apphome/components/quicksearch/header-search.html", $context)
	#end
	
	#if($user)
	<div class="d-flex align-items-center z-n1">
		#set($uploadmodules = 0)
		#foreach ( $amodule in $userprofile.getEntities() )
			#if($amodule.getBoolean("enableuploading"))
				#set($uploadmodules = $uploadmodules  +1)
			#end
		#end
		#if( $uploadmodules > 0 && $canviewupload )
			<div class="headeruploadarea">
				<div class="dropdown">
					<a class="btn-topnav dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						[[Upload To]]
					</a>
					<div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuLink">
						#foreach ( $amodule in $userprofile.getEntities() )
							#set($amoduleid = $amodule.getId())
							#if($amodule.getBoolean("enableuploading"))
								#if($permissions.can($amoduleid, "create") && $amoduleid!="faceprofilegroup" && $amoduleid!="asset" && $amoduleid!="modulesearch")
								
									#set($addurl = "$siteroot$applink/views/modules/${amoduleid}/editors/pickerforuploading/index.html")
									<a class="dropdown-item emdialog" 
										data-hidefooter="true"
										data-dialogid="entityuploadto"
										href="$addurl" 
										title="[[Upload To]] #text($amodule)"
										data-width="1200"	>#text($amodule)</a>
								#end
							#end
						#end
					</div>
				</div>
			</div>
		#end

		#if($user && $canviewupload)
			<a href="$siteroot$applink/views/modules/contentcreator/index.html" 
				class='ajax activelistener btn-topnav' 
				data-targetdiv="applicationmaincontent" 
				data-oemaxlevel="3" 
				data-clearselection="true"
				data-clearfilters="true"
				data-updateurl="true"
				data-scrolltotop="true"
				title="[[Create Content with AI]]">
				<i class="bi bi-magic"></i>
			</a> 
		#end
		
		#if($cancheckout)
			$pages.include("$apphome/components/basket/menuitem.html")
		#end

		#if($user && $canaddtofavorites)
			<a href="$siteroot$applink/views/modules/modulesearch/editors/modulesearchbookmarks/index.html" 
				class='ajax activelistener btn-topnav' 
				data-targetdiv="applicationmaincontent" 
				data-oemaxlevel="3" 
				data-clearselection="true"
				data-clearfilters="true"
				data-updateurl="true"
				data-scrolltotop="true"
				title="[[View Bookmarks]]">
				<i class="bi bi-bookmarks-fill"></i>
			</a> 
		#end
		#set($guidelink = $mediaarchive.getCatalogSettingValue("guidelink"))
		#ifnotnull($guidelink)
			<a class="btn-topnav" target="_blank" href="$guidelink" title="[[Guides]]">
				<i class="bi bi-book"></i>
			</a>
		#end
		#if($canviewsettings && $userprofile.hasModule("order") )
			#set( $orders = $mediaarchive.query("order").exact("checkoutstatus","pending").search($context))
		#end
		<div class="position-relative em">
			<div class="dropdown">
			#if( $orders.size() > 0)
				<div class="dot-badge" role="alert"></div>
			#end
			<button class="dropdown-toggle dropdown-toggle-btn" type="button" data-toggle="dropdown">
				<span class="navbar-toggler-icon">
					<i class="bi bi-person-circle"></i>
				</span>
			</button> 
			
			<div class="dropdown-menu dropdown-menu-right"> 
				#if($canviewsettings)
					#if( $orders.size() > 0)
						<a href="$apphome/views/modules/order/pending.html" 
							class="dropdown-item ajax" 
							data-targetdiv="applicationmaincontent" 
							data-oemaxlevel="3" 
							data-updateurl="true" 
							title="[[Pending Orders]]">
							$orders.size() [[Pending Orders]]
						</a>
					#end
					## <a href="$!{siteroot}$apphome/views/dashboard/index.html" class="dropdown-item ajax" data-targetdivinner="application" data-updateurl="true" data-oemaxlevel="4" title="[[Dashboard]]">
					## 	[[Dashboard]]
					## </a>
				#end
				#if( $user )
					#if( $canviewmyaccount ) 
						<a class="dropdown-item ajax" data-targetdivinner="application" data-updateurl="true" data-oemaxlevel="4" href="$!siteroot$apphome/views/myaccount/index.html"  title="[[Account Settings]]">
							[[My Account]]
						</a>
						<a class="dropdown-item ajax" data-targetdivinner="application" data-updateurl="true" data-oemaxlevel="4" href="$!siteroot$apphome/views/myaccount/orders/index.html"  title="[[My Orders]]">
							[[My Orders]]
						</a>
					#end
					<div class="dropdown dropleft">
						<a class="dropdown-item dropdown-toggle" href="#" data-toggle="dropdown" style="padding-left:0.25rem">
							<i class="bi bi-palette mr-1"></i> [[Theme]]: <strong>#text($theme)</strong>
						</a>
						<div class="dropdown-menu">
							#set($themes = $mediaarchive.getList("theme") )
							#set($currentthemeid = $userprofile.getValue("themeid") )
							#foreach( $th in $themes)
							<a class="dropdown-item changeuserprofile" 
								href="$home$apphome"
								data-propertyname="themeid"
								data-themeid="$th.id">#if($currentthemeid==$th.id)<i class="bi bi-check-circle-fill ns mr-1"></i>#end#text($th)</a>
							#end
						</div>
					</div> 
					#if($desktop)
						<a class="dropdown-item emdialog" href="$apphome/components/sidebars/localdrives/workspacedialog.html"  title="[[Local Workspace]]">
							[[Local Workspace]]
						</a>
					#end
					#set( $localesearcher = $mediaarchive.getSearcher("locale") )
					#set($currentlang = $localesearcher.searchById($context.language))
					<div class="dropdown dropleft">
						<a class="dropdown-item dropdown-toggle" href="#" data-toggle="dropdown" style="padding-left:0.25rem">
							<i class="bi bi-translate mr-1"></i>
							#if($currentlang)
								$currentlang
							#else
								[[Language]]
							#end
						</a> 
						<div id="language-bar-select" class="dropdown-menu">
							#set( $languages = $localesearcher.query().named("localehits").match("enabled", "true").search($context) )
							#foreach( $lang in $languages)
								#set($langurl = "$home$apphome/components/languages/changelanguage.html?newlang=locale_${lang.id}&origURL=$context.getPathUrl()")
								<a class="dropdown-item" href="#urlescape($langurl)">$lang</a>
							#end
						</div> 
					</div>
					#ifnull($destop)
						<a class="dropdown-item" target="_blank" href="https://emedialibrary.com/downloads.html" title="[[Desktop App]]">
							<i class="bi bi-laptop mr-1"></i> [[Desktop App]]
						</a>
					#end
					<a class="dropdown-item" href="$!siteroot$apphome/authentication/logout.html" title="[[Logout]]">
						<i class="bi bi-box-arrow-right mr-1"></i> [[Logout]] ($user)
					</a> 
				#else
					<a class="dropdown-item" href="$!siteroot$apphome/authentication/login.html"  title="[[Login]]">
						[[Login]]
					</a> 
				#end 
			</div>
			</div>
		</div>
	</div>
	#end
</div>