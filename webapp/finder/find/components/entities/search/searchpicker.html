<div id="pickersearchentities" >
	
	#set($moduleid = $context.getRequestParameter("moduleid"))
	#if(!$moduleid)
		#set($moduleid = $module.getId())	
	#end
	
	#set($copyinghitssessionid = $context.getRequestParameter("copyinghitssessionid"))
	#set($copyinghits = $context.getSessionValue($copyinghitssessionid))

	#set($copyingsearchtype = $context.getRequestParameter("copyingsearchtype"))
	
	#set($assetid = $context.getRequestParameter("assetid"))
	
	#set($copyingcategoryid = $context.getRequestParameter("copyingcategoryid"))
	

	#if( $copyinghits || $assetid)
	<div class="alert alert-info">
		
		#if( $copyinghitssessionid && $copyinghits.getSelectionSize() > 0)	
		  		<strong>[[Adding]]</strong> $copyinghits.getSelectionSize() [[items]]
		#elseif($assetid)	
				<strong>[[Adding]]</strong> 1 [[asset]]
		#end	
	</div>
	#end
	
	#set($pickersearchaddnew = $context.getRequestParameter("pickersearchaddnew"))
	#if($pickersearchaddnew)
		#set($addnew = "$apphome/views/modules/${moduleid}/components/entities/addnew.html")
		#set($pickertarget = $context.getRequestParameter("pickertarget"))
		<a class="btn btn-sm btn-blue mb-2 float-right ajax"
		data-targetdivinner="pickersearchentities"
		data-pickertarget="$!pickertarget"
		data-oemaxlevel="1"
		href="$addnew">
		<i class="bi bi-plus-lg mr-1"></i> [[New]] #text($module)</a>
	#else
		#set($addnew = "$apphome/views/modules/${moduleid}/components/gridsample/preview/entity.html")
		
		#if($assetid)
			#set($addnew = "${addnew}?edit=true&addnew=true&viewfiles=true&saveaction=addassets&assetid=$!assetid")
		#elseif($copyingcategoryid)
			#set($addnew = "${addnew}?edit=true&addnew=true&viewfiles=true&copyingsearchtype=$!copyingsearchtype&saveaction=additems&copyingcategoryid=$!copyingcategoryid&moduleid=$moduleid")
		#elseif($copyinghits)
			#set($addnew = "${addnew}?edit=true&addnew=true&viewfiles=true&copyingsearchtype=$!copyingsearchtype&saveaction=additems&copyinghitssessionid=$!copyinghitssessionid&moduleid=$moduleid")
		#else
			#set($addnew = "${addnew}?edit=true&addnew=true&saveaction=upload")
		#end
		<a class="btn btn-sm btn-blue mb-2 float-right emdialog"
		data-dialogid="addnewentity"
		href="$addnew">
		<i class="bi bi-plus-lg mr-1"></i> [[New]] #text($module)</a>
	#end
	
     
    <form  id="colsearchform" 
	    class="ajaxform autosubmit"  
	    data-targetdivinner="entitypickerresults" 
	    action="$home$apphome/views/modules/$!{moduleid}/components/entities/search/results.html">

		<input type="hidden" name="sortby" value="name" />
		<input type="hidden" name="assetid" value="$!asset.id" />
		<table  width="100%">
		<tr>
		<td>
		<div class="row inlinesearch" style="margin-bottom: 10px;;" >
			$context.putPageValue("autocomplete","off")
			<input type="hidden" name="operation" value="contains" />
			<input type="hidden" name="field" value="description" />
			<div class="col">
			<input type="text" name="description.value" class="form-control" placeholder="[[Or search for existing]]" autocomplete="off" />
			</div>
	
##			#foreach( $detail in $details)
##			<div class="col">
##					$context.putPageValue("detail", $detail)
##					$pages.include("/${applicationid}/components/advancedsearch/detaileditinline.html", $context)
##			</div>
##			#if( $counter == 4)
##				</div>
##				<div  class="row" >
##			#end	
##			#end
	
		</div>	
		</td>
		
		</tr>
		</table>
	</form>

	<div id="entitypickerresults"
		class="pickerresults"
		#set($pickertarget = $context.getRequestParameter("pickertarget"))
		#if( $copyinghits || $assetid || $copyingcategoryid) 
			#if($assetid)
				data-assetid="$assetid"
			#else
				data-copyinghitssessionid="$!copyinghitssessionid"
			#end
			
			#if($pickertarget=="addtocategory")
   				data-copyinghitssessionid="$!copyinghitssessionid"
   				data-copyingsearchtype="$!copyingsearchtype"
				data-clickurl="$applink/views/modules/searchcategory/savetoentities.html"
				data-clicktargetdiv="applicationmaincontent"
				data-clicktargettype="message"
				data-pickedmoduleid="$!{moduleid}"
			#else
				#if($copyingsearchtype == "category")
					data-clickurl="$applink/views/modules/${moduleid}/components/entities/addcategorytoentity.html" 
					data-copyingcategoryid="$!copyingcategoryid"
				#else
					#if($copyingsearchtype == "assets")
						data-clickurl="$applink/views/modules/${moduleid}/components/entities/addassetstoentity.html"
					#else 
						data-clickurl="$applink/views/modules/${moduleid}/components/entities/copytoentity.html"
					#end
				#end
				data-copyingsearchtype="$!copyingsearchtype"
				data-clicktargetdiv="applicationmaincontent"
				data-clicktargettype="message"
				data-pickedmoduleid="$!{moduleid}"
			#end
		#elseif($pickertarget)
				data-clicktargettype="entitypicker"
				data-pickertarget="$pickertarget"
		#else
			data-clicktargettype="entitydialog"
			data-targetlink="$applink/views/modules/${moduleid}/components/gridsample/preview/entity.html"
			data-saveaction="upload"
			data-uploadmedia="true"
		#end
		
		##data-viewfiles="true"
		data-moduleid="${moduleid}">
	
	#set( $foreignkeyid = $context.getRequestParameter("foreignkeyid") )
	#set( $foreignkeyvalue = $context.getRequestParameter("foreignkeyvalue") )
	#if( $foreignkeyid && $foreignkeyvalue )	
			$pages.include("$apphome/components/entities/search/results.html?field=$foreignkeyid&${foreignkeyid}.value=$foreignkeyvale&operation=exact",$context)
	#else
			$pages.include("$apphome/components/entities/search/results.html",$context)
	#end		
	</div>
	

</div>	
