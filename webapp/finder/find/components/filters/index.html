#if(!$moduleid)
	#set( $moduleid = $module.getId())
#end
##$hits

#if ($editfilters)
	#set( $edit = true )
#elseif( !$editfilters)
	#set( $edit = $context.getRequestParameter("editfilters"))
#end
#if( $edit)
	$context.putPageValue("edit",$edit)
#end

#if(!$categoryid)
	#set($categoryid = $context.getRequestParameter("categoryid"))
#end
#if(!$topmoduleid)
	#set ( $topmoduleid = $context.getRequestParameter("topmoduleid") )
#end
#if(!$entityid)
	#set ( $entityid = $context.getRequestParameter("entityid") )
#end
#if(!$targetdivsearch)
	#set ( $targetdivsearch = $context.getRequestParameter("targetdivsearch") )
#end

<div id="moduleadvfilterpanel" class="advfilterpanel" >
#set( $filterautorefresh = $userprofile.get("filterautorefresh"))
#if($filterautorefresh != "false")
	##defaults to true
	#set($$filterautorefresh = "true")
#end
<div class="d-flex flex-column py-1 pl-2 mb-1 bg-light align-items-right">
	<div class="d-flex align-items-center">
		<div class="custom-control custom-switch">
			
		<input 
			type="checkbox" 
			class="custom-control-input false-switch"
			id="filterautorefresh" 
			name="filterautorefresh"
			value="true" 
			#if($filterautorefresh=="true")checked#end
		><label class="custom-control-label" for="filterautorefresh"></label>
		</div>
		<label class="mb-0 pr-2 text-brand" for="filterautorefresh">[[Auto Refresh]]</label>
		##<label class="mb-0">[[May Include]]</label>
	</div>
</div>


<div class="advfilterpanelcontent" >
	#set( $view = "$moduleid/$!{moduleid}advancedfilter")

	#set( $searcher = $mediaarchive.getSearcher($moduleid))
	
	$context.putPageValue("view", $view)
	$context.putPageValue("searcher", $searcher)
	
	#set($usestartswith = $page.isPropertyTrue('usestartswith'))
	$context.putPageValue("usestartswith",$usestartswith)
	$context.putPageValue("caneditlists",false)
	
	#if(!$targetdivsearch)
		#set($targetdivsearch = "$!{moduleid}resultscontainer")
	#end

	#if(!$resultslink)
	#set($resultslink = $context.getRequestParameter("resultslink"))
	#end
	
	<form  	name="filterform" 
			id="filterform" 
			class="ajaxform autosubmitform filterform"
			method="POST" 
			 
			
			
			#if($resultslink)
				action="$resultslink"
				data-targetdiv="$targetdivsearch"
			#elseif($topmoduleid)
				#if($moduleid== "asset" && $categoryid)
					action="$siteroot$apphome/views/modules/$moduleid/dialogshowcategory.html"
					data-oemaxlevel="3"
				#else
					action="$siteroot$apphome/views/modules/$moduleid/dialogindex.html"
				#end
				data-targetdivinner="$targetdivsearch"
				data-updateurl="false"
			#else
				#if($moduleid== "asset" && $categoryid)
					action="$siteroot$apphome/views/modules/$moduleid/showcategory.html"
					data-oemaxlevel="2"
					data-targetdiv="$targetdivsearch"
				#else
					action="$siteroot$apphome/views/modules/$moduleid/index.html"
					data-targetdiv="$targetdivsearch"
				#end
			#end  
	>
	<input type="hidden" name="targetdivsearch" value="$targetdivsearch" />
	<input type="hidden" name="searching" value="true" />
	
	
	

	
	
	#if($dialogresults)
		###if( $hits.getSearchQuery().hasMainInput())
		#if($moduleid=="asset")
			#if($dialogresults)
				#set($href = "$siteroot$apphome/views/modules/$moduleid/dialogindex.html?hitssessionid=$!hits.getSessionId()&topmoduleid=$!topmoduleid&rootcategory=$!rootcategory&categoryid=$!{categoryid}&removeterm=description")
			#else
				#set($href = "$siteroot$apphome/views/modules/$moduleid/index.html?hitssessionid=$!hits.getSessionId()&topmoduleid=$!topmoduleid&rootcategory=$!rootcategory&categoryid=$!{categoryid}&removeterm=description")		
			#end
			#set($oemaxlevel = "1")
		#else
			#set($href = "$siteroot$apphome/views/modules/$moduleid/index.html?hitssessionid=$!hits.getSessionId()&removeterm=$!term.getId()")
			#set($oemaxlevel = "1")
		#end
		#set($inputsearch = $!hits.getSearchQuery().getMainInput())
		#if(!$targetdivsearch)
			#set($targetdivsearch = "$!{moduleid}resultscontainer")
		#end
		<div class="d-flex w-100 justify-content-center mt-1 mb-2">
			<label class="d-inline search-term text-brand" style="font-size: 0.8rem;" for="editSearch">
				
				<input type="hidden" name="field" value="description" />
				<input type="hidden" name="operation" value="contains" />
				<input type="text" value="$!inputsearch" class="filter-search " name="description.value" autocomplete="off" />
				<a href="$href"
					class="submitform text-brand"
					title="[[Search]]: #esc($!inputsearch)"
					> 
					<i class="bi bi-search mr-1"></i>
				</a>
			</label>
		</div>
		###end
	#end
	
	
	
		#if( $librarycol)
			<input name="collectionid" type="hidden" value="$!librarycol.getId()">
		#end
		
		##We need 2 things passed in: $searcher, $view or $searcher $details
	
##		#if (!$details && $userprofile)
##			#set ($details = $searcher.getDetailsForView($view, $userprofile))
##		#else
			#set ($details = $searcher.getDetailsForView($view))
##		#end
		
		#ifnull($idprefix)
		$context.putPageValue("idprefix","search")
		#end
		
		##FILTERS
		#foreach( $detail in $details)   
			##set( $viewpermission = $context.getPageValue("canviewfilter${detail.getId()}") )
			$context.putPageValue("detail", $detail)
			$context.putPageValue("searchform", true)
			
			#set( $viewtype = $detail.searchcomponent )
			#if (!$viewtype)
				#set( $viewtype = $detail.viewType )
			#end
			#if (!$viewtype)
				#set ($viewtype = $detail.dataType)
			#end
			#if (!$viewtype || $viewtype == "text" || $detail.isMultiLanguage() || $viewtype == "textarea" || $viewtype == "html")
				#set ($viewtype = "default")
			#end
			#if ($viewtype == "date")
				#set ($viewtype = "datesearch")
			#end
			$context.putPageValue("viewtype", $viewtype)
			
			#if ($detail.isLeaf())
				#set($filternode = $hits.findFilterValue($detail.id))
				$context.putPageValue("filternode",$filternode)
				#if(!$filternode && ($viewtype == "list" || $viewtype == "entity" ))
					##skip
					#set ($viewtype = "")
				#end
				#if($viewtype)
					$pages.include("/${applicationid}/components/filters/detailedit.html", $context)
				#end
				
			#else
				#if($detail.hasChildren())
					$pages.include("/${applicationid}/components/filters/section.html", $context)
				#end
			#end
		#end
		
		#set( $nodeID = $context.getRequestParameter("nodeID"))
		
		#if($topmoduleid)
			<input name="topmoduleid" type="hidden" value="$!topmoduleid" />
			<input name="entityid" type="hidden" value="$!entityid" />
			<input name="dialogresults" type="hidden" value="true" />
			#set($dialogindextype = $context.getRequestParameter("dialogindextype"))
			<input name="dialogindextype" type="hidden" value="$!dialogindextype" />
			<input name="targetdivsearch" type="hidden" value="$!targetdivsearch" />
		#end
		
		#if( $categoryid )
		
			<input type="hidden" name="field" value="category" />
			<input type="hidden" name="operation" value="exact" />
			<input type="hidden" name="category.value" value="$categoryid" />
			<input type="hidden" name="nodeID" value="$!nodeID" />
			<input type="hidden" name="categoryid" value="$categoryid" />
		#end
		

		<input type="hidden" name="$!{moduleid}endusersearch" value="true"/>
	
		<input type="hidden" name="customproperty" value="userinputsearch"/>
		<input type="hidden" name="userinputsearch.value" value="true"/>
		<input type="hidden" name="removeterm" id="filtersremoveterm" value=""/>
			
		#set ($resultview = $userprofile.get('resultview'))
		
		#if( !$resultview )
		<input type="hidden" name="resultstype" value="table" />
		#end
		
		</form>
		
	
	</div>
</div>