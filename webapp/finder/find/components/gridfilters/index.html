#set( $module = $content.module)

#if( !$librarycol )
	#set($collectionid = $context.getRequestParameter("collectionid"))
	#if($module=="librarycollection" && $collectionid)
		#set( $librarycol = $mediaarchive.query("librarycollection").exact("id",$collectionid).searchOne() )
	#end
#end

#if( $librarycol )	
	$context.putPageValue("librarycol",$librarycol)
	$context.putPageValue("collectionid", $librarycol.getId())
#end

#if( $modulehits.size() > -1 )
#set( $hits = $modulehits)
$context.putPageValue("hits",$modulehits)
#end


<div id="advfilterpanel" class="advfilterpanel" >



##SORT
#if($module== "asset")
#set( $searcher = $mediaarchive.getAssetSearcher())
<form  	name="filtersortform" 
		id="filtersortform" 
		class="autosubmitform filterform em-widget-content ajaxform" 
		data-targetdivinner="applicationmaincontent" 
		method="POST"  
	#if( $librarycol)
		data-oemaxlevel="1" 
		action="$home$apphome/views/modules/librarycollection/columnsort.html" 
	#else
		data-oemaxlevel="1" 
		action="$home$apphome/views/modules/asset/components/results/columnsort.html" 
	#end 
	>
	#if( $librarycol)
		<input name="collectionid" type="hidden" value="$librarycol.getId()">
	#end
		<input name="searchtype" type="hidden" value="asset">
		<div class="filter-box" style="margin-bottom:20px;">
			<div class="filter-box-header">
					<span class="toggle-filter sidetoggle" data-target="filterboxsorting">
					#set($minimizedfilterbox = true)
					#if(!$userprofile.minimizefilterboxsorting || $userprofile.minimizefilterboxsorting == "false")
						#set($minimizedfilterbox = false)
					#end
					<i class="caret fas 
						#if($minimizedfilterbox) 
							 fa-caret-right 
					  	#else 
					  		 fa-caret-down 
					  	#end"></i>
					</span> 
					[[Sort]]
			</div>
			<div class="filter-box-options" id="filterboxsorting" #if($minimizedfilterbox) style="display: none;" #end>
				#set ($alldetails = $searcher.getUserPropertyDetails() )
				<div style="width:145px; display: inline-block;">
				<select data-sortup="$hits.searchQuery.isSortUp()" 
						class="form-control form-control-sm select2 autosubmited" 
						name="sortby" 
						id="assetsortby" 
						data-allowclear="false" 
						style="" >
					#foreach( $detail in $alldetails)
						
						 #if($hits.searchQuery.isSortUp())
						 	#set($value = "${detail.id}Up")
						 #else
						 	#set($value = "${detail.id}Down")
						 #end
						<option data-detailid="${detail.id}" 
								value="$value" 
								#if($hits.isSortedBy($detail.id)) 
								selected="selected" 
								#end>$detail.getText($context)</option>
					#end
				</select>
				</div>
				<div class=" float-right" ><i class="filterschangesort fas #if($hits.searchQuery.isSortUp()) fa-sort-alpha-up #else fa-sort-alpha-down #end" style="padding-top:5px"></i></div>
			</div>
		</div>
	</form>	
#end		
		



<div class="tanmodule" >

		#set( $view = "$module/${module}advancedfilter")
		#set( $searcher = $mediaarchive.getSearcher($module))
		
		$context.putPageValue("view", $view)
		$context.putPageValue("searcher", $searcher)
		
		#set($usestartswith = $page.isPropertyTrue('usestartswith'))
		$context.putPageValue("usestartswith",$usestartswith)
		$context.putPageValue("caneditlists",false)
					
		<form  	name="filterform" 
				id="filterform" 
				class="ajaxform autosubmitform  filterform em-widget-content" 
				data-targetdivinner="applicationcontent" 
				method="POST"
				data-oemaxlevel="3"   
		#if( $librarycol)
			action="$siteroot$apphome/views/modules/librarycollection/search.html"
		#elseif ($content.get("section")=="favorites")
			action="$siteroot$apphome/views/modules/modulesearch/favorites.html"
		#else
			action="$siteroot$apphome/views/modules/$module/filter.html" 
		#end 
		>
		#if( $librarycol)
			<input name="collectionid" type="hidden" value="$librarycol.getId()">
		#end
		
		##We need 2 things passed in: $searcher, $view or $searcher $details
		#if (!$details && $userprofile)
			#set ($details = $searcher.getDetailsForView($view, $userprofile))
		#else
			#set ($details = $searcher.getDetailsForView($view))
		#end
		$context.putPageValue("idprefix","search")
				
		#foreach( $detail in $details)   
				$context.putPageValue("detail", $detail)
				$context.putPageValue("searchform", true)

				#if ($detail.isLeaf())
					#if ($detail.isFilter())
						#set($filternode = $hits.findFilterValue($detail.id))
						##$detail.id = $filternode
						$context.putPageValue("filternode",$filternode)
						#if(($edit == "true") || ($filternode && !$filternode.isEmpty() && $filternode.children.size() > 1))							
							$pages.include("/${applicationid}/components/gridfilters/detailedit.html", $context)
						#end	
					#else
						$pages.include("/${applicationid}/components/gridfilters/detailedit.html", $context)
					#end
				#else
					$pages.include("/${applicationid}/components/gridfilters/section.html", $context)
				#end
		#end
				
			<input type="hidden" name="${searcher.getSearchType()}endusersearch" value="true"/>
		
			<input type="hidden" name="field" value="description" />
			<input type="hidden" name="operation" value="freeform" />
			<input type="hidden" name="description.value" value='$!hits.getInput("description")' />
	
			<input type="hidden" name="hitssessionid" value="$hits.sessionId" />
			
			<input type="hidden" name="customproperty" value="userinputsearch"/>
			<input type="hidden" name="userinputsearch.value" value="true"/>
			<input type="hidden" name="removeterm" id="filtersremoveterm" value=""/>
		
			<input type="hidden" name="keeppreviousfilter" value="true"/>
		
				
			#set ($resultview = $userprofile.get('resultview'))
			
			#if( !$resultview )
			<input type="hidden" name="resultstype" value="table" />
			#end
			
					
			</form>
	</div>
</div>
