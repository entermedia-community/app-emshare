<div>
<div style="margin:0 10px;" id="downloadassetsdialog">
	#if( !$order )
		[[Session expired, Reload browser]]
	#end
	#if( $order.userid != $context.getUserName() )
	[[Invalid order, username does not match]]
	#else
	
		#set($orderitemsearcher = $searcherManager.getSearcher($catalogid, "orderitem"))
		#set($ordersearcher = $searcherManager.getSearcher($catalogid, "order"))
		
	<form class="validate ajaxform" 
		id="usereditform"
		data-targetdiv="downloadassetsdialog"  
		method="get" 
		onSubmit='$("#submitbutton").attr("disabled","disabled");$("#submitbutton").val("[[Processing]]...");'
		action="$home$apphome/components/sidebars/userdownloads/downloadpathpicker.html">
		
	#set($searcher = $searcherManager.getSearcher($catalogid, "order"))
	$context.putPageValue("searcher", $searcher)	 
	$context.putPageValue("data", $order)	 
	$context.putPageValue("view", "order/downloadform")	
	<input type="hidden" name="view" value="order/downloadform"/>
	<input type="hidden" name="searchtype" value="order"/>
	<input type="hidden" name="catalogid" value="$catalogid"/>
	<input type="hidden" name="orderid" value="$order.id"/>
	<input type="hidden" name="newuserstatus" value="downloadrequested"/>

	<input type="hidden" name="field" value="collectionid"/>
	<input type="hidden" name="collectionid.value" value="$!context.getRequestParameter('collectionid')"/>

	<input type="hidden" name="field" value="publishdestination" />
	#set($publishdestination  = "desktopdownload")
	<input type="hidden" name="publishdestination.value" value="$publishdestination" /> ## 0 is http 1 is aspera
	
	<input type="hidden" name="field" value="ordertype" />
	<input type="hidden" name="ordertype.value" value="desktopdownload" />
	
		<h4>$orderitems.size() [[Items]]</h4>
		#if($canconvert)
		<div>[[Choose a download format for each type of asset]].</div>
		#end
		
		#foreach( $item in $orderitems )
			<input type="hidden" name="itemid" value="$item.id"/>
		#end
		
		<table id="shared-asset-table" class="table table-striped download-table" style="margin:10px 0;" >
		#foreach( $renderoption in $rendertypeoptions)
			#set($rendertypeid = $renderoption.getRenderTypeId() )
			<tr>
				<td>
				<input type="hidden" name="field" value="rendertype"/>
				<input type="hidden" name="rendertype.value" value="${rendertypeid}"/>
				
				#set($num = $renderoption.getOrderItems().size())
				[[Downloading]] $!num #text($renderoption.getRenderType())
				</td>
				<td>
				<input type="hidden" name="field" value="presetid"/>
			
		  		<select name="${rendertypeid}.presetid.value" class="form-control form-control-sm downloadpreset">
					#foreach ($presetoption in $renderoption.getPresetOptions())
						#set($preset = $presetoption.getPreset())
						#set($ok = false)
						#if($canconvert && $candownloadfpo)
							#set($ok = true) 
						#elseif ($canconvert && $preset.watermark != "true")
							#set($ok = true) 
						#elseif($candownloadfpo && $preset.watermark == "true")
							#set($ok = true) 
						#end
						#if($preset.id == "0" && $candownload)
							#set($ok = true) 
						#end
						#if($preset.id == "0" && !$candownload)
							#set($ok = false) 
						#end
						##Hide if display = false in preset
						#if($preset.id != "0" && $preset.getValue("display")=="false")
							#set($ok = false) 
						#end
						#if($ok)
						<option value="$preset.id" #if($preset.id == "0") selected #end>$preset
						</option>
						#end
						#set($ok = false)
					#end
				</select>
				#foreach ($presetoption in $renderoption.getPresetOptions())
				
					#foreach($downloadpath in $presetoption.getDowloadPaths() )
					<input type="hidden" 
							name="${rendertypeid}_${presetoption.getPreset().getId()}" 
							data-url="$downloadpath.downloadpath"
							data-savetopath="$!downloadpath.savetopath"
							class="orderitemsperpreset${presetoption.getPreset().getId()}"/>
					#end
				#end
				</td>
			</tr>
		#end
		</table>
	
	<div style="text-align: right"> 
		##<input class="btn btn-sm btn-primary" id="submitbutton" type="submit" name="submit" value="[[Next]]"/> 
		<a href="#" id="localfolderDownloadPath"  class="btn btn-sm btn-primary ">[[Pick Download Path]]</a>
	</div>
	<div id="itemsave"></div>
	</form>
	#end
</div>
</div>