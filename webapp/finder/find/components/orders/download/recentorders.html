
#set( $downloadorders = $ordermanager.findDownloadOrdersForUser( $context,  $user))

<div class="sidebarorders overflow-y">
	#foreach($downloadorder in $downloadorders)

		#set($assetid = $downloadorder.getCurrentItem().get("assetid"))
		#set($asset = $mediaarchive.getAsset($assetid))
		#set($publishstatus = $downloadorder.getCurrentItem().get("publishstatus"))
		#set($status = $downloadorder.getCurrentItem().get("status"))
		
		##set($errordetails = $downloadorder.getCurrentItem().get("errordetails"))


		<div class="sidebarorder d-block py-2 px-2 $publishstatus $status" id="d-$downloadorder.getCurrentItem()">

			<div id="dl-$downloadorder.getCurrentItem()" class="downloadProgress" style="display:none;width:0%">
				<div class="shine" style="display:none;"></div>
			</div>

			<div class="d-flex align-items-center">
				#set ($mime = $mediaarchive.getMimeTypeIcon($asset.fileformat))
				
				<div class="format-thumb">
					<i class="bi bi-$mime"></i>
				</div>
			
				<div class="d-flex align-items-center justify-content-between flex-grow-1">
					<div class="d-flex flex-column flex-grow-1">
						<div class="order-name">
							$downloadorder.getCurrentItem().get("itemexportname")
						</div>
						<div class="order-filetype">
							#if( $downloadorder.getItemCount() > 1 )
								[[Zip File]] ($downloadorder.getItemCount() [[files]])
							#end
						</div>
						<div class="d-flex align-items-center">			
							<span class="status">
								#if($publishstatus == "readytopublish" )
									[[Ready to Download]]
								#elseif($publishstatus == "publishingexternal" )
									[[Downloading]]
								#elseif($publishstatus == "complete" )
									[[Downloaded]]
								#elseif($publishstatus == "cancelled" ) 
									[[Cancelled]]
								#elseif($publishstatus == "new" ) 
									[[Processing]]
								#end
							</span>
							<i class="bi bi-dot mx-1"></i>
							<span class="file-size text-right">
								<span id="dlp-$downloadorder.getCurrentItem()"></span>
								$sizer.inEnglish( $downloadorder.totalBytes() )
							</span>
						</div>
						<div class="d-flex align-items-center">	
							#if($publishstatus == "complete" )
								#set( $orderage = $!context.getAge($downloadorder.getPublishedDate()))
								#ifnotnull($orderage )
									<span class="date">
										$orderage [[ago]]
									</span>
								#end
							#else
								#set( $orderage = $!context.getAge($downloadorder.getEstimatedEndDate()))
								#ifnotnull($orderage )
									<span class="date">
											$orderage [[remaining]]
									</span>
								#end
							#end
						</div>
					</div>
				</div>
				<div class="file-thumb">
					#if($status == "error")
						<i class="bi bi-x-circle-fill error"></i>
					#else
						#if($publishstatus == "complete")
							<i class="bi bi-check-circle-fill success"></i>
						#elseif($publishstatus == "readytopublish" )
							<i class="bi bi bi-cloud-arrow-down-fill ready"></i>
						#elseif($publishstatus == "publishingexternal" ) 
							<div class="spinner-border text-white"></div>
						#elseif($publishstatus == "cancelled" ) 
							<i class="bi bi-slash-circle-fill cancelled"></i>
						#elseif($publishstatus == "new" ) 
							<i class="bi bi-hourglass-split processing"></i>
						#end
					#end
					$context.putPageValue("asset", $asset)
					$context.putPageValue("thumbsize","carousel")
					$pages.include("$componenthome/results/thumbnails/small.html",$context)
					
				</div>
				<div class="actions">
					#if($status != "error" && ($publishstatus == "complete" || $publishstatus == "readytopublish" || $publishstatus == "cancelled"))
						<a href="#" class="redownloadorder" 
							data-orderitemid="$downloadorder.getCurrentItem()" 
							data-itemexportname='$downloadorder.getCurrentItem().get("itemexportname")'
							data-itemdownloadurl='$downloadorder.getCurrentItem().get("itemdownloadurl")'
							title="[[Download Again]]">
							<i class="bi bi-arrow-clockwise"></i>
						</a>
					#end
					#if($publishstatus == "publishingexternal")
						<a href="#" class="abortdownloadorder" data-orderitemid="$downloadorder.getCurrentItem()" title="[[Cancel Download]]">
							<i class="bi bi-x-circle"></i>
						</a>
					#end
					#if($publishstatus == "new" )
						<a href="#" class="abortdownloadprocessing" data-orderitemid="$downloadorder.getCurrentItem()" title="[[Cancel Order Processing]]">
							<i class="bi bi-x-circle"></i>
						</a>
					#end
				</div>
			</div>
		</div>
	#end

	#if( $downloadorders.size() == 0 )
		<p class="text-center text-muted mt-4">[[No recent downloads]]</p>
	#end
</div>