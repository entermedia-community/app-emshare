#ifnull($moduleid)
	#set($moduleid = $context.getRequestParameter("moduleid"))
#end

#ifnull($searchhome)
	#set($searchhome = "$apphome/views/modules/$moduleid" )
#end
$context.putPageValue("searchhome", $searchhome)

#ifnull($viewid)
	#set($viewid = "${moduleid}resultstable")
#end
#ifnull($viewpath)
	#if($viewid)
		#set($viewpath = "${moduleid}/${viewid}")
	#else
		#set($viewpath = "${moduleid}/${moduleid}resultstable")
	#end
#end
#ifnull($resultdetails)
	#set($resultdetails = $searcher.getDetailsForView($viewpath, $userprofile))
#end

<div id="resultsdiv" 
		class="tableresults" 
		data-hitssessionid="$!hits.getSessionId()"
		data-componenthome="$!searchhome/components" 
		data-searchhome="$!searchhome/components/results"
		data-category="$!category.getId()"
		data-collectionid="$!librarycol.getId()" 
		data-searchtype="$!searchtype" 
		data-pagenum="$!hits.getPage()" 
		data-totalpages="$!hits.getTotalPages()"
		data-moduleid="$!moduleid"
		data-viewid="$!viewid"
		data-viewpath="$!viewpath">

 

<div id="emresultscontent">

$pages.include("${searchhome}/resultsactions.html",$context)

#if ( $hits.size() == 0 )
	$pages.stream("/$!{searchhome}/empty.html", $context)	
#else
	##set ($canedit = $context.getPageValue("${moduleid}edit") )
	
	
	#if( $caneditdata )
		#set( $readonly = false)
	#else
		#set( $readonly = true)
	#end
	<form name="selectionform" action="$home$!{searchhome}/common/selection/toggle.html">
		<input type="hidden" name="hitsname" value="hits"/>
	
		<div class="tablecontainer">
		
		<div id="messagearea"> </div>
		#set($defaultview = $userprofile.getDefaultViewForModule($moduleid) )
		#if($defaultview)
		 	#set($defaultviewid = $defaultview.id )
		#end
		#if(!$defaultviewid)
			#set($defaultviewid = "${moduleid}general" )
		#end
		
		#set($targetdiv = "applicationmaincontent")
		#set($targetlink = "$!searchhome/components/gridsample/preview/entity.html")
		
		#if($moduleid == "order")
			#set($targetdiv = "orderresultsarea")
			#set($targetlink = "$!apphome/views/modules/order/edit/edit.html")
		#end
		
		<div id="emselectable" 
				class="emselectablemodule emselectablemodule_${moduleid} adjustHeight" 
				data-viewid="$!defaultviewid"
				data-hitssessionid="$hits.getSessionId()" 
				data-id="$!id"
				data-searchtype="$!searchtype" 
				data-searchhome="$!searchhome"
				data-tabletype="$!{tabletype}"
				data-targetlink="$!targetlink"
				data-targetdiv="$!targetdiv">
		
			<table class="table table-striped table-hover" 
					id="$!searchtype-main-results-table" 
					data-resultsarea="resultsarea" 
					data-hitssessionid="$!hits.sessionId">
			
			<thead>
			<tr id="tableheader" class="tableheader" >
			###if($content.isPropertyTrue("showactions"))
			
				<th class="firstheader p-0" id="th-checkbox">
				
					<div class="d-flex align-items-center">
					<input name="pagetoggle" type="checkbox" #if($hits.isAllSelected()) checked #end title="[[Select All on This Page]]"  />
			    	</div>

					##<a id="unselectall" class="ajax deselectpage" targetdiv="resultsheader" href="${searchhome}/components/results/togglepage.html?oemaxlevel=1&hitssessionid=$hits.getSessionId()&action=none" style="display: none;" title="[[Deselect All]]">
					##	<i class="bi bi-x-lg ns"></i>
					##</a>
				</th>
			
			###end
			
			#set( $edit = $context.getRequestParameter("editheader"))
			#if( !$edit || $edit == "false")
				#set( $edit = false)
			#end
				#set( $sortby = $hits.getSearchQuery().getSortBy() )
				#foreach( $detail in $resultdetails)
					<th id="th-$detail.id"
						#if($detail.id != 'primarymedia')
							class="sortable #if( $edit)editcolumnheader #end #if( $sortby.startsWith($detail.getId() ) ) currentsort #if( $sortby.endsWith("Up") ) up #else down #end #end tableheader-${detail.id}"
							style='#if($detail.viewType =="asset" || $detail.viewType =="primarymedia" )width:180px;#end'
							sortby="$detail.id"
							data-sortby="$detail.id"
						#else
							class="tableheader-${detail.id}"
						#end >
						<div id="$detail.id" 
								hitssessionid="$hits.getSessionId()"  
								editing="$edit" 
								class="headerdraggable headerdroppable"> 
								#text( $detail.name )
								#if( $edit) 
									<a class="baseemenableonhover ajax edit-table-header" 
										data-targetdiv="$!{moduleid}resultsarea" 
										data-oemaxlevel="1"
										href="$componenthome/results/addremovecolumns.html?searchtype=${moduleid}&hitssessionid=$hits.getSessionId()&editheader=true&removecolumn=$detail.id">
										<i class="bi bi-x"></i></a>
								#elseif ($sortby.startsWith($detail.getId()))
					 				#if($sortby.endsWith("Up"))
					 					#set($sorticon="up")
					 				#else
					 					#set($sorticon="down")
					 				#end	
									#if($detail.id != 'primarymedia')
					 					&nbsp;&nbsp;&nbsp;<i class="bi bi-caret-$sorticon-fill"></i>
									#end
								#end
						</div>
					 </th>
				#end
				
				#if(!$hiderowactions)
				<th class="lastheader">
					#if(!$edit || $edit == "false")  
						<a class="ajax nav-hover text-center" 
							id="table-editor-close" 
							data-targetdiv="$!module.getId()resultsarea"
							data-oemaxlevel="2" 
							title="[[Edit Table Header]]"
							href="$siteroot$componenthome/results/index.html?searchtype=asset&hitssessionid=$hits.getSessionId()&editheader=true"><i class="bi bi-pencil-square"></i></a>
					#else
						<a class="ajax table-edit-close" 
							data-targetdiv="$!{moduleid}topcontainer"
							data-oemaxlevel="2"
							title="[[Cancel Edit Table Header]]"
							href="${searchhome}/index.html?searchtype=$!moduleid&hitssessionid=$!hits.getSessionId()&editheader=false&moduleid=$!moduleid"><i class="bi bi-x-lg"></i></a>
					#end
				</th>
				#end
			</tr>
			</thead>
			
			<tbody>
			
			#set( $even = true )
			#set($count = 0)
			#foreach ( $hit in $hits.getPageOfHits() )
			
			   	$context.putPageValue('data', $hit)
		    
				#set( $clink = "$home${content.linkprefix}${cell.id}${content.linksuffix}" )
			
			    <tr  rowid="$!{hit.id}">
			   
			    
			###if($content.isPropertyTrue("showactions"))
			
				<td class="borderedcell checkbox" noclick="true"> 
					
					<input type="checkbox" class="selectionbox resultsselection" name="count" value="" #if($hits.isSelected(${hit.id})) checked #end data-dataid="${hit.id}" />
			
					##<input type="checkbox" class="moduleselectionbox" name="count" value="" #if($hits.isSelectedOnPage(${hit.id})) checked #end data-dataid='${hit.id}' data-hitssessionid='$hits.sessionId' />
					<div id="check_${count}"></div>
				</td>
			###end
			
			#foreach( $detail in $resultdetails )
				<td class="editfield highlightMe tablecell tablecell-$!detail.id tablecell-$!detail.rendertype"
				>
				#set($val =  $hit.get($detail.id) )
				#set($value = $searcherManager.getValue($hit, $detail, $context.getLocale() ) ) 

				#ifnull($val)
					#set($val = "")	
				#end		
				
				$context.putPageValue('val',  $val)
				$context.putPageValue('value',  $value)
				
				$context.putPageValue('detail',  $detail)
				
				#set($viewtype = $detail.viewType)
				
				#if($viewtype  == "tageditor")
					#set($tagssearchlink = "$siteroot$apphome/views/modules/${searchtype}/index.html")
					$context.putPageValue("tagssearchlink",$tagssearchlink)
				#end
				#if($viewtype  == "primarymedia")
					#set($viewtype = "primarymediafolder")
				#end
				$context.putPageValue('viewtype',  $viewtype)
				   <div id="edit_${hit.id}_$detail.id" class="popupdetails" data-id="${hit.id}">
				        $pages.include("$apphome/components/xml/detailreadonly.html", $context)
				    </div>
				</td>
			#end
			
			#if(!$hiderowactions)
			<td class="rowactions" noclick="true">
				$pages.include("$componenthome/gridsample/favorites.html?id=$!{hit.id}&moduleid=$moduleid", $context)
				#if($desktop)
					<a class="emdialog btn text-accent px-1 rounded"
						style="font-size: 16px;margin-top: 4px;" 
						title="[[Upload]]" some-change
						><i class="bi bi-cloud-arrow-down"></i></a>

					<a class="emdialog btn text-accent px-1 rounded"
						style="font-size: 16px;" 
						title="[[Upload]]"
						><i class="bi bi-cloud-arrow-up"></i></a>

					#if($module.getBoolean("enableuploading") && ($permissions.can($moduleid, "upload_files") || $permissions.can($moduleid, "upload_folders")) )
						<a class="emdialog btn #if($enabled) btn-success #else text-accent #end px-1 rounded"
							style="font-size: 16px;" 
							data-dialogid="importexistingdialog"
							data-moduleid="${moduleid}"
							data-modulename="#text($module)"
							data-entityid="$!{hit.id}"
							data-entityname="$!{hit.name}"
							href="$apphome/components/sidebars/localdrives/importexistingdialog.html"
							title="[[Add to Auto Import]]" 
							><i class="bi bi-box-arrow-in-up-right"></i></a>
					#end
				#else
					#if($module.getBoolean("enableuploading") && 
						($permissions.can($moduleid, "upload_files") ||
						$permissions.can($moduleid, "upload_folders")) )
						<a href="$!searchhome/components/gridsample/preview/entity.html?entityid=$!{hit.id}&entitytabopen=import" 
						style="font-size: 16px;" 
						class="emdialog btn #if($enabled) btn-success #else text-accent #end px-1 rounded" 
						title="[[Add New Folders]]" 
						data-moduleid="${moduleid}"
						data-updateurl="true"
						data-urlbar="$!searchhome/index.html?entityid=$!{hit.id}&entitytabopen=import"><i class="bi bi-cloud-arrow-up"></i></a>
					#end
					#if($permissions.can($moduleid, "downloadall"))
						<a href="$!searchhome/components/gridsample/preview/entity.html?entityid=$!{hit.id}&entitytabopen=export&tabsection=downloadzip" 
						style="font-size: 14px;" 
						class="emdialog btn #if($enabled) btn-success #else text-accent #end px-1 mb-2 rounded" 
						title="[[Download Folder]]" 
						data-moduleid="${moduleid}"
						data-updateurl="true"
						data-urlbar="$!searchhome/index.html?entityid=$!{hit.id}&entitytabopen=export&tabsection=downloadzip"><i class="bi bi-download"></i></a>
					#end
				#end
			</td>
			#end
			
			</tr>
			#set($count = $count + 1)
			#end
			</tbody>
			</table>
		</div>
		
	
			
		
		
		</div>
	</form>
		
		## $pages.include("/${searchhome}/navigate.html", $context)
		<div class="clearfix"></div>

#end
		</div>
</div>