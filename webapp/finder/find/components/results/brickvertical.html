#if(!$ismodulesearch)
	#set ( $ismodulesearch = $content.get("ismodulesearch") )
#end
#if(!$ismodulesearch)
	#set ( $ismodulesearch = $context.getRequestParameter("ismodulesearch") )
#end

#set($componenthome = "$apphome/views/modules/asset/components")

#set($loop = $hits)
#if($lightboxassets && !$lightboxassets.isEmpty())
	#set($loop = $lightboxassets)
	#set( $hits = $assethits )
	$context.putPageValue("hits",$hits)
#end

<div id="resultsdiv" 
	class="h-100 scroll-resultsdivX lightboxselect resultsdiv"
	data-hitssessionid="$!hits.getSessionId()" ##it breaks drag&drop
	data-hitsname="$!hits.getHitsName()"
	data-componenthome="$!componenthome"
	data-searchhome="$!home$!{componenthome}/results"
	data-targetdiv="$maintargetdiv"
	data-category="$!category.getId()"
	data-collectionid="$!librarycol.getId()" 
	data-rendertype="$!rendertype"
	data-lightboxassetsresults="$!{lightboxassetsresults}"
	data-lightboxid="$!lightboxid"
	data-pagenum="$!hits.getPage()" 
	data-totalpages="$!hits.getTotalPages()"
	data-moduleid="asset"
	data-topmoduleid="$!topmoduleid"
	data-entityid="$!entity.id"
	data-section="$!content.section"
	#set( $inputid = $context.getRequestParameter("inputid"))
	data-inputid="$!inputid"
	data-ismaingrid="true"
	data-stackedviewpath="">

	#if( $hideheader &&  $hideheader != "true")
		$pages.include("$apphome/views/modules/asset/components/results/header.html",$context) 
	#end
	<div class="scrollview">
		<div class="brickvertical brickverticalsortable" 
			data-maxheight="180" 
			data-maxwidth="180"
			data-targeth="180"
			data-cellpadding="4">
		
		#set($count = 0)
		#set($viewerlink = $content.get("assetviewerlink") )
		#set($stackedfield = $mediaarchive.getCatalogSettingValue("stackedgalleryfield"))
		
		#foreach( $brick in $loop.getPageOfHits())
		 
		 	#ifnotnull( $hitassetlookup )
			 	#set( $hit = $hitassetlookup.get($brick.getId()) )
		 	#end
		 	#ifnull( $hitassetlookup )
				#set( $hit = $brick)
		 	#end
			$context.putPageValue("brick", $brick)
			$context.putPageValue("hit", $hit)
			$context.putPageValue("asset", $hit)

			#set($type = $hit.getSearchHit().getType())
			$context.putPageValue("type", $type)
		
			#set($rendertype = $mediaarchive.getMediaRenderType($hit.fileformat))
			$context.putPageValue("rendertype", $rendertype)
		
			#set($sourcepath = $hit.sourcepath)
			$context.putPageValue("sourcepath", $hit.sourcepath )
			
			$context.putPageValue("assetid", $hit.id)
			$context.putPageValue("count", $count )
		
			$context.putPageValue("thumbsize", "mediumplus" )
			
			#set($assetwidth = $mediaarchive.getRealImageWidth($hit))
			$context.putPageValue("assetwidth", "assetwidth" )
			
			#set($assetheight = $mediaarchive.getRealImageHeight($hit))
			$context.putPageValue("assetheight", "assetheight" )
			
			#set($click = "$siteroot$viewerlink?hitssessionid=${hits.getSessionId()}&assetid=${hit.id}")
			$context.putPageValue("click", "click" )
			       
			<div class="masonry-grid-cell assetdraggable"
				 
				id="gallerycell_$!{hit.id}"
				data-assetid="$!{hit.id}"
				data-assetlightboxid="${brick.id}"
				data-ordering="${brick.ordering}"
				
				#if($rendertype == "audio")
					data-width="250"
					data-height="110"
				#else
					data-width="$assetwidth"
					data-height="$assetheight"
					$context.putPageValue("thumbheight", "180" ) 
				#end
				>
				<div class="assetdroppable" data-ordering="${brick.ordering}" data-assetlightboxid="${brick.id}">
				$pages.include("$componenthome/results/thumbnails/brick.html", $context)
				</div>
			</div>
		    #set ( $count = $count + 1) 
		    
		#end
		
	</div>
	</div>
</div>