##Header for ASSET module

#if( !$hits )
	#set( $hits = $collectionassets)
	$context.putPageValue("hits",$hits)
#end

#if( !$hits )
	#set( $hits = $orderassets)
	$context.putPageValue("hits", $hits)
#end

#if(!$searchtype)
	#set ( $searchtype = $context.getRequestParameter("searchtype") )
#end
#if(!$searchtype)
	#set ( $searchtype = "asset" )
#end

##set( $categoryid = $hits.getInput("categoryid") )
#set($categoryid = $context.getRequestParameter("categoryid"))
#if (!$categoryid)
	#set( $categoryid = $context.getRequestParameter("category"))
#end
#set( $nodeID = $context.getRequestParameter("nodeID"))
#if (!$categoryid && $nodeID)
	#set( $categoryid = $nodeID )
#end
#if ($categoryid)
	$context.putPageValue("catid",$categoryid)  ##used?
	$context.putPageValue("categoryid",$categoryid)
#end
#if( $categoryid && !$category)
	#set( $category = $mediaarchive.getData("category",$categoryid) )
#end

#if(!$rootcategory)
	#set($rootcategory = $context.getRequestParameter("rootcategory"))
	#if(!$rootcategory)
		#set( $rootcategory = $categoryid)
	#end
	$context.putPageValue("rootcategory",$rootcategory)
#end
#if(!$categoryid && $rootcategory)
	#set($categoryid = $rootcategory)
#end
#if(!$topmoduleid)
	#set($topmoduleid = $context.getRequestParameter("topmoduleid"))
	$context.putPageValue("topmoduleid",$topmoduleid)
#end

#if(!$dialogresults)
	#set($dialogresults = $context.getRequestParameter("dialogresults"))
	$context.putPageValue("dialogresults",$dialogresults)
#end

#if(!$maintargetdiv)
	#set($maintargetdiv = $context.getRequestParameter("maintargetdiv"))
	$context.putPageValue("maintargetdiv",$maintargetdiv)
#end

#set( $orderid = $hits.getInput("orderid") )
#if( $orderid )
	#set( $order = $mediaarchive.getData("order",$orderid) )
	$context.putPageValue("order",$order)
#end

#if( !$librarycol && $category ) 
	#set( $librarycol = $mediaarchive.query("librarycollection").orgroup("rootcategory",$category.getParentCategories()).searchOne() )
#end

#if( $librarycol )	
	$context.putPageValue("librarycol",$librarycol)
#end

#set($reloadsearchtype = $searchtype)
#set($librarycollectionassets = $context.findValue("librarycollectionassets"))
#if($searchtype=="librarycollection")
	#if($librarycollectionassets)
		#set($reloadsearchtype = "asset")
	#end
#end

#if(!$maintargetdiv)
	#set ($maintargetdiv = $context.getRequestParameter("maintargetdiv") )
	$context.putPageValue("maintargetdiv",$maintargetdiv)
#end
	
	<div id="resultsheader" class="resultsheader #if(!$dialogresults) autostickywidth #end" >
	<div id="sub-nav" class="emsubnav sub-nav-${module.id}">
		<ul class="resultsnav">
			#set ($enabled = false)
			#if ($hits.getSelectionSize() && $hits.getSelectionSize()>0)
				#set ($enabled = true)
			#end
			
			#if($dialogresults)
				#ifnull($dialogtreestatus)
				#set($dialogtreestatus = $userprofile.get("dialogtreestatus"))
				#end
				#if(!$hidedialogtree && $dialogtreestatus == "close")
				<li>
				<a href="" 
						class="toggledialogtree"
						style="padding:0 10px"
						data-targetdiv="dialogassetresultscontainer"
						data-oemaxlevel="1"
						data-url="$applink/views/modules/asset/dialogindex.html"
						data-categoryid="$!categoryid"
						data-topmoduleid="$!topmoduleid"
						data-rootcategory="$!rootcategory"
						data-treestatus="open"
						title="[[Expand Tree]]">
						<i class="fas fa-angle-double-right "></i>
						</a>
				</li>
				#ifnull($topmodule)
					#set($topmodule = $mediaarchive.getCachedData("module", $topmoduleid))
					
				#end
				#end
			#end
			
			#if ($resultview != "map")
				#if($searchtype=="librarycollection" && $librarycol )
				<li class=" dropdown">
					<a href="#" class="dropdown-toggle dropdown-noarrow" data-toggle="dropdown" data-bs-toggle="dropdown" title="[[Album Actions]]">[[Album]]</a>
					<div class="dropdown-menu">
					 	#if(!$canforcebasiccollections)
						 	#if($cansharecollection )
							 	#set( $editlink = "$siteroot$apphome/views/modules/librarycollection/sharecollection.html?collectionid=${librarycol.getId()}")
							 	<a class="dropdown-item emdialog" data-allwaysloadpage="true" data-hidefooter="true"   href="$editlink" title="[[Sharing Album]]"><i class="dropdown-item-icon fas fa-share-alt"></i> [[Sharing]]</a>
						 	#end
					 	#end
					 	#if( $canaddnewcollection || $cancopycollection)
								<a class="dropdown-item emdialog" href="$siteroot$apphome/views/modules/librarycollection/copycollection.html?collectionid=$!librarycol.getId()" title="[[Create a copy of this Album]]"><i class="dropdown-item-icon fas fa-copy"></i> [[Copy Album]]</a>
						#end
						#if($caneditcollection)
						  #set( $link = "$siteroot$apphome/views/modules/librarycollection/share.html?collectionid=${librarycol.getId()}")
						  <a class="dropdown-item emdialog" id="sharetab" href="$link" data-hidefooter="true" title="[[Notifications]]"><i class="dropdown-item-icon fas fa-flag"></i> [[Notifications]]</a>
						  #set( $link = "$siteroot$apphome/views/modules/librarycollection/users.html?collectionid=${librarycol.getId()}")
						  <a class="dropdown-item emdialog"  id="editingtab"  href="$link" data-hidefooter="true" title="[[Editing Users]]"><i class="dropdown-item-icon fas fa-user-friends"></i> [[Editing Users]]</a>
						   #set( $link = "$siteroot$apphome/views/modules/librarycollection/permissions.html?collectionid=${librarycol.getId()}")
						  <a class="dropdown-item emdialog" id="permissionstab" href="$link" data-hidefooter="true" title="[[Viewing Users]]"><i class="dropdown-item-icon fas fa-user-check"></i> [[Viewing Users]]</a>
						  #set( $link = "$siteroot$apphome/views/modules/librarycollection/datapermissions/index.html?collectionid=${librarycol.getId()}&id=${librarycol.getId()}")
						  <a class="dropdown-item emdialog" id="colpermissionstab" href="$link" data-hidefooter="true" title="[[Album Permissions]] (${librarycol})"><i class="dropdown-item-icon fas fa-user-lock"></i> [[Album Permissions]]</a>
			              #if($librarycol.get('library'))
							  #set( $link = "$siteroot$apphome/views/modules/library/datapermissions/index.html?id=${librarycol.get('library')}")
							  <a class="dropdown-item emdialog" id="libpermissionstab" href="$link" data-hidefooter="true" title="$librarycol.library [[Library Permissions]]"><i class="dropdown-item-icon fas fa-user-lock"></i>  [[Library Permissions]]</a>
						  #end
						  #set( $editlink = "$siteroot$apphome/views/modules/librarycollection/edit/settings.html?collectionid=${librarycol.getId()}")
					 	  <a class="dropdown-item emdialog"  data-allwaysloadpage="true" data-hidefooter="true"   href="$editlink" title="[[Album Properties]]"><i class="dropdown-item-icon fas fa-cogs"></i> [[Properties]]</a>
					   	#else
						   	#set( $editlink = "$siteroot$apphome/views/modules/librarycollection/edit/settings.html?collectionid=${librarycol.getId()}")
						 	<a class="dropdown-item emdialog"  data-allwaysloadpage="true" data-hidefooter="true"   href="$editlink" title="[[Album Properties]]"><i class="dropdown-item-icon fas fa-cogs"></i> [[Properties]]</a>
						#end
					</div>
				</li>
				#end

				#if($topmoduleid && $permissions.can($topmoduleid, "upload_files"))
					<li>
						<a href="$siteroot$applink/views/modules/asset/add/entityaddmedia.html?categoryid=$!categoryid" 
							class="ajax" 
							data-targetdiv="dialogmediaentity"
							data-oemaxlevel="1"
							style="padding: 0 10px" title="[[Upload]]"><i class="fas fa-upload"></i></a>
					</li>
				#else
					#if($moduleid == "asset")
					<li>
						<a  class="ajax" 
							data-updateurl="true" 
							data-targetdivinner="applicationmaincontent" 
							data-oemaxlayout="3"
							href="$siteroot$applink/views/modules/asset/add/start.html?categoryid=$!categoryid"
							style="padding: 0 10px" title="[[Upload]]"><i class="fas fa-upload"></i></a>
					</li>
					#end
				#end

				<li class="dropdown">
					<a class="dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="navbarActionsDropdown">Select</a>
					<div class="dropdown-menu">
						<a class="dropdown-item selectpage" data-action="page">[[Select This Page]]</a>
						<a class="dropdown-item selectpage" data-action="all">[[Select All Results]]</a>
						<a class="dropdown-item selectpage" data-action="none">[[Deselect All]]</a>
					</div>
				</li>

				$pages.include("$componenthome/results/selected/index.html",$context)
	
	  			#set( $edit = $context.getRequestParameter("editheader") )
			
				#if ( $cancheckout && $order)
					<li>
						<a class="updatebasket emdialog -cart" data-action="remove" targetdiv="basket-paint"  href="$siteroot$apphome/views/modules/asset/activity/checkout/accept.html?orderid=${order.id}" title="[[Checkout your Cart]]">[[Checkout Cart]] <i class="fas fa-caret-right"></i></a>
					</li>				
				#end
			#end
			
			#if($desktop && $user && ($candownload || $canconvert || $candownloadfpo ) )
				$pages.include("$componenthome/desktop/menu.html?collectionid=$librarycol.getId()",$context)
			#end

			<li id="filtersselected" class="filtersselected">
				$pages.include("$componenthome/filters/filters-inline.html", $context)
			</li>	
			
			<li>
			<div id="resultsmessages"></div>
			</li>
				
			</ul>
			<ul class="resultsnavright">
				#if(!$resultview)
					#set($resultview = $userprofile.get("$!{searchtype}resultview"))
					#if (!$resultview)
						#set($resultview = $content.get("resultview"))
					#end
					#if (!$resultview)
						#set($resultview = "stackedgallery")
					#end
				#end
				
				$context.putPageValue("resultview", $resultview)
				
				
				#if(!$edit || $edit == "false"  )

					#if($resultview != "stackedgallery")
				
						##-PAGINATION
						
						#set($total = $hits.getTotalPages())
						#if( $total > 1)
							<li class="resultpages">		
								$pages.include("$componenthome/results/positions.html", $context)
							</li>
						#end

						##-HITSPERPAGE

						#if($dialogresults)
							#set($targetdiv= "dialog$!{moduleid}resultscontainer")
						#else
							#set($targetdiv= "$!{moduleid}resultscontainer")
						#end
					
						<li class="resultsnavtitem subnav-dropdown" style="width:65px;height:36px">
								#if(!$currenthitsperpage)
									#set( $currenthitsperpage = $hits.getHitsPerPage())
								#end
								#if(!$currenthitsperpage)
									#set( $currenthitsperpage = $userprofile.get("${resultview}assethitsperpage"))
								#end
								#if(!$currenthitsperpage)
									#set( $currenthitsperpage = $userprofile.get("assethitsperpage"))
								#end
								#set($hitcountoptions = $mediaarchive.getList("hitcount"))
								<select class="form-control form-select-sm hitsperpagechange resultsnavselect" 
										id="hitsperpagechange$!topmodule"
										data-oemaxlevel="1">
										#foreach($ho in $hitcountoptions)
											<option value="$ho.id" #if($currenthitsperpage==$ho.id) selected="selected"#end>#text($ho)</option>
										#end	
								</select>
						</li>	
					#else
						## TODO?: infinie scroll for stacked media
					#end
					
					
					##-RESULTS TYPE
					
					<li class="resultsnavtitem">
						<select class="form-control" 
							name="resultview" 
							id="selectresultview"
							data-oemaxlevel="1"
							data-hitsperpage="$!currenthitsperpage ">
							#set( $types = $mediaarchive.getList("resulttype"))
							#foreach($type in $types)
								<option value="$!type.getId()" #if( $resultview == "$type.getId()") selected #end>$type.getName($context)</option>
							#end
						</select>
						
					</li>
					
				#end	
				
				
				#if(!$resultview || $resultview == 'table')
					#if( $canedittablecolumns )
						#if( $edit )
							
							<li class="resultsnavtitem" style="min-width:180px;">
								#set ($alldetails = $searcher.getUserPropertyDetails() )
								<span class="hint">*[[Drag columns to move them]]</span>
								<select class="form-control form-control-sm select2 tableresultsaddcolumn" 
										name="addcolumn"
										data-componenthome="$!siteroot$componenthome/results/addremovecolumns.html?searchtype=asset&hitssessionid=$hits.getSessionId()&editheader=true"
										data-targetdiv="$!module.getId()resultsarea" 
										data-oemaxlevel="1"
										data-allowclear="false">
									<option>[[Add Column]]</option>
									#foreach( $detail in $alldetails) <option value="$!detail.id">$detail.getText($context)</option>
									#end
								</select>
								
							</li>
							<li>
								<a class="ajax table-edit-close" 
									data-targetdiv="$!module.getId()resultsarea"
									data-oemaxlevel="1" 
									title="[[Close Edit Columns Mode]]"
									href="$siteroot$componenthome/results/index.html?searchtype=asset&hitssessionid=$hits.getSessionId()&editheader="><i class="fas fa-times"></i></a>
							</li>		
							<li class="resultsnavtitem">
								
							</li>
						#else 
							<li >
								<a class="ajax nav-hover" 
									id="table-editor" 
									data-targetdiv="$!module.getId()resultsarea"
									data-oemaxlevel="1" 
									href="$siteroot$componenthome/results/index.html?searchtype=asset&hitssessionid=$hits.getSessionId()&editheader=true">
									<i class="fas fa-edit"></i></a>
							</li>
						#end	
					#end								
				#end
				<li class="resultsnavtitem">
					<button class="btn summary-opener">
						<i class="fas fa-angle-double-left"></i> [[Summary]]
					</button>
				</li>
		</ul>
		
	</div>
	<div class="clearfix"></div>
	</div>
