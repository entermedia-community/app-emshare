#set($moduleid = $module.getId())
$context.putPageValue("moduleid", $moduleid)

#set($filter = $modulehits.findFilterValue("entitysourcetype") )
$context.putPageValue("filter", $filter)

	<div class="emgrid-module emgrid-box emgrid-column emgrid-module-$!rendertype">
   		<div class="emgrid-subtitle">
	   		<h3>
		     	#set($moduleicon = "grid")
		     	#if ($module.moduleicon)
		     		#set($moduleicon = $module.moduleicon)
		     	#end
		     	
		     	#set($rendertype = $module.modulerendertype)
				
				#if (!$rendertype)
				   	#set($rendertype = "entity")
				#end
				$context.putPageValue("entityrendertype", $rendertype)
		     	
	     		#set($entityurl = "$!siteroot$apphome/views/modules/$!{module.id}/index.html?$!{module.id}page=1&hitssessionid=$!hits.getSessionId()")
	
				<a href="$entityurl" 
					class="ajax minimizeexpandedmoduleX" 
					data-targetdiv="applicationcontent" 
					data-oemaxlevel="4" 
					data-updateurl="true" 
					data-profilepreference="defaultmodule"
					data-profilepreference.value="$!module.getId()"
					title="#text($module)" >
				
					<i class="bi bi-$!{moduleicon} module-icon" style="font-size:0.9em;line-height:1;"></i> 
				
					#ifnull($count)
						#set( $count = $hits.size()) 
					#end
					#text($module)
					 <span class="count">($count)</span>
					</a>
					
					#if($topmoduleid == "favorites")
						<a href="$apphome/views/modules/modulesearch/bookmarksremove.html?moduleid=${module.id}" 
							class="ajax removemodulebookmarks rounded btn btn-brand clear-bookmarks ml-2"
							data-targetdivinner="modulesearchtopcontainer"
							data-oemaxlevel="1"
							data-confirm="[[Are you sure to remove items from Bookmarks?]]"
							title="[[Clear Bookmarks]]"><i class="bi bi-bookmark-x mr-1"></i>[[Remove All]]</a>
					#end
					
								
					
			</h3>
			

		<div class="clearfix"></div>
   		</div>

		#set($rendertype = "entity")
	   	#if ($module.modulerendertype)
	   		#set($rendertype = $module.modulerendertype)
	   	#end
	   	$context.putPageValue("rendertype", $rendertype)
	   	$context.putPageValue("rendermoduleid", $module.id)
	   	
	   	##check for view
		#set($viewid = "${moduleid}gridfields")
		#set($view = "$moduleid/$viewid")

		#if( $context.getUserProfile() )
			#set($searcher = $searcherManager.getSearcher($catalogid,$moduleid))
			#set ($details = $searcher.getDetailsForView($view, $context.getUserProfile()))
			
		#else
			#set ($details = $searcher.getDetailsForView($view))
			
		#end
	   	$context.putPageValue("details", $details)
	   
	   $hits.setHitsPerPage(6)
	 <div class="emgridflex">  	
		<div id="galleryimg-${rendertype}" 
				class='emgrid #if($section != "favorites")emgridlimited#end entitiescontainer' 
				style="width:1125px"
				data-fixedwidth="175" 
				data-cellpadding="10"
				data-entityrenderurl="$!{siteroot}$apphome/views/modules/${module.id}/components/gridsample/gridcell.html"
				data-rendertype="$rendertype">
				#foreach( $hit in $hits.getPageOfHits() )
					$context.putPageValue("hit", $hit)
				    ##$pages.include("$apphome/components/gridsample/gridcell.html", $context)
				    <div class="emgridcell emgridcell-$rendertype activelistcontainer 
		 			#if($selectedid == $hit.getId() || $topselectedid == $hit.getId()) active #end
		 			"> 
					#set($rendertype = $module.modulerendertype)
					#if (!$rendertype || $rendertype == "searchcategory")
			   			#set($rendertype = "entity")
					#end
					$pages.include("$apphome/views/modules/$!{moduleid}/components/gridsample/types/${rendertype}.html", $context)
					<div class="emgridcell-bookmark">
						$pages.include("$componenthome/gridsample/favorites.html?id=$hit.getId()&moduleid=$moduleid", $context)
					</div>
				    </div>
				#end
		</div>
		
		#if($permissions.can($moduleid, "create") && $moduleid!="faceprofilegroup" && $topmoduleid != "favorites")
	 		#set($addurl = "$siteroot$applink/views/modules/${moduleid}/components/gridsample/preview/$!{rendertype}.html?edit=true&addnew=true&viewid=$!{moduleid}addnew")
	 		#ifnotnull($topentityid)
	 			#set($addurl = "$addurl&fieldexternalid=${topmodule.getId()}&fieldexternalvalue=${topentityid}&reloadtargets=topmodulecontainer")
	 		#end
			<div class=" emgrid-addmore">
				<a href="$addurl"
				class="emdialog"
				title="[[Add Record]]"
				>[[Add New]]</a>
			</div>
		#end
		
		</div>
	</div>
		
		
		
			