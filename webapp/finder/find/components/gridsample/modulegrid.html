#set($filter = $modulehits.findFilterValue("entitysourcetype") )
$context.putPageValue("filter", $filter)


#set($topentityid = $context.getRequestParameter("topentityid"))

#if($topentityid)
	#set($topentity = $mediaarchive.getCachedData($topmodule.getId(), $topentityid))
	#set($href = "$siteroot$apphome/views/modules/${topmodule.getId()}/index.html?hitssessionid=$!hits.getSessionId()&${topmodule.getId()}clearresults=true&${topmodule.getId()}clearselection=true&clearselection=true&clearfilters=true")
	#set($oemaxlevel = "4")
	<div class="filtered">
		<div class="filtered-breadcrumb">
		[[Showing]]: <span class="searchterm">#text($topentity)</span>
		</div>
		<a class="clearallfilters ajax btn btn-secondary btn-xs btn-clearall " 
		href="$href"
		data-targetdiv="applicationcontent" 
		data-oemaxlevel="$oemaxlevel" 
		data-updateurl="true" 
		data-onsuccess="closetypeaheadmodal"
		title="[[Clear Search Filters]]">[[Clear Filters]] <i class="fas fa-times"></i> </a>
	</div>
#end

   		<div class="emgrid-module emgrid-box emgrid-column emgrid-module-$!rendertype">
   		<div class="emgrid-subtitle">
	   		<h3>
		     	#set($moduleicon = "entity")
		     	#if ($module.moduleicon)
		     		#set($moduleicon = $module.moduleicon)
		     	#end
		     	
	     		#set($entityurl = "$!siteroot$apphome/views/modules/$!{module.id}/index.html?$!{module.id}page=1&hitssessionid=$!hits.getSessionId()")
	
				<a href="$entityurl" 
					class="ajax minimizeexpandedmoduleX" 
					data-targetdiv="applicationcontent" 
					data-oemaxlevel="3" 
					data-updateurl="true" 
					data-profilepreference="defaultmodule"
					data-profilepreference.value="$!module.getId()"
					title="#text($module)" >
				<img src="$siteroot$apphome/theme/images/entity/${moduleicon}.svg" style="height: 25px; max-width:20px;"> 
				
				#if( $module.id == "asset") ##this is safe
					#set( $count = $hits.size()) 
				#else
					#set( $count = $filter.getCount($module.id) ) 
				#end
				#ifnull($count)
					#set( $count = $hits.size()) 
				#end
				#text($module)
				 <span class="count">($count)</span>
				</a>
				

			</h3>
			
					<div style="float:right" >
					#if($moduleid=="asset")
						
						<a href="$entityurl" 
						class="btn-sm btn-blue btn-view-media entity-add-media ajax"
						data-targetdiv="applicationcontent"
						data-sidebarcomponent="categories"
						data-oemaxlevel="4"
						title="[[View Media]]" 
						data-profilepreference="defaultmodule"
						data-profilepreference.value="$!module.getId()">
						<i class="fas fa-images"></i> [[View Media]]</a>
					#else
						<a href="$entityurl" 
						class="ajax minimizeexpandedmodule" 
						data-targetdiv="applicationcontent" 
						data-oemaxlevel="4" 
						data-updateurl="true" 
						data-profilepreference="defaultmodule"
						data-profilepreference.value="$!module.getId()"
						title="[[Expand]] #text($module)">
						<i class="fas fa-window-maximize"></i></a>
					
					#end
				</div>
		<div class="clearfix"></div>
   		</div>
   		
   		
		#if ($moduleid!="faceprofilegroup" && $moduleid!="asset")
				#set($canaddnew = $permissions.can($moduleid, "create"))
				#if($canaddnew)
				<div style="margin-bottom:15px">
						<a class="btn btn-xs btn-blue emdialog TODOautocloseside" 
							style="margin-right:5px; "  
							title="[[Add New]] #text($module)"
							href="$siteroot$applink/views/modules/${moduleid}/components/gridsample/preview/$!{rendertype}.html?edit=true&addnew=true&viewid=$!{module.id}addnew&targetdiv=applicationmaincontent"
							data-hidefooter="true">
							<i class="fas fa-plus"></i> [[New]]</a>
							</div>
				#end
			#end
		#set($rendertype = "entity")
	   	#if ($module.modulerendertype)
	   		#set($rendertype = $module.modulerendertype)
	   	#end
	   	$context.putPageValue("rendertype", $rendertype)
	   	$context.putPageValue("rendermoduleid", $module.id)
	   	
	   	##check for view
		#set($viewid = "${moduleid}gridfields")
		#set($view = "$moduleid/$viewid")

		#if( $context.getUserProfile() )
			#set($searcher = $searcherManager.getSearcher($catalogid,$moduleid))
			#set ($details = $searcher.getDetailsForView($view, $context.getUserProfile()))
			
		#else
			#set ($details = $searcher.getDetailsForView($view))
			
		#end
	   	$context.putPageValue("details", $details)
	   
	   
	   	
	   $hits.setHitsPerPage(6)
	   
	   
	   	
		<div id="galleryimg-${rendertype}" 
				class='emgrid #if($section != "favorites")emgridlimited#end entitiescontainer' 
				style="width:1300px"
				data-fixedwidth="200" 
				data-cellpadding="10"
				data-entityrenderurl="$!{siteroot}$apphome/views/modules/${module.id}/components/gridsample/gridcell.html"
				data-rendertype="$rendertype">
				#foreach( $hit in $hits.getPageOfHits() )
					$context.putPageValue("hit", $hit)
				    $pages.include("$apphome/components/gridsample/gridcell.html", $context)
				#end
				#if($hits.getTotalPages() > 1)
				<div class=" emgrid-viewmore " style="">
					<a href="$siteroot$applink/views/modules/${moduleid}/index.html">[[View More]]</a>
				</div>
				#end
		</div>
		
		
		
		
		
	</div>
		
		
		
			