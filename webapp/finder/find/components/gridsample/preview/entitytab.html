#set( $searchtype = $context.getRequestParameter("searchtype"))
#set( $id = $context.getRequestParameter("id"))

#if( !$entity)
	#set( $entity  = $mediaarchive.getData($searchtype, $id) )
#end
#set($module = $mediaarchive.getData("module", $searchtype))
#set($entityid = $entity.id)
#set($moduleid = $module.getId())

$context.putPageValue("entityid", $entityid)
$context.putPageValue("moduleid", $moduleid)


<div id="entity-tab" class="entity-tab-content" data-id="$!entity.getId()">
<div class="entity-metadata" id="entitymetadata" data-id="$!entity.getId()" data-searchtype="$!searchtype">
	$context.putPageValue("data", $entity)
	$context.putPageValue("searchtype", $searchtype)
	$pages.include("metadata.html", $context)
</div>

<div class="entity-media">
	<div class="entity-media-box" style="margin-bottom:20px;">
	<div class="entity-media-header">
		<h4>[[Folders]]</h4>
		
			<a href="$uploadlink" 
					class="ajax entity-add-media"
					data-targetdivinner="$targetdiv"
					data-closedialog="true" 
					data-closemediaviewer="true"
					data-updateurl="true"
					data-oemaxlevel="$!oemaxlevel"
					title="[[Download Folder]]">
					<i class="fas fa-download"></i></a>
		
			
				#set($uploadlink = "$siteroot$applink/views/modules/asset/add/start.html?entityupload=true&entitytype=$moduleid&addselection=$entityid&clearotherentities=true")
				#set($oemaxlevel = "1")
				#set($targetdiv = "applicationmaincontent")

					
					<a href="$uploadlink" 
					class="ajax entity-add-media"
					data-targetdivinner="$targetdiv"
					data-closedialog="true" 
					data-closemediaviewer="true"
					data-updateurl="true"
					data-oemaxlevel="$!oemaxlevel"
					title="[[Upload Folder]]">
					<i class="fas fa-upload"></i></a>
					
			#set( $folders = $mediaarchive.query("category").hitsPerPage(6).match($moduleid, $entityid).sort("name").search($context) )
					
			##TODO create list of categories
			
			#set($searchlink = "$apphome/components/categories/search/searchcategory.html")
			<a href="$searchlink" 
			   class="detail-edit-icon btn  emdialog"
			   data-cancelsubmit="true" 
			   data-multivalue="false"
			   data-pickone="true"
			   ## data-detailid="categoryid"
			   ## data-assetid=${asset.id}
			   data-moduleid="$moduleid"
			   data-dataid="$entityid"
			   data-existingcategories="$!{existingcategories}"
			   data-action="$apphome/components/gridsample/preview/entitytab.html"
			   data-targetdiv="entity-tab"
			   data-parameterdata="id"
			   data-noesc="true"
			   title="[[Choose Folder]]"><i class="fas fa-search"></i></a>		

		
	</div>
	
	
	</div>
	
	
		<div class="entity-media-box">
				<div class="entity-media-header">
				<h4>[[Files]]</h4>
				#set($uploadlink = "$siteroot$applink/views/modules/asset/add/start.html?entityupload=true&entitytype=$moduleid&addselection=$entityid&clearotherentities=true")
				#set($oemaxlevel = "1")
				#set($targetdiv = "applicationmaincontent")
				<a href="$uploadlink" 
					class="ajax entity-add-media"
					data-targetdivinner="$targetdiv"
					data-closedialog="true" 
					data-closemediaviewer="true"
					data-updateurl="true"
					data-oemaxlevel="$!oemaxlevel"
					title="[[Upload Media]]">
					<i class="fas fa-upload"></i></a>
				</div>
				
				#set( $assetsshown = 4)
				#if( $searchtype == "faceprofilegroup" )
					#set( $assetshits = $mediaarchive.query("asset").hitsPerPage($assetsshown).exact("faceprofiles.faceprofilegroup", $entityid).sort("assetaddeddateDown").search() )
							
				#else
					#set( $assetshits = $mediaarchive.query("asset").hitsPerPage($assetsshown).match($moduleid, $entityid).sort("assetaddeddateDown").search() )
						
				#end
				
				
				$context.putPageValue("assetshits", $assetshits)
				$context.putPageValue("fullview",true) 
				$context.putPageValue("thumbsize", "small" )
				$context.putPageValue("primaryimage", $entity.primaryimage )
				
				$context.putPageValue("mediarender", "attachedmedialist" )
				
				$pages.include("$componenthome/gridsample/preview/attachedmedia.html",$context)
				
		</div>
	
	</div>


</div>