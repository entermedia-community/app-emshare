#set($searchtype = $context.getRequestParameter("searchtype"))
#if(!$searchtype)
	#set( $searchtype = $context.findValue("module"))
#end
#if(!$searchtype)
	#set( $searchtype = $context.findValue("searchtype"))
#end

#set( $id = $context.getRequestParameter("id"))
#set($entityid = $id)

#if( !$entity)
	#set( $entity  = $mediaarchive.getData($searchtype, $id) )
#end
#set($entityid = $entity.id)

#set($module = $mediaarchive.getData("module", $searchtype))
#set($moduleid = $module.getId())

$context.putPageValue("entityid", $entityid)
$context.putPageValue("moduleid", $moduleid)

#if(!$id)
#set($id= $entity.id)
#end
#if(!$id)
#set($id= "")
#end

#set($edit = $context.getRequestParameter("edit"))
#if($edit!="true")
	#set($edit="false")
#end
$context.putPageValue("edit", $edit)



<div id="entity-tab-#eid($id)" 
	class="entity-tab-content ajaxautoreload" 
	data-id="$!entity.id" 
	data-searchtype="$searchtype"
	data-autoreloadevents="uploadstart"
	data-url="$componenthome/gridsample/preview/entitytab.html">
	
	<div class="entity-metadata" id="entitymetadata" data-id="$!entity.getId()" data-searchtype="$!searchtype">
		$context.putPageValue("id", $entityid)
		$context.putPageValue("data", $entity)
		$context.putPageValue("searchtype", $searchtype)
		$pages.include("$componenthome/gridsample/preview/metadata.html", $context)
	</div>
	
	<div class="entity-media">
	#if($moduleid && $entityid)
		
		$pages.include("$componenthome/categories/entities/listcategories.html",$context)
		
		
		#set( $assetsshown = 4)
		#if( $searchtype == "faceprofilegroup" )
			#set( $assetshits = $mediaarchive.query("asset").hitsPerPage($assetsshown).exact("faceprofiles.faceprofilegroup", $entityid).sort("assetaddeddateDown").search() )
					
		#else
			#set( $assetshits = $mediaarchive.query("asset").hitsPerPage($assetsshown).match($moduleid, $entityid).sort("assetaddeddateDown").search() )
				
		#end
		$context.putPageValue("assetshits", $assetshits)
		$context.putPageValue("fullview",true) 
		$context.putPageValue("thumbsize", "small" )
		$context.putPageValue("primaryimage", $entity.primaryimage )
		$context.putPageValue("mediarender", "attachedmedialist" )

		
		<div class="entity-media-box #if(!$assetshits) collapsedmediabox #end">
			<div class="entity-media-header">
				<h4 class="expandmediabox">
				#if(!$assetshits)
					<i class="fas  fa-caret-right  expandmediaboxicon"></i>
				#else
					<i class="fas  fa-caret-down  expandmediaboxicon"></i>
				#end [[Files]]</h4>
				#if($moduleid && $entityid)
				
					#if($desktop)
					<a href="#" 
							class="ajax localfilePicker"
							data-targetdivinner="$targetdiv"
							data-closedialog="true" 
							data-closemediaviewer="true"
							data-updateurl="true"
							data-oemaxlevel="$!oemaxlevel"
							data-sourcepath="Albums/Users/$user.getScreenName()/Desktops"
							title="[[Upload Media]]">
							<i class="fas fa-upload"></i></a>
					
					#else
						#set($uploadlink = "$siteroot$applink/views/modules/asset/add/start.html?entityupload=true&entitytype=$moduleid&addselection=$entityid&clearotherentities=true")
						#set($oemaxlevel = "1")
						#set($targetdiv = "applicationmaincontent")
						<a href="$uploadlink" 
							class="ajax entity-add-media"
							data-targetdivinner="$targetdiv"
							data-closedialog="true" 
							data-closemediaviewer="true"
							data-updateurl="true"
							data-oemaxlevel="$!oemaxlevel"
							title="[[Upload Media]]">
							<i class="fas fa-upload"></i></a>
					#end	
					
					#set($searchlink = "$componenthome/assetpicker/search/searchassets.html")
					<a href="$searchlink" 
						data-targetdiv=""
						data-target="$siteroot$apphome/components/assetpicker/search/searchassets.html?targetdiv=${detail.id}-value&detailid=${detail.id}"
						data-dialogid="assetsearchdialog" 
						class="emdialog"
						title="[[Choose Folder]]"><i class="fas fa-search"></i></a>
				#end
				</div>
				
				$pages.include("$componenthome/gridsample/preview/attachedmedia.html",$context)
		</div>
		#end
		</div>
	<div class="clearfix"></div>
	
	
	$pages.include("$componenthome/gridsample/preview/metadata-submodules.html",$context)
	
	
	

</div>