#set( $searchtype = $context.findValue("searchtype"))
#set( $parentsearchtype = $searchtype)
#set( $id = $context.getRequestParameter("id"))
#ifnull($id)
	#set( $id = $context.getRequestParameter("entityid"))
	$context.putPageValue("id", $id)
#end

#if($id.startsWith("multiedit"))

#else
	#if( !$entity)
		#set( $entity  = $mediaarchive.getData($searchtype, $id) )
	#end
	#set($entityid = $entity.id)
	$context.putPageValue("entity", $entity)
	$context.putPageValue("entityid", $entityid)
#end

#set($module = $mediaarchive.getData("module", $searchtype))
#set($moduleid = $module.getId())
$context.putPageValue("moduleid", $moduleid)


#set($viewsearcher = $searcherManager.getSearcher($catalogid, "view"))
#set($enttiyviews = $viewsearcher.query().exact("moduleid", $moduleid).exact("rendertype","table").exact("systemdefined","false").sort("orderingUp").search($context) )



#set( $entitytabopen = $context.getRequestParameter("entitytabopen"))
#ifnull($entitytabopen)
	#set( $entitytabopen = $userprofile.get("entitytabopen"))
#end

##default to General tab if not submodules configured
#if($entitytabopen == 'submodulehome')
	#if(!$enttiyviews)
		#set($entitytabopen = "metadata")
	#end
#end

##default to General tab if not media allowed
#if($entitytabopen == 'media')
	#if(!$module.getBoolean("enableuploading") || !$permissions.can($moduleid, "upload_files"))
		#set($entitytabopen = "metadata")
	#end
#end



#set( $enablebackbutton = $context.getRequestParameter("enablebackbutton"))

<div class="entitydialog #if($enablebackbutton) enablebackbtn #end" data-moduleid="$moduleid" data-entityid="$!entityid" data-url="$componenthome/gridsample/preview/entity.html">
	<div class="entity-wraper">
	<h2>
	<a href="#" class="entitydialogback emdialog" data-moduleid="" data-entityid="" style="display: none;">
	<i class="fas fa-arrow-left"></i></a>
	#text($module) \ 
	
	#if($entity.getName($context))
			#set($name = $!entity.getName($context))
	#else 
			#set($name = "[[Add New]]")
			#set($entitytabopen = "metadata")
	#end
	
	#text($name)
	
	</h2>
		
		<nav>
	  	<div class="nav nav-tabs entity-navigation" id="entity-nav-tab" role="tablist" 
	  		 data-tabmenuurl="gridsample/preview/entitytabmenu.html">
	  		##myself
	  		$context.putPageValue("tabmodule", $module)
	  		#set($tabid = "${moduleid}$!{entityid}")
			#set($tabid = "#eid($tabid)")
			#set($tabtype= "metadata")
			$context.putPageValue("tabtype", $tabtype)
			
			#if(!$entitytabopen || $entitytabopen == $tabtype)
	  			$context.putPageValue("currenttab", $tabtype)
	  			
			#end
			
			$pages.include("$componenthome/gridsample/preview/entitytabmenu.html", $context)
			
			#ifnotnull($id)
				
				##submodules
				#if($enttiyviews)		
					#foreach( $targetview in $enttiyviews)
						#set( $targetviewid = $targetview.getId())
						#set( $viewdata = $viewsearcher.searchById($targetviewid))
						#set( $subentitysearchtype = $viewdata.rendertable )
						#ifnotnull($subentitysearchtype)
							#set($submodule = $mediaarchive.getCachedData("module", $viewdata.rendertable))
							$context.putPageValue("tabmodule", $submodule)
							$context.putPageValue("tabtype", "submodulehome")
							$context.putPageValue("targetviewid", $targetviewid)
							#set($tabid = "$!subentitysearchtype")
							#set($tabtype= "submodulehome")
							#if($entitytabopen == $tabtype)
					  			$context.putPageValue("currenttab", $tabtype)
							#end
							#set($subcomponenthome = "$apphome/views/modules/$subentitysearchtype/components")
							$pages.include("$subcomponenthome/gridsample/preview/entitytabmenu.html", $context)
						#end
					#end
				#end	
				
				##media
				#if($module.getBoolean("enableuploading") && $permissions.can($moduleid, "upload_files"))
					#set($submodule = $mediaarchive.getCachedData("module", "asset"))
					$context.putPageValue("tabmodule", $submodule)
					$context.putPageValue("tabtype", "media")
					#set($tabid = "asset")
					#if($entitytabopen == "media")
			  			$context.putPageValue("currenttab", "media")
					#end
					#set($subcomponenthome = "$apphome/views/modules/asset/components")
					$pages.include("$subcomponenthome/gridsample/preview/entitytabmenu.html", $context)
				#end
			#end	
		</div>
		</nav>
		
		<div class="tab-content entity-body" id="entity-nav-tabContent">
				#set($tabtype= "metadata")
				$context.putPageValue("tabtype", $tabtype)
				$pages.include("$componenthome/gridsample/preview/entitytab.html", $context)
				
				#ifnotnull($id)
					##submodules
					#if($enttiyviews)		
						#foreach( $targetview in $enttiyviews)
							#set( $targetviewid = $targetview.getId())
						
							
							$context.putPageValue("targetviewid", $targetviewid)
							$context.putPageValue("parentsearchtype", $parentsearchtype)
							$context.putPageValue("parentid", $id)
							$context.putPageValue("hidesubmodule", true)
							#set($tabtype= "submodulehome")
							#if($entitytabopen == $tabtype)
					  			$context.putPageValue("currenttab", $tabtype)
					  		#end
							#set($subcomponenthome = "$apphome/views/modules/$subentitysearchtype/components")
							$pages.include("$subcomponenthome/gridsample/preview/entitytabsub.html", $context)
						#end
					#end
						
					#if($module.getBoolean("enableuploading") && $permissions.can($moduleid, "upload_files"))
						$context.putPageValue("parentsearchtype", $parentsearchtype)
						$context.putPageValue("hidesubmodule", true)
						#set($tabtype= "media")
						#if($entitytabopen == $tabtype)
				  			$context.putPageValue("currenttab", $tabtype)
				  		#end
						$pages.include("$subcomponenthome/gridsample/preview/entitytabmedia.html?entityid=$id", $context)
					#end
			#end
		</div>
	</div>
</div>


