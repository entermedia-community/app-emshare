#set( $id = $context.getRequestParameter("id"))
#set( $searchtype = $context.getRequestParameter("searchtype"))
#set( $searcher = $mediaarchive.getSearcher($searchtype) )
$context.putPageValue("searcher",$searcher)


#if($id)

#if( !$data)
	#set( $data  = $mediaarchive.getData($searchtype, $id) )
#end
$context.putPageValue("data",$data)

<div id="editentitymetadata">

#set($edit = $context.getRequestParameter("edit"))
#if($edit!="true")
	#set($edit="false")
#end

#set($viewid = "${searchtype}generalmetadata")
#set($view = "$searchtype/$viewid")

#set($action = "$siteroot$applink/components/gridsample/preview/metadata-save.html")

<form id="entitydataeditor" 
		name="entitydataeditor" 
		class="ajaxform force-validate-inputs" 
		data-targetdiv="editentitymetadata" 
		data-onsuccess="updateentities"
		method="post"  
		action="$action"
		enctype="multipart/form-data">
    	<input name="save" type="hidden" value="true" />
    	<input name="id" type="hidden" value="$!id" />
    	<input name="searchtype" type="hidden" value="$searchtype" />
    	<input name="viewid" type="hidden" value="$viewid" />
    	<input name="view" type="hidden" value="$view" />
    	<input name="hitssessionid" type="hidden" value="$!hits.sessionId" />

    	
    	$context.putPageValue("view", $view)
    	$context.putPageValue("viewid", $viewid)
    	
		#if($edit =="true")  ##TODO - Permissions
			##1 or 2 colums feature
			#set($detailviewercolumns = $context.getRequestParameter("detailviewercolumns"))
			#if(!$detailviewercolumns)
				#set($detailviewercolumns = 2)
			#end
		
			$pages.include("/$applicationid/components/xml/detaileditor-entities.html?longform=true&detailviewercolumns=$detailviewercolumns", $context)
		#else
			##Tags search link
			$context.putPageValue("tagssearchlink", "$siteroot$apphome/views/modules/modulesearch/index.html")
		
			$pages.include("/$applicationid/components/xml/detaileditor-entities.html?detailsreadonly=true&alwaysshow=true", $context)
		#end
	
    #if($edit=="true")
    <div class="btns">
	    <a class="btn btn-sm btn-dark submitform" style="margin-right: 10px;">[[Save]]</a>
		<a class="btn btn-sm btn-dark ajax" style="margin-right: 10px;" data-targetdiv="editentitymetadata" href="$siteroot$apphome/components/gridsample/preview/metadata.html?id=$!id&searchtype=$!searchtype">[[Cancel]]</a>
		
		#if($detailviewercolumns==1)
			#set($changedetailviewercolumns = 2)
			#set($icondetailviewercolumns = "grip-vertical")
		#else
			#set($changedetailviewercolumns = 1)
			#set($icondetailviewercolumns = "grip-horizontal")
		#end
		<a class="ajax btn btn-sm btn-darkless float-right" data-targetdiv="applicationcontent" data-updateurl="true" data-closedialog="true" data-oemaxlayout="2" href="$siteroot$apphome/views/settings/modules/${searcher.searchType}/metadata/views/index.html?viewid=$viewid&viewpath=$view"><i class="fas fa-cog"></i> [[Fields]]</a>
		<a class="ajax btn btn-sm btn-darkless float-right" style="margin-right:5px;" data-targetdiv="editentitymetadata" href="$siteroot$apphome/components/gridsample/preview/metadata.html?edit=true&id=$data.id&searchtype=$searchtype&detailviewercolumns=$changedetailviewercolumns">
			<i class="fas fa-$icondetailviewercolumns"></i>
		</a>
		
	    <div class="clearfix"></div>
    </div>
    #end
    </form>

#if($edit!="true")
<a href="$siteroot$apphome/components/gridsample/preview/metadata.html?edit=true&id=$data.id&searchtype=$searchtype" data-targetdiv="editentitymetadata" class="ajax btn btn-dark"><i class="fas fa-edit"></i> [[Edit]]</a>
#end
</div>

#end