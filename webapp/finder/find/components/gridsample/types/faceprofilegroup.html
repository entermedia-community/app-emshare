#if($hit)
	#set($entity = $hit)
	#set($entityid = $entity.id)
	#set($moduleid = $module.id)
#else
	#if(!$moduleid)
		#set($moduleid = $context.getRequestParameter("moduleid"))
	#end
	#if(!$entityid)
		#set($entityid = $context.getRequestParameter("entityid"))
	#end
	#if($moduleid && $entityid)
		#set($entity = $mediaarchive.getCachedData($moduleid, $entityid))
	#end
#end

$context.putPageValue("entityid", $entityid)
$context.putPageValue("moduleid", $moduleid)

#set($previewurl = "$siteroot$componenthome/gridsample/preview/${rendertype}.html?id=$entityid&searchtype=$moduleid&hitssessionid=$!hits.sessionId")
$context.putPageValue("previewurl", $previewurl)
<div class="emgridcellC-header"></div>
<div class="emgrid-content emgrid-type-faceprofilegroup entitycontainer entity$!moduleid$!entityid"
	data-id="${entityid}"
   	data-moduleid="$!moduleid"
   	data-rendertype="faceprofilegroup">
   	 
   	 #set($name = $entity.name)
   	 
   	 
  	 
 	 #set($assetsshown = 1)
 	 $context.putPageValue("viewer", "e_m_pp_${entity.id}")
 	 
	#set( $primaryasset = $mediaarchive.getCachedData("asset", $entity.primaryimage))
	$context.putPageValue("primaryasset", $primaryasset)
	 
	#set($facemanager = $mediaarchive.getBean("faceDetectManager") )
	#set($entityassetshits = $facemanager.searchForAssetsNotPrimary($mediaarchive, $entityid, $primaryasset) )
	$!entityassetshits.setHitsPerPage($assetsshown)
	#set($entityassetscount = $entityassetshits.size())
	
	$context.putPageValue("entityassetshits", $entityassetshits)
	
	#set($link = "$!siteroot$applink/views/modules/$!topmodule.getId()/index.html")
	  
		<a href="$link?entityid=$!entity.getId()&entitytype=$!moduleid" 			
				class=" ajax activelistenerparent"
				data-targetdivinner="application"
				data-defaultfolder="$defaultfolder.getId()"
				data-entity="$!entity.getId()"
				data-oemaxlevel="5"
				data-field=""
				data-updateurl="true"
				data-scrollto="entitymediapreviewselected"
				title="[[View]]">
       <div class="emgridC-entitymedia assetdropentity"
       style="text-align: center;"
       		id="attachedmedia$entityid" 
       		data-moduleid="$moduleid" 
       		data-entityid="$entityid" 
       		data-assetsshown="$assetsshown"
       		data-attachedmediaurl="$siteroot$componenthome/gridsample/types/attachedmedia/faceprofilegroup.html"
       		data-targetdiv="attachedmedia$entityid"> 	
       		
       
       		
       		
       		
   	 	 $pages.include("$componenthome/gridsample/types/attachedmedia/entity2.html", $context)
   	 	 <div class="clearfix"></div>
   	 	 </div>
   	 	 <div class="emgridC-name">
			#if($name)
				#text($!name) ([[Profile]] $entity.facecounter)
			#else	
				[[Profile]] $entity.facecounter
			#end
			</div>
	   </a>
	   
	   <a href="$previewurl" 
   	 	class="emdialog entity-dialog emgridpreviewlink" 
   	 	data-hidefooter="true" 
   	 	data-hideheader="true"
   	 	id="clickid${entity.id}"  
   	 	data-id="$entity.id"
   	 	title="#text($!entity.name)">
	        #text($!entity.name)
	        </a>

</div>

