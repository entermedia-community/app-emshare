#if($hit)
	#set($entity = $hit)
	#set($entityid = $entity.id)
	#set($moduleid = $module.id)
#else
	#if(!$moduleid)
		#set($moduleid = $context.getRequestParameter("moduleid"))
	#end
	#if(!$entityid)
		#set($entityid = $context.getRequestParameter("entityid"))
	#end
	#if($moduleid && $entityid)
		#set($entity = $mediaarchive.getCachedData($moduleid, $entityid))
	#end
#end

$context.putPageValue("entityid", $entityid)
$context.putPageValue("moduleid", $moduleid)

#if (!$rendertype && $moduleid)
	#if(!$module)
		#set($module = $mediaarchive.getCachedData("module", $moduleid))
	#end
   	#set($rendertype = $module.modulerendertype)
#end
#if (!$rendertype)
   		#set($rendertype = "entity")
#end

#set($previewurl = "$siteroot$componenthome/gridsample/preview/${rendertype}.html?id=$entityid&searchtype=$moduleid&hitssessionid=$!hits.sessionId")
$context.putPageValue("previewurl", $previewurl)

<div class="emgrid-content emgrid-type-$!moduleid entitycontainer entity$!moduleid$!entityid" 
	 id="emgridentity$!moduleid$!entityid"
		data-id="${entityid}"
   	 	data-moduleid="$!moduleid">
   	 <div class="emgrid-entityheader">
   	 <h3>
   	 <a href="$previewurl" 
   	 	class="emdialog entity-dialog emgridresulttitle" 
   	 	data-hidefooter="true" 
   	 	data-hideheader="true"
   	 	id="clickid${entityid}"  
   	 	data-id="${entityid}"
   	 	data-moduleid="$!moduleid"
   	 	title="$!entity.name">
   	 	##$!hits.highlight($hit,"name")
   	 	$!entity.name
   	 	</a>
   	 	
   	 </h3>
   	 <div class="emgrid-moredetails">
       	<a class="emdialog entity-dialog" 
       		data-hidefooter="true" 
       		href="$previewurl" 
       		title="$!entity.name">
       		<i class="fas fa-info-circle"></i></a>
       	</div> 
   	 </div>
	<div class="emgrid-entitymetadata">
	
		#set( $asset = $mediaarchive.getCachedData("asset", $entity.primaryimage))
		#if($asset)
			$context.putPageValue("asset", $asset)
			$context.putPageValue("viewer", "e_m_i_${entity.id}")
			
			#set( $imagesize = "image200x200.jpg")
	  	 	#set($tpath = $mediaarchive.asLinkToPreview($asset, null, $imagesize, true))
	  	 	<div  class="assetdraggable" data-assetid="$!entity.primaryimage">
	   	 	<a href="$previewurl" 
	   	 	class="emdialog entity-dialog" 
	   	 	data-hidefooter="true" 
	   	 	data-hideheader="true"
	   	 	id="clickid${entityid}"  
	   	 	data-id="entity.id"
	   	 	title="$!entity.name">
			
			  #set($rendertype = $mediaarchive.getMediaRenderType($asset.fileformat))
			  #if(!$rendertype || $type =="rendertype")
	   	    		#set( $rendertype = "mime" )
	   	    	#elseif( $rendertype =="video")
	   	    		#set( $rendertype = "videothumbnail" )
	   	    	#end
	       	    $pages.include("$componenthome/results/thumbnails/${rendertype}.html", $context)
			</a>        	 
			</div>
		#end
        	 
       	#if($entity.longcaption)
       		<div  class="emgrid-entitydescription">
       		$entity.longcaption</div>
       	#end
        	
       	##$pages.include("$componenthome/gridsample/tags.html",$context)
	        
      </div>
      
      #set($assetsshown = 4)
      $context.putPageValue("assetsshown", $assetsshown)
      $context.putPageValue("viewer", "e_m_g_${entity.id}")
       <div class="emgrid-entitymedia assetdropentity"
       		id="attachedmedia$entityid" 
       		data-moduleid="$moduleid" 
       		data-entityid="$entityid" 
       		data-assetsshown="$assetsshown"
       		data-attachedmediaurl="$siteroot$componenthome/gridsample/types/entity.html"
       		data-targetdiv="emgridentity$!moduleid$!entityid"> 	
	        $pages.include("$componenthome/gridsample/types/attachedmedia/entity.html",$context)
	   </div>
	        
        <div class="clearfix"></div>
        
        <div class="grid-gallery-footer">
        
       	<div class="emgrid-moredetailsright">
       		#if( $canviewupload )
		       	#if($moduleid=="librarycollection")
					#set($uploadlink = "$siteroot/$applink/views/modules/asset/add/start.html?collectionid=$entityid&clearotherentities=true")
					#set($oemaxlevel = "1")
					#set($targetdiv = "applicationmaincontent")
				#elseif($moduleid=="faceprofilegroup")
					#set($uploadlink = "")
				#else
					#set($uploadlink = "$siteroot/$applink/views/modules/asset/add/start.html?entityupload=true&entitytype=$moduleid&addselection=$entityid&clearotherentities=true")
					#set($oemaxlevel = "1")
					#set($targetdiv = "applicationmaincontent")
				#end
				#if ($uploadlink)
				<a href="$uploadlink" 
					class="ajax moreactions"
					data-targetdivinner="$targetdiv"
					data-closedialog="true" 
					data-closemediaviewer="true"
					data-updateurl="true"
					data-oemaxlevel="$!oemaxlevel"
					title="[[Upload assets here]]">
					<i class="fas fa-upload"></i></a>
				#end
			#end
			
	       	$pages.include("$componenthome/gridsample/favorites.html?id=$hit.id&searchtype=$moduleid", $context)
	       	
	       	
       	</div>
        </div>
        
       ## <div class="griditem-tools resultsselection">
       ## <input type="checkbox" class="selectionbox" name="count" value="" data-dataid="$hit.getId()">
       ## </div>
</div>


