#if($hit)
	#set($entity = $hit)
	#set($entityid = $entity.id)
	#if($rendermoduleid)
		#set($moduleid = $rendermoduleid)
	#else
		#set($moduleid = $module.id)
	#end
#else
	#if(!$moduleid)
		#set($moduleid = $context.getRequestParameter("moduleid"))
	#end
	#if(!$entityid)
		#set($entityid = $context.getRequestParameter("entityid"))
	#end
	#if($moduleid && $entityid)
		#set($entity = $mediaarchive.getCachedData($moduleid, $entityid))
	#end
#end

#set($module = $mediaarchive.getCachedData("module", $moduleid))

$context.putPageValue("entityid", $entityid)
$context.putPageValue("moduleid", $moduleid)



#set($previewurl = "$!{siteroot}$apphome/views/modules/$!moduleid/components/gridsample/preview/entity.html?id=$entityid&hitssessionid=$!hits.sessionId")
$context.putPageValue("previewurl", $previewurl)
<div class="emgridcellC-header"></div>

<div class="emgrid-content emgrid-type-$!moduleid entitycontainer entity$!moduleid$!entityid" 
	 id="emgridentity$!moduleid$!entityid"
		data-id="${entityid}"
   	 	data-moduleid="$!moduleid"
   	 	data-rendertype="entity">


   	 	
   	 
   	 	##check for view
		#set($viewid = "${moduleid}gridfields")
		#set($view = "$moduleid/$viewid")

		#if( $context.getUserProfile() )
			#set($searcher = $searcherManager.getSearcher($catalogid,$moduleid))
			#set ($details = $searcher.getDetailsForView($view, $context.getUserProfile()))
			
		#else
			#set ($details = $searcher.getDetailsForView($view))
			
		#end
	
		
		$context.putPageValue("details", $details)
		
		##look for primaryimage
		#foreach( $detail in $details )
			#if($detail.getId() == "primaryimage")
				#set( $primaryasset = $mediaarchive.getAsset($entity.primaryimage))
			#end
			
			#ifnull($primaryasset)
				#if($detail.viewType == "asset")
					#set($assetfieldid = $detail.getId()) 
					#set( $primaryasset = $mediaarchive.getAsset($entity.get($assetfieldid)))
				#end
				
			#end
		#end
		
		$context.putPageValue("primaryasset", $primaryasset)
	    $context.putPageValue("viewer", "e_m_g_${entity.id}")
		
		#set($defaultfolder =  $mediaarchive.getBean("entityManager").loadDefaultFolder($module, $entity, $context.getUser()))
       #if($defaultfolder.getId() != $category.getId())
			#ifnotnull($defaultfolder)
			   	###set($link = "$!siteroot$applink/views/modules/$!moduleid/components/gridsample/types/viewmedia.html")
			   	#set($link = "$!siteroot$applink/views/modules/$!moduleid/index.html")
				<a href="$link?entityid=$!entity.getId()&externalid=$!moduleid" 			
				class=" ajax activelistenerparent"
				data-targetdivinner="application"
				data-defaultfolder="$defaultfolder.getId()"
				data-entity="$!entity.getId()"
				data-oemaxlevel="5"
				data-field=""
				data-updateurl="true"
				data-scrollto="entitymediapreviewselected"
				title="[[View]]">
				
				<div class="emgridC-entitymedia assetdropentity"
					style="text-align: center;"
			       		id="attachedmedia$entityid" 
			       		data-moduleid="$moduleid" 
			       		data-entityid="$entityid" 
			       		data-assetsshown="$assetsshown"
			       		data-attachedmediaurl="$siteroot$componenthome/gridsample/types/entity.html"
			       		data-targetdiv="emgridentity$!moduleid$!entityid"> 
					#if($primaryasset)
					        $pages.include("$componenthome/gridsample/types/attachedmedia/entity2.html", $context)
				   #else
					   	#set($moduleicon = "entity")
				     	#if ($module.moduleicon)
				     		#set($moduleicon = $module.moduleicon)
				     	#end
				     	<img src="$siteroot$apphome/theme/images/entity/${moduleicon}.svg" style="height: 95px; width:95px; ">
				   #end
			   		<div class="clearfix"></div>
			   </div>
			        
			   <div class="emgridC-name">#text($!entity)</div>     
				</a>
			#end
		#end
		
       
        <a href="$previewurl" 
   	 	class="emdialog entity-dialog emgridpreviewlink" 
   	 	data-hidefooter="true" 
   	 	data-hideheader="true"
   	 	id="clickid${entityid}"  
   	 	data-id="${entityid}"
   	 	data-moduleid="$!moduleid"
   	 	title="#text($!entity.name)">
		<i class="fas fa-ellipsis-v"></i>
   	 	</a>
       
       
       
       
</div>


