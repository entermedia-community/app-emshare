#set($moduleid = $module.getId())

#if( !$librarycol && $category )
	#set($rootcategories = $category.getParentCategories()) 
	#set( $librarycol = $mediaarchive.query("librarycollection").orgroup("rootcategory", $rootcategories).searchOne() )
#end
<div class="emgrid-box expandedmodule" style=" margin:0 10px 10px;">
	<div class="emgrid-subtitle">
		<h2>
	   	#set($moduleicon = "entity")
	   	#if ($module.moduleicon)
	   		#set($moduleicon = $module.moduleicon)
	   	#end
	   	
	  	#set($entityurl = "$siteroot$apphome/views/modules/$module.id/index.html")
	
	<img src="$siteroot$apphome/theme/images/entity/${moduleicon}.svg" style="height: 24px;"> 
	
		#set( $count = $hits.size())
		
		#if($librarycol)
		 	#text($librarycol)
		#else
			#text($module)
		#end
		 <span class="count">($count)</span>
	</h2>
	
	#if($permissions.can($moduleid, "create"))
		<a class="btn-addentity ajax sidebarselected float-left" 
			data-updateurl="true" 
			data-targetdivinner="applicationmaincontent" 
			data-oemaxlayout="3" 
			href="$siteroot$applink/views/modules/asset/add/start.html" 
			title="[[Upload Media]]">
			<i class="fas fa-plus-circle"></i></a>	
	#end
	
	
	
	#set( $entities = $userprofile.getEntitiesInParent($category) )
	#foreach ( $entity in $entities)
		#set($moduleid = $entity.moduleid) 
		
		#set($module = $mediaarchive.getData("module", $moduleid))
		
		#set($rendertype = $module.modulerendertype)
		#if (!$rendertype)
   			#set($rendertype = "entity")
		#end
		#set($previewurl = "$!{siteroot}$apphome/views/modules/$!{moduleid}/components/gridsample/preview/${rendertype}.html?id=$entity.getId()&hitssessionid=$!hits.sessionId")
		<div class="entityheaderincategory">
			<h3><strong>#text($module):</strong> #text($entity) <a href="$previewurl" class="emdialog entity-dialog"><i class="fas fa-window-restore"></i></a> </h3>
			#if($entity.longcaption)
			<div class="entityheaderincat-description">$entity.longcaption</div>
			#end
		</div> 
	#end
		
	<div class="float-right">
		<a href="$applink/index.html" 
		class="ajax minimizeexpandedmodule"
		title="[[Collapse]] #text($module)"
		data-oemaxlevel="3"
		data-updateurl="true"
		data-targetdiv="applicationcontent"
		data-profilepreference="defaultmodule"
		data-profilepreference.value="none"
		>
		<i class="fas fa-minus-square"></i>
		</a>
	</div>
	<div class="clearfix"></div>
	</div>
	
	
	<div id="${moduleid}resultsarea" class="resultsarea" >
		$pages.include("$componenthome/results/index.html", $context)
		<div class="clearfix"></div>
	</div>
</div>



