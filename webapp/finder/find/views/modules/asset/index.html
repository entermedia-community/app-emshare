#set($moduleid = $module.getId())

#if( !$librarycol && $category )
	#set($rootcategories = $category.getParentCategories()) 
	#set( $librarycol = $mediaarchive.query("librarycollection").orgroup("rootcategory", $rootcategories).searchOne() )
#end


#set( $count = $hits.size())
	
#set($entityurl = "$siteroot$apphome/views/modules/$module.id/index.html")
#set( $entities = $userprofile.getEntitiesInParent($category) )
<div class="emgrid-box expandedmodule" style=" margin:0 10px 10px;">

	<div class="expandedgrid-subtitle">
	#if(!$entities.isEmpty())
		#foreach ( $entity in $entities)
			#set($moduleid = $entity.moduleid) 
			
			#set($module = $mediaarchive.getData("module", $moduleid))
			
			#set($rendertype = $module.modulerendertype)
			#if (!$rendertype)
	   			#set($rendertype = "entity")
			#end
			
			#set($moduleicon = "entity")
	     	#if ($module.moduleicon)
	     		#set($moduleicon = $module.moduleicon)
	     	#end
		     	
		     	
			#set($previewurl = "$!{siteroot}$apphome/views/modules/$!{moduleid}/components/gridsample/preview/${rendertype}.html?id=$entity.getId()&hitssessionid=$!hits.sessionId")
			<div class="entityinheader">
				<a href="$previewurl" class="emdialog entity-dialog entityproperties" 
					style=""
					title="[[View]]: #text($entity)"><i class="fas fa-ellipsis-v"></i></a>
				
				
				#set( $primaryasset = $mediaarchive.getAsset($entity.primaryimage))
		
				#if($primaryasset)
					$context.putPageValue("primaryasset", $primaryasset)		
					
					$context.putPageValue("hit", $primaryasset)
					$context.putPageValue("asset", $primaryasset)
					$context.putPageValue("thumbsize", "crop" )
					<div style="float:left; margin: 0 5px 5px 0;">
					$pages.include("$componenthome/gridsample/types/attachedmediarender.html", $context)
					</div>
				#end
				
				<h3>
				<span style=""> #text($module)</span><br>
				<a href="$previewurl" 
					class="emdialog entity-dialog" 
					style=""
					title="[[View]]: #text($entity)"><strong>#text($entity)</strong></a> 
				</h3>
				<div class="clearfix"></div>
				<div class="emgrid-entitydataZ">
					$context.putPageValue("searchtype", $moduleid)
					$context.putPageValue("data", $entity)
					
					<div class="emgridcell-fields">
	
					$pages.include("$apphome/views/modules/$!moduleid/components/gridsample/types/fields.html",$context)


					</div>
			   
			    </div>
			 </div>
		#end

	#end
	<div class="clearfix"></div>
	
	<div class="">
	#if($permissions.can($moduleid, "create"))
	
		<a class="btn-sm btn-blue ajax sidebarselected " 
			style="margin-right: 5px;"
			data-updateurl="true" 
			data-targetdivinner="applicationmaincontent" 
			data-oemaxlayout="3" 
			href="$siteroot$applink/views/modules/asset/add/start.html?nodeID=$!category.getId()" 
			title="[[Upload Media]]">
			<i class="fas fa-plus"></i> [[Media]]</a>
	#end
	
	##if($permissions.can($moduleid, "create"))
		<a class="btn-sm btn-blue ajax sidebarselected " 
			data-updateurl="true" 
			data-targetdivinner="applicationmaincontent" 
			data-oemaxlayout="3" 
			href="$siteroot$applink/views/modules/asset/add/start.html" 
			title="[[Download Folder]]">
			<i class="fas fa-download"></i> [[Download Folder]]</a>
	##end
	</div>	
		
	
		
	
	<div class="clearfix"></div>
	
	
	
	</div>
	
	
	<div id="${moduleid}resultsarea" class="resultsarea" >
		$pages.include("$componenthome/results/index.html", $context)
		<div class="clearfix"></div>
	</div>
</div>



