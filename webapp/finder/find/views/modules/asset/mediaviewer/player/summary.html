#if( !$thumbsize )
	#set( $thumbsize  = "largepreview" )
#end
$context.putPageValue("thumbsize",$thumbsize)

#set($assetwidth = $mediaarchive.getRealImageWidth($asset)) 
$context.putPageValue("assetwidth",$assetwidth)	
#set($assetheight = $mediaarchive.getRealImageHeight($asset)) 
$context.putPageValue("assetheight",$assetheight)

##Blockfind picker

#if($picker && $picker.isPickerEnabled("asset", $module.id))
	$context.putPageValue("pickerenabled", true)
#end

<div id="mediaplayer" 
	class="media-player-mini editdiv" 
	data-assetid="${asset.id}" 
	data-assetwidth="${assetwidth}"
	data-assetheight="${assetheight}"
	data-opentab="viewproperties"
	data-faceprofileedithome="$siteroot$apphome/views/modules/asset/editor/faceprofiles">
		#set($totalpages = $numberutils.toInt($asset.pages))
		#set ( $hitssessionid = $context.findValue("hitssessionid"))
		
		
			#set($facemanager = $mediaarchive.getBean("faceProfileManager") )
			#set($faceboxescollection =  $facemanager.collectFaceBoxesAllPeople($asset,$assetwidth) )
					

			<div class="media-thumbnail #if($faceboxescollection) emshowbox #end">
				
				#set( $rendertype = $mediaarchive.getMediaRenderType($asset.fileformat))
				
				$context.putPageValue("viewer","summary")
					
				#if( $asset.previewstatus == "mime" || $alwaysmime)
					#set( $rendertype = "mime" )
				#end
						
				#if( ($asset.previewstatus != "2" && $asset.previewstatus != "exif" && $asset.previewstatus != "mime" && $asset.previewstatus != "1" && $asset.previewstatus != "generated") && !$mediaarchive.isCatalogSettingTrue("realtimethumbs"))
			    
					$pages.include("$searchhome/convertqueue/previewstatus.html?assetid=$!{asset.id}",$context)
					
				#else   

					#if($rendertype == "image")
			
						#if($asset.fileformat == "gif")
							#set($cdnprefix = $!{mediaarchive.getCatalogSettingValue("cdn_prefix")})
							#if(!$cdnprefix )
								#set($cdnprefix = $context.siteRoot )
							#end
							$context.putPageValue("cdnprefix", $cdnprefix)
							$context.putPageValue("useoriginal", "true")
						#end
					
					#end 						

	 				$pages.include("$searchhome/thumbnails/${rendertype}.html", $context) 
				#end
				
			</div>
			
		    <div class="media-player-mini-links d-flex flex-wrap justify-content-center" >
				
				
			#if( !$ismulti )
				<div class="assetlock #if($asset.isLocked()) assetlocked #end me-2">
				#if($caneditasset || $canviewsettings)	
					<form name="lockform" 
					class="autosubmit ajaxform noautofocus" 
					style="display: inline-block;" 
					action="$siteroot${apphome}/views/modules/asset/editors/dataasset/generalinformation/toggleassetlock.html" 
					data-targetdiv="tabsummarypanel">
						<input type="hidden" name="assetid" value="${asset.id}"/>
						
							<a href="#" 
								class="btn #if(!$asset.isLocked())btn-primary #else btn-cta #end submitform"
								#if(!$asset.isLocked()) 
									title="[[Lock Asset]]"
								#else
									title="[[Unlock Asset]]" 
								#end
								>
								#if(!$asset.isLocked())
									<i class="bi bi-lock me-1"></i>[[Lock]]
								#else
									#set($userlock = $asset.getLockOwner())
									#if($userlock.id != $user.id)
										<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
										[[Currently locked by]]  <strong>$asset.getLockOwner()</strong>
									#else
										<i class="bi bi-lock-fill me-1"></i> [[Locked by You]]
									#end
								#end
								
							</a>
							
					</form>
				#else
					#if($asset.isLocked())
						
						<a href="#" class="btn btn-cta">
							#if(!$asset.isLocked())
								<i class="bi bi-lock me-1"></i>[[Lock]]
							#else
								#set($userlock = $asset.getLockOwner())
								#if($userlock.id != $user.id)
									<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
									[[Currently locked by]]  <strong>$asset.getLockOwner()</strong>
								#else
									<i class="bi bi-lock-fill me-1"></i> [[Locked by You]]
								#end
							#end
							
						</a>
						
					#end
				#end
				</div>
			#end
				   
			#if($caneditasset && $canviewapprovereject )
			<div class="btn-group dropup">
				<a href="#" 
					class="btn btn-cta dropdown-toggle  me-2"
					role="button" id="dropdownStatusAsset" data-toggle="dropdown" data-bs-toggle="dropdown"
				>
					#if($asset.editstatus =="rejected")
					<i class="bi bi-slash-circle ns me-1"></i>
					#elseif($asset.editstatus =="6")
					<i class="bi bi-check2-circle ns me-1"></i>
					#else
					<i class="bi bi-circle  ns me-1"></i>
					#end
					#ifnotnull($asset.editstatus)
					$mediaarchive.getCachedData("asseteditstatus", $asset.editstatus)
					#end
				</a>
				<div class="dropdown-menu">
				   	#if($asset.editstatus != "rejected")
						
						<a class="dropdown-item emdialog"
						href="$!{siteroot}${apphome}/views/modules/asset/approval/confirmreject.html?assetid=$asset.getId()&dialogresults=$!dialogresults">[[Reject]]</a>
					#end
					#if($asset.editstatus != "6")
						<a class="dropdown-item emdialog" 
						href="$!{siteroot}${apphome}/views/modules/asset/approval/confirmapprove.html?assetid=$asset.getId()&dialogresults=$!dialogresults">[[Approve]]</a>
					#end
					###set($statuses = $mediaarchive.getList("asseteditstatus"))
					###foreach($status in $statuses)
					##	 <a class="dropdown-item" href="#?$status2.getId()">#text($status)</a>
					###end
				</div>
			</div>
			#end
				
				   
			#if($caneditasset)
			<a href="$siteroot$apphome/views/modules/asset/editor/conversions/replaceoriginal/index.html" 
				class="btn btn-primary emdialog me-2"
				data-assetid="$asset.getId()"
				data-dialogid="replaceoriginalasset">
				<i class="bi bi-files ns me-1"></i>
				[[Replace Original File]]
			</a>
			#end
			#if($caneditasset && $candeleteasset )
				#if ( $ismulti )
					#if($canmultidelete)  
					<a class="btn btn-danger  emdialog" href="$siteroot${apphome}/views/modules/asset/mediaviewer/fullscreen/delete/index.html?collectionid=$!collectionid&hitssessionid=$!hitssessionid">
						<i class="bi bi-trash me-1"></i> [[Delete Selected Assets]]
					</a>
					#end 
				#else
					<a class="btn btn-danger emdialog" 
						data-maxwidth="600"
						href="$siteroot${apphome}/views/modules/asset/mediaviewer/fullscreen/delete/index.html?assetid=$asset.id&collectionid=$!collectionid&hitssessionid=$!hitssessionidOriginal&hideOverlay=true">
						<i class="bi bi-trash me-1"></i> [[Delete Asset]]
					</a>
				#end
			#end
				
				  
		##    #set( $views = $mediaarchive.getAssetStatsManager().getViewsForAsset($asset))
		##    <a class="assettab" 
		##		data-link="$siteroot$apphome/views/modules/asset/mediaviewer/fullscreen/tabs/viewactions.html?action=converthistory" title="[[History]]"
		##		data-assettab="viewactions"
		##		data-assettabactions="converthistory"
		##		data-assettabname="[[History]]" >
		##	<i class="fas fa-eye"></i> $views 
		##	</a>
			
			$context.putPageValue("assetid",$asset.id)
		    ##<div id="mvassetfavorite-${asset.id}" class="media-info-icons">
	        ##	$pages.include("$apphome/views/modules/asset/editor/favorite/index.html?targetdiv=mvassetfavorite", $context)
	   		##</div>
			
			 #if(!$title)		         	
		     	#if( $asset.assettitle )
		     		#set($title =  $asset.getText("assettitle",$context)) 
		     	#else 
		     		#set($title = $asset.getText("name",$context) )
		     	#end
		     #end
			
			## Download Button 
			#if($candownload)
				#if( $desktop )
		        	<a href="#" class="emdesktopdownload grid-gallery-download" data-assetid="$asset.id" title="[[Download]]  #esc($!title)">
		        	<i class="fas fa-download"> </i>
		        	</a>
	        	#else
					#set($dlink = $mediaarchive.asLinkToOriginal($asset))
					#set($dlink = "$siteroot/$mediadbappid/services/module/asset/downloads/originals/$dlink?assetid=$!asset.getId()")
					#if($collectionid)
						#set($dlink = "$dlink&collectionid=$!{collectionid}")
					#end
		        ##	<a href="$!dlink" class="grid-gallery-download" data-assetid="$asset.id" title="[[Download]]  #esc($!title)">
		        ##	<i class="fas fa-download"> </i>
		        ##	</a>
	        	#end
			#end
			
			
			#if( $desktop )
			<div class="btn-group" role="group" aria-label="Button group with nested dropdown">
		 
			  <div class="btn-group" role="group">
			    <button id="btnGroupDrop1" type="button" class="btn btn-sm btn-secondary dropdown-toggle" data-toggle="dropdown"  data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			      [[Desktop Sync]] </button>
			    <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
			      <a class="dropdown-item ajax" data-targetdiv="nowhere"  href="$siteroot$apphome/components/desktop/openasset.html?assetid=$asset.id&lock=true">[[Edit on Desktop]]</a>
			      <a class="dropdown-item desktop-send" href="#" data-assetid="${asset.id}" data-command="singleupload" data-catalogid="${catalogid}" data-mediadb="${mediadbappid}" data-replace="true" data-filename='#esc($asset.getText("name",$context))'>[[Replace from Desktop]]</a>
			      <a class="dropdown-item desktop-send" href="#" data-assetid="${asset.id}" data-replace="false" data-command="singleupload" data-catalogid="${catalogid}" data-mediadb="${mediadbappid}" data-filename='#esc($asset.getText("name",$context))'>[[Create new copy from Desktop]]</a>
			      
			    </div>
			    
			    
			  </div>
		   
			</div>
			#end
		</div>	
</div>
