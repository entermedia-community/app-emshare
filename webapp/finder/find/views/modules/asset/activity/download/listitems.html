<div >
	<table id="shared-asset-table" class="table table-striped table-hover download-table" >

#set( $downloadall = false)
#set( $cdnprefix = $mediaarchive.getCatalogSettingValue("cdn_prefix") )
#set( $mediadbappid=$mediaarchive.getMediaDbId())
#if( !$cdnprefix )
	#set( $cdnprefix = $context.siteRoot )
#end
#foreach( $item in $orderitems )

    #set( $asset = $mediaarchive.getAssetBySourcePath($item.assetsourcepath))
    #set( $sourcepath = $asset.sourcePath )
    
	#set( $click = "$home$apphome/views/modules/asset/editor/index.html?hitssessionid=$rootid&assetid=${asset.getId()}&orderid=$order.id" )
	
	#set( $publishqueueid = $item.get("publishqueueid"))
	#set($publishqueue = $searcherManager.getData($catalogid, "publishqueue",$item.get("publishqueueid") ) )
	#set( $presetid = $publishqueue.get("presetid") )
	
	#set($publishstatus = $item.get("publishstatus"))

	<tr>
	<td class="asset-thumb" style="width:160px; padding:10px">		
		$context.putPageValue("asset", $asset)
		$context.putPageValue("item", $item)
		$context.setRequestParameter("sourcepath", $sourcepath)					
	
	   	#set( $assetpath = $mediaarchive.getLinkToAssetViewer($sourcepath) )
		#set( $thumbend = $mediaarchive.getLinkToSize($sourcepath, "thumb") )
		#set( $tsize = "$home$thumbend" )
		
		#if( $parenthits )
			#set( $rootid = $parenthits.sessionId )
		#else
			#set( $rootid = $hits.sessionId )
		#end
		
			##<a  class="showasset" data-assetid="$asset.id" href="#" alt="$asset" name="$asset" style="text-decoration: none;">
		
			#set( $type = $mediaarchive.getMediaRenderType($asset.fileFormat))
			#if(!$type)
				#set ($type = "none")
			#end
			$context.putPageValue("cell", $asset)
			$context.putPageValue("showdetails", "false")
			$context.putPageValue("thumbsize", "crop")
			$pages.include("${apphome}/components/results/thumbnails/${type}.html", $context)
			##</a>
	</td>

	$context.putPageValue("searcher",$searcherManager.getSearcher($catalogid,"asset") )	
	$context.putPageValue("view","asset/downloaddetails")	
	$context.putPageValue("data",$asset)
	##$pages.include("/$applicationid/components/xml/detaileditorcss.html?detailsreadonly=true", $context)
	
	#set( $presetid = $publishqueue.get("presetid") )

	#set($filename = "")
	#if( $presetid == "0")
		#set($filename = "$asset")
	#else	
		#set($convertpreset = $searcherManager.getCachedData($catalogid, "convertpreset", $presetid ) )
		#set($filename = $item.itemexportname)
	#end

	

	<td class="asset-name">
		$!filename
	</td>
	
	
	
		#if( $order.orderstatus == "error" )
			<td></td>
			<td>[[Error, download not available]]</td> ##Link to my orders
			#set( $downloadall = false)
		#else	
		
	
			#set( $presetid = $publishqueue.get("presetid") )
			
				<td>
					
				##if($status != "error" && ($publishstatus == "complete" || $publishstatus == "readytopublish" || $publishstatus == "canceled"))
					<!-- <a href="#" class="btn btn-sm btn-primary redownloadorder" 
						data-orderitemid="$item.getId()" 
						data-itemexportname='$item.itemexportname'
						data-itemdownloadurl='$item.get("itemdownloadurl")'
						
						title="[[Download Again]]">
						<i class="bi bi-download"></i> &nbsp;[[Download]]
					</a> -->
				##end
					#if($publishstatus == "publishingexternal")
						<a href="#" class="abortdownloadorder" data-orderitemid="$downloadorder.getCurrentItem()" data-orderid="$downloadorder.getCurrentItem().get('orderid')" title="[[Cancel Download]]">
							<i class="bi bi-x-circle"></i>
						</a>
					#end
					#if($publishstatus == "new" )
						<a href="#" class="abortdownloadprocessing" data-orderitemid="$downloadorder.getCurrentItem()" data-orderid="$downloadorder.getCurrentItem().get('orderid')" title="[[Cancel Order Processing]]">
							<i class="bi bi-x-circle"></i>
						</a>
					#end
				</td>
				<td style="width: 90px; text-align: center;">
					#if($publishqueue.status=='error')
						<div style="overflow: auto; height: 200px;">
							<strong>[[Error]]</strong><br>
							$publishqueue.errordetails
						</div>
					#else
						###set($convertpreset = $searcherManager.getCachedData($catalogid, "convertpreset", $presetid ) )
						##<a class="btn btn-sm btn-primary" href="#urlencode("$cdnprefix$home/$mediadbappid/services/module/asset/downloads/generated/${asset.sourcepath}/${convertpreset.generatedoutputfile}/${publishqueue.exportname}?orderid=${order.id}&collectionid=$!{order.collectionid}")">[[Download]]</a>
						
						#set( $downloadall = true)
					#end
				</td>
			
		#end	
	
	</tr>
	<tr>
		<td colspan="4" class="p-0">
			<div class="w-100" style="background-color: #efefef;">
				<div class="xhrProgress $asset.id progress-bar-striped progress-bar-animated"style="height:5px;background-color:#4d5d80;width: 0%;display:none"></div>
			</div>
		</td> 
	</tr>
	#end
	
</table>
#if($downloadall && $orderitems.size()> 1)
	<div style="text-align:right; padding:20px 0;"> 
	<a class="btn btn-sm btn-primary" style="margin-right:20px" href="$!home$apphome/views/modules/asset/activity/download/zip/${order.id}.zip?orderid=${order.id}" >[[Download All (Zip)]]</a>
	</div>
#end	
</div>