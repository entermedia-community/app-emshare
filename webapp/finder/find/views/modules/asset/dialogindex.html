#set($hits = $entityassethits)
$context.putPageValue("hits", $hits)

#set($module = $mediaarchive.getCachedData("module", "asset"))
#set($moduleid = $module.getId())

$context.putPageValue("module", $module)
#set($componenthome = "$apphome/views/modules/asset/components")
$context.putPageValue("componenthome", $componenthome)

#if( !$category)
	#set($categoryid = $context.getRequestParameter("categoryid"))
	#if(!$categoryid)
		#set($categoryid = $context.getRequestParameter("rootcategory"))
	#end
	#if($categoryid)
		#set($category = $mediaarchive.getCachedData("category", $categoryid))
	#end
#end
#if( !$categoryid && $category)
	#set( $categoryid= $category.getId())
#end
$context.putPageValue("category", $category)
$context.putPageValue("categoryid", $categoryid)
#if( !$librarycol && $category )
	#set($rootcategories = $category.getParentCategories()) 
	###set( $librarycol = $mediaarchive.query("librarycollection").orgroup("rootcategory", $rootcategories).searchOne() )
#end
#set($rootcategory = $context.getRequestParameter("rootcategory"))
#if(!$rootcategory)
	#set( $rootcategory = $categoryid)
#end



#if(!$topmoduleid)
	#set ( $topmoduleid = $context.getRequestParameter("topmoduleid") )
#end
#ifnotnull($topmoduleid)
	#set($topmodule = $mediaarchive.getCachedData("module", $topmoduleid))
#end
#ifnull($topmodule)
	#set($topmodule = $mediaarchive.getCachedData("module", $parentsearchtype))
	
#end
$context.putPageValue("topmodule", $topmodule)
$context.putPageValue("topmoduleid", $topmoduleid)


#set($maintargetdiv = "dialogassetresultscontainer")
$context.putPageValue("maintargetdiv", $maintargetdiv)

$context.putPageValue("dialogresults", true)

<div id="$maintargetdiv"
	class="assetresults h-100 resultsdiv" 
	data-moduleid="asset"
	
	data-url="$apphome/views/modules/asset/dialogindex.html"
	data-categoryid="$!categoryid"
	data-nodeID="$!categoryid"
	
	data-dialogresults="true"
	data-hitssessionid="$!hits.getSessionId()"
	data-componenthome = "$!componenthome"
	data-searchhome="$!home$!componenthome/results"
	data-targetdiv="$maintargetdiv"
	data-topmoduleid="$!topmoduleid"
	data-rootcategory="$!rootcategory"
	data-oemaxlevel="1"
	>
	
	<div class="emgrid-module emgrid-box emgrid-module-asset h-100">
		<div class="emgrid-subtitle">
	  		
	     	#set($moduleicon = "entity")
	     	#if ($module.moduleicon)
	     		#set($moduleicon = $module.moduleicon)
	     	#end
	     	
			#set( $count = $hits.size())
			 
				##<img src="$siteroot$apphome/theme/images/entity/${moduleicon}.svg" style="height: 26px;"> 
						
				#if( $category )
					<div class="filtered-breadcrumb">
						#set($parentcategories = $category.getParentCategories())
						
						#if(!$parentcategories.isEmpty())
							#foreach( $parent in $parentcategories)
								#if( ${foreach.count} > 1) / #end
								
								<a style="padding:0px 4px 0;" 
									href="$siteroot$apphome/views/modules/asset/viewfiles/$!{parent.id}/#dash($parent).html?hitssessionid=$!hits.getSessionId()"
									title="[[View Files]]: $parent"
									class="ajax"
									data-targetdiv="applicationcontent"
									data-oemaxlevel="5"
									data-scrolltocat="true"
									data-updateurl="true"
									data-closedialog="true"
									data-sidebarcomponent="categories">#text($parent)</a>
					
							#end
						
							#if($count)&nbsp;<span class="count">($count)</span>#end 
						#end
						</div>
						
					
				#end
			
			<div class="clearfix"></div>
		</div>
		
		<div class="embedmediacontainer">
		<div class="embedmediacol embedmediacol-tree">
			<div class="embedmediacolheader">
				<a href="" 
					class="float-left createfoldertree"
					data-tree="entitymediatreetree" 
					style="border-right:1px solid #444; width:32px; text-align: center;" 
					title="[[Add Sub-Folder]]"><i class="fas fa-folder-plus"></i></a>
					
				#if($topmodule.getBoolean("enableuploading") && $permissions.can($topmoduleid, "upload_files"))
					<a href="$siteroot$applink/views/modules/asset/add/entityaddmedia.html?categoryid=$!categoryid" 
						class="ajax float-left" 
						data-targetdiv="dialogmediaentity"
						data-oemaxlevel="1"
						style="border-right:1px solid #444; width:32px;" title="[[Upload]]"><i class="fas fa-upload"></i></a>
				#end
				
					
					
				
			</div>
			
			$context.putPageValue("rootcategory", $rootcategory)
			#set( $targetdivmedia = "dialogmediaentity")
			$context.putPageValue("targetdivmedia", $targetdivmedia)
			#if($categoryid != $rootcategory)
				$context.putPageValue("selectednodes", $categoryid)
			#end
			#set( $link = "$componenthome/emtree/tree.html")
		    #set( $link = "${link}?entitymediatreeroot=$rootcategory&treename=entitymediatree&editabletree=true" )
		    #set( $link = "${link}&maintargetdiv=$!maintargetdiv&targetdiv=$!targetdivmedia&maxlevelclick=1&updateAddressBar=false&uploadmaxlevel=1" )
			#set( $link = "${link}&customurladdmedia=$apphome/views/modules/asset/add/entityaddmedia.html" )
		    #set( $link = "${link}&oemaxlevel=1&urlprefix=$apphome/views/modules/asset/dialogshowcategory.html" )
		    
			$pages.include($link, $context)
		</div>
		
		<div class="embedmediacol embedmediacol-results" id="$!{targetdivmedia}" >
			$pages.include("$componenthome/results/index.html", $context)
		</div>
		</div>
		
	</div>


</div>
