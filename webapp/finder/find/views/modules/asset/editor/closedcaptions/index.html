#set( $clientroot = "/${applicationid}/views/modules/asset/editor/closedcaptions" )

<script src="/${applicationid}/components/javascript/jquery.cuepoint.js"></script>
<script src="${clientroot}/closedcaptions.js"></script>

<div id="asset-editor-container" class="h-100">
	<div id="closedcaptioneditor"
		#if($track.transcribestatus == "inprogress" || $track.transcribestatus == "translating")
			class="disabled bg-light h-100 ajaxstatus"
			data-ajaxpath="$clientroot/index.html?oemaxlevel=1&assetid=$asset.id"
		#else
			class="bg-white h-100"
		#end>
		#if($track.transcribestatus == "inprogress" || $track.transcribestatus == "translating")
		<div class="transcribe-progress-mask">
			<div class="transcribe-progress-message">
				<i class="fas fa-spinner fa-spin fa-3x"></i>
				<div class="mt-2">
					#if($track.transcribestatus == "inprogress")
						[[Transcribing...]]
					#elseif($track.transcribestatus == "translating")
						[[Translating...]]
					#else
						[[Processing...]]
					#end
					[[Please wait]]
				</div>
				<div>[[You can close this window anytime]]</div>
			</div>
		</div>
		#end
		
		<div class="row g-0">
			<div class="col-8">
				<div class="timelineviewercontainer">
					<div id="closedcaptiondetails">
						<div class="d-flex flex-column">
							<div class="d-flex align-items-center justify-content-between mt-1">
								<div class="d-flex flex-column">
									<span>[[Select the language]]</span>
									#set($languages = $mediaarchive.getList("locale"))
									<form name="swaplang" id="cclangform" action="$clientroot/switchlang.html" class="ajaxform" data-targetdiv="closedcaptioneditor" data-onsuccess="ccreloadvideo" >
										<input type="hidden" name="assetid" value="$asset.id" />
										<select class="select2 lenguagepicker form-control form-control-sm" 
											id="languages" 
											name="selectedlang" 
											data-count="$count" 
											data-detailid="${detailid}" 
											data-allowclear="false">	 
											#foreach($locale in $languages)
												<option value="$!locale.id" #if($selectedlang==$!locale.id) selected="selected" #end>$!locale</option>
											#end
										</select>
									</form>
								</div>
								<div class="d-flex flex-wrap align-items-center">
									<div class="d-flex me-1">
										<a href="$clientroot/details/transcribedialog.html?assetid=$asset.id&selectedlang=$selectedlang" 
											data-dialogid="ccautogenerate" class="emdialog btn btn-sm btn-cta me-1">
											<i class="bi bi-badge-cc me-1"></i>
											[[Generate Captions]]
										</a> 
										<a href="$clientroot/details/translatedialog.html?assetid=$asset.id&selectedlang=$selectedlang" 
											data-dialogid="ccautotranslate" class="emdialog btn btn-sm btn-cta">
											<i class="bi bi-translate me-1"></i>
											[[Translate Captions]]
										</a>
									</div>
									<div class="d-flex">
										<a  href='#urlescape("$home/${mediadbappid}/services/module/asset/players/closedcaption/${asset.id}/closedcaption-${asset.name}-${selectedlang}.vtt")'
											class="btn btn-sm btn-accent me-1">
											<i class="bi bi-download me-1"></i> [[Download VTT]]
										</a> 
										<a href="$clientroot/details/importstart.html?assetid=$asset.id&selectedlang=$selectedlang"
											class="emdialog btn btn-sm btn-accent" data-noesc="true">
											<i class="bi bi-upload me-1"></i> [[Upload VTT]]
										</a> 
									</div>
								</div>
							</div>
						</div>
					</div>
					
					<div class="d-flex flex-column my-3">
						<div class="d-flex align-self-start">	
							<span id="captionstart">00:00.0</span>
							<span class="mx-2">-</span>
							<span id="captionend">00:00.0</span>
						</div>
						<div class="w-100 my-1">
							<form id="addcaption" data-targetdiv="captionview" action="$clientroot/addcaption.html" class="ajaxform" >
								<input type="hidden" name="assetid" value="$asset.id" />
								<input type="hidden" name="oemaxlevel" value="1" />
								<input type="hidden" id="timecodestart" name="timecodestart" value="0" />
								<input type="hidden" id="timecodelength" name="timecodelength" value="8000" />
								<textarea  id="captioninput" name="cliplabel" class="form-control" placeholder="[[press tab to start/stop and press enter to save]]" rows="4"></textarea>
							</form>
						</div>
						<div class="d-flex justify-content-between mt-1">	
							<div>
								<a id="removetime"  title="[[Move Back]]" class="btn btn-accent btn-sm"><i class="bi bi-caret-left-fill"></i></a>
								<a id="addtime" title="[[Move Forward]]" class="btn btn-accent btn-sm mx-2"><i class="bi bi-caret-right-fill"></i></a>
							</div>
							<a id="removecaption" class="btn btn-danger btn-sm"><i class="bi bi-trash-fill"></i></a>
						</div>
					</div>
				</div>
			</div>
			<div class="col-4">
				$pages.include("$clientroot/details/video.html",$context)
			</div>
		</div>
	
		<div class="overflow-x minimal p-2 bg-light m-2">
			$pages.include("$clientroot/viewcaptions.html",$context)
		</div>
		
	</div>
</div>
