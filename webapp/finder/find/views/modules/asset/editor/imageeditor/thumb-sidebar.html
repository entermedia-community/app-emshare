
#set($cdnprefix = $context.siteRoot )

#set( $type = $mediaarchive.getMediaRenderType($asset.fileformat))

#set($mediadbappid=$mediaarchive.getMediaDbId())
#set($type =$mediaarchive.getMediaRenderType($asset.fileformat))
#set($results = $conversionUtil.getCompletedPresetList($mediaarchive,$asset) )

#set($isready = $conversionUtil.isReady($mediaarchive,$results) )


$context.putPageValue("results", $results)

$context.putPageValue("viewer", "media_download_")
#set($rendertype = $mediaarchive.getMediaRenderType($asset.fileformat))

#if(!$rendertype || $type =="rendertype")
    #set( $rendertype = "mime" )
#elseif( $rendertype =="video")
    #set( $rendertype = "videothumbnail" )
#end

$context.putPageValue("thumbsize", "small" )
$context.putPageValue("urlparams", "?cache=false&_=$mathutil.getRandomValue(99999)" )

<div id="sidebar" class="photo-selection-column #if(!$isready) ajaxstatus #end" 
	data-assetid="$asset.id"
	data-url="$applink/views/modules/asset/editor/imageeditor/thumb-sidebar.html">
    <div class="d-flex align-items-center">
      <h2>[[Saved Copies]]</h2>
    </div>
    <div class="w-100 selection-images">
      #foreach ($result in $results)
        #set($cancrop = false)
        #set($cancrop = $conversionUtil.canCrop($catalogid,$result.id,$asset.id))

        #if(!$cancrop)
          #if( $mediaarchive.isCatalogSettingTrue("preventupscaling"))
            #set($show = false)
          #else
            #set($show = true)
          #end
        #else
          #set($show = true)
        #end

        #set($expfilename = $mediaarchive.asExportFileName($asset, $result))
        #set($url = "$siteroot/$mediadbappid/services/module/asset/downloads/generated/$asset.sourcepath/$result.generatedoutputfile/$expfilename")
        #if($conversionUtil.doesConvertedFileExist($mediaarchive, $asset,$result) && $show)
          #set($dimension = $conversionUtil.getConvertPresetDimension($catalogid,$result.id))
          #set($height = $mathtool.toInteger($dimension.getHeight()))
          #set($width = $mathtool.toInteger($dimension.getWidth())) 

          <div class='thumb'> 
            <img src="#urlescape($url)" />
            <div class="d-flex align-items-end justify-content-between"> 
              <small>$expfilename</small> 
            </div>
            <strong class="img-size">${width}&times;${height}</strong>
          
            #if(($candownload || $canconvert || $candownloadfpo) && $canquickdownload)
            <a href="#urlescape($url)" class="btn btn-sm btn-secondary dl" title="[[Download]]"><i class="bi bi-download"></i></a>
            #end
            #if($canembedasset)
              <a class="btn btn-sm btn-secondary emdialog" 
                href="$siteroot$apphome/views/modules/asset/editor/imageeditor/share.html?assetid=${asset.id}&presetid=${result.id}"
                data-noesc="true"
                data-hidefooter="true"
                title="[[Share]] $!result.name"><i class="fas fa-share-alt"></i></a>
            #end
          </div>
        #end
      #end    
    </div>
  </div>