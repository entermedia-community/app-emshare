
#set($cdnprefix = $context.siteRoot )

#set( $type = $mediaarchive.getMediaRenderType($asset.fileformat))

#set($mediadbappid=$mediaarchive.getMediaDbId())
#set($type =$mediaarchive.getMediaRenderType($asset.fileformat))
#set($presets = $conversionUtil.getActivePresetList($mediaarchive,$asset) )
#set($isconverting = $conversionUtil.isConverting($mediaarchive,$asset) )

$context.putPageValue("viewer", "media_download_")
#set($rendertype = $mediaarchive.getMediaRenderType($asset.fileformat))

#if(!$rendertype || $type =="rendertype")
    #set( $rendertype = "mime" )
#elseif( $rendertype =="video")
    #set( $rendertype = "videothumbnail" )
#end

$context.putPageValue("thumbsize", "small" )
##$context.putPageValue("urlparams", "?cache=false&_=$mathutil.getRandomValue(99999)" )

<div id="imageeditorsidebar" class="photo-selection-column #if($isconverting) ajaxstatus #end" 
	data-assetid="$asset.id"
	data-oemaxlevel="1"
	data-ajaxpath="$applink/views/modules/asset/editor/imageeditor/thumb-sidebar.html">
    <div class="d-flex flex-column align-items-center justify-content-center header">
      <h2>[[Saved Copies]]</h2>
      #if( $isconverting) 
        <span class="text-secondary"><i class="fas fa-spinner fa-spin"></i> [[rendering]]</span>
      #end
    </div>
    <div class="w-100 selection-images">
      #foreach ($result in $presets)
        #set($expfilename = $mediaarchive.asExportFileName($asset, $result))
        #set($url = "$siteroot/$mediadbappid/services/module/asset/downloads/generated/$asset.sourcepath/$result.generatedoutputfile/$expfilename")
        #set( $contentitem = $conversionUtil.outPutForPreset($mediaarchive, $asset,$result))
        #if($contentitem.exists())
          #set($dimension = $conversionUtil.getConvertPresetDimension($catalogid,$result.id))
          #set($height = $mathtool.toInteger($dimension.getHeight()))
          #set($width = $mathtool.toInteger($dimension.getWidth())) 

          <div class='thumb'> 
            <img src="#urlescape($url)?_=$contentitem.getLastModified()" />
            <div class="d-flex align-items-end justify-content-between"> 
              <small>$result.name</small> 
            </div>
            
            <strong class="img-size">$result.name</strong>
          
            #if(($candownload || $canconvert || $candownloadfpo) && $canquickdownload)
            <a href="#urlescape($url)" class="btn btn-sm btn-secondary dl" title="[[Download]]"><i class="bi bi-download"></i></a>
            #end
            #if($canembedasset)
              <a class="btn btn-sm btn-secondary emdialog" 
                href="$siteroot$apphome/views/modules/asset/editor/imageeditor/share.html?assetid=${asset.id}&presetid=${result.id}"
                data-noesc="true"
                data-hidefooter="true"
                title="[[Share]] $!result.name"><i class="fas fa-share-alt"></i></a>
            #end
          </div>
        #else
        	  ##$result
        #end
      #end    
    </div>
  </div>