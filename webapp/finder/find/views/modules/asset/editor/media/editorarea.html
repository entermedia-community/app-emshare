#set($catalogid = $context.getRequestParameter("catalogid"))
#set($assetid = $context.getRequestParameter("assetid"))
#set($assetsource = $context.getRequestParameter("assetsource"))
#set($resultid = $context.getRequestParameter("resultid"))
#set($resultoutput = $context.getRequestParameter("resultoutput"))
#set($expfilename = $context.getRequestParameter("expfilename"))
#set($url = "$siteroot/$mediadbappid/services/module/asset/downloads/generated/$assetsource/$resultoutput/$expfilename")
#set($filename = "$!url_util.getPathUtilities().extractPageName($expfilename)")

<div class="d-flex flex-column h-100">
    <div class="d-flex align-items-center justify-content-start">
        <!-- <h2>Customized Image Copy</h2> -->
        <!-- <input type="text" value="$expfilename" /> -->
    </div>
    <div class="editorarea">
        <div class="d-flex align-items-center justify-content-end top-toolbar">
            <div class="d-flex align-items-center justify-content-end position-relative">
                <a href="#" id="exportAs">
                    <i class="bi bi-floppy"></i>
                    <label>export as</label>
                </a>
                <a href="#" id="saveAs">
                    <i class="bi bi-floppy"></i>
                    <label>save as</label>
                </a>
                <div class="mask" role="button"></div>
                <div class="save-as-menu">
                    <form class="d-flex flex-column">
                        <h4 class="text-center">export As</h4>
                        <div class="d-flex align-items-center mb-2">
                            <label for="saveAsName" class="mb-0 mr-1" style="width: 60px;">Name:</label>
                            <input class="flex-grow-1 py-1 px-2 rounded border-0" type="text" id="saveAsName" name="saveAsName" data-filename="$filename" value="$filename" />
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <label class="mb-0 mr-1" style="width: 60px;">Format:</label>
                            <label class="mb-0 mr-3 d-flex align-items-center">
                                <input type="radio" name="saveAsType" value="png" class="mr-1" checked /> PNG
                            </label>
                            <label class="mb-0 d-flex align-items-center">
                                <input type="radio" name="saveAsType" value="jpg" class="mr-1" /> JPG
                            </label>
                        </div>
                        <div class="d-flex mb-2">
                            <label class="mb-0 mr-1" style="width: 115px;">Max Dimension:</label>
                            <div class="d-flex flex-column">
                                <label class="mb-0 mr-3 d-flex align-items-center">
                                    <input type="radio" name="saveAsDimension" class="mr-1" value="3000" checked /> 3000 &times; 3000
                                </label>
                                <label class="mb-0 d-flex align-items-center">
                                    <input type="radio" name="saveAsDimension" class="mr-1" value="2000" /> 2000 &times; 2000
                                </label>
                                <label class="mb-0 mr-3 d-flex align-items-center">
                                    <input type="radio" name="saveAsDimension" class="mr-1" value="1024" /> 1024 &times; 1024
                                </label>
                                <label class="mb-0 d-flex align-items-center">
                                    <input type="radio" name="saveAsDimension" class="mr-1" value="512" /> 512 &times; 512
                                </label>
                            </div>
                        </div>
                        <div class="d-flex justify-content-between mt-3">
                            <div class="d-flex align-items-center">
                                <a href="#" id="downloadImg" data-filename="$filename">
                                    <i class="bi bi-download"></i>
                                    <label>export</label>
                                </a>
                            </div>
                            <a id="saveAsCancel" type="reset" class="rounded">
                                <i class="bi bi-x mr-0"></i>
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="d-flex editor">
            <div id="canvasContainer">
                <div id="editCandidateLoader" class="lds-dual-ring light"></div>
                <canvas id="canvas"></canvas>
            </div>
            <div class="d-flex flex-column side-toolbar">
                <a href="#" data-action="filter">
                    <i class="bi bi-transparency"></i>
                    <label>filters</label>
                </a>
                <a href="#" data-action="crop">
                    <i class="bi bi-crop"></i>
                    <label>crop</label>
                </a>
                <a href="#" data-action="rotate">
                    <i class="bi bi-arrow-repeat"></i>
                    <label>rotate</label>
                </a>
                <a href="#" data-action="text">
                    <i class="bi bi-fonts"></i>
                    <label>text</label>
                </a>
                <a href="#" data-action="image">
                    <i class="bi bi-images"></i>
                    <label>image</label>
                </a>
                <!-- <a href="#">
                <i class="bi bi-person-x"></i>
                <label>remove</label>
            </a> -->
            </div>
        </div>
    </div>
</div>

<img style="display: none;" src="#urlescape($url)" id="editingCandidate" />

<div class="text-editor panel"> 
    <div class="x-close text-white ml-auto pt-1">
        <i class="bi bi-x"></i>
    </div>
    <div class="w-100">
        <label for="textField">Text</label>
        <textarea rows="3" type="text" id="textField" placeholder="Start typing..." ></textarea>
    </div>

    <label for="font-family" class="mt-1">Font Family</label>
    <select id="font-family">
        <option value="Roboto">Roboto</option>
        <option value="Ubuntu">Ubuntu</option>
        <option value="Mali">Mali</option>
    </select>

    <label for="font-weight" class="mt-1">Font Weight</label>
    <select id="font-weight">
        <option value='{"weight":300,"style":"normal"}'>Lite</option>
        <option value='{"weight":300,"style":"italic"}'>Lite Italic</option>
        <option value='{"weight":400,"style":"normal"}' selected>Regular</option>
        <option value='{"weight":400,"style":"italic"}'>Regular Italic</option>
        <option value='{"weight":700,"style":"normal"}'>Bold</option>
        <option value='{"weight":700,"style":"italic"}'>Bold Italic</option>
    </select>

    <div class="d-flex align-items-center mt-2 mb-1">
        <label for="font-color" class="mb-0 mr-2">Color</label>
        <input type="text" id="font-color" value="#ffffff">
    </div>
    <div class="d-flex align-items-center">
        <label for="font-color" class="mb-0 mr-2">Align</label>
        <button data-action="left" class="text-align-btn"><i class="bi bi-text-left"></i></button>
        <button data-action="center" class="text-align-btn"><i class="bi bi-text-center"></i></button>
        <button data-action="right" class="text-align-btn"><i class="bi bi-text-right"></i></button>
        <button data-action="justify" class="text-align-btn"><i class="bi bi-justify"></i></button>
    </div>
</div>
<div class="image-editor panel">
    <div class="x-close text-white ml-auto pt-1">
        <i class="bi bi-x"></i>
    </div>
    <label for="imageField" class="mt-1">
        <input type="file" id="imageField" accept="image/*" />
        <img src="#" id="imagePreview" style="display: none;" />
    </label>
    <div class="align-items-center justify-content-between" style="display: none;">
        <button id="insertImg">Insert</button>
        <button id="removeImg">
            <i class="bi bi-trash"></i>
        </button>
    </div>
</div>
<div class="filter-editor panel">
    <div class="x-close text-white ml-auto pt-1">
        <i class="bi bi-x"></i>
    </div>
    <canvas id="fpCanvas" style="display: none;"></canvas>
    <div class="d-flex flex-column justify-content-center">
        <div class="filter-controls">
            <h5 class="text-white m-0 text-center">Custom Filters</h5>
            <div class="d-flex align-items-center fltr" id="Brightness">
                <input type="checkbox" />
                <label>Brightness:<input type="range" disabled value="0" min="-1" max="1" step="0.003921"></label>
            </div>
            <div class="py-1" style="background-color: #343e55;">
                <label class="text-white justify-content-center m-0 fltr" id="Gamma">Gamma <input type="checkbox" /></label>
                <div class="d-flex align-items-center fltr" data-id="Gamma">
                    <label>Red: <input type="range" id="gamma-red" disabled value="1" min="0.2" max="2.2" step="0.003921"></label>
                </div>
                <div class="d-flex align-items-center fltr" data-id="Gamma"> 
                    <label>Green: <input type="range" id="gamma-green" disabled value="1" min="0.2" max="2.2" step="0.003921"></label>
                </div>
                <div class="d-flex align-items-center fltr" data-id="Gamma"> 
                    <label>Blue: <input type="range" id="gamma-blue" disabled value="1" min="0.2" max="2.2" step="0.003921"></label>
                </div>
            </div>
            <div class="d-flex align-items-center fltr" id="Contrast">
                <input type="checkbox" />
                <label>Contrast:<input type="range" disabled class="form-range" value="0" min="-1" max="1" step="0.003921"></label>
            </div>
            <div class="d-flex align-items-center fltr" id="Saturation">
                <input type="checkbox" />
                <label>Saturation:<input type="range" disabled value="0" min="-1" max="1" step="0.003921"></label>
            </div>
            <div class="d-flex align-items-center fltr" id="Vibrance">
                <input type="checkbox" />
                <label>Vibrance:<input type="range" disabled value="0" min="-1" max="1" step="0.003921"></label>
            </div>
            <div class="d-flex align-items-center fltr" id="HueRotation" data-prop="rotation">
                <input type="checkbox" />
                <label>Hue:<input type="range" disabled value="0" min="-2" max="2" step="0.002"></label>
            </div>
            <div class="d-flex align-items-center fltr" id="Noise">
                <input type="checkbox" />
                <label>Noise:<input type="range" disabled value="0" min="0" max="1000"></label>
            </div>
            <div class="d-flex align-items-center fltr" id="Pixelate">
                <input type="checkbox" />
                <label>Pixelate:<input type="range" disabled value="0" min="2" max="20"></label>
            </div>
            <div class="d-flex align-items-center fltr" id="Blur">
                <input type="checkbox" />
                <label>Blur:<input type="range" disabled value="0" min="0" max="1" step="0.01"></label>
            </div>
        </div>
        <h5 class="text-white mb-0 mt-4 text-center">Built-In Filters</h5>
        <div class="d-flex flex-wrap align-items-center justify-content-center overflow-y" id="preDefFilters">
            <a href="#" data-action="Grayscale" style="display: none;"> 
                <img src="#urlescape($url)" />
                <span>Grayscale</span>
            </a>
            <a href="#" data-action="BlackWhite" style="display: none;"> 
                <img src="#urlescape($url)" />
                <span>BlackWhite</span>
            </a>
            <a href="#" data-action="Sepia" style="display: none;"> 
                <img src="#urlescape($url)" />
                <span>Sepia</span>
            </a> 
            <a href="#" data-action="Invert" style="display: none;"> 
                <img src="#urlescape($url)" />
                <span>Invert</span>
            </a>
            <a href="#" data-action="Vintage" style="display: none;"> 
                <img src="#urlescape($url)" />
                <span>Vintage</span>
            </a> 
            <a href="#" data-action="Technicolor" style="display: none;"> 
                <img src="#urlescape($url)" />
                <span>Technicolor</span>
            </a>
            <a href="#" data-action="Polaroid" style="display: none;"> 
                <img src="#urlescape($url)" />
                <span>Polaroid</span>
            </a> 
            <a href="#" data-action="Kodachrome" style="display: none;"> 
                <img src="#urlescape($url)" />
                <span>Kodachrome</span>
            </a>
        </div>
    </div>
</div>
<div class="rotate-editor panel">
    <div class="x-close text-white ml-auto pt-1">
        <i class="bi bi-x"></i>
    </div>
    <div class="d-flex align-items-center justify-content-between">
        <button class="icon-button" data-action="rotateLeft">
            <i class="bi bi-arrow-counterclockwise"></i>
            <span>-90&deg;</span>
        </button>
        <button class="icon-button" data-action="rotateRight">
            <i class="bi bi-arrow-clockwise"></i>
            <span>+90&deg;</span>
        </button>
    </div>
    <div class="d-flex align-items-center justify-content-between">
        <button class="icon-button" data-action="flipX">
            <i class="bi bi-vr"></i>
            <span>Flip X</span>
        </button>
        <button class="icon-button" data-action="flipY">
            <i class="bi bi-hr"></i>
            <span>Flip Y</span>
        </button>
    </div>
</div>
<div class="crop-editor panel">
    <div class="x-close text-white ml-auto pt-1">
        <i class="bi bi-x"></i>
    </div> 
    <label for="aspectRatio" class="mt-1">Aspect Ratio</label>
    <select id="aspectRatio">
        <option value="0">Original</option>
        <option value="1">1:1 (square)</option>
        <option value="1.78">16:9</option>
        <option value="0.5625">9:16</option>
        <option value="1.33">4:3</option>
        <option value="0.75">3:4</option> 
        <option value="2">2:1</option>
        <option value="0.5">1:2</option>
        <option value="-1">Free Transform</option>
    </select>
    <div class="d-flex justify-content-between">
        <button id="cropBtn">Crop</button>
        <button id="resetBtn">reset</button>
    </div>
</div>
<div id="toast" class="alert alert-secondary alert-dismissible fade hide" role="alert">
  <span></span>
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <i class="bi bi-x"></i>
  </button>
</div>
<div class="zoom-pan">
    <div class="d-flex flex-column align-items-center">
        <button class="icon-button" data-action="zoomIn">
            <i class="bi bi-zoom-in"></i>
            </button>
        <button class="icon-button my-2" data-action="zoomOut">
            <i class="bi bi-zoom-out"></i>
        </button>
        <button class="icon-button" data-action="reset">
            <svg fill="currentColor" viewBox="0 0 24 24">
                <path d="M9 9V3H7v2.59L3.91 2.5 2.5 3.91 5.59 7H3v2zm12 0V7h-2.59l3.09-3.09-1.41-1.41L17 5.59V3h-2v6zM3 15v2h2.59L2.5 20.09l1.41 1.41L7 18.41V21h2v-6zm12 0v6h2v-2.59l3.09 3.09 1.41-1.41L18.41 17H21v-2z"></path>
            </svg>
        </button>
    </div>
</div>
<script type="text/javascript" src="$siteroot$apphome/theme/photo-editor.js"></script> 