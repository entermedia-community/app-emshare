#set( $contentitem = $conversionUtil.outPutForPreset($mediaarchive, $asset,"image3000x3000"))
 
<div id="imageeditorarea" class="w-100 h-100 #if(!$contentitem.exists()) ajaxstatus #end" data-assetid="$asset.id" data-oemaxlevel="1" 
	data-ajaxpath="$applink/views/modules/asset/editor/adjustments/editorarea.html">
  #set($url = $mediaarchive.asLinkToPreview($asset, "image3000x3000"))
  #set($filename = $url_util.getPathUtilities().extractPageName($asset.getName()) )
  <div class="d-flex flex-column h-100" id="photo-editor" >
    <div class="editorarea">
      <div class="d-flex align-items-center top-toolbar pl-2">
        <p class="my-0 text-center flex-grow-1 fw-bold monospace" style="margin-left:260px">$asset.name</p>
        <div class="d-flex align-items-center justify-content-end position-relative">
          <a href="#" id="copyImg" title="[[Copy image to clipboard]]">
            <i class="bi bi-clipboard"></i>
          </a>
          <a href="#" id="exportAs" title="[[Download to your device]]">
            <i class="bi bi-download"></i>
          </a>
          #if($canmediaeditsave)
          
          #if( $asset.fileformat == "jpeg" || $asset.fileformat == "jpg" || $asset.fileformat == "png" ) 
            <a id="imagesave" href="$applink/views/modules/asset/editor/adjustments/savepresetfile.html?assetid=$asset.id&overwrite=true" title="[[Save / Replace]]">
              <i class="bi bi-floppy-fill"></i>
              <label>[[Save]]</label>
            </a>
            <form id="saveform" name="saveform" style="display:none;" action="$applink/views/modules/asset/editor/adjustments/saveoverwrite.html" data-assetfileformat = "$asset.fileformat">
              <input type="hidden" name="assetid" value="$asset.id" />
            </form>
          #end
          
          #end
          #if($canmediaeditsaveas)
          <a href="#" id="saveAs" title="[[Save as preset file]]">
            <i class="bi bi-copy"></i>
            <label>[[Save as]]</label>
          </a>
          #end
          <div class="mask" role="button"></div>
          <div class="save-as-menu">
            <form class="d-flex flex-column" id="saveasform" action="$applink/views/modules/asset/editor/adjustments/savepresetfile.html"
            	data-assetfileformat = "$asset.fileformat"
            >
              <h4 class="text-center">[[Save As]]</h4>
              <div class="d-flex mb-2">
                #set($type =$mediaarchive.getMediaRenderType($asset.fileformat))
                #set($results = $conversionUtil.getActivePresetList($mediaarchive, $asset) )
                <input type="hidden" name="assetid" value="$asset.id" />
                <div class="d-flex align-items-center w-100">
                  <label class="mb-0 me-2 d-flex flex-grow-1">
                    <input type="text" name="newfilename" class="form-control newfilename" value="${filename}-copy" data-originalname="$filename" required />
                  </label> 
                  #set( $types = $mediaarchive.query("fileformat").exact("creator","imagemagick").sort("name").search() )
                  <select name="newfiletype" class="newfileext" data-originalext="$asset.fileformat">
                  #foreach( $type in $types)
                    <option value="$type.id" #if( $asset.fileformat == $type.id) selected #end>#text( $type )</option>
                  #end  
                  </select>
                </div>
              </div>
              <div class="d-flex justify-content-center mt-3 mb-2">
                <div class="d-flex align-items-center">
                  <a href="#" id="saveAsImg">
                    <i class="bi bi-floppy"></i>
                    <label>[[Save]]</label>
                  </a>
                </div>
                <a id="saveAsCancel" type="reset" class="rounded">
                  <i class="bi bi-x-lg mr-0"></i>
                </a>
              </div>
            </form>
          </div>

          <div class="export-menu">
            <form class="d-flex flex-column">
              <div class="d-flex align-items-center justify-content-center">
                <label class="mb-0 me-2" >[[Export As]]:</label>
                <select id="exportAsType" class="me-2">
                  <option selected value="png">PNG</option>
                  <option value="jpeg">JPEG</option>
                </select>
                <a href="#" id="downloadImg" data-filename="$filename" class="me-2"> 
                  <i class="bi bi-download"></i>
                </a>
                <a id="exportAsCancel" type="reset" class="rounded">
                  <i class="bi bi-x-lg mr-0"></i>
                </a> 
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="d-flex editor">
        <div id="canvasContainer">
          <div id="editCandidateLoader" class="lds-dual-ring light"></div>
          <canvas id="canvas"></canvas>
        </div>
        <div class="d-flex flex-column side-toolbar">
          <a href="#" data-action="filter">
            <i class="bi bi-transparency"></i>
            <label>[[filters]]</label>
          </a>
          <a href="#" data-action="rotate">
            <i class="bi bi-arrow-repeat"></i>
            <label>[[rotate]]</label>
          </a>
          <a href="#" data-action="text">
            <i class="bi bi-fonts"></i>
            <label>[[text]]</label>
          </a>
          <a href="#" data-action="image">
            <i class="bi bi-images"></i>
            <label>[[image]]</label>
          </a>
          <!-- <a href="#">
            <i class="bi bi-person-x"></i>
            <label>remove</label>
          </a> -->
        </div>
      </div>
    </div>
  </div>

  <div class="text-editor panel"> 
    <div class="x-close text-white ms-auto pt-1">
      <i class="bi bi-x-lg"></i>
    </div>
    <div class="w-100">
      <label for="textField">Text</label>
      <textarea rows="2" type="text" id="textField" placeholder="[[Start typing]]..." ></textarea>
    </div>

    <label for="font-family" class="mt-1">[[Font Family]]</label>
    <select id="font-family"></select>

    <label for="font-weight" class="mt-1">[[Font Weight]]</label>
    <select id="font-weight">
      <option value='{"weight":"normal","style":"normal"}' selected>Regular</option>
      <option value='{"weight":"bold","style":"normal"}'>Bold</option>
      <option value='{"weight":"normal","style":"italic"}'>Italic</option>
    </select>

    <div class="d-flex align-items-center mt-2 mb-1">
      <label for="font-color" class="mb-0 me-2">Color</label>
      <input type="text" id="font-color" value="#ffffff">
    </div>
    <div class="d-flex align-items-center">
      <label class="mb-0 me-2">[[Align]]</label>
      <button data-action="left" class="text-align-btn"><i class="bi bi-text-left"></i></button>
      <button data-action="center" class="text-align-btn active"><i class="bi bi-text-center"></i></button>
      <button data-action="right" class="text-align-btn"><i class="bi bi-text-right"></i></button>
      <button data-action="justify" class="text-align-btn"><i class="bi bi-justify"></i></button>
    </div>
  </div>

  <div class="image-editor panel">
    <div class="x-close text-white ms-auto pt-1">
      <i class="bi bi-x-lg"></i>
    </div>
    <label for="imageField" class="mt-1">
      <input type="file" id="imageField" accept="image/*" />
      <img src="#" id="imagePreview" style="display: none;" />
    </label>
    <div class="align-items-center justify-content-between" style="display: none;">
      <button id="insertImg">Insert</button>
      <button id="removeImg">
        <i class="bi bi-trash"></i>
      </button>
    </div>
  </div>

  <div class="filter-editor panel overflow-y">
    <div class="x-close text-white ms-auto pt-1">
      <i class="bi bi-x-lg"></i>
    </div>
    
    <canvas id="fpCanvas" style="display: none;"></canvas>
    
    <div class="d-flex flex-column justify-content-center">
      <div class="filter-controls"> 
        <div class="fltr" id="Brightness">
          <div class="row-1">
            <label>[[Brightness]]:</label>
            <a href="#" data-id="Brightness" title="[[Reset]]"><i class="bi bi-arrow-repeat"></i></a>
          </div>
          <div class="row-2">
            <input type="range" defaultValue="0" value="0" min="-1" max="1" step="0.01">
            <input type="text" value="0" data-type="percentage" />
            <span>%</span>
          </div>
        </div>
        <div class="fltr" id="Contrast">
          <div class="row-1">
            <label>[[Contrast]]:</label>
            <a href="#" data-id="Contrast" title="[[Reset]]"><i class="bi bi-arrow-repeat"></i></a>
          </div>
          <div class="row-2">
            <input type="range" defaultValue="0" value="0" min="-1" max="1" step="0.01">
            <input type="text" value="0" data-type="percentage" />
            <span>%</span>
          </div>
        </div>
        <div class="fltr" id="Saturation">
          <div class="row-1">
            <label>[[Saturation]]:</label>
            <a href="#" data-id="Saturation" title="[[Reset]]"><i class="bi bi-arrow-repeat"></i></a>
          </div>
          <div class="row-2">
            <input type="range" defaultValue="0" value="0" min="-1" max="1" step="0.01">
            <input type="text" value="0" data-type="percentage" />
            <span>%</span>
          </div>
        </div>
        <div class="fltr" id="HueRotation" data-prop="rotation">
          <div class="row-1">
            <label>[[Hue Rotation]]:</label>
            <a href="#" data-id="HueRotation" title="[[Reset]]"><i class="bi bi-arrow-repeat"></i></a>
          </div>
          <div class="row-2">
            <input type="range" defaultValue="0" value="0" min="-2" max="2" step="0.01">
            <input type="text" value="0" data-type="degree" />
            <span><sup>&deg;</sup></span>
          </div>
        </div>
        <div class="fltr" id="Vibrance">
          <div class="row-1">
            <label>[[Vibrance]]:</label>
            <a href="#" data-id="Vibrance" title="[[Reset]]"><i class="bi bi-arrow-repeat"></i></a>
          </div>
          <div class="row-2">
            <input type="range" defaultValue="0" value="0" min="-1" max="1" step="0.01">
            <input type="text" value="0" data-type="percentage" />
            <span>%</span>
          </div>
        </div>
        <div class="fltr" id="Blur">
          <div class="row-1">
            <label>[[Blur]]:</label>
            <a href="#" data-id="Blur" title="[[Reset]]"><i class="bi bi-arrow-repeat"></i></a>
          </div>
          <div class="row-2">
            <input type="range" defaultValue="0" value="0" min="0" max="1" step="0.01">
            <input type="text" value="0" data-type="percentage" />
            <span>%</span>
          </div>
        </div>
        <div class="fltr" id="Noise">
          <div class="row-1">
            <label>[[Noise]]:</label>
            <a href="#" data-id="Noise" title="[[Reset]]"><i class="bi bi-arrow-repeat"></i></a>
          </div>
          <div class="row-2">
            <input type="range" defaultValue="0" value="0" min="0" max="1000" step="1">
            <input type="text" value="0" />
          </div>
        </div>
        <div class="fltr" id="Pixelate">
          <div class="row-1">
            <label>[[Pixelate]]:</label>
            <a href="#" data-id="Pixelate" title="[[Reset]]"><i class="bi bi-arrow-repeat"></i></a>
          </div>
          <div class="row-2">
            <input type="range" defaultValue="0" value="0" min="0" max="20">
            <input type="text" value="0" />
          </div>
        </div>
        <div class="d-flex align-items-center flex-wrap matrixFilter">
          <div class="d-flex align-items-center">
            <input type="checkbox" data-action="Sharpen" id="sharpen" />
            <label for="sharpen" class="ps-1 pr-0 mb-0">[[Sharpen]]</label>
          </div>
          <div class="d-flex align-items-center">
            <input type="checkbox" data-action="Emboss" id="emboss" />
            <label for="emboss" class="ps-1 pr-0 mb-0">[[Emboss]]</label>
          </div>
          <div class="d-flex align-items-center">
            <input type="checkbox" data-action="Edge" id="edge" />
            <label for="edge" class="ps-1 pr-0 mb-0">[[Edge]]</label>
          </div>
        </div>
      </div>
        
      <h5 class="text-white mb-0 mt-2 text-center">Built-In Filters</h5>
      <div class="d-flex flex-wrap align-items-center justify-content-center overflow-y" id="preDefFilters">
        <a href="#" data-action="Grayscale"> 
          <img src="$url" />
          <span>[[Grayscale]]</span>
        </a>
        <a href="#" data-action="BlackWhite"> 
          <img src="$url" />
          <span>[[BlackWhite]]</span>
        </a>
        <a href="#" data-action="Sepia"> 
          <img src="$url" />
          <span>[[Sepia]]</span>
        </a> 
        <a href="#" data-action="Invert"> 
          <img src="$url" />
          <span>[[Invert]]</span>
        </a>
        <a href="#" data-action="Vintage"> 
          <img src="$url" />
          <span>[[Vintage]]</span>
        </a> 
        <a href="#" data-action="Technicolor"> 
          <img src="$url" />
          <span>[[Technicolor]]</span>
        </a>
        <a href="#" data-action="Polaroid"> 
          <img src="$url" />
          <span>[[Polaroid]]</span>
        </a> 
        <a href="#" data-action="Kodachrome"> 
          <img src="$url" />
          <span>[[Kodachrome]]</span>
        </a>
      </div>
    </div>
  </div>

  <div class="rotate-editor panel">
    <div class="x-close text-white ms-auto pt-1">
      <i class="bi bi-x-lg"></i>
    </div>
    <div class="d-flex align-items-center justify-content-between">
      <button class="icon-button" data-action="rotateLeft">
        <i class="bi bi-arrow-counterclockwise"></i>
        <span>-90&deg;</span>
      </button>
      <button class="icon-button" data-action="rotateRight">
        <i class="bi bi-arrow-clockwise"></i>
        <span>+90&deg;</span>
      </button>
    </div>
    <div class="d-flex align-items-center justify-content-between">
      <button class="icon-button" data-action="flipX">
        <i class="bi bi-vr"></i>
        <span>[[Flip]] X</span>
      </button>
      <button class="icon-button" data-action="flipY">
        <i class="bi bi-hr"></i>
        <span>[[Flip]] Y</span>
      </button>
    </div>
  </div>

  <div class="zoom-pan">
    <div class="d-flex flex-column align-items-center">
      <button class="icon-button my-2" data-action="zoomIn" title="[[Zoom In]]">
        <i class="bi bi-zoom-in"></i>
      </button>
      <button class="icon-button mb-2" data-action="zoomOut" title="[[Zoom Out]]">
        <i class="bi bi-zoom-out"></i>
      </button>
      <button class="icon-button mb-2" data-action="reset" title="[[Recenter]]">
        <svg fill="currentColor" viewBox="0 0 24 24">
          <path d="M9 9V3H7v2.59L3.91 2.5 2.5 3.91 5.59 7H3v2zm12 0V7h-2.59l3.09-3.09-1.41-1.41L17 5.59V3h-2v6zM3 15v2h2.59L2.5 20.09l1.41 1.41L7 18.41V21h2v-6zm12 0v6h2v-2.59l3.09 3.09 1.41-1.41L18.41 17H21v-2z"></path>
        </svg>
      </button>
      <button class="icon-button" data-action="tips" data-toggle="popover" data-html="true" title="Controls" data-content="[[Press]] <b>Ctrl</b>+<b>0</b> [[to recenter]]<br><br>[[Press and hold]] <b>Ctrl</b>, [[then scroll up or down to]] <b>[[zoom in/out]]</b>">
        <i class="bi bi-question-circle"></i>
      </button>
    </div>
  </div>

  #if($contentitem.exists())
    <img style="display: none;" src="${url}?_=$contentitem.getLastModified()" id="editingCandidate" />
  #end
</div>
