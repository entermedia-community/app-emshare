<div id="asset-editor-container">

<div class="assetpanel-editorinner">

<div style="padding:20px;">

#if( $asset.assettitle )
     	#set($title =  $asset.assettitle) 
   #else 
     	#set($title = $asset.name) 
   #end

<div class="row">
<div class="col-md-3">
##<h2>[[Asset Downloads]]</h2>
<div class="clearfix"></div>

	##set($mediaurl = "$siteroot/$mediadbappid/services/module/asset/downloads/preset/$asset.sourcepath/$presetdata.generatedoutputfile")	  
	##set($previewurl="$siteroot$apphome/components/asseteditor/preview.html?previewimg=$mediaurl")
	
	##set($$assetthpath = $mediaarchive.asLinkToPreview($asset, null, "image200x200.jpg", true))
	##set($imgurl="$mediaurl?_=$mathutil.getRandomValue(9999)")
	
	$context.putPageValue("asset", $asset)
	$context.putPageValue("viewer", "media_download_")
	
	#set($rendertype = $mediaarchive.getMediaRenderType($asset.fileformat))
	 	#if(!$rendertype || $type =="rendertype")
		   	#set( $rendertype = "mime" )
		#elseif( $rendertype =="video")
		   	#set( $rendertype = "videothumbnail" )
		#end
		$context.putPageValue("thumbsize", "small" )
		$context.putPageValue("urlparams", "?cache=false&_=$mathutil.getRandomValue(99999)" )
		
		
	<div class="text-center conversionsmainpreview conversionsmainpreview-$!rendertype">
	##<img src="$assetthpath?cache=false" alt="$title" style="max-width: 200px; max-height: 200px" />
		#if($rendertype == "audio")
			$pages.include("$componenthome/results/thumbnails/${rendertype}.html", $context)

			<div class="conversionassetfilename">#text($title)</div>
		#else
	    	$pages.include("$componenthome/results/thumbnails/${rendertype}.html", $context)
	    #end
	</div>


<div style="margin:10px 0; text-align: center;">
	#if($candownload)	
		#if( $desktop )
	       	<a href="#" class="emdesktopdownload btn btn-dark" data-assetid="$asset.id" title="[[Download]] #text($!title)">
	       	<i class="fas fa-download"> </i> [[Download Original]]
	       	</a>
	    #else
			#set($dlink = $mediaarchive.asLinkToOriginal($asset))
			#ifnotnull($dlink)
				#set($dlink = "$siteroot/$mediadbappid/services/module/asset/downloads/originals/$dlink?assetid=$!asset.getId()")
				#if($collectionid)
					#set($dlink = "$dlink&collectionid=$!{collectionid}")
				#end
		       	<a href="$!dlink" class="btn  btn-dark" data-assetid="$asset.id" title="[[Download]] $!title">
		       	<i class="fas fa-download"></i> [[Download Original]]
		       	</a>
	       	#end
	   	#end
	#end   	
   	#if($caneditasset)
   	<div style="padding:10px 0;"><a  href="$applink/views/modules/asset/editor/conversions/upload.html"
   	 	class="emdialog btn btn-dark"
   		data-width="600" data-height="300" data-hidefooter="true" 
   		data-assetid="$asset.id"
   		data-presetid="0"
   		title="[[Replace]] #text($!title)">
       	<i class="fas fa-upload"> </i> [[Replace Original]]
       	</a>
       	</div>
	#end
</div>



	

#if($caneditasset && $rendertype=="image")
	<div style="padding:10px 0 0; text-align: center;">
	<a class="btn btn-sm btn-secondary ajax" data-targetdivinner="asset-editor-container" data-oemaxlevel="1" 
	   href="$siteroot$apphome/views/modules/asset/editor/conversions/rotate.html?rotate=90&assetid=$asset.id">[[Rotate +90]]</a>
	</div>
##	<div style="padding-top:5px">
##	<form id="uploadform" class="ajaxform" data-targetdiv="asset-editor-container" name="wizard" method="post" enctype="multipart/form-data" action="$siteroot${apphome}/views/modules/asset/editor/conversions/customthumb.html">
##		<span class="btn btn-sm btn-secondary btn-default btn-file">
##		    [[Replace Image]] <input type="file" name="file.0" id="file0-file" onchange='$("#file0-file-info").html($(this).val());'>
##		</span>
##		<span id="file0-file-info" style="font-size:90%"></span>
		##[[Replace Image]]:<input type="file" size="50" name="file.0">
##		<input type="hidden" name="unzip" value="false" />
##		<input type="hidden" name="sourcepath" value="$!context.getRequestParameter('assetid')" />
##		<input type="hidden" name="assetid" value="$!context.getRequestParameter('assetid')" />
##		<input type="hidden" name="presetid" value="$!context.getRequestParameter('presetid')" />
##		<input type="submit" id="finishbutton" value="[[Upload]]" class="btn btn-sm btn-primary" >
##	</form>
##	</div>
#end


</div>
<div class="col-md-9">


###set( $cdnprefix = $mediaarchive.getCatalogSettingValue("cdn_prefix") )
#set($cdnprefix = $context.siteRoot )

#set( $type = $mediaarchive.getMediaRenderType($asset.fileformat))
#set($newpreset = $context.findValue("newpreset"))

$context.putPageValue("asset",$asset)


#set($mediadbappid=$mediaarchive.getMediaDbId())
#set($type =$mediaarchive.getMediaRenderType($asset.fileformat))
#set($results = $conversionUtil.getActivePresetList($catalogid,$type) )



$context.putPageValue("results", $results)

$context.putPageValue("viewer", "media_download_")
#set($rendertype = $mediaarchive.getMediaRenderType($asset.fileformat))

#if(!$rendertype || $type =="rendertype")
    #set( $rendertype = "mime" )
#elseif( $rendertype =="video")
    #set( $rendertype = "videothumbnail" )
#end

$context.putPageValue("thumbsize", "small" )
$context.putPageValue("urlparams", "?cache=false&_=$mathutil.getRandomValue(99999)" )

#set($initSelection = "")

#set( $originalpath = $mediaarchive.asLinkToOriginal($asset, true) )

<div class="photo-editor-container">
  <div class="photo-selection-column">
    <div class="d-flex align-items-center">
      <h2>[[Saved Copies]]</h2> 
    </div>
    <div class="w-100 selection-images">
      #foreach ($result in $results)
        #set($cancrop = false)
        #set($cancrop = $conversionUtil.canCrop($catalogid,$result.id,$asset.id))

        #if(!$cancrop)
          #if( $mediaarchive.isCatalogSettingTrue("preventupscaling"))
            #set($show = false)
          #else
            #set($show = true)
          #end
        #else
          #set($show = true)
        #end

        #set($expfilename = $mediaarchive.asExportFileName($asset, $result))
        #set($ext = $!url_util.getPathUtilities().extractPageType($expfilename))
        #set($url = "$siteroot/$mediadbappid/services/module/asset/downloads/generated/$asset.sourcepath/$result.generatedoutputfile/$expfilename")
        #if($conversionUtil.doesExist($catalogid, $asset.id,$asset.sourcePath, $result.id) && $show)
        #set($dimension = $conversionUtil.getConvertPresetDimension($catalogid,$result.id))
        #set($height = $mathtool.toInteger($dimension.getHeight()))
        #set($width = $mathtool.toInteger($dimension.getWidth())) 

        #if($result.id == "largeimage")
          #set($initSelection = "/$apphome/views/modules/asset/editor/media/editorarea.html?assetid=${asset.id}&assetsource=${asset.sourcepath}&resultid=${result.id}&resultoutput=${result.generatedoutputfile}&expfilename=${expfilename}&catalogid=${catalogid}&width=${width}&height=${height}&oemaxlevel=1")
        #end

        <div 
          class="thumb #if($result.id == "largeimage") selected #end" 
          role="button" 
          tabindex="0" 
          data-href="$siteroot$apphome/views/modules/asset/editor/media/editorarea.html"
          data-assetid="${asset.id}"
          data-assetsource="${asset.sourcepath}"
          data-resultid="${result.id}"
          data-resultoutput="${result.generatedoutputfile}"
          data-expfilename="${expfilename}"
          data-catalogid=${catalogid}" 
          data-oemaxlevel="1"
        > 
          <img src="#urlescape($url)" />
          <div class="d-flex align-items-end justify-content-between"> 
            <small>$expfilename</small> 
            <!-- <small>$ext</small>  -->
          </div>
          <strong class="img-size">${width}&times;${height}</strong>
          <a href="#urlescape($url)" class="btn btn-sm btn-secondary dl" title="[[Download]]"><i class="bi bi-download"></i></a>
          #if($canembedasset)
            <a class="btn btn-sm btn-secondary emdialog" 
              href="$siteroot$apphome/views/modules/asset/editor/media/share.html?assetid=${asset.id}&presetid=${result.id}"
              data-noesc="true"
              data-hidefooter="true"
              title="[[Share]] $!result.name"><i class="fas fa-share-alt"></i></a>
          #end
        </div>
        #end
      #end    
    </div>
  </div>
  <div id="photoEditorColumn">
    #if($initSelection)
      $pages.include($initSelection)
    #end
  </div>
</div>

