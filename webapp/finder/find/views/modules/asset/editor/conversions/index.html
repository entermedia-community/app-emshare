
###set( $cdnprefix = $mediaarchive.getCatalogSettingValue("cdn_prefix") )
#set($cdnprefix = $context.siteRoot )

#set( $type = $mediaarchive.getMediaRenderType($asset.fileformat))
#set($newpreset = $context.findValue("newpreset"))

$context.putPageValue("asset",$asset)


#set($mediadbappid=$mediaarchive.getMediaDbId())
#set($type =$mediaarchive.getMediaRenderType($asset.fileformat))
#set($results = $conversionUtil.getActivePresetList($catalogid,$type) )



$context.putPageValue("results", $results)

$context.putPageValue("viewer", "media_download_")
#set($rendertype = $mediaarchive.getMediaRenderType($asset.fileformat))

#if(!$rendertype || $type =="rendertype")
    #set( $rendertype = "mime" )
#elseif( $rendertype =="video")
    #set( $rendertype = "videothumbnail" )
#end

$context.putPageValue("thumbsize", "small" )
$context.putPageValue("urlparams", "?cache=false&_=$mathutil.getRandomValue(99999)" )

#set($initSelection = "")

#set( $originalpath = $mediaarchive.asLinkToOriginal($asset, true) )

<div class="photo-editor-container mt-1">
  <div class="photo-selection-column">
    <div class="d-flex align-items-center">
      <h2>[[Saved Copies]]</h2> 
    </div>
    <div class="w-100 selection-images">
      #foreach ($result in $results)
        #set($cancrop = false)
        #set($cancrop = $conversionUtil.canCrop($catalogid,$result.id,$asset.id))

        #if(!$cancrop)
          #if( $mediaarchive.isCatalogSettingTrue("preventupscaling"))
            #set($show = false)
          #else
            #set($show = true)
          #end
        #else
          #set($show = true)
        #end

        #set($expfilename = $mediaarchive.asExportFileName($asset, $result))
        #set($ext = $!url_util.getPathUtilities().extractPageType($expfilename))
        #set($url = "$siteroot/$mediadbappid/services/module/asset/downloads/generated/$asset.sourcepath/$result.generatedoutputfile/$expfilename")
        #if($conversionUtil.doesExist($catalogid, $asset.id,$asset.sourcePath, $result.id) && $show)
        #set($dimension = $conversionUtil.getConvertPresetDimension($catalogid,$result.id))
        #set($height = $mathtool.toInteger($dimension.getHeight()))
        #set($width = $mathtool.toInteger($dimension.getWidth())) 

        #if($result.id == "largeimage")
          #set($initSelection = "/$apphome/views/modules/asset/editor/media/editorarea.html?assetid=${asset.id}&assetsource=${asset.sourcepath}&resultid=${result.id}&resultoutput=${result.generatedoutputfile}&expfilename=${expfilename}&catalogid=${catalogid}&width=${width}&height=${height}&oemaxlevel=1")
        #end

        <div 
          class='thumb #if($result.id == "largeimage") selected #end' 
          role="button" 
          tabindex="0" 
          data-href="$siteroot$apphome/views/modules/asset/editor/media/editorarea.html"
          data-assetid="${asset.id}"
          data-assetsource="${asset.sourcepath}"
          data-resultid="${result.id}"
          data-resultoutput="${result.generatedoutputfile}"
          data-expfilename="${expfilename}"
          data-catalogid="${catalogid}" 
          data-oemaxlevel="1"        > 
          <img src="#urlescape($url)" />
          <div class="d-flex align-items-end justify-content-between"> 
            <small>$expfilename</small> 
            <!-- <small>$ext</small>  -->
          </div>
          <strong class="img-size">${width}&times;${height}</strong>
          
          #if(($candownload || $canconvert || $candownloadfpo) && $canquickdownload)
          <a href="#urlescape($url)" class="btn btn-sm btn-secondary dl" title="[[Download]]"><i class="bi bi-download"></i></a>
          #end
          #if($canembedasset)
            <a class="btn btn-sm btn-secondary emdialog" 
              href="$siteroot$apphome/views/modules/asset/editor/media/share.html?assetid=${asset.id}&presetid=${result.id}"
              data-noesc="true"
              data-hidefooter="true"
              title="[[Share]] $!result.name"><i class="fas fa-share-alt"></i></a>
          #end
        </div>
        #end
      #end    
    </div>
  </div>
  <div id="photoEditorColumn">
    #if($initSelection)
      $pages.include($initSelection)
    #end
  </div>
</div> 
