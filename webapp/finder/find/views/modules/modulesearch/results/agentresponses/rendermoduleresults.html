
#set($moduleicon = "grid")
#if ($module.moduleicon)
	#set($moduleicon = $module.moduleicon)
#end

#if(!$input)
	#set($input = "")
#end

#set($entityurl = "$!siteroot$apphome/views/modules/$!{module.id}/index.html?$!{module.id}page=1&field=description&operation=freeform&description.value=$input")
	
<div class="#if($foreach.count > 1) mt-3 #else mb-3 #end">
	#if(!$hidemoduleheaders)
		<div class="mt-2 qsresultsEntity d-flex align-items-center">
			<i class="bi bi-$moduleicon module-icon"></i>
			<span class="qsresultsEntitytext">#text($module)</span>
	
			#if( $module.id == "asset") ##this is safe
				#set( $count = $hits.size()) 
			#else
				#set( $count = $filter.getCount($module.id) ) 
			#end
	
			#ifnull($count)
				#set( $count = $hits.size()) 
			#end

			#if($count > 0)
				<span class="mx-1">&middot;</span> 
				<a href="$entityurl" 
					class="ajax " 
					data-targetdiv="applicationmaincontent" 
					data-oemaxlevel="3" 
					data-updateurl="true" 
					title="[[View]] $count: #text($module)">
					<span class="count">
						[[View]] $count
					</span>
				</a>
			#end
		</div>
	#end

	$context.putPageValue("rendermoduleid", $module.id)
	
	$hits.setHitsPerPage(10)
	$context.putPageValue("hits", $hits)
	
	$context.putPageValue("searchresults", true)
	$context.putPageValue("searchhome", "$apphome/views/modules/${module.id}/results/default")
	
	<div class="emgridflex">  	
		<div id="galleryimg-entitiy" 
			class='emgrid #if($section != "favorites")emgridlimited#end entitiescontainer emgridquickresults' 
			style="width:100%"
			data-fixedwidth="180" 
			data-cellpadding="10"
			data-entityrenderurl="$!{siteroot}$apphome/views/modules/${module.id}/editors/default/tabs/gridcell.html"
			data-rendertype="$!rendertype">
			#foreach( $hit in $hits.getPageOfHits() )

				$agentcontext.addExcludedEntityId($hit.getId())

				$context.putPageValue("hit", $hit)
				#set($rendertype = $module.modulerendertype)
				#if (!$rendertype)
					#set($rendertype = "entity")
				#end
				<messageplain>Entity Search Result#${foreach.count}</messageplain>
				<messageplain>Entity ID: ${hit.id}</messageplain>
				<messageplain>Entity Name: ${hit.name}</messageplain>
				<messageplain>Module ID: ${hit.entitysourcetype}</messageplain>
				#ifnotnull($hit.primaryimage)
				<messageplain>Primary Image ID: ${hit.primaryimage}</messageplain>
				#end
				#ifnull($hit.primaryimage)
					#ifnotnull($hit.primarymedia)
					<messageplain>Primary Image ID: ${hit.primarymedia}</messageplain>
					#end
				#end
				<div class="emgridcell emgridcellqs emgridcell-$rendertype activelistcontainer 
					#if($selectedid == $hit.getId() || $topselectedid == $hit.getId()) active #end">
					$pages.include("$apphome/views/modules/$!{module.id}/results/default/types/qsresult.html", $context)
					#set($highlight =  $hits.highlight($hit, "description", 20, true))
					#if($highlight)
						<div class="gridcellhighlight">$highlight</div>
					#end
				</div>
			#end
		</div>
	</div>
</div>
