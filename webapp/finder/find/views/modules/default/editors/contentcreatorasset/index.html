#ifnull($entitymoduleviewid) 
	#set($entitymoduleviewid = $context.getRequestParameter("entitymoduleviewid"))
	
#end
#set($viewdata = $mediaarchive.getCachedData("view",$entitymoduleviewid))

#set( $pickertargetfield = $context.getRequestParameter("pickertargetfield"))


#set( $gptkey = $mediaarchive.getCatalogSettingValue("gpt-key"))

#ifnull($gptkey)
	<div class="alert alert-warning m-4 text-center"><strong>[[Missing Key]]:</strong> [[Gpt Key not defined in Catalog Settings]]</div>
#end
<div class="bg-white">
  <div class="w-100 my-2 px-2">
    <form
			class="contentpickerForm autocloseform checkCloseDialog force-validate-inputs"
			action="$edithome/finish.html"
			data-ajaxreloadtargets="dataeditedreload"
			data-includeeditcontext="true"
			data-targetdiv="importdone"
			data-pickertargetfield="$!pickertargetfield"
			data-toastmessage="[[Creating]] #text($submodule) [[with AI]]"
			data-toastsuccess="[[Created]] #text($submodule) [[successfully]]"
			data-toasterror="[[Failed to create]] #text($submodule)">
			<input type="hidden" name="entitymoduleviewid.value" value='$entitymoduleviewid'/>
			<input type="hidden" name="field" value="entitymoduleviewid" />
			
			<input type="hidden" name="save" value='true'/>
			<input type="hidden" name="entitymoduleid" value="$entitymodule.id" />
			<input type="hidden" name="entityid" value="$entity.id" />
			
			
			<input type="hidden" name="field" value="entitymoduleviewid" />

			#set($llmmodel = "dall-e-3")
			<input type="hidden" name="field" value="llmmodel" />
			<input type="hidden" name="llmmodel.value" value="$llmmodel" />


			$context.putPageValue("viewid", "contentcreatorassetimage")
			$context.putPageValue("details",null)
			$context.putPageValue("searcher",$mediaarchive.getSearcher("contentcreator"))
			
			<div class="updateaiimagetemplate #if($customprompt) customized #end"
				data-template="$edithome/aitools/createassetinstructions.html"
				data-targetarea="aiInstruction">
				$pages.include("$apphome/components/xml/detaileditor-entities.html", $context)
			</div>
			<div class="entitiesinfputform">
				<label for="aiInstruction" class="emdatafield mb-1">[[AI Prompt]]</label>
				<input type="hidden" name="field" value="llmprompt" />
				
				<textarea name="llmprompt.value" id="aiInstruction" class="form-control rounded" rows="6" required autocomplete="off" data-gramm="false">$pages.include("$edithome/createassetinstructions.html", $context)</textarea>
			</div>
			
			<div class="mt-1">[[Model]]: $!llmmodel</div>
			
			<div class="d-flex justify-content-center mt-3">
				
				<button type="submit" class="btn btn-cta" #ifnull($gptkey) disabled="disabled"#end >
					<i class="bi bi-brush mr-1"></i>
					[[Create with AI]]
				</button>
				
			</div>
    </form>
    <div id="importdone"></div>
  </div>
</div>
