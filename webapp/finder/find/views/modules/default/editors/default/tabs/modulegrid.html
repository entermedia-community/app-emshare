#set($moduleid = $module.getId())
$context.putPageValue("moduleid", $moduleid)

#set($filter = $searchcategoryhits.findFilterValue("entitysourcetype") )

$context.putPageValue("filter", $filter)

<div class="emgrid-module emgrid-box emgrid-column emgrid-module-$!rendertype">
	<div class="emgrid-subtitle">
		<h3>
			#set($moduleicon = "grid")
			#if ($module.moduleicon)
				#set($moduleicon = $module.moduleicon)
			#end
		
			#set($entityurl = "$!siteroot$apphome/views/modules/$!{module.id}/index.html?$!{module.id}page=1&hitssessionid=$!hits.getSessionId()")
		
			<i class="bi bi-$!{moduleicon} module-icon" style="font-size:0.9em;line-height:1;"></i> 

			#if( $module.id == "asset") ##this is safe
				#set( $count = $hits.size()) 
			#else
				#set( $count = $filter.getCount($module.id) ) 
			#end
			#ifnull($count)
				#set( $count = $hits.size()) 
			#end

			#text($module)

			#if($parentmoduleid == "favorites")
				<a href="$apphome/views/modules/modulesearch/bookmarksremove.html?moduleid=${module.id}" 
					class="ajax removemodulebookmarks rounded btn btn-brand clear-bookmarks ml-2"
					data-targetdiv="modulesearchtopcontainer"
					data-oemaxlevel="1"
					data-confirm="[[Are you sure to remove items from Bookmarks?]]"
					title="[[Clear Bookmarks]]"><i class="bi bi-bookmark-x mr-1"></i>[[Remove All]]</a>
			#elseif($parentmoduleid == "searchcategory")
				#set($searchcategory = $context.getRequestParameter("searchcategory.value"))
				<a href="$!siteroot$apphome/views/modules/searchcategory/searchcategorytable.html" 
					class="ajax rounded btn btn-brand ml-2"
					data-targetdiv="searchcategorytopcontainer"
					data-searchcategoryid="$!searchcategory"
					data-showmoduleid="$!moduleid"
					data-oemaxlevel="2"
					title="[[View Results]]">[[View Table]] <span class="count">($count)</span></a>
			#end
		</h3>
		<div class="clearfix"></div>
	</div>

	#set($rendertype = "entity")
		#if ($module.modulerendertype)
			#set($rendertype = $module.modulerendertype)
		#end
		$context.putPageValue("rendertype", $rendertype)
		$context.putPageValue("rendermoduleid", $module.id)
		
		##check for view
	#set($entitymoduleviewid = "${moduleid}gridfields")
	#set($view = "$moduleid/$entitymoduleviewid")

	#if( $context.getUserProfile() )
		#set($searcher = $searcherManager.getSearcher($catalogid,$moduleid))
		#set ($details = $searcher.getDetailsForView($view, $context.getUserProfile()))
		
	#else
		#set ($details = $searcher.getDetailsForView($view))
		
	#end
		$context.putPageValue("details", $details)
		
	##$hits.setHitsPerPage(6)
	<div class="emgridflex">  	
		<div id="galleryimg-${rendertype}" 
				class='emgrid #if($section != "favorites")emgridlimited#end entitiescontainer emgridFixHeight' 
				#if($modulecount==1)
				style="max-height:600px"
				#end
				data-fixedwidth="175" 
				data-cellpadding="10"
				data-rendertype="$!rendertype">
				#foreach( $hit in $hits.getPageOfHits() )
					$context.putPageValue("hit", $hit)
					<div class="emgridcell emgridcell-$rendertype activelistcontainer 
						#if($selectedid == $hit.getId() || $topselectedid == $hit.getId()) active #end">
						${edithome} 
						##$pages.include("${edithome}/index.html", $context)
						<div class="emgridcell-bookmark">
							$pages.include("${edithome}/tabs/favorites.html?id=$hit.getId()&moduleid=$moduleid", $context)
						</div>
					</div>
				#end
		</div>
	</div>
</div>
	