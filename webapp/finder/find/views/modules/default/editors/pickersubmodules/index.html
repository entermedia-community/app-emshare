#set($entitymoduleviewid = $context.getRequestParameter("entitymoduleviewid"))
#set($viewdata = $mediaarchive.getCachedData("view",$entitymoduleviewid))
#set($submoduleid = $!viewdata.rendertable)

##Edithome might be wrong because the parent has one set

<div id="$!{edithomeid}" class="editdiv pickersubmodules" 
	data-entityid="$!entity.id"
	data-entitymoduleid="$!entitymodule.id"
	data-entitymoduleviewid="$entitymoduleviewid"
	data-edithome="$!{edithome}"
	data-edithomeid="$!{edithomeid}"
	data-setpagetitle="[[Select]] #text($module)"

>

#set($submoduleid = $!entitymoduleviewdata.rendertable)

	<div class="overflow-y">
		<div class="clickableresultlist"
		data-edithomeid="$!{edithomeid}"
		data-url= "${apphome}/views/modules/${submoduleid}/editors/pickersubmodules/actions/savesubmodule.html"
		data-entityid="$!entity.id"
		data-entitymoduleid="$!entitymodule.id"
		data-entitymoduleviewid="$entitymoduleviewid"
		data-toastmessage="[[Saving]]"
		data-toastsuccess="[[Record Saved]]"
		data-closedialog="true"
		data-ajaxreloadtargets="entitysubmodules"  ##this reloads any
		
		>
		
	#set($module = $mediaarchive.getCachedData("module",$submoduleid))
	$context.putPageValue("module", $module)
	#set($searchhome = "$apphome/views/modules/${submoduleid}/results/submodulesexcludelist")
	$context.putPageValue("searchhome", $searchhome)
	
			
	#set($sortby = $!viewdata.rendersort)
	#set($args = "field=$!{entitymodule.id}&$!{entitymodule.id}.value=$!{entity.id}&operation=not")
	#set($args = "$args&sortby=$!sortby&entitymoduleviewid=$entitymoduleviewid&viewid=$entitymoduleviewid&${module.id}setpage=1")
	$pages.include("${searchhome}/search.html?$!args",$context)


		</div>
	</div>

</div>


		
