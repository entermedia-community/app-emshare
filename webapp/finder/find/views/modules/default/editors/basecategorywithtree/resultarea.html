
#set($module = $mediaarchive.getCachedData("module", "asset"))
$context.putPageValue("module", $module)
#set($moduleid = $module.getId())


#if( !$category)
	#set($categoryid = $context.getRequestParameter("categoryid"))
	#if($categoryid)
		#set($category = $mediaarchive.getCachedData("category", $categoryid))
	#end
#end

#set($rootcategoryid = $context.getRequestParameter("rootcategory"))

#if( !$categoryid && $category)
	#set( $categoryid= $category.getId())
#end

$context.putPageValue("category", $category)
$context.putPageValue("categoryid", $categoryid)



<div id="categorywithtree" class="emgridcontainer">
	<div class="emgrid-module emgrid-box emgrid-module-asset h-100">
		
		$context.putPageValue("selectednodes", $categoryid)
		
		#set($canupload = false)
		#if($canviewupload)
			#if($parentmodule.getBoolean("enableuploading") && $permissions.canModule($entitymodule, "upload_files"))
				#set($canupload = true)
			#end
		#end

		$context.putPageValue("canupload", $canupload)
		
		#set($dialogtreestatus = $userprofile.get("dialogtreestatus"))
		#ifnotnull($dialogtreestatus)
			#if($dialogtreestatus != "open")
				#set($dialogtreestatus = "close")
			#end
		#end
		#ifnull($dialogtreestatus)
			#set($dialogtreestatus = "close")
		#end
		$context.putPageValue("dialogtreestatus", $dialogtreestatus)
		
		<div class="embedmediacontainer">
			#if($dialogtreestatus == "open")
				<div class="embedmediacol embedmediacol-tree embedtreestatus$dialogtreestatus">
				
					<div class="embedmediacolactions d-flex align-items-center">

						
						<a href="$edithome/index.html" 
						class="d-flex align-items-center ajax toggledialogtree toggledialogclose"
						data-targetdiv="${edithomeid}"
						data-oemaxlevel="1"
						data-propertyfield="dialogtreestatus"
						data-propertyvalue="close"
						data-includeeditcontext="true"
						data-includesearchcontext="true"
						title="[[Collapse Tree]]">
							<i class="bi bi-chevron-left"></i>
							<h3 class="embedmediacolheader">[[Folders]]</h3>
						</a>
						#if($canviewupload && $entitymodule.getBoolean("enableuploading") && $permissions.canModule($$entitymodule, "upload_files"))
						<a href="" 
							class="createfoldertree"
							data-tree="dialogentitymediatreetree" 
							style="width:32px;" 
							title="[[Add Sub-Folder]]"><i class="bi bi-folder-plus"></i></a>
							
						
						#end
					</div>
								#end	
					
#set($searchhome = "$apphome/views/modules/asset/results/category")
#set($searchhomeid = "assetcategory")
$context.putPageValue("searchhome", $searchhome)

			#if($dialogtreestatus == "open")

					<div class="assetdropcategory dialogdroppable left-foldertree">
						<div class="embedmediatree overflow-y">
						#set($componenthome = "$apphome/views/modules/asset/components")
						$context.putPageValue("componenthome", $componenthome)
						
						#set( $link = "$componenthome/emtree/tree.html")
						#set( $link = "${link}?treename=dialogentitymediatree&dialogentitymediatreeroot=$rootcategoryid&editabletree=true&targetdivsearch=$!searchhomeid" )
						#set( $link = "${link}&targetdiv=${searchhomeid}${edithomeid}&maxlevelclick=1&updateAddressBar=false&uploadmaxlevel=1&nodeID=$!{categoryid}&exactsearch=true" )
						#set( $link = "${link}&customurladdmedia=$apphome/views/modules/asset/editors/assetupload/index.html" )
						#set( $link = "${link}&edithome=$edithome" )
						#set( $link = "${link}&oemaxlevel=1&urlprefix=${searchhome}/search.html" )
						$pages.include($link, $context)
						</div>
					</div>
					
			</div>
				#end   ##tree hide
			<div class="embedmediacol embedmediacol-results overflow-x" #if($dialogtreestatus != "open")style="width:100%;"#end>
				<div id="dialogmediaentity" class="h-100"> 
				
						$pages.include("${searchhome}/search.html?categoryid=$categoryid&exactsearch=false", $context)
				</div>
			</div>
		</div>
	</div>
</div>