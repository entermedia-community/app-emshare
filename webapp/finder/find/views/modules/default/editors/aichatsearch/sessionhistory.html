<div class="sessionhistory overflow-y">
  <div class="d-flex justify-content-center mt-3 mb-2">
    <a class="btn btn-accent ajax"  data-targetdiv="aichatsearch" data-oemaxlevel="1" data-createnew="true" href="$edithome/sessionadd.html">
      <i class="bi bi-plus-lg me-1"></i> [[New Session]]
    </a>
  </div>
  
  <hr>

  <p class="text-center small my-2">
    <strong>[[Session History]]</strong>
  </p>

  #set($toplevelfunctionid = $agentcontext.getTopLevelFunctionName())

  #set( $hits = $mediaarchive.query("channel").exact("dataid",$user).exact("searchtype", "user").sort("refreshdateDown").search($context))

  #foreach($hit in $hits.getPageOfHits() )
    <div class="sessionhistory-item #if( $currentchannel.id == $hit.id ) active #end">

      <a class="ajax item d-flex flex-column" 
        data-targetdiv="aichatsearch"
        data-channel="$hit.id"
        data-oemaxlevel="1"
	      href="$edithome/sessionrestore.html" 
        title="[[Retrieve this session]]">
        <span class="session-name">
          #ifnotnull($toplevelfunctionid)
            #set($toplevelfunction = $mediaarchive.query("aifunction").id($toplevelfunctionid).searchOne())
            <i class="bi ns bi-${toplevelfunction.icon} me-1"></i> 
          #end
          #ifnotnull($hit.name)
            #esc($!hit.name)
          #end
          #ifnull($hit.name)
            #set($id = $hits.size() - $foreach.count + 1)
            [[Session]] #$id
          #end
        </span>
        <small class="text-muted">
          #datetime($hit.refreshdate)
        </small>
      </a>

      <a class="ajax del" data-targetdiv="aichatsearch" data-oemaxlevel="1" data-id="$hit.id" data-confirm="[[Sure you want to delete session?]]" href="$edithome/sessiondelete.html" title="[[Delete this session]]"> 
        <i class="far fa-trash-alt"></i>
      </a>

    </div>
  #end

</div>