<div id="edit-faceprofiles" class="asset-data-detail asset-data-preview assetpanel-editor-box edit-panel-generic">
	<h4>[[Face Profiles]]</h4>

	$context.putPageValue("clearfilters","true")	
	#set ($viewtype = "faceprofiles")
	#set( $val = false )
	#set( $target = "${detail.id}.value" )

	$context.putPageValue("thumbsize",$thumbsize)
	#set($assetwidth = $mediaarchive.getRealImageWidth($asset)) 
	$context.putPageValue("assetwidth",$assetwidth)	
	#set($assetheight = $mediaarchive.getRealImageHeight($asset)) 
	$context.putPageValue("assetheight",$assetheight)	

	<div class="$detailviewercolumnclass asset-data-detail emdatafield-$!viewtype p-3">
		#set($collection = $data.getValue("faceprofiles"))
		<div class="emfield-scroll" id="faceprofilefield">
			<ul class="entity-value-list mb-3">
				#foreach( $profile in $collection )
					#set( $row = false )
					#set( $name = "")
					
					#set( $row = $mediaarchive.getCachedData("faceprofilegroup", $profile.faceprofilegroup) )
					#if( $row )
					
						#set( $person = $mediaarchive.getCachedData("entityperson", $row.entityperson) )
					
						#ifnotnull($person)
							#set($namefield = $mediaarchive.getSearcher("entityperson").getDetail("name"))
								#set($name = $mediaarchive.getSearcherManager().getValue($person, $namefield, $context.getLocale()))
								#set($name= "$name ($!row.get('samplecount'))")
							#set($link = "$!siteroot$applink/views/modules/entityperson/editors/default/tabs/index.html?entityid=$person.id&hitssessionid=$!hits.sessionId")
								#set($title = "[[Person]]: ")
						#end

						#if( $name == "")
							#set($name = "[[Profile]] $!row.get('facecounter') ($!row.get('samplecount'))")
							#set($link = "$!siteroot$applink/views/modules/faceprofilegroup/editors/default/tabs/index.html?entityid=$row.id&hitssessionid=$!hits.sessionId")
							#set($title = "[[Face Profile]] ") 
						#end

						#if($profile.timecodestart)
							#set($secs = $mediaarchive.formatMilliseconds($profile.timecodestart))
							#set($name = "$name &nbsp;($secs)")
						#end
						
						
						<li>
							#set( $facemanager = $mediaarchive.getBean("faceProfileManager") )
							#set($imagebox = $facemanager.getImageBox( [$row], $asset, $assetwidth, $assetheight) )
							<a href="$link" 
								class="emdialog entityupdateurl"
								data-dialogid="faceprofiledialog"
								data-moduleid="faceprofilegroup"
								title="[[View Face Profile]]">
								<i class="bi bi-person-fill"></i> $!name
							</a>
							#if($caneditasset) 
								<a href="$siteroot$applink/components/faceprofile/removefromprofile.html" 
									data-assetid="$!asset.getId()" 
									data-profileid="$row.id" 
									class="ajax entityremoveurl"
									data-targetdiv="faceprofilefield" 
									data-confirm="[[Remove face profile from this asset]]" title="[[Remove Face Profile]]">
									<i class="bi bi-x"></i>
								</a>
							#end	
						</li>
					#end 
				#end	
			</ul>
			#ifnull($xmledithome)
				#set( $xmledithome = "$apphome/components/xml")
			#end
			$context.putPageValue("detail",$detail)
			$pages.include("$xmledithome/types/entity.html", $context)

			#set($addnew = "$apphome/views/modules/entityPerson/editors/pickerforfield/actions/addnewentity.html")
			<a class="btn btn-accent rounded emdialog"
				data-dialogid="dialogpickerentityPerson"
				data-width="1200"
				data-hidefooter="true"
				data-pickertargetfield="$!{pickertargetfield}"
				data-entityid="$!{entity.id}"
				data-entitymoduleid="$!{entitymodule.id}"
				href="$addnew">
				<i class="bi bi-plus-lg mr-1"></i> [[Create New]]
			</a>
		</div>
	</div>
</div>
