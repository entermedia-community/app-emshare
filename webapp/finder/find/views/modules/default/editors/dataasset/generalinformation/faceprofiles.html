## Needs $asset
<div id="editfaceprofiles" class="asset-data-detail asset-data-preview assetpanel-editor-box edit-panel-generic">
	<div class="d-flex align-items-center justify-content-between mr-3">
		<h4 class="m-0">[[People]]</h4>
	</div>
	
	$context.putPageValue("clearfilters","true")	
	#set ($viewtype = "faceprofiles")

	$context.putPageValue("thumbsize",$thumbsize)
	#set($assetwidth = $mediaarchive.getRealImageWidth($asset))
	$context.putPageValue("assetwidth",$assetwidth)	
	#set($assetheight = $mediaarchive.getRealImageHeight($asset))
	$context.putPageValue("assetheight",$assetheight)

	##if($rendertype=="video")							
	##	#set($imageboxsource = $mediaarchive.asLinkToGenerated($asset, "image1900x1080"))										##else
	#set($imageboxsource = $mediaarchive.asLinkToGenerated($asset, "image3000x3000"))
	
	<div class="$detailviewercolumnclass asset-data-detail emdatafield-$!viewtype p-3">
		##set($collection =  $asset.getValue("faceprofiles"))
		<div class="emfield-scroll" id="entitypickerentityperson">
			#set( $facemanager = $mediaarchive.getBean("faceProfileManager") )
			#set($faceboxescollection =  $facemanager.collectFaceBoxesAllPeople($asset) )
			
			<ul class="entity-value-list d-flex flex-wrap">
				#foreach( $row in $faceboxescollection )
					
					#set( $box = $row.getEmbeddedData())	
					#set( $person = $row.getPerson() )
					
					<li class="position-relative facepf-item">
						<div class="d-flex align-items-center justify-content-between">
							<div>
								
								#set($link = "$!siteroot$applink/views/modules/asset/editors/facesshowsimilar/index.html?faceembeddedid=$box.getId()&hitssessionid=$!hits.sessionId")
								
								#if($row.timecodestart)
									#set($secs = $mediaarchive.formatMilliseconds($row.timecodestart))
									##TODO: Click on image to play video
								#end
								<a href="$link" 
									class="emdialog facepf showimagebox"
									data-showboxtarget="mediaplayer"
									data-dialogid="faceprofiledialog"
									data-moduleid="faceprofilegroup"
									data-location="${row.toJsonArray()}"
									data-width="${assetwidth}"
									data-height="${assetheight}"
									data-img="${imageboxsource}"
									title="[[See Similar Faces]]">
								</a>
							</div>
							<i class="bi bi-chevron-right mx-2 text-muted"></i>
							<div>
							#ifnotnull($person)
								#set($namefield = $mediaarchive.getSearcher("entityperson").getDetail("name"))
								#set($name = $mediaarchive.getSearcherManager().getValue($person, $namefield, $context.getLocale()))
								<a href="$link" 
									class="emdialog faceperson"
									data-showboxtarget="mediaplayer"
									data-dialogid="faceprofiledialog"
									title="[[View]] #text($name)">
									<span title="$!name">$!name</span>
								</a>
								#if($caneditasset) 
										<a href="$apphome/views/modules/asset/editor/faceprofiles/removefromprofile.html" 
											data-assetid="$!{asset.getId()}" 
											data-profileid="${box.id}" 
											class="ajax facepf-remove"
											data-targetdiv="editfaceprofiles" 
											title="[[Remove Person]]"></a>
									#end	
							#end
							#ifnull($person)
									#set($pickmoduleid = "entityperson")
									#set($link = "$!siteroot$applink/views/modules/asset/editors/facesshowsimilar/index.html?faceembeddedid=$box.getId()&hitssessionid=$!hits.sessionId")
									##TODO: Show ALL the related assets and let them pick a name
									#set($pickmodule = $mediaarchive.getCachedData("module", $pickmoduleid ))
									<a href="$link" 
										class="emdialog facepf-add"
										data-dialogid="dialogpicker${pickmoduleid}"
										data-width="1200"
										data-faceid="${box.id}"
										data-assetid="${asset.id}"
										data-hidefooter="true"
										title="[[Assign]] #text($pickmodule)"></a> 
							#end
							</div>
						</div>
					</li>
				#end	
			</ul>
			#if($$collection.isEmpty())
				<p class="text-muted">[[No faces Found]]</p>
			#end
			<hr class="m-0">
			
		</div>
	</div>
</div>
