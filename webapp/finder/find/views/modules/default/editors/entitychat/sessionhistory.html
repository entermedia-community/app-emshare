<div class="sessionhistory overflow-y">
  <div class="d-flex justify-content-center mt-3 mb-2">
    <a class="btn btn-accent ajax"  
		data-targetdiv="aichatsearch" 
		data-oemaxlevel="1" 
		data-createnew="true" 
		href="$edithome/sessionadd.html">
      <i class="bi bi-plus-lg mr-1"></i> [[New Session]]
    </a>
  </div>
  
  <hr>

  <p class="text-center small my-2">
    <strong>[[Session History]]</strong>
  </p>

  #set( $hits = $mediaarchive.query("channel").exact("dataid",$entity.id).exact("searchtype", $module.id).sort("refreshdateDown").search($context))

  #foreach($hit in $hits.getPageOfHits() )
    <div class="sessionhistory-item #if( $currentchannel.id == $hit.id ) active #end">

      <a class="ajax item d-flex flex-column" 
        data-targetdiv="aichatsearch"
        data-channel="$hit.id"
        data-oemaxlevel="1"
	      data-restorechannel="true"
	      href="$edithome/sessionrestore.html" 
        title="[[Retrieve this session]]">
		#ifnotnull($hit.user)
			#set($chatuser = $mediaarchive.getUser($hit.user) )
			#set( $userimageurl = $mediaarchive.asLinkToUserProfile($chatuser))
			#ifnull($userimageurl) #set( $userimageurl = "${edithome}/chatterbox/images/user.svg" ) #end
			<div class="chat-icon">
			<a href="#esc($userlink)" title="$chatuser.getAnonNickName()" class="msg-avt">
				<img src="${userimageurl}" class="img-fluid">
			</a>
			</div>
		#end
        #ifnull($hit.name)
          #if($foreach.count == 1)
            <span class="text-muted">[[Current Session]]</span>
          #else
            <span class="text-muted">[[Session]] #$foreach.count</span>
          #end
        #end
        <small class="text-muted">#datetime($hit.refreshdate)</small>
      </a>

      <a class="ajax del" data-targetdiv="aichatsearch" data-oemaxlevel="1" data-id="$hit.id" data-confirm="[[Sure you want to delete session?]]" href="$edithome/sessiondelete.html" title="[[Delete this session]]"> 
        <i class="far fa-trash-alt"></i>
      </a>

    </div>
  #end

</div>