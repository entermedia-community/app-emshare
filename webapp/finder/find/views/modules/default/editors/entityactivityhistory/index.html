#set($entityid = $context.getRequestParameter("entityid"))
#if(!$parentsearchtype)
	#set($parentsearchtype = $context.getRequestParameter("parentsearchtype"))
#end
$context.putPageValue("parentsearchtype", $parentsearchtype)

#if( !$entity)
	#set( $entity  = $mediaarchive.getData($parentsearchtype, $entityid) )
#end
#set($entityid = $entity.id)

<div id="$edithomeid" 
	class="editdiv entity-tab-content entity-tab-media tabtypemedia" 
	data-entityid="$!entity.id"
	data-entitymoduleid="$!entitymodule.id"
	data-entitymoduleviewid="$entitymoduleviewid"
	data-edithome="$!{edithome}"
>
	<div id="entityactivityhistoryhistory" class="entiytabhistory p-2">
		 
		#set( $assetActivityHistory =  $mediaarchive.getEntityManager().loadHistoryForEntity($applicationid, $context.getUser(), $module, $entity))
		#if($assetActivityHistory.isEmpty())
			<p>[[History Is Empty]]</p>
		#end
		#if(!$assetActivityHistory.isEmpty())
		<table class="emdata table table-striped table-hover">
			<thead>
				<tr class="tableheader">
						<th style="width: 200px;">[[Date]]</th>
						<th>[[User]]</th>
						<th>[[Activity]]</th>
						<th>[[Details]]</th>
						<th style="width: 200px;">[[Undo]]</th>
					</tr>
			</thead>
			<tbody>
				#foreach($activity on $assetActivityHistory)
					<tr>
						<td>$!context.getDateTime($activity.get("date"))</td>
						<td>$activity.getValue("user")</td>
						<td>
							#set($operation = $activity.get("operation"))
							#set($operaionName = $mediaarchive.getCachedData("historyactivitytype", $operation))
							
							#text($operaionName)
						</td>
						<td>
							#if($activity.moduleid == "asset")
								#set($assetids = $activity.getValue("assetids"))
								#if($assetids.size()>3)
								<span class="trim-text" data-max="100">
								#end
								#foreach($assetid in $assetids)
									#set($asset = $mediaarchive.getAsset($assetid))
									#if($asset)
										$asset.getName()
										#if($foreach.hasNext), &nbsp;#end
									#else
										$assetid
									#end
								#end
								#if($assetids.size()>3)</span>
								<button class="see-more-btn see-more" data-seemore="(...[[see more]])" data-seeless="(...[[see less]])">(..[[.see more]])</button>
								#end
							#else
								#set($details = $activity.getValue("historydetails"))
								$!details
							#end
							</td>
						<td>
							#if($activity.moduleid == "asset")
								#if($operation == "assetsremoved")
									<a href="#" class="btn btn-xs btn-dark">[[Restore]]</a>
								#elseif($operation == "assetsadded")
									<a href="#" class="btn btn-xs btn-dark">[[Remove]]</a>
								#end
							#else
								<a href="${edithome}/restoresnapshot.html" 
									class="btn btn-xs btn-dark ajax"
									data-oemaxlevel="1"
									data-historyid="$activity.getId()"
									data-entityid="$entity.getId()"
									data-toastsuccess="[[Restore Complete]]"
									data-targetdiv="$edithomeid">[[Restore]]</a>
							#end
						</td>
					</tr>
				#end
			</tbody>
		</table> 
		#end
	</div>
</div>
