#ifnull($entitymoduleviewid) 
	#set($entitymoduleviewid = $context.getRequestParameter("entitymoduleviewid"))
	
#end
#set($viewdata = $mediaarchive.getCachedData("view",$entitymoduleviewid))

<div class="bg-white" id="editentitymetadata">
  <div class="w-100 my-2 px-2">
    <form
			class="ajaxform autocloseform checkCloseDialog "
			data-includeeditcontext="true"
			data-targetdiv="importdone"
			action="$edithome/finish.html"
			data-toastmessage="[[Creating]] #text($submodule) [[with AI]]"
			data-toastsuccess="[[Created]] #text($submodule) [[successfully]]"
			data-toasterror="[[Failed to create]] #text($submodule)">
			
			<input type="hidden" name="functionname" value='createEntity'/>
			
			<input type="hidden" name="entitymoduleviewid.value" value='$context.getRequestParameter("entitymoduleviewid")'/>
			<input type="hidden" name="field" value="entitymoduleviewid" />
			
			<input type="hidden" name="save" value='true'/>

			<input type="hidden" name="field" value="entityid" />
			<input type="hidden" name="entityid.value" value='$!entity.id'/>

			<input type="hidden" name="field" value="entitymoduleid" />
			<input type="hidden" name="entitymoduleid.value" value="$!module.id" />
			
			<input type="hidden" name="field" value="contentcreatortype" />
			<input type="hidden" name="contentcreatortype.value" value="entity" />

##			$context.putPageValue("viewid", "contentcreatortoplevel")
##			$context.putPageValue("details",null)
##			$context.putPageValue("searcher",$mediaarchive.getSearcher("contentcreator"))
			
##			<div class="updateaitemplate #if($customprompt) customized #end"
##				data-template="$edithome/aitools/createassetinstructions.html"
##				data-targetarea="aiInstruction">
##				$pages.include("$apphome/components/xml/detaileditor-entities.html", $context)
##			</div>
		
			<label for="aiInstruction" class="mb-1">[[AI Prompt]]</label>
			<input type="hidden" name="field" value="llmprompt" />
			<textarea name="llmprompt.value" id="aiInstruction" class="form-control rounded" rows="8" required autocomplete="off" data-gramm="false">$pages.include("$edithome/createentityinstructions.html", $context)</textarea>
			
			<div class="d-flex align-items-center mt-3">
				<button type="submit" class="btn btn-cta mr-3">
					<i class="bi bi-brush mr-1"></i>
					[[Create with AI]]
				</button>
				<button id="closebutton" type="button" class="btn btn-secondary" data-dismiss="modal">[[Cancel]]</button>
			</div>
    </form>
    <div id="importdone"></div>
  </div>
</div>
