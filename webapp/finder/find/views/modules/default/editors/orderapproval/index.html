##<div class="maincontentlayout" id="myaccountcontent" style="margin:0; height: 100%; overflow-y: auto;">

<form class="ajaxform" data-targetdiv="itemsaved" id="itemsave" name="itemform" method="POST" 
	action="${edithome}/saveitems.html" >
	<div class="d-flex">
	
	
	<div class="pl-2"style="width: 60%;">
		
	    #set($orderitemsearcher = $searcherManager.getSearcher($catalogid, "orderitem"))
	    #set($ordersearcher = $searcherManager.getSearcher($catalogid, "order"))
	    
	    #set($owner = $userManager.getUser($order.userid))
	
		<div class="row no-gutters">
				<div class="col-md-12 editor-data-detail emdatafield-default">
				<div class="container-fluid">
					   <div class="row">
							<div class="col-md-3 col-lg-2 col-emdatafield">
								<label class="emdatafield" data-field="name">
										[[Requester]]
								</label>				
							</div>
							<div class="col-md-9 col-lg-9">
								<div id="detail_name" class="emdatafieldvalue ">
								<div class="emdatafieldvalue-readonly">
								   <div class="emdatafieldreadonly emdatafieldreadonly-default">
									$owner.getName() $owner.get("lastname")
								    (<a href="$home/$applicationid/views/settings/users/usermanager/user/index.html?username=$owner.id" style="text-decoration: underline;">$owner</a>)
								   </div>
								</div> 
								</div>
							</div>
						</div>
				</div>
		</div>
		</div>
		<input type="hidden" name="id" value="$order.id"/>
	    <input type="hidden" name="orderid" value="$order.id"/>
	    <input type="hidden" name="sourcepath" value="$order.sourcepath"/>
	
	    #set($details = $mediaarchive.getAssetSearcher().getDetailsForView("assetorderitems",$context.getUserProfile()) )
	    #foreach( $detail in $details )
	     #if($detail.isEditable())
	    	<input type="hidden" name="field" value="$detail.id" />
	      #end
	    #end
	   
	    $context.putPageValue("searcher", $ordersearcher)	 
	    $context.putPageValue("viewid", "orderviewcheckoutorder")	
	    $context.putPageValue("data", $order)
	    
	    $pages.include("/$applicationid/components/xml/detaileditor.html?detailsreadonly=false", $context)
    
    	<div style="padding:10px 0 20px;">
            <input class="btn btn-primary" type="submit" id="save" name="Save" value="[[Save]]"/>
			<button id="closebutton" type="button" class="btn btn-secondary" data-dismiss="modal">[[Cancel]]</button>
        </div>
        <div id="itemsaved">		</div>
        
	</div>
	
	
	<div  class="pl-4" style="width: 40%;">
		#if($orderitems)
		<div class="d-flex  justify-content-end">
		<input class="btn btn-sm btn-primary mr-2" type="button" id="approveall" value="[[Approve All]]"/>
		<input class="btn btn-sm btn-primary mr-2" type="button" value="[[Reject All]]" id="rejectall">
		
		<input class="btn btn-sm btn-primary" type="button" name="Send" id="sendnotification" value="[[Send Notification]]"/>
		</div>
		
		<div id="itemsent" class="text-right py-3">		
			#if($order.get("lastnotified"))
				[[Last Notified]]:	<strong>$context.getDateTime($order.get("lastnotified"))</strong>
			#end</div>
		
			
	    <table class="emdata table table-striped table-hover border">
			<thead>
	        <tr class="tableheader">
	            <th>[[Asset]]</th>
	            <th style="width: 150px;">[[Status]]</th>
	        </tr>
	    	</thead>
	   		 ##TODO: Use another form or ajax to deal with items
	    
	        #foreach( $item in $orderitems )
	        	#set($asset = false)
				#set( $asset = $mediaarchive.getAsset($item.assetid))
	        	
	        	#if( $asset )
					$context.putPageValue("asset", $asset)
					$context.putPageValue("item", $item)
					$context.putPageValue("order", $order)
					$context.setRequestParameter("sourcepath", $asset.sourcepath)
					$pages.include("$apphome/components/orders/row.html", $context)
	            #else
	                <tr><td>[[Asset missing]]</td></tr>
	            #end
			
	        #end
	    
	    </table>
		
		#else
			[[No assets in order]]
		#end
		
	    
		</div>
	
</div>
</form>
<div style="display: none;">
		  <form id="emailform" class="ajaxform" data-targetdiv="itemsent" name="emailform" 
		  	action="${edithome}/sendnotification.html">
		    <input type="hidden" name="to" value="$owner.email"/>
		    <input type="submit" name="Notification" value="[[Send Notification]]"/>
		    <input type="hidden" name="id" value="$order.id"/>
		    </form>
		</div>
##</div>
    
   



    

<script type="text/javascript">

lQuery("#approveall").livequery("click", function (e) {
	jQuery("#itemsave .statusfield").val("approved");
	$("#itemsave #checkoutstatusvalue").val("approved").trigger("change", true);
	e.preventDefault();
	jQuery("#itemsave").trigger("submit");
	##jQuery("#itemsent").remove();
	return false;
} );
lQuery("#sendnotification").livequery("click", function (e) {
	jQuery("#emailform").submit();
	return false;
} );

lQuery("#rejectall").livequery("click", function () {
	jQuery("#itemsave .statusfield").val("rejected");
	jQuery("#itemsave #list-checkoutstatus").val("rejected").trigger("change", true);
	jQuery("#itemsave").submit();
	##jQuery("#itemsent").remove();
	return false;
} ); 

</script>



