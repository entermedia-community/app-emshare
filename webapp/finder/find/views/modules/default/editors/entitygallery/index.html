#set($lightboxid = $context.getRequestParameter("lightboxid"))
<div id="tabexportcontent" class="editdiv entitytabcolumcontent">
<div id="publishingcontainer" class="tabpulications" style="height: 100%;">
	<div class="tabpulications-col overflow-y" style="padding:10px 20px;  flex: 0 0 500px;">
	
	<form action="${edithome}/save.html" 
	class="ajaxform mt-1" 
	data-targetdiv="tabexportcontent">
		<div class="form-group">
			<div class="form-check form-check-inline">
				<input type="hidden" value="enabled" name="field" />
				<input class="form-check-input wg-autosave" type="checkbox" id="wgEnabledLabel" value="true" name="enabled.value" #if($publishing.enabled=="true")checked#end style="padding-bottom: 2px;">
				<label class="form-check-label text-brand fw-bold" for="wgEnabledLabel">[[Enable Gallery]]</label>
			</div>
		</div>

		<div class="#if($publishing.enabled!="true")disabled-mask#end">

			<div class="d-flex">
				<div class="form-group mb-1">
					<input type="hidden" value="lightboxid" name="field" />
					<label class="form-select-label	" for="wgSortLabel">[[Lightbox]]</label>
					<br>
					
					#ifnull($lightboxid)
						#set($lightboxid = $publishing.lightboxid)
					#end
					
					#set($boxes =  $mediaarchive.getEntityManager().loadLightBoxesForModule($module, $entity, $context.getUser()))
					
					<select class="form-control form-control-sm form-select form-select-sm wg-autosave" id="wgSortLabel" name="lightboxid.value">
						<option value="">[[All Files]]</option>
						#foreach( $box in $boxes)
							<option value="${box.id}" 
									#if($lightboxid == $box.id)) 
										selected="selected" 
									#end>#text($box)</option>
							#end
					</select>
				</div>
				
				<div class="form-group mb-1">
					<input type="hidden" value="sortby" name="field" />
					<label class="form-select-label	" for="wgSortLabel">[[Sort By]]</label><br>
					#set($publishingSortby = $publishing.sortby)
					#ifnull($publishingSortby)
						#set($publishingSortby = "orderingDown")
					#end
					
					#set ($alldetails = $mediaarchive.getAssetSearcher().getUserPropertyDetails() )
					<select data-sortup="$hits.searchQuery.isSortUp()" 
							class="form-control form-control-sm form-select form-select-sm select2  wg-autosave" 
							name="sortby.value" 
							id="$!{moduleid}dialogsortby" 
							data-allowclear="false">
						#foreach( $detail in $alldetails)
							#set($value = "${detail.id}")
							
							<option data-detailid="${detail.id}" 
									value="$value" 
									#if($publishingSortby== "${detail.id}") 
										selected="selected" 
									#end>$detail.getText($context)</option>
							<option data-detailid="${detail.id}" 
									value="${value}Down" 
									#if($publishingSortby== "${detail.id}Down")
										selected="selected" 
									#end>$detail.getText($context) ([[Desc]])</option>
						#end
					</select>
				</div>
			</div>

			<div class="form-group">
				<div class="form-check form-check-inline">
					<input type="hidden" value="title_enabled" name="field" />
					<input class="form-check-input wg-autosave" type="checkbox" id="wgTitleLabel" value="true" name="title_enabled.value" #if($publishing.title_enabled=="true")checked#end>
					<label class="form-check-label" for="wgTitleLabel">[[Gallery Title]]</label>
				</div>
				<input type="hidden" value="title" name="field" />
				<input  class="form-control wg-autosave"  placeholder="[[Enter Title here]]" name="title.value" value="$!publishing.title">
			</div>
			
			<div class="form-group">
				<div class="form-check form-check-inline">
					<input type="hidden" value="caption_enabled" name="field" />
					<input class="form-check-input wg-autosave" type="checkbox" id="wgCaptionLabel" value="true" name="caption_enabled.value" #if($publishing.caption_enabled=="true")checked#end>
					<label class="form-check-label" for="wgCaptionLabel">[[Gallery Subtitle]]</label>
				</div>
				<input type="hidden" value="caption" name="field" />
				<textarea  class="form-control wg-autosave" name="caption.value">$!publishing.caption</textarea>
			</div>

			<div class="form-group">
				<div class="form-check form-check-inline">
					<input type="hidden" value="image_caption_enabled" name="field" />
					<input class="form-check-input wg-autosave" type="checkbox" id="wgImageCaptionLabel" value="true" name="image_caption_enabled.value" #if($publishing.image_caption_enabled=="true")checked#end>
					<label class="form-check-label" for="wgImageCaptionLabel">[[Show Image Captions]] [[(visible on popup)]]</label>
				</div>
			</div>

			<div class="form-group">
				<div class="form-check form-check-inline">
					<input type="hidden" value="image_copyright_enabled" name="field" />
					<input class="form-check-input wg-autosave" type="checkbox" id="wgImageCopyrightLabel" value="true" name="image_copyright_enabled.value" #if($publishing.image_copyright_enabled=="true")checked#end>
					<label class="form-check-label" for="wgImageCopyrightLabel">[[Show Copyright/Author]]</label>
				</div>
			</div>

			<div class="form-group">
				<div class="form-check form-check-inline">
					<input type="hidden" value="download_enabled" name="field" />
					<input class="form-check-input wg-autosave" type="checkbox" id="wgDownloadtLabel" value="true" name="download_enabled.value" #if($publishing.download_enabled=="true")checked#end>
					<label class="form-check-label" for="wgDownloadtLabel">[[Show Download Button]]</label>
				</div>
			</div>

			<div class="form-group">
				<div class="form-check form-check-inline">
					<input type="hidden" value="footer_enabled" name="field" />
					<input class="form-check-input wg-autosave" type="checkbox" id="wgFooterLabel" value="true" name="footer_enabled.value"  #if($publishing.footer_enabled=="true")checked#end>
					<label class="form-check-label" for="wgFooterLabel">[[Footer]]</label>
				</div>
				<input type="hidden" value="footer" name="field" />
				<input  class="form-control wg-autosave"  placeholder="[[Enter Footer here]]" name="footer.value" value="$!publishing.footer">
			</div>

			<div class="form-group">
				<div class="form-check form-check-inline">
					<input type="hidden" value="externalcss_enabled" name="field" />
					<input class="form-check-input wg-autosave" type="checkbox" id="wgExternalCSSLabel" value="true" name="externalcss_enabled.value"  #if($publishing.externalcss_enabled=="true")checked#end>
					<label class="form-check-label" for="wgExternalCSSLabel">[[External CSS]]</label>
				</div>
				<input type="hidden" value="externalcss" name="field" />
				<input  class="form-control wg-autosave"  placeholder="[[External CSS Link]]" name="externalcss.value" value="$!publishing.externalcss">
			</div>

			<div class="form-group mb-1">
				<input type="hidden" value="publishingfeedlayout" name="field" />
				<label class="form-select-label me-1" for="wgThemeLabel">[[Theme]]</label>
				<select class="form-select form-select-sm wg-autosave" id="wgThemeLabel" name="publishingfeedlayout.value">
					<option value="light" #if($publishing.publishingfeedlayout!="dark") selected #end>Light</option>
					<option value="dark" #if($publishing.publishingfeedlayout=="dark") selected #end>Dark</option>
				</select>
			</div>

			#set($containerwidth = 1000)
			#if($publishing.containerwidth > 0)
				#set($containerwidth = $publishing.containerwidth)
			#end
			#set($containerheight = 824)
			#if($publishing.containerheight > 0)
				#set($containerheight = $publishing.containerheight)
			#end

			<div class="form-group">
				<div class="form-check form-check-inline">
					<input type="hidden" value="containerdimension_enabled" name="field" />
					<input class="form-check-input wg-autosave" type="checkbox" id="wgCDLabel" value="true" name="containerdimension_enabled.value"  #if($publishing.containerdimension_enabled=="true")checked#end>
					<label class="form-check-label" for="wgCDLabel">[[Use Fixed Dimension]]</label>
				</div>
				<input type="hidden" value="containerwidth" name="field" />
				<input type="hidden" value="containerheight" name="field" />
				<div class="d-flex align-items-center">
					<input  class="form-control wg-autosave"  placeholder="[[Width]]" name="containerwidth.value" value="$containerwidth" type="number" #if($publishing.containerdimension_enabled!="true")disabled#end>
					<span class="mx-2">&times;</span>
					<input  class="form-control wg-autosave"  placeholder="[[Height]]" name="containerheight.value" value="$containerheight" type="number" #if($publishing.containerdimension_enabled!="true")disabled#end>
				</div>
				<small class="text-muted">[[Uses container width and height if disabled]]</small>
			</div>

			<input type="hidden" value="entityid" name="field" />
			<input type="hidden" name="entityid.value" value="$!entity.id" />
			<input type="hidden" value="distributiontype" name="field" />
			<input type="hidden" name="distributiontype.value" value="gallery" />
			#if($publishing)
				<input type="hidden" name="publishingid" value="$!publishing.id" />
				<input type="hidden" name="id.value" value="$!publishing.id" />
			#end
			
			<input type="hidden" name="searchtype" value="distributiongallery" />
			<input type="hidden" name="field" value="moduleid" />
			<input type="hidden" name="moduleid.value" value="$!module.id" />
			<input type="hidden" name="parentviewid" value="$!viewid" />
			<input type="hidden" name="entityid" value="$!entity.id" />
			<input name="save" type="hidden" value="true">
			
			#set($overrideligthboxid = $context.getRequestParameter("lightboxid"))
			#ifnotnull($overrideligthboxid)
				#if($overrideligthboxid != $publishing.ligthboxid)
					<div class="my-2">[[Press Update to update the file source]]</div>
				#end
			#end
			
			<div class="d-flex align-items-center pt-2">
				<button type="submit" class="btn btn-brand btn-savepublishing rounded" style="padding-top: 6px;">
					<i class="bi bi-save ns me-1"></i> [[Update]]
				</button>
				<span class="text-success ms-2" id="wgAutoSaved" style="display: none;">
					<i class="bi bi-check-lg"></i> [[Saved]]
				</span>
			</div>
		</div>

		
		#if($publishing.enabled=="true")
			<div class="p-1 border my-3 rounded bg-light">
				#set( $link = "$!siteroot/$mediadbappid/services/publishingdestination/view/${publishing.id}")
				<div class="p-1 mb-2">
					<strong>[[Link]]:</strong>
					<textarea class="embedlinktextarea form-control" id="embedcode" onclick="this.select();" readonly="readonly" rows="3" cols="45">$link</textarea>
					
					<a href="$link" class="my-1 px-2 btn btn-xs btn-outline-brand" title="[[Open]]" target="_blank"><i class="bi bi-link ns me-1"></i> [[Open]]</a>
					<a href="#"
						class="my-1 px-2 copytoclipboard btn btn-xs btn-outline-brand"
						data-copytarget="embedcode"
						title="[[Copy to Clipboard]]">
						<i class="bi bi-copy ns me-1"></i> [[Copy]]
					</a>
				</div>
				<hr>
				<div class="p-1">
					<strong>&lt;[[iframe]]&gt; code:</strong>
					<textarea class="iframelinktextarea form-control" id="iframecode" onclick="this.select();" readonly="readonly" rows="4" cols="45"><iframe src="$!siteroot/$mediadbappid/services/publishingdestination/gallery/${publishing.id}" frameborder="0" style="width: 100%; height: 100%; border: 0;"></iframe></textarea>
					<a href="#"
						class="my-1 px-2 copytoclipboard btn btn-xs btn-outline-brand"
						data-copytarget="iframecode"
						title="[[Copy to Clipboard]]">
						<i class="bi bi-copy ns me-1"></i> [[Copy]]
					</a>
				</div>
				#if( $canviewsettings )
				<div class="p-1 mb-2" style="word-break:break-all">
					<strong>[[OEmbed Debug]]:</strong>
					<br>
					#set( $url = "$!siteroot/$mediadbappid/services/publishingdestination/oembed?url=$link")
					<a href="$url" class="" title="View" target="_blank">$url</a>
				</div>
				#end
			</div>
		#end
	</form>
</div>


<div class="tabpulications-col h-100">
	<div class="p-1 overflow-hidden bg-light"  style="height: 100%">
		#if($publishing.enabled == "true")
			<iframe src="$!siteroot/$mediadbappid/services/publishingdestination/view/${publishing.id}" style="width: 100%; height: 100%; border: 0;"></iframe>
		#else
			<div class="d-flex justify-content-center align-items-center h-100">
				<div class="text-center text-brand">
					<h3>[[Please click "Enable" to load the Preview]]</h3>
				</div>
			</div>
		#end
	</div>
</div>
</div>


