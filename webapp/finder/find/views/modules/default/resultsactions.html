##Header for Modules (not asset)

#set($moduleid = $module.id)
$context.putPageValue("moduleid", $moduleid)

#if(!$topmoduleid)
	#set($topmoduleid = $context.getRequestParameter("topmoduleid"))
#end
#set( $fieldexternalid = $context.getRequestParameter("fieldexternalid"))
#set( $fieldexternalvalue = $context.getRequestParameter("fieldexternalvalue"))
#ifnull($entityid)
	#set($entityid = $context.getRequestParameter("entityid"))
#end

#if(!$tabletype)
	#set($tabletype = $context.getRequestParameter("tabletype"))
#end

#set($resulttype = $userprofile.get("${moduleid}-display"))
#if(!$resulttype)
	#set($resulttype = "table")
#end
$context.putPageValue("resulttype", $resulttype)

#set( $edit = $context.getRequestParameter("editheader"))
#if( !$edit || $edit == "false")
	#set( $edit = false)
#end

#set($entityrendertype = "entity")
#if ($module.modulerendertype)
	#set($entityrendertype = $module.modulerendertype)
#end
$context.putPageValue("entityrendertype", $entityrendertype)

#set($defaultview = $userprofile.getDefaultViewForModule($module.id) )

#if(!$resultview)
	#set($resultview = $userprofile.get("$!{module.getId()}resultview"))
	
	#if (!$resultview)
		#set($resultview = $content.get("resultview"))
	#end
	#if (!$resultview)
		#set($resultview = "table")
	#end
#end

<div id="resultsheader" class="resultsheader #if($!hits.getSelectionSize() > 0)hasselections#end">
	<div id="sub-nav" class="search-views emsubnav sub-nav-$!moduleid">
		<ul class="resultsnav">
			#set($pickertarget = $context.getRequestParameter("pickertarget"))
			#ifnull($pickertarget)
				#if($permissions.can($moduleid, "create") && $moduleid!="faceprofilegroup" && $moduleid!="order")
					<li>
						#if($topmoduleid)
							#set($addnew = "$!{siteroot}${apphome}/views/modules/${moduleid}/components/entities/addnew.html")
							<a class="resultsnavlink emdialog"
							data-dialogid="entitypickeraddnew"
							data-hidefooter="true"
							data-targetdivinner="pickersearchentities"
							data-ajaxreloadtargets="onetomanytab"
							data-fieldexternalid="$!fieldexternalid"
							data-fieldexternalvalue="$!fieldexternalvalue"
							href="$addnew"
							title="[[Create New]] #text($entity)">
							<i class="bi bi-plus-lg mr-1"></i> [[Create New]]</a>
						#else
							#set($addurl = "$!{siteroot}${apphome}/views/modules/${moduleid}/components/gridsample/preview/$!{entityrendertype}.html?edit=true&addnew=true&viewid=$!{moduleid}addnew")
							#ifnotnull($topentityid)
								#set($addurl = "$addurl&fieldexternalid=${topmodule.getId()}&fieldexternalvalue=${topentityid}&reloadtargets=topmodulecontainer")
							#end
							<a class="emdialog resultsnavlink" href="$addurl" title="[[Add New Record]]">
								<i class="bi bi-plus-lg mr-1"></i> [[Create New]]
							</a>
						#end
					</li>
				#end
			#end
			#if($resultview != "grid")
			<li class="dropdown">
				<a class="resultsnavlink dropdown-toggle #if($!hits.getSelectionSize() > 0)btn-accent#end" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					#if($!hits.getSelectionSize() > 0)
						[[Folders]] ($!hits.getSelectionSize())
					#else
						[[Folders]]
					#end
				</a>
				<ul class="dropdown-menu">
				
					<li class="dropdown-submenu">
					<a class="dropdown-item  dropdown-toggle" href="#" data-bs-toggle="dropdown">[[Select]]</a>
						<ul class="submenu dropdown-menu">
							<li>
						<a class="dropdown-item ajax  selectpage" 
						targetdiv="resultsheader" 
						href="$!{siteroot}${apphome}/views/modules/${moduleid}/components/results/togglepage.html?oemaxlevel=1&hitssessionid=$hits.getSessionId()&action=all"
						title="[[Select All results]]">[[Select All]]</a>
						</li>
						<li>				
						<a class="dropdown-item ajax selectpage" 
						targetdiv="resultsheader" 
						href="$!{siteroot}${apphome}/views/modules/${moduleid}/components/results/togglepage.html?oemaxlevel=1&hitssessionid=$hits.getSessionId()&action=page"
						title="[[Select this page of results]]">[[Select Only This Page]]</a>
						</li>
						<li>
						<a class="dropdown-item ajax  deselectpage" 
						targetdiv="resultsheader" 
						href="$!{siteroot}${apphome}/views/modules/${moduleid}/components/results/togglepage.html?oemaxlevel=1&hitssessionid=$hits.getSessionId()&action=none"
						title="[[Deselect all results]]">[[Select None]]</a>
						</li>
					</ul>
					</li>	
					
				#if( $!hits.getSelectionSize() > 0)
					
					#if($permissions.can($moduleid, "edit"))
					#set($previewediturl = "$!{siteroot}${apphome}/views/modules/${moduleid}/components/gridsample/preview/$!{entityrendertype}.html?entityid=multiedit:$!hits.sessionId&hitssessionid=$!hits.sessionId&searchtype=$moduleid&edit=true")
					<li><a class="dropdown-item emdialog" 
						href="$previewediturl"
						title="[[Multi edit selected items]]">[[Bulk Edit]] $!hits.getSelectionSize() [[Records]]</a>
					</li>
					#end
					
					#ifnull($tabid)
					#set($tabid = $context.getRequestParameter("tabid"))
					#end
					#ifnull($topmoduleid)
					#set($topmoduleid = $context.getRequestParameter("topmoduleid"))
					#end
					#ifnull($viewid)
					#set($viewid = $context.getRequestParameter("viewid"))
					#end
					
					#if($permissions.can($moduleid, "delete"))
						 <li><a class="dropdown-item ajax" 
						 data-confirm="[[Delete items?]]" 
						 #if($tabletype=="subentity")
							 data-oemaxlevel="2" 
							 data-targetdiv="$tabid" 
							 data-tabletype="$tabletype"
							 data-viewid="$viewid"
							 data-entityid="$entityid"
							 data-topmoduleid="$topmoduleid"
							 href="$!{siteroot}${apphome}/views/modules/${moduleid}/actions/deleteselections.html?hitssessionid=$hits.sessionId&module=$!{module.id}"
						 #else
							 data-oemaxlevel="2" 
							 data-targetdiv="$!{moduleid}resultscontainer" 
							 href ="$!{siteroot}${apphome}/views/modules/${moduleid}/actions/deleteselections.html?hitssessionid=$hits.sessionId&module=$!{module.id}"
						 #end
						 title="[[Delete selected items]]">[[Delete]] $!hits.getSelectionSize() [[Records]]</a></li>
					#end
					
					<li class="dropdown-submenu">
						<a class="dropdown-item  dropdown-toggle" href="#" data-bs-toggle="dropdown">[[Export]]</a>
							<ul class="submenu dropdown-menu">
								<li><a class="dropdown-item" href="$!{siteroot}${apphome}/views/modules/${moduleid}/export/download/export_${moduleid}.csv?hitssessionid=$hits.sessionId"
									title="[[Export reults to CSV]]">[[Export]]  $!hits.getSelectionSize() [[Records Using IDs]]</a></li>
								<li><a class="dropdown-item" href="$!{siteroot}${apphome}/views/modules/${moduleid}/export/download/export_${moduleid}.csv?hitssessionid=$hits.sessionId&friendly=true&view=${moduleid}/${moduleid}resultstable"
									title="[[Export results to CSV (Friendly)]]">[[Export]] $!hits.getSelectionSize() [[Records Using Text]]</a></li>
							</ul>
					</li>
					
					
				#if($canaddtofavorites && $librarycol.id != "${user.id}-favorites" )
				<li><a class="dropdown-item ajax"
					data-targetdivinner="empty"
					data-alertmessage="[[Added to User Bookmarks]]"
					data-oemaxlevel="2" 
				title="[[Add To User Bookmarks]]"  
				href="$!{siteroot}${apphome}/views/modules/asset/editor/favorite/favorite-add-multi.html?hitssessionid=$hits.getSessionId()"
				><i class="bi bi-bookmark-fill mr-2"></i> [[Bookmark]]</a></li>
				#end
				#if($permissions.can("searchcategory", "create"))
					#set($addurl = "$!{siteroot}${applink}/views/modules/searchcategory/components/entities/search/searchpicker.html") 
					<li><a 
					class="dropdown-item emdialog" 
							href="$addurl" 
							data-viewfiles="true"
							data-pickertarget="addtocategory"
							data-copyingsearchtype="$moduleid"
							data-copyinghitssessionid="$hits.getSessionId()"	
							title="[[Add To Category]]"
							data-width="1200"><i class="bi bi-category mr-2"></i>[[Assign]] #text( $mediaarchive.getCachedData("module","searchcategory") )</a></li>
			 	#end	
			#end ##Selection					
			
			</ul>
		</li>
		#end
				
			#if($resultview == "grid")
				#if($hits.getTotalPages() >  1  )
					$pages.include("${apphome}/views/modules/${moduleid}/navigate.html", $context)
				
				#end
			#end
				
			#if($moduleid != "faceprofilegroup")
				#if(!$edit)
				
					#if($hits && $resultview == "table" && $hits.hasSelections())
					
						$pages.include("${apphome}/views/modules/${moduleid}/selectionactions.html", $context)
					#end
				#end
			#end
			
			##<li> <div id="resultsmessages"></div> </li>
			
			
		</ul>
			
		#if($hits)
			<ul class="resultsnavright">
				#if($edit != "true")
					#set($total = $hits.getTotalPages() )
					#if( $total > 1)
						
							$pages.include("${apphome}/views/modules/${moduleid}/components/results/positions.html", $context)
						
					#end
				#end

				#if (!$resultview || $resultview == 'table')
					#if($canedittablecolumns)
						#if($edit)
							<li class="resultsnavitem s2h" style="min-width:180px">
								#set ($alldetails = $searcher.getUserPropertyDetails() )
								<select class="form-control form-control-sm select2 tableresultsaddcolumn" 
										name="addcolumn"
										data-componenthome="$!{siteroot}${apphome}/views/modules/${moduleid}/components/results/addremovecolumns.html?searchtype=$!moduleid&hitssessionid=$hits.getSessionId()&editheader=true&moduleid=$!moduleid&viewid=$!{moduleid}resultstable"
										data-targetdiv="$!{moduleid}resultsarea"
										data-oemaxlevel="1" 
										data-allowclear="false" 
									>
									<option>[[Add Column]]</option>
									#foreach( $detail in $alldetails) 
										<option value="$detail.id">$detail.getText($context)</option>
									#end
								</select>
								##<span class="hint">*[[Drag columns to move them]]</span>
								<a href="$!{siteroot}${apphome}/views/modules/${moduleid}/components/results/resetcolumns.html?searchtype=$!moduleid&hitssessionid=$hits.getSessionId()&moduleid=$!moduleid&viewid=$!{moduleid}resultstable&$!{moduleid}clearresults=true"
									data-targetdiv="$!{moduleid}resultsarea"
									data-oemaxlevel="1"
									data-confirm="[[Are you sure you want to reset all columns?]]"
									class="ajax reset-columns">
									<i class="bi bi-arrow-counterclockwise mr-1"></i>
									[[Reset Columns]]
								</a>
							</li>
							##Close Icon
						#end	
					#end								
				#end
				
				<li>

					<a href="$!{siteroot}${apphome}/views/modules/${moduleid}/components/filters/dialogsort.html" 
						class="emdialog emsort #if($selectedpreference == "true") closed #end"
						data-dialogid="sortdialog"
						data-hidebackdrop="true"
						data-hidefooter="true"
						data-modalsize="sm"
						data-moduleid="$!{moduleid}"
						data-hitssessionid="$hits.getSessionId()"
						data-categoryid="$!categoryid"
						data-rootcategory="$!rootcategory"
						
						data-topmoduleid="$!{topmoduleid}"
						data-entityid="$!{entityid}"
						#if($tabletype =="subentity")
							data-fieldexternalid="$!fieldexternalid"
							data-fieldexternalvalue="$!fieldexternalvalue"
							data-tabletype="$!tabletype"
							data-targetdivsearch="tab_$!{viewid}"
							data-viewid="$!{viewid}"
						#else 
							data-targetdivsearch="$!{moduleid}resultscontainer"
						#end						
						style="padding:0 8px 0 10px;" 
						title="[[Sort Results]]"><i class="bi bi-sort-down"></i> [[Sort]]</a>
				</li>
				#if($resultview != "stackedgallery")
					<li class="resultsnavitem rpp" title="[[Results per page]]">
						#set( $currenthitsperpage = $hits.getHitsPerPage())
						#set($hitcountoptions = $mediaarchive.getList("hitcount"))
						<select class="form-control hitsperpagechange" id="hitsperpagechange$!{moduleid}">
							#foreach($ho in $hitcountoptions)
								<option value="$ho.id" #if($currenthitsperpage==$ho.id) selected="selected"#end>#text($ho)</option>
							#end	
						</select>
					</li>		
				#end
				#set($preference = "minimize$!{moduleid}summary")
				#set($selectedpreference = $userprofile.get($preference))
				#ifnull($selectedpreference)
					#set($selectedpreference = "true")
				#end
				<li class="resultsnavitem">
					<button class='btn summary-toggler summary-opener #if($selectedpreference == "true") closed #end' data-target="$preference">
						<i class="fas fa-angle-double-left"></i> [[Summary]]
					</button>
				</li>
			</ul>
		#end
	</div>
	$pages.include("${apphome}/views/modules/${moduleid}/components/filters/filters-inline.html", $context)
</div>

