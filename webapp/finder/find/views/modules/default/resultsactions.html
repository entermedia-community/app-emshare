#set($moduleid = $module.id)
$context.putPageValue("moduleid", $moduleid)

#set($defaultview = $userprofile.getDefaultViewForModule($module.id) )

##if($hits)
	
	#set($resulttype = $userprofile.get("${module.id}-display"))
	#if(!$resulttype)
		#set($resulttype = "table")
	#end
	$context.putPageValue("resulttype", $resulttype)
	
	#set($searchhome = $page.get("searchhome") )
	
	#set( $edit = $context.getRequestParameter("editheader"))
	#if( !$edit || $edit == "false")
		#set( $edit = false)
	#end
	
	#set($entityrendertype = "entity")
	#if ($module.modulerendertype)
		#set($entityrendertype = $module.modulerendertype)
	#end
	$context.putPageValue("entityrendertype", $entityrendertype)
	
	#if(!$resultview)
		#set($resultview = $userprofile.get("$!{module.getId()}resultview"))
		
		#if (!$resultview)
			#set($resultview = $content.get("resultview"))
		#end
		#if (!$resultview)
			#set($resultview = "stackedgallery")
		#end
	#end
	
		<div id="resultsheader" class="resultsheader">
		
		
		<div id="sub-nav" class="search-views emsubnav sub-nav-$!moduleid">
			#if($moduleid != "faceprofilegroup")
					<ul class="resultsnav">
					<li>
						#if($permissions.can($moduleid, "create"))
						<div class="" style="">
							<a class="btn-sm btn-blue emdialog " 
								style="margin-right: 5px;"
								data-updateurl="true" 
								data-targetdivinner="applicationmaincontent" 
								data-oemaxlayout="3" 
								href="$siteroot$applink/views/modules/${moduleid}/components/gridsample/preview/$!{rendertype}.html?edit=true&addnew=true&viewid=$!{module.id}addnew&targetdiv=applicationmaincontent"
								title="[[Add New]] #text($module)">
								<i class="fas fa-plus"></i> [[New]]</a>
						</div>
						#end
							
					</li>
						
					#if(!$edit)
						#if($hits && $resultview == "table" && $hits.hasSelections())
							$pages.include("$searchhome/selectionactions.html", $context)
						#end
					#end
					</ul>
				
			#end
	
		#if($hits)
		<ul class="resultsnavright">
				#set($total = $hits.getTotalPages() )
				#if( $total > 1)
				<li class="resultpages">	 
					$pages.include("/${searchhome}/components/results/positions.html", $context)
				</li>
				#end
				
				#if($resultview != "stackedgallery")
					<li class="resultsnavtitem" style="width:61px;">
							#set( $currenthitsperpage = $userprofile.get("modulehitsperpage"))
							#set($hitcountoptions = $mediaarchive.getList("hitcount"))
							<select class="form-control resultsnavselect" 
								id="hitsperpagechange"
									data-hitssessionid="$!hits.getSessionId()" 
									data-searchtype="$!reloadsearchtype"
									data-moduleid="$!moduleid"
									data-ismodulesearch = "$!ismodulesearch" 
									data-componenthome = "$apphome/views/modules/$moduleid/components"
									data-page="$!hits.getPage()" 
									data-showremoveselections="$!showremoveselections" 
									data-collectionid="$!librarycol.getId()"
									data-targetdiv="$!{moduleid}resultscontainer">
							#foreach($ho in $hitcountoptions)
							<option value="$ho.id" #if($currenthitsperpage==$ho.id) selected="selected"#end>#text($ho)</option>
							#end	
							</select>
					</li>		
				#end
				
			#if($edit != "true")
					<li class="resultsnavtitem">
						<select class="form-control" 
							name="resultview" 
							id="selectresultview"  
							data-hitssessionid="$!hits.getSessionId()" 
							data-searchtype="$!moduleid"
							data-moduleid="$moduleid"
							data-ismodulesearch = "$!ismodulesearch" 
							data-componenthome = "$apphome/views/modules/$moduleid/components"
							data-page="$!hits.getPage()" 
							data-showremoveselections="$!showremoveselections" 
							data-collectionid="$!librarycol.getId()"
							data-targetdiv="resultsviewcontainer$!moduleid"
							readonly="readonly">
							
							<option value="grid" #if( $resultview == "grid") selected #end>[[Grid]]</option>
							<option value="table" #if( $resultview == "table") selected #end>[[Table]]</option>
							##<option value="map" #if( $resultview == "map") selected #end>[[Map]]</option>
							
						</select>
						
					</li>
				
					##<li class="resultsnavtitem hidden-sm-xs hidden-xs hidden-sm hidden-md">
					##$pages.include("$apphome/views/modules/default/pages.html", $context) ## views/modules/default/navigate.html",$context)
					##</li>
				#end
			#if (!$resultview || $resultview == 'table')
				#if( $canedittablecolumns )
					#if( $edit )
						##Close Icon
						<li>
							<a class="ajax table-edit-close" 
								data-targetdiv="resultsviewcontainer$!moduleid" 
								href="$siteroot$componenthome/results/index.html?oemaxlevel=1&searchtype=$!moduleid&hitssessionid=$!hits.getSessionId()&editheader=&moduleid=$!moduleid"><i class="fas fa-times"></i></a>
						</li>
						<li class="resultsnavtitem" style="min-width:180px">
							#set ($alldetails = $searcher.getUserPropertyDetails() )
							<select class="form-control form-control-sm select2 tableresultsaddcolumn" 
									name="addcolumn"
									data-componenthome="$siteroot$componenthome/results/addremovecolumns.html?oemaxlevel=1&searchtype=$!moduleid&hitssessionid=$hits.getSessionId()&editheader=true&moduleid=$!moduleid&viewid=$!{moduleid}resultstable"
									data-targetdiv="resultsviewcontainer$!moduleid" 
									data-allowclear="false" >
								<option>[[Add Column]]</option>
								#foreach( $detail in $alldetails) <option value="$detail.id">$detail.getText($context)</option>
								#end
							</select>
						</li>
								
						<li class="resultsnavtitem">
							<span class="" style="padding-right: 10px;" >[[Drag columns to move them]]</span>
						</li>
					#else 
						##Edit
						<li >
							<a class="ajax nav-hover" 
								id="table-editor-close" 
								data-targetdiv="resultsviewcontainer$!moduleid" 
								href="$siteroot$componenthome/results/index.html?searchtype=$!searchtype&hitssessionid=$hits.getSessionId()&editheader=true&moduleid=$!moduleid"> <i class="fas fa-edit"></i></a>
						</li>
					#end	
				#end								
			#end
			
		
		</ul>
		#end
		
	</div>
	</div>
##end

	
	##<script type="text/javascript">
	##	//This should be moved out of here
	##	function refreshSelections() {
	##		jQuery('#moduleselections').load("$searchhome/selections/selected.html?oemaxlevel=1&searchtype=${module.id}&hitssessionid=$hits.getSessionId()");
	##	}
	##</script>
