#set($searchtype = $context.getRequestParameter("submodulesearchtype"))
#set($parentsearchtype = $context.getRequestParameter("parentsearchtype"))
#set($parentviewid = $context.getRequestParameter("parentviewid"))
#set($parentviewpath = $context.getRequestParameter("parentviewpath"))
#set($parentid = $context.getRequestParameter("parentid"))

#set ($fieldexternalid = $context.getRequestParameter("fieldexternalid"))
#set ($fieldexternalvalue = $context.getRequestParameter("fieldexternalvalue"))

#set($targetdiv = $context.getRequestParameter("parenttargetdiv"))

<div  id="search-entities-modal" class="searchonetomany" >
	<div id="searcharea" >
	
	#set($predata = $mediaarchive.getSearcher($searchtype).createNewData())
	$predata.setValue($fieldexternalid, $fieldexternalvalue)
	$context.putPageValue("data", $predata)
	
	$context.putPageValue("entitydialogeditor", "true")
	
	$pages.include("$apphome/views/modules/${searchtype}/edit/addnewentity.html?viewid=${searchtype}addnew&searchtype=${searchtype}&targetdiv=$!targetdiv")
	<div class="clearfix"></div>
	
<hr>
<h5 style="margin-bottom:10px;">[[Or Choose From Existing]]</h5>

	<form id="dialogsearchform" 
		style="margin-bottom:10px;" 
		class="autosubmit" 
		data-targetdiv="submodulepicker"
		data-oemaxlevel="1" 
		action="${page.directory}/generictablesearchresults.html"
		>
		
		<input type="hidden" name="searchtype" value="${searchtype}" />
		<input type="hidden" name="moduleid" value="${searchtype}" />
		<input type="hidden" name="sortby" value="name" />
		#if($fieldexternalid)
			<input name="operation" value="not" type="hidden">
			<input name="field" value="$fieldexternalid" type="hidden">
			<input name="${fieldexternalid}.value" value="$fieldexternalvalue" type="hidden">
		#end
		<table style="width:100%;">
		<tr>
		<td>

		<div  class="row inlinesearch" >
		<div class="col">
			<input name="operation" value="contains" type="hidden">
			<input name="field" value="description" type="hidden">
			<input type="text" class="form-control detail_name textinput autosubmited " 
					autocomplete="off" 
					value="" 
					id="name.value" 
					name="description.value"
					placeholder="[[Search]]">
		</div>	
		</div>
		</td>
		</tr>
		</table>
	</form>

	
	<div id="submodulepicker" 
		class="domdatacontext"
		data-targetdiv="$!targetdiv" 
		data-oemaxlevel="1" 
		data-submodulesearchtype="$!{searchtype}" 
		data-hitssessionid="$!hits.sessionId"
		data-fieldexternalid="$fieldexternalid"
		data-fieldexternalvalue="$fieldexternalvalue"
		data-clickurl="${page.directory}/generictablesavesubmodule.html"
		
		data-parentsearchtype="$!{parentsearchtype}"
		data-viewid="$!parentviewid"
		data-viewpath="$!parentviewpath"
		data-parentid="$!parentid"
		style="display: none;"
		>
		$pages.include("${page.directory}/generictablesearchresults.html?searchtype=${searchtype}&sortby=name&field=${fieldexternalid}&${fieldexternalid}.value=${fieldexternalvalue}&operation=not")
		
		<div class="clearfix"></div>
	</div>
	
	
	</div>
</div>	
