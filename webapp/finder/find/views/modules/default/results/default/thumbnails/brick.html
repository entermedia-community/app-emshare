#set($isselected = $hits.isSelectedOnPage(${hit.id}) )
$context.putPageValue("isselected", "isselected" )

#if(!$rendertype || $type =="rendertype")
	#set( $rendertype = "mime" )
#elseif( $rendertype =="video")
	#set( $rendertype = "image" )
#end


<div class="grid-cell-hover"></div>
#set($assetwidth = $mediaarchive.getRealImageWidth($hit)) 
$context.putPageValue("assetwidth",$assetwidth)	
#set($assetheight = $mediaarchive.getRealImageHeight($hit)) 
$context.putPageValue("assetheight",$assetheight)	

<div class='embrickcontent #if($rendertype=="audio") nothumb #end' 
	data-rowname="#text($hit)"
	data-dataid="$!{entityid}"
	data-entityid="$!{entityid}"
  	data-entitymoduleid="$!{moduleid}"
  	##data-rendertype="entity"
#if($assetwidth > 0)
	data-imgwidth="$!assetwidth"
	data-imgheight="$!assetheight"
#elseif($rendertype == "audio")
	data-imgwidth="250"
	data-imgheight="140"
#else 
	data-imgwidth="250"  ##moduleicon
	data-imgheight="140"
#end
>

<input type="checkbox" class="resultsselection selectionbox" name="count" id="sl-$!{hit.id}" value="$!{hit.id}" #if($isselected) checked #end data-dataid="${hit.id}"/>
<label class="selectionbox-label" for="sl-$!{hit.id}" title="$title ([[Click to select]])">
	<i class="bi bi-check-lg"></i>
</label>
##<div class="grid-gallery-checked"></div>

<div class="grid-thumbimage" data-assetid="$!{hit.id}" data-rendertype="$!rendertype">
	
	#if( $hit.previewstatus == "mime" || $alwaysmime)
		#set( $rendertype = "mime" )
	#end
		
	#if( ($hit.previewstatus != "2" && $hit.previewstatus != "mime" && $hit.previewstatus != "exif" && $hit.previewstatus != "1" && $hit.previewstatus != "generated") && !$mediaarchive.isCatalogSettingTrue("realtimethumbs"))
	 	$pages.include("$!{searchhome}/convertqueue/previewstatus.html?assetid=$!{hit.id}",$context)
	#else
		$pages.include("$!{searchhome}/thumbnails/${rendertype}.html", $context)
	#end
</div>

##Caption
<div class="stackedplayer draggholder grid-caption grid-caption-${rendertype} #if($rendertype=="default") grid-caption-show #end"
	data-assetid="$!{hit.id}" 
	title="$!title">
	#if($stackedfield)
		#set($title = $hit.get($stackedfield))
	#end

	#if(!$title)		         	
		#if( $hit.assettitle )
			#set($title =  $hit.assettitle) 
		#else 
			#set($title = $hit.name) 
		#end
	#end

	<div class="grid-caption-link">
		$context.putPageValue("data",$hit)	
		$context.putPageValue("searcher",$mediaarchive.getAssetSearcher() )	
		$context.putPageValue("viewid", "assetstackedgallery")
		$pages.include("/$applicationid/components/xml/detailviewer-stackedgallery.html", $context)
	</div>

	#if ($hit.assetaddeddate)
	<span class="date-preview">
			$!context.getDate($hit.assetaddeddate)
	</span>
	#end

	$pages.include("${searchhome}/badges.html", $context)
	<div class="grid-gallery-footer d-flex align-items-center justify-content-between"> 
		<div class="d-flex align-items-center"> 
			<div class="d-flex align-items-center ml-1">
				#if($canaddtofavorites)
					<div id="gsassetfavorite-$!{hit.id}" class="media-info-icons mr-1">
						$pages.include("$apphome/views/modules/asset/editor/favorite/index.html?targetdiv=gsassetfavorite", $context)
					</div>
				#end
				#if(($candownload || $canconvert || $candownloadfpo) && $canquickdownload)
					#set($dlink =  "$applink/views/modules/asset/activity/downloadassets.html")
					<a href="$dlink" data-dialogid="downloadfromassethover" class="emdialog mr-1" data-assetid="$hit.id" data-hidefooter="true" title="[[Download]] $!title">
						<i class="bi bi-download ns"></i>
					</a>
				#end
				#if($desktop)
					#ifnotnull($category)
						#set($dlink = $mediaarchive.asLinkToOriginal($hit))
						#set($dlink = "$siteroot/$mediadbappid/services/module/asset/downloads/originals/$dlink")
						<div class="open-file-default ml-1 mr-2" style="font-size:1.3rem" data-categorypath="$!category.getCategoryPath()" data-filename="$!{hit.name}" data-dlink='$!{dlink}' title="[[Open this file locally with your default application]]">
							<i class="bi bi-eye"></i>
						</div>
					#end
				#end
				
				#if($sortableassets)
					#if($hits.getSortBy().contains("ordering"))
					<a href="#" class="hitmovetotop mr-1" data-assetid="$!{hit.id}" title="[[Move to top]]">
						<i class="bi bi-arrow-up-circle ns"></i>
					</a>
					#end
				#end
			</div>
		</div>
	</div>
</div>

</div>