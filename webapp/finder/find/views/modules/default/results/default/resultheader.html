##Header for Modules (not asset)

#set( $searchhome = $context.findValue("searchhome") )

#set($moduleid = $module.id)
$context.putPageValue("moduleid", $moduleid)

#if(!$parentmoduleid)
	#set($parentmoduleid = $context.getRequestParameter("topmoduleid"))
#end
#set( $fieldexternalid = $context.getRequestParameter("fieldexternalid"))
#set( $fieldexternalvalue = $context.getRequestParameter("fieldexternalvalue"))
#ifnull($entityid)
	#set($entityid = $context.getRequestParameter("entityid"))
#end

#if(!$tabletype)
	#set($tabletype = $context.getRequestParameter("tabletype"))
#end

#set($resulttype = $userprofile.get("${moduleid}-display"))
#if(!$resulttype)
	#set($resulttype = "table")
#end
$context.putPageValue("resulttype", $resulttype)

#set( $edit = $context.getRequestParameter("editheader"))
#if( !$edit || $edit == "false")
	#set( $edit = false)
#end

#set($entityrendertype = "entity")
#if ($module.modulerendertype)
	#set($entityrendertype = $module.modulerendertype)
#end
$context.putPageValue("entityrendertype", $entityrendertype)

#set($defaultview = $userprofile.getDefaultViewForModule($module.id) )

#if(!$resultview)
	#set($resultview = $userprofile.get("$!{module.getId()}resultview"))
	
	#if (!$resultview)
		#set($resultview = $content.get("resultview"))
	#end
	#if (!$resultview)
		#set($resultview = "table")
	#end
#end

#set($preference = "minimize$!{moduleid}summary")
#set($isminimized = $userprofile.getBoolean($preference))
#set($showaddnew = $content.isPropertyTrue("showaddnew",true))
#if($content.section == "favorites")
	#set($showaddnew = false)
#end
<div id="resultsheader" class="resultsheader #if($!hits.getSelectionSize() > 0)hasselections#end">
	<div id="sub-nav" class="search-views emsubnav sub-nav-$!moduleid">
		<ul class="resultsnav">
			#set($pickertarget = $context.getRequestParameter("pickertarget"))
			#ifnull($pickertarget)
				#if($permissions.can($moduleid, "create") && $showaddnew)
					<li> 
						#ifnotnull($entity)
							#set($addnew = "${edithome}/addnew.html")
							<a href="$addnew"
							class="resultsnavlink emdialog btn-cta"
							data-dialogid="entitypickeraddnew"
							data-hidefooter="true"
							data-includeeditcontext="true"
							data-autosetformtargetdiv="editdiv"
							title="[[Create New]] #text($module)">
							<i class="bi bi-plus-lg mr-1"></i> [[Create New]]</a>
						#end
						
						#ifnull($entity)
							#set($addurl = "${edithome}/tabs/index.html?edit=true&addnew=true&viewid=$!{moduleid}addnew")
							<a href="$addurl"
								class="resultsnavlink emdialog btn-cta" 
								data-addnew="true"
								title="[[Add New Record]]">
								<i class="bi bi-plus-lg mr-1"></i> [[Create New]]
							</a>
						#end
	
					</li>
				#end
			#end
			#if($resultview != "grid")
			<li class="dropdown">
				<a class="resultsnavlink dropdown-toggle #if($!hits.getSelectionSize() > 0)btn-accent#end" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					#if($!hits.getSelectionSize() > 0)
						[[Folders]] ($!hits.getSelectionSize())
					#else
						[[Folders]]
					#end
				</a>
				<ul class="dropdown-menu">
				
							<li>
						<a class="dropdown-item  selectpage" 
						href="${searchhome}/togglepage.html"
						data-targetdiv="resultsheader"
						data-action="all"
						data-includesearchcontext="true"
						data-includeeditcontext="true"
						title="[[Select All results]]">[[Select All]]</a>
						</li>
						<li>				
						<a class="dropdown-item selectpage" 
						href="${searchhome}/togglepage.html"
						data-targetdiv="resultsheader"
						data-action="page"
						data-includesearchcontext="true"
						data-includeeditcontext="true"
						title="[[Select this page of results]]">[[Select Only This Page]]</a>
						</li>
						<li>
						<a class="dropdown-item  selectpage" 
						href="${searchhome}/togglepage.html"
						data-targetdiv="resultsheader"
						data-action="none"
						data-includesearchcontext="true"
						data-includeeditcontext="true"
						title="[[Deselect all results]]">[[Select None]]</a>
						</li>
					
				#if( $!hits.getSelectionSize() > 0)
					
					#if($permissions.can($moduleid, "edit"))
					#set($previewediturl = "${edithome}/tabs/index.html?entityid=multiedit:$!hits.sessionId&hitssessionid=$!hits.sessionId&searchtype=$moduleid&edit=true")
					<li><a class="dropdown-item emdialog" 
						href="$previewediturl"
						title="[[Multi edit selected items]]">[[Bulk Edit]] $!hits.getSelectionSize() [[Records]]</a>
					</li>
					#end
					
					#ifnull($tabid)
					#set($tabid = $context.getRequestParameter("tabid"))
					#end
					#ifnull($viewid)
					#set($viewid = $context.getRequestParameter("viewid"))
					#end
					
					#if($permissions.can($moduleid, "delete"))
						 <li><a class="dropdown-item ajax" 
						 data-confirm="[[Delete items?]]" 
						 #if($tabletype=="subentity")
							 data-oemaxlevel="2" 
							 data-targetdiv="$tabid" 
							 data-tabletype="$tabletype"
							 data-viewid="$viewid"
							 data-entityid="$entityid"
							 href="${edithome}/actions/deleteselections.html?hitssessionid=$hits.sessionId"
						 #else
							 data-oemaxlevel="3" 
							 data-targetdiv="resultsdiv" 
							 href ="${edithome}/actions/deleteselections.html?hitssessionid=$hits.sessionId"
						 #end
						 title="[[Delete selected items]]">[[Delete]] $!hits.getSelectionSize() [[Records]]</a></li>
					#end
					
					<li class="dropdown-submenu">
						<a class="dropdown-item  dropdown-toggle" href="#" data-bs-toggle="dropdown">[[Export]]</a>
							<ul class="submenu dropdown-menu">
								<li><a class="dropdown-item" href="$!{siteroot}${apphome}/views/modules/${moduleid}/export/download/export_${moduleid}.csv?hitssessionid=$hits.sessionId"
									title="[[Export reults to CSV]]">[[Export]]  $!hits.getSelectionSize() [[Records Using IDs]]</a></li>
								<li><a class="dropdown-item" href="$!{siteroot}${apphome}/views/modules/${moduleid}/export/download/export_${moduleid}.csv?hitssessionid=$hits.sessionId&friendly=true&view=${moduleid}/${moduleid}resultstable"
									title="[[Export results to CSV (Friendly)]]">[[Export]] $!hits.getSelectionSize() [[Records Using Text]]</a></li>
							</ul>
					</li>
					
					

				#if($permissions.can("searchcategory", "create"))
					#set($edithome = "$apphome/views/modules/${module.id}/editors/picksearchcategory")
					#set($addurl = "$!{edithome}/index.html") 
					<li><a 
					class="dropdown-item emdialog" 
							href="$addurl" 
							data-dialogid="pickeraddnew" ##This is the same as the ADD new dialog
							data-copyingsearchtype="$module.id"
							data-copyinghitssessionid="$hits.getSessionId()"	
							data-originaledithomeid="${edithomeid}"
							title="[[Add To Category]]"
							data-width="1200"><i class="bi bi-category mr-2"></i>[[Assign]] #text( $mediaarchive.getCachedData("module","searchcategory") )</a></li>
			 	#end	
			#end ##Selection					
			
			</ul>
		</li>
		#end
				
			#if($resultview == "grid")
				#if($hits.getTotalPages() >  1  )
					$pages.include("${apphome}/views/modules/${moduleid}/navigate.html", $context)
				
				#end
			#end
				
			#if($moduleid != "faceprofilegroup")
				#if(!$edit)
				
					#if($hits && $resultview == "table" && $hits.hasSelections())
					
						$pages.include("${searchhome}/selectionactions.html", $context)
					#end
				#end
			#end
			
		</ul>
			
		#if($hits)
			<ul class="resultsnavright">
				#if($edit != "true")
					#set($total = $hits.getTotalPages() )
					#if( $total > 1)
							$pages.include("${searchhome}/positions.html", $context)
					#end
				#end

				#if (!$resultview || $resultview == 'table')
					#if($canedittablecolumns)
						#if($edit)
							<li class="resultsnavitem s2h" style="min-width:180px">
								#set ($alldetails = $searcher.getUserPropertyDetails() )
								<select class="form-control form-control-sm select2 tableresultsaddcolumn" 
										name="addcolumn"
										data-componenthome="${searchhome}/addremovecolumns.html?searchtype=$!moduleid&${hits.getSearchType()}hitssessionid=$hits.getSessionId()&editheader=true&moduleid=$!moduleid&viewid=$!{moduleid}resultstable"
										data-targetdiv="$!{moduleid}resultsarea"
										data-oemaxlevel="1" 
										data-allowclear="false" 
									>
									<option>[[Add Column]]</option>
									#foreach( $detail in $alldetails) 
										<option value="$detail.id">$detail.getText($context)</option>
									#end
								</select>
								##<span class="hint">*[[Drag columns to move them]]</span>
								<a href="${searchhome}/resetcolumns.html?searchtype=$!moduleid&${hits.getSearchType()}hitssessionid=$hits.getSessionId()&moduleid=$!moduleid&viewid=$!{moduleid}resultstable&$!{moduleid}clearresults=true"
									data-targetdiv="$!{moduleid}resultsarea"
									data-oemaxlevel="1"
									data-confirm="[[Are you sure you want to reset all columns?]]"
									class="ajax reset-columns">
									<i class="bi bi-arrow-counterclockwise mr-1"></i>
									[[Reset Columns]]
								</a>
							</li>
							##Close Icon
						#end	
					#end								
				#end
				
				<li>

					<a href="${searchhome}/filters/dialogsort.html" 
						class="emdialog emsort #if($isminimized) closed #end"
						data-dialogid="sortdialog"
						data-hidebackdrop="true"
						data-hidefooter="true"
						data-modalsize="sm"
						data-includesearchcontext="true"						
						data-includeeditcontext="true"
						style="padding:0 8px 0 10px;" 
						title="[[Sort Results]]"><i class="bi bi-sort-down"></i> [[Sort]]</a>
				</li>
				#if($resultview != "stackedgallery")
					<li class="resultsnavitem rpp" title="[[Results per page]]">
						#set( $currenthitsperpage = $hits.getHitsPerPage())
						#set($hitcountoptions = $mediaarchive.getList("hitcount"))
						<select class="form-control hitsperpagechange" 
								id="hitsperpagechange$!{moduleid}"
								data-allowclear="false">
							#foreach($ho in $hitcountoptions)
								<option value="$ho.id" #if($currenthitsperpage==$ho.id) selected="selected"#end>#text($ho)</option>
							#end	
						</select>
					</li>		
				#end
				
				#ifnull($isminimized)
					#set($isminimized = false)
				#end
				<li class="resultsnavitem" style="border: none;">
					<button class='btn summary-toggler summary-opener #if(!$isminimized) closed #end' data-target="$preference">
						<i class="fas fa-angle-double-left"></i> [[Summary]]
					</button>
				</li>
			</ul>
		#end
	</div>
	#if($content.section != "favorites")
		$pages.include("${searchhome}/filters/filters-inline.html", $context)
	#end
</div>

