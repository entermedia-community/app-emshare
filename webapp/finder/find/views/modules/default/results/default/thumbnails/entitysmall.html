#set($entity = $hit)
#set($entityid = $hit.id)

#set( $moduleid = $hit.entitysourcetype )
#ifnotnull($moduleid)
	#set( $module = $mediaarchive.getCachedData("module",$moduleid) ) 	
#end


#set($previewurl = "$apphome/views/modules/${moduleid}/editors/default/tabs/index.html?entityid=$entityid")
 <div class="emfolder-wrapper compact emgrid-type-$!moduleid entitycontainer entity$!moduleid$!entityid" 
	id="emgridentity$!moduleid$!entityid"
	data-id="${entityid}"
  data-moduleid="$!moduleid"
  data-rendertype="entity">

	<a 
		#ifnull($picker.getTargetType())
			id="clickid${entityid}"  
			href="$!{previewurl}" 
			class="emdialog entity-dialog"
		#end
		data-updateurl="true"
		data-urlbar="$!{siteroot}$apphome/views/modules/$!{moduleid}/index.html?entityid=$entityid"
		data-hidefooter="true" 
		data-hideheader="true" 
		data-categorypath="$!entity.sourcepath"
		data-id="${entityid}"
		data-moduleid="$!moduleid" 
		title="[[View]]: #text($!entity)">
	
		##look for primaryimage
		#set( $primarymediafield = $entity.primarymedia )
		
		#if($primarymediafield)
			#set( $primarymediatemp = $mediaarchive.getCachedAsset($entity.primarymedia))
				#ifnotnull($primarymediatemp)
					#set($rendertype = $mediaarchive.getMediaRenderType($primarymediatemp.fileformat))
					#if($rendertype != 'audio')				
						#set($primarymedia = $primarymediatemp)
					#end
			#end
		#end
		
		#ifnull($primarymedia)
			#set( $primarymediafield = $entity.primaryimage )
			#if($primarymediafield)
				#ifnotnull($entity.primaryimage)
						#set( $primarymediatemp = $mediaarchive.getCachedAsset($entity.primaryimage))
						#set($rendertype = $mediaarchive.getMediaRenderType($primarymediatemp.fileformat))
						#if($rendertype != 'audio')
							#set($primarymedia = $primarymediatemp)
						#end
				#end
			#end
		#end	

		
		$context.putPageValue("type", $rendertype)
	   	#set($link = "$!siteroot$applink/views/modules/$!topmodule.getId()/index.html")
		#if( $parentmodule == $module)
			#set($link = "$link?entityid=$!entity.getId()&entitytype=$!moduleid&topentityid=$!entity.getId()")
		#else
			#set($link = "$link?entityid=$!entity.getId()&entitytype=$!moduleid&topentityid=$!topentityid")
		#end
		#set($moduleicon = "grid")
		#if ($module.moduleicon)
			#set($moduleicon = $module.moduleicon)
		#end
		<div 
			class="emfolder-inner" 
			id="attachedmedia$entityid" 
			data-moduleid="$!moduleid" 
			data-entityid="$!entityid" 
			data-assetsshown="$!assetsshown"
			data-attachedmediaurl="${edithome}/types/entityfolder.html"
			data-targetdiv="emgridentity$!moduleid$!entityid">
			<div class="emfolder-icon">
				#if($primarymedia)
					$context.putPageValue("thumbsize", "thumbnail" )
					$context.putPageValue("hit", $primarymedia) 
					$context.putPageValue("asset", $primarymedia)
					#set( $assetrendertype = $mediaarchive.getMediaRenderType($primarymedia.fileformat))
					
					#if($module.id == "faceprofilegroup")
						$context.putPageValue("faceprofilegroups", [$entity]) 
					#end

					#set($searchhome = "${apphome}/views/modules/asset/results/default")
					$context.putPageValue("searchhome", $searchhome)
					$pages.include("${searchhome}/thumbnails/${assetrendertype}.html", $context)
			  #else
					<i class="bi bi-$moduleicon module-icon"></i> 
			  #end
			</div>
			<div class="emfolder-text">
				<i class="bi bi-$moduleicon module-icon"></i>
				<span>#text($!entity)</span>
			</div>
			#if($picker.getTargetType() == "entity")
				<div class="pickfromiframe entity" 
					data-entityid="${entityid}" 
					data-moduleid="${moduleid}"
					#if($primarymedia) data-primarymedia="$primarymedia.getId()" #end
					>
					<i class="bi bi-check2-circle"></i>
				</div>
			#end
		</div>
	</a>
</div>


