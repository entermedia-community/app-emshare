#set( $moduleid = $hit.entitysourcetype )
#ifnotnull($moduleid)
	#set( $module = $mediaarchive.getCachedData("module",$moduleid) ) 	
#end
	 
##look for primaryimage
#if($entity.primarymedia)
	#set( $primarymediatemp = $mediaarchive.getCachedAsset($entity.primarymedia))
		#ifnotnull($primarymediatemp)
			#if($primarymediatemp.previewstatus == '2')				
				#set($primarymedia = $primarymediatemp)
			#end
	#end
#end
#ifnull($primarymedia)
	#set( $primarymediafield = $entity.primaryimage )
	#if($primarymediafield)
		#ifnotnull($entity.primaryimage)
				#set( $primarymedia = $mediaarchive.getCachedAsset($entity.primaryimage))
				#if($primarymedia.previewstatus == '2')
					##break
				#else
					#set($primarymedia = '')
				#end
		#end
	#end
#end	

#set($moduleicon = "grid")
#if ($module.moduleicon)
	#set($moduleicon = $module.moduleicon)
#end 

#set( $entityid = $hit.id )

<div class="resultsdivdata emcategory-wrapper #ifnull($primarymedia) nothumb #end emgrid-type-$!moduleid entitycontainer entity$!moduleid$!entityid" 
	id="emgridentity$!moduleid$!entityid"
	data-rowname="#text($hit)"
	data-dataid="${entityid}"
	data-entityid="${entityid}"	
  data-entitymoduleid="$!{moduleid}"
  data-rendertype="entity"
>

	#set($pickertarget = $context.getRequestParameter("pickertarget"))
	<div class="emcategory-inner" 
		id="attachedmedia$entityid" 
		data-moduleid="$!moduleid" 
		data-entityid="$!entityid" 
		data-assetsshown="$!assetsshown"
		data-attachedmediaurl="${edithome}/types/entityfolder.html"
		data-targetdiv="emgridentity$!moduleid$!entityid">
		<div class="emcategory-thumb">
			#if($primarymedia)

				#set($assetwidth = $mediaarchive.getRealImageWidth($primarymedia)) 
				#set($assetheight = $mediaarchive.getRealImageHeight($primarymedia)) 
				<div class="imgDim d-none" data-width="$assetwidth" data-height="$assetheight"></div>
				
				$context.putPageValue("thumbsize", "thumbnail" )
				$context.putPageValue("hit", $primarymedia) 
				#set( $assetrendertype = $mediaarchive.getMediaRenderType($primarymedia.fileformat))
				$context.putPageValue("searchhome", "${apphome}/views/modules/asset/results/default")
				$pages.include("${apphome}/views/modules/asset/results/default/thumbnails/${assetrendertype}.html", $context)
			#else
				<i class="bi bi-${moduleicon} module-icon"></i>			
			#end 
			<div class="emthumb-mask">
				<span>
					<i class="bi bi-search ns mr-1"></i> [[Explore]]
				</span>
			</div>
		</div>
		<div class="emcategory-name">	
			<p>
				#text($!entity) 	
			</p>
			#if($moduleid == "searchcategory" && $permissions.can($module.id, "edit"))
			<a href="$apphome/views/modules/$moduleid/editors/default/tabs/index.html?edit=true" data-entityid="${entityid}" class="emdialog emcategory-edit">
				<i class="bi bi-pencil-square"></i>
			</a>
			#end
		</div>
		#ifnotnull($entity.longcaption)
		<div class="emcategory-desc">
			<p>$entity.longcaption</p>
		</div>
		#end
	</div>
</div>
