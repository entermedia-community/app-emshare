#set( $viewid = $context.getRequestParameter("viewid"))
#set( $assettype = $context.getRequestParameter("assettype"))
#if (!$assettype)
	#set($assettype = "default")
#end
#set( $viewsearcher = $searcherManager.getSearcher($catalogid, "view"))
#set ( $systemdefined = "false" )
#set( $systemdefined = $context.findValue("systemdefined") )
#set( $moduleid = $context.findValue("module") )     

#set( $query = $viewsearcher.createSearchQuery().append("moduleid",$moduleid).append("systemdefined",$systemdefined) )
$!query.addSortBy("ordering")
#set( $views = $viewsearcher.search($query))
#set( $viewsroot = $content.viewsroot )

<ul data-path="$siteroot$viewsroot/moveviews.html?searchtype=view&field=ordering&sortprefix=view_" 
	class="emsettingslist listsort" 
	data-searchtype="view" 
	data-field="ordering">
    <li class="header no-sort d-flex align-items-center justify-content-between py-0" style="height: 46px;">
        <span>[[Editing Boxes]]</span>
        #if ($systemdefined != "true")
            <a class="btn btn-accent toggleAjax" 
                data-targetdivinner="addeditbox"
                data-focusparent="emsettingslist"
                href="$siteroot$viewsroot/addneweditingbox.html?oemaxlevel=1">
                [[Add New]]
            </a>
        #end      
    </li>
    <li id="addeditbox" class="no-sort"></li>
    #foreach( $target in $views)
	    #set($sortid = $target.id) ##.replaceAll("_", "||"))
        <li id="$sortid" data-ordering="${target.ordering}" class="#if($viewid == $target.id) current #end" byassettype="$!target.byassettype">
        	#if( ($target.byassettype && $target.byassettype == "true") )
            	#set( $viewpath = "${moduleid}/assettype/${assettype}/$target.id")
            #else
                #set( $viewpath = "${moduleid}/$target.id")
            #end
            <a class="sortableitem ajax" 
            	data-targetdiv="settingsmaincontent"
            	data-oemaxlevel="2"
            	href="$siteroot$viewsroot/index.html?viewid=$target.id&viewpath=$viewpath&assettype=$!assettype"
            	title="Id: $target.id">
            <span class="drag-and-drop"></span>$context.getText($target.toString())
            </a>
            
            <a class="ajax delete-row" data-targetdiv="viewlist" href="$siteroot$viewsroot/deleteview.html?searchtype=${moduleid}&id=${target.id}&viewpath=$viewpath&assettype=$!assettype">
			<i class="fas fa-times"></i></a>
        </li>
    
    #end            
                        
    </ul>