#set($currentrole = $context.getRequestParameter("settingsgroupid")) 
#set($permissiontype = $context.getRequestParameter("permissiontype")) 
#set ($roleSearcher = $searcherManager.getSearcher($catalogid, "settingsgroup"))

#set( $moduleid = $module.getId() )

<div class="tab-actions" >
    <strong> [[Choose Role]]:</strong> 
        <select id="roles" style="position: relative; top: 2px; margin-left: 5px;">
            <option value=""></option>
       #foreach($settingsgroup in $roleSearcher.fieldSearch("id", "*", "textUp"))
           <option #if($currentrole == $settingsgroup.id) selected #end value="$settingsgroup.id">$settingsgroup</option>
       #end
    </select>
    
    <script>
        $("select#roles").change(function () {
           var val = $(this).val();
           if ( val == "new" ) {
              $("#permissions-div").load("$siteroot$apphome/views/settings/modules/$moduleid/permissions/views/addnew.html?oemaxlevel=1&groupname=New", function(){
            	  $(window).trigger( "resize" );
              });
              $('#module-picker').hide();
           }
           else {
              $("#permissions-div").load("$siteroot$apphome/views/settings/modules/$moduleid/permissions/views/index.html?oemaxlevel=1&permissiontype=$!permissiontype&settingsgroupid=" + val, function(){
            	  $(window).trigger( "resize" );
              });
              $('#module-picker').show();
           }
        });
    </script>
    
    
        
        <script>
            $("#module-picker select").change(function () {
               var rolesval = $('select#roles').val();
               var val = $(this).val();
               if ( val == "all" ) {
              //    $("#permissions-div").load("./views/index.html?oemaxlevel=1&settingsgroupid=" + rolesval);
              jQuery(".togglesection").show();
               }
               else {
            	   jQuery(".togglesection").hide();
            	   jQuery("."+ val).show();
                //  $("#permissions-div").load("./views/index.html?oemaxlevel=1&settingsgroupid=" + rolesval + "&permissiontype=" + val);
               }
            });
        </script>   
    </span>
     
</div>


#if( $currentgroup)
	#set($currentgroup = $context.getRequestParameter("settingsgroupid"))
	
	#set ($profilesearcher = $searcherManager.getSearcher($catalogid, "userprofile"))
	#set($users = $profilesearcher.fieldSearch("settingsgroup", $currentgroup))
	
	#if($users.size() > 0)
	<br>
	
	<h3>[[Users in the group]]</h3>
	
	
	<ul class="vlist">
	#foreach($hit in $users)
		#set($target = $userManager.getUser($hit.userid))
		#set($url = "$siteroot$apphome/views/settings/usermanager/user/index.html?userid=${target.id}")
	 <li>
	 <a target="_blank" href="$url">$target</a></li>
	#end
	</ul>
	

	#end
#end

<div id="permissions-div">
$pages.includeContent()
</div>
