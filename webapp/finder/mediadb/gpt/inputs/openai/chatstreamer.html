#set($systeminfo = $gpt.loadInputFromTemplate($context, "/$mediaarchive.getMediaDbId()/gpt/systemmessage/entermediachat.html"))
{
	"model": "$model",
	"stream": false,
	"messages": [
		{
			"role": "system",
			"content": #jesc($systeminfo)
		},
		#foreach($message in $recent)
			
			#if($foreach.count != 1)
			,
			#end

			{
				#if($message.messagetype == "function_call")				
					"role": "function",	
					"name" : "$message.function",					
				#elseif($message.user == "agent")
					"role": "assistant",
				#else
					"role": "user",
				#end
					"content": #jesc("$!message.message $!message.functionresponse $!message.arguments")
			}
		#end		
	]
	,
	"functions": [
		{
			"name": "showHintOrHelpInfo",
			"description": "Shows hints on how to properly use the search function and provides examples. Used for questions like: 'What can you do?', 'How can I search using this tool?', 'Give me example of some search queries'."
		},
		{
			"name": "parseSentence",
			"description": "Breaks a sentence into structured parts. Used for understanding user queries and extracting sentence type, intended action, keywords, filters, and targets.",
			"parameters": {
				"type": "object",
				"properties": {
					"sentence_type": {
						"type": "string", 
						"enum": ["search", "command", "analyze_image", "analyze_video", "analyze_audio", "create_image"],
						"description": "The type of sentence"
					},
					"action": {
						"type": "string", 
						"description": "The action to perform"
					},
					"keywords": {
						"type": "array",
						"items": {"type": "string"},
						"description": "The exact keywords to search for, such as name of the person or file, tags, phrase or concept"
					},
					"strict": {
						"type": "boolean",
						"description": "Whether to apply strict filtering to the search, true means only exact matches will be considered, false means partial matches are allowed."
					},
					"filters": {
						"type": "array",
						"items": {"type": "string"},
						"description": "The filters to apply to the search, such as media type, upload date, etc."
					},
					"targets": {
						"type": "array",
						"items": {"type": "string"},
						"description": "The targets to search within, such as modules, categories, departments, etc."
					}
				}
			}
    }
		#*
		{
			"name": "searchByType",
			"description": "Search with one or more keywords in one or more types. Keywords can be mutually exclusive or inclusive depending on their phrasing. For example: \"search fils containing any of the words 'red' and 'blue'\" is an exclusive search; \"search fils containing all of the words 'red' and 'blue'\" is an inclusive search. If not specified, exclusive search will be used. If types are not specified, all types will be searched. Types may have conjunction too, ignore it.",
			"parameters": {
					"type": "object",
					"properties": {
							"keywords": {
									"type": "array",
									"description": "The keywords to search for",
									"items": {
											"type": "string"
									}
							},
							"conjunction": {
									"type": "string",
									"description": "The conjunction to use. Inclusive if user asks to search with all of the keywords. Exclusive if user asks to search with any of the keywords. Default value 'exclusive' if conjunction is not specified.",
									"enum": [
											"exclusive",
											"inclusive"
									]
							},
							"types": {
									"anyOf": [
										{
											"type": "string",
											"enum": ["all"],
											"description": "Search all types. Default value if types are not specified."
										}
								#foreach($module in $chatprofile.getEntities())
									#if($module.getBoolean("showonsearch"))
										,
										{
											"type": "string",
											"enum": ["${module.id}", "${module.name}"],
											"description": #jesc("This is ${module.name} type.#ifnotnull($module.aisearch_contains) This type includes ${moduleProp.aisearch_contains}#end")
										}
									#end
								#end
									]
							}
					},
					"required": [
						"keywords"
					]
			}
		}
		*#
	],
	"function_call": "auto"
}