#set($systeminfo = $gpt.loadInputFromTemplate($context, "/$mediaarchive.getMediaDbId()/gpt/systemmessage/entermediachat.html"))
{
	"model": "$model",
	"stream": false,
	"messages": [
		{
			"role": "system",
			"content": #jesc($systeminfo)
		},
		#foreach($message in $recent)
			
			#if($foreach.count != 1)
			,
			#end
			{
				#if($message.messagetype == "function_call")				
					"role": "function",	
					 "name" : "$message.function",					
				#elseif($message.user == "agent")
					"role": "assistant",
				#else
					"role": "user",
				#end
					"content": #jesc("$!message.message $!message.functionresponse $!message.arguments")
			}
		#end		
	]
	,
	"functions":[
		##$gpt.loadInputFromTemplate($context, "/$mediaarchive.getMediaDbId()/gpt/functiondefs/checkweather.json"),
		#foreach($module in $chatprofile.getEntities())    
			#if($module.showonsearch =="true")                    	
				$context.putPageValue("module",$module)
				$gpt.loadInputFromTemplate($context, "/$mediaarchive.getMediaDbId()/gpt/functiondefs/search-moduletemplate.json"),
			#end
		#end
		
		$gpt.loadInputFromTemplate($context, "/$mediaarchive.getMediaDbId()/gpt/functiondefs/emediasearchformat.json"),
		
		$gpt.loadInputFromTemplate($context, "/$mediaarchive.getMediaDbId()/gpt/functiondefs/emediasearchall.json")					
						
	],
	"function_call": "auto"
	
}