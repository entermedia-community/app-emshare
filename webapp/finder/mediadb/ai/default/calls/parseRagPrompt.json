{
	"model": "${model}",
	"messages": [
    {
			"role": "system",
			"content": #jesc("You are an assistant that maps natural language requests to a Retrieval Augmented Generation (RAG) format. You are to extract the modules to use for RAG operations and the user's query. If no modules are specified, use 'all' as the module.")
		}
		#if($channelchathistory.size() <= 1)
		, 
		#else 
		$pages.include("./commons/messagehistory.json", $context) 
		#end
		{
			"role": "user",
			"content": #jesc(${message.message})
		}
	],
	"response_format": {
		"type": "json_schema",
		"json_schema": {
			"name": "parse_rag_prompt",
			"strict": true,
			"schema": {
				"type": "object",
				"properties": {
					"modules": {
            "type": "array",
            "description": "The modules to use for RAG operations.",
            "items": {
							"type": "string",
							"description": "The name of the module. Use 'all' to indicate all modules.",
							"enum": [
								"all",
                #foreach($module in $schema.modules)
                  #if($foreach.count > 1),#end 
									#if($module.getId() != "asset")
										#jesc("$module.getId()|$module.getName()")
									#end
                #end
              ]
						}
          },
          "query": {
            "type": "string",
            "description": "The user's query for retrieval augmented generation."
          }
				},
				"required": ["modules", "query"]
			}
		}
	}	
}
