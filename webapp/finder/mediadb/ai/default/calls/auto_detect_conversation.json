{
	"model": "${model}",
	"messages": [
		{
			"role": "system",
			"content": "You are a helpful assistant that can automatically detect what type of conversation is taking place based on the user's input. Your task is to analyze the provided context and determine the most appropriate conversation type from a predefined tools list.\n\nYou are able to select one of the following tools:\n\n1. create_tutorial: Use this tool when the user is trying to create a tutorial or instructional content.\n2. start_tutorial: Use this tool when the user is beginning a tutorial or instructional content.\n3. ask_questions: Use this tool when the user is asking questions or seeking information.\n4. image_creation: Use this tool when the user is requesting the creation of an image.\n5. general_chat: Use this tool for general conversations that do not fit into specific categories.\n\nBased on the user's input, choose the most appropriate tool and provide the necessary parameters as specified in the tools list."
		},
		{
			"role": "user",
			"content": "$userquery"
		}
	],
	"tools": [
		$context.putPageValue("createtype", "tutorial")
		$pages.include("./toplevel/smartcreator_create.json", $context)
		,
		{
			"type": "function",
			"function": {
				"name": "ask_questions",
				"description": "Use this tool when the user is asking questions or seeking information.",
				"parameters": {
					"type": "object",
					"properties": {
						"question": {
							"type": "string",
							"description": "The specific question being asked by the user."
						}
					},
					"required": ["question"]
				}
			}
		},
		{
			"type": "function",
			"function": {
				"name": "image_creation",
				"description": "Use this tool when the user is requesting the creation of an image",
				"parameters": {
					"type": "object",
					"properties": {
						"image_name": {
							"type": "string",
							"description": "The name or description of the image to be created."
						},
						"prompt": {
							"type": "string",
							"description": "The prompt or details for generating the image."
						}
					},
					"required": ["image_name", "prompt"]
				}
			}
		},
		{
			"type": "function",
			"function": {
				"name": "general_chat",
				"description": "Use this tool for general conversations that do not fit into specific categories.",
				"parameters": {
					"type": "object",
					"properties": {
						"friendly_response": {
							"type": "string",
							"description": "A friendly response to keep the conversation going and asking user to be more specific."
						}
					},
					"required": ["friendly_response"]
				}
			}
		},
		{
			##TODO: addd message ihistory
			"type": "function",
			"function": {
				"name": "search_tables",
				"description": 	#jesc("Use this tool to search as a search assistant that maps natural language requests to a logical steps that could be executed as sequential database or API operations. 

				You will first determine the next step, which is one of these values: 'conversation' and 'parseSearchParts'.
				If not clear which step to select, use 'conversation' and ask for clarification.

				Based on the selected next_step, fill respective field in step_details:
				if next_step is conversation, step_details must have conversation object
				if next_step is parseSearchParts, step_details must have parseSearchParts object.
				"),
				"parameters": {
					"type": "object",
					"properties": {
						"step_details": {
								"type": "object",
								"description": "Details about the selected step.",
								"properties": {
									"conversation": $pages.include("./parsefunctions/conversation.json", $context),
									"parseSearchParts": $pages.include("./parsefunctions/parseSearchParts.json", $context)
								}
							}
					},
					"required": ["friendly_response"]
				}
			}
		}
	],
	"tool_choice": "required"
}
