$context.putPageValue("aicommandprefix", "Analyze the following text that was extracted from a document and generate appropriate values for its missing metadata fields.\n\nText Content: $textcontent\n\n")

{
	"model": "${model}",
	"messages": [
		{
			"role": "system",
			"content": "You are a metadata analysis assistant. Analyze the provided fields values to generate appropriate values for its missing metadata fields."
		},
		{
			"role": "user",
			"content": $pages.include("./commons/context_fields.json", $context)
		}
	],
	"tools": [
		{
			"type": "function",
			"function": {
				"name": "generate_metadata_document",
				"description": "Generates metadata for a document",
				"parameters": {
					"type": "object",
					"properties": {
						"metadata": {
							"type": "object",
							"properties": {
						#foreach($field in $aifields)
							#if($foreach.count>1)
							,
							#end
							#if($field.isList())
								"$field.id": {
									"type": "string",
									"description": "#jrender($field.aicreationcommand)",
									"enum": [
										#foreach( $option in $mediaarchive.getList($field.getListId()) )
											#if($foreach.count>1)
											,
											#end
											#jesc("$option.id|#text($option)")
										#end
									]
								}
							#else
								"$field.id": {
									"type": "string",
									"description": "#jrender($field.aicreationcommand)"
								}
							#end
						#end
							},
							"additionalProperties": false,
							"required": [
						#foreach($field in $aifields)
							#if($foreach.count>1)
							,
							#end
								"$field.id"
						#end
							]
						}
					},
					"additionalProperties": false,
					"required": ["metadata"]
				}
			}
		}
	],
	"tool_choice": "required"
}
