{
	"model": "${model}",
	"messages": [
    {
			"role": "system",
			"content": #jesc("You are an assistant that maps natural language requests to a request type and request details object. 

You will first determine the next step, which is one of these values: 'conversation', 'searchByKeywordForQuestioning'.
If not clear which step to select, use 'conversation' and ask for clarification.

Based on the next_step, fill respective field in step_details:
if next_step is conversation, step_details must have conversation object
if next_step is searchByKeywordForQuestioning, step_details must have searchByKeywordForQuestioning object.
")
		}
		#if($channelchathistory.size() <= 1)
		, 
		#else 
		$pages.include("./commons/messagehistory.json", $context) 
		#end
		{
			"role": "user",
			"content": #jesc(${message.message})
		}
	],
	"response_format": {
		"type": "json_schema",
		"json_schema": {
			"name": "start_question_parsing",
			"strict": true,
			"schema": {
				"type": "object",
				"properties": {
					"next_step": {
						"type": "string",
						"enum": ["conversation", "searchByKeywordForQuestioning"],
						"description": "The type of request being made."
					},
					"step_details": {
						"type": "object",
						"description": "Details about the request, specific to the next_step.",
						"properties": {
							"conversation": $pages.include("./parsefunctions/conversation.json", $context),
							"searchByKeywordForQuestioning": $pages.include("./parsefunctions/searchByKeywordForQuestioning.json", $context)
						}
					}
				},
				"required": ["next_step", "step_details"]
			}
		}
	}	
}
